/*! genome-viewer June 22, 2016 15:43:59 */
function Region(a){this.chromosome=null,this.start=null,this.end=null,_.isObject(a)?this.load(a):_.isString(a)&&this.parse(a)}function Grid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("Grid"),this.grid=null,this.store=null,this.model=null,_.extend(this,a)}function FeatureBinarySearchTree(){this._root=null}function FileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FileWidget"),this.targetId,this.wum=!0,this.tags=[],this.viewer,this.title,this.dataAdapter,this.args=a,_.extend(this,a),this.on(this.handlers)}function BEDFileWidget(a){null==a&&(a=new Object),a.title="BED",a.tags=["bed"],FileWidget.prototype.constructor.call(this,a)}function GFFFileWidget(a){null==a&&(a={}),this.version="2",null!=a.version&&(this.version=a.version),a.title="GFF"+this.version,a.tags=["gff"],FileWidget.prototype.constructor.call(this,a)}function GTFFileWidget(a){null==a&&(a=new Object),a.title="GTF",a.tags=["gtf"],FileWidget.prototype.constructor.call(this,a)}function TrackSettingsWidget(a){this.id="TrackSettingsWidget"+Math.round(1e4*Math.random()),"undefined"!=typeof a&&(this.trackSvg=a.trackSvg||this.trackSvg,this.treeRecord=a.treeRecord||this.treeRecord),this.filtersConfig=this.trackSvg.getFiltersConfig(),this.filters=this.trackSvg.getFilters(),null!=this.filtersConfig&&this.draw()}function UrlWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("UrlWidget"),this.targetId=null,this.title="Custom url",this.width=500,this.height=400,_.extend(this,a),this.on(this.handlers)}function VCFFileWidget(a){null==a&&(a=new Object),a.title="VCF",a.tags=["vcf"],FileWidget.prototype.constructor.call(this,a)}function InfoWidget(a,b,c){switch(this.id="InfoWidget_"+Math.round(1e7*Math.random()),this.targetId=null,this.species=b,this.title=null,this.featureId=null,this.width=800,this.height=460,this.feature=null,this.query=null,this.adapter=null,null!=a&&(this.targetId=a),null!=c&&(null!=c.title&&(this.title=c.title),null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height)),Utils.getSpeciesCode(b.text)){case"hsapiens":this.ensemblSpecie="Homo_sapiens",this.reactomeSpecie="48887",this.wikipathwaysSpecie="Homo+sapiens",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie="";break;case"mmusculus":this.ensemblSpecies="Mus_musculus",this.reactomeSpecies="48892",this.wikipathwaysSpecie="Mus+musculus",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie="";break;case"drerio":this.ensemblSpecie="Danio_rerio",this.reactomeSpecie="68323",this.wikipathwaysSpecie="Danio+rerio",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie=""}this.notFoundPanel=Ext.create("Ext.panel.Panel",{id:this.id+"notFoundPanel",cls:"ocb-border-left-lightgrey",border:!1,flex:3,bodyPadding:"40",html:"No results found"})}function GeneInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Gene Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function GeneOrangeInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Gene Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function MirnaInfoWidget(a,b,c){null==c&&(c=new Object),c.title="miRNA Information",InfoWidget.prototype.constructor.call(this,a,b,c)}function ProteinInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Protein Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function SnpInfoWidget(a,b,c){null==c&&(c=new Object),c.title="SNP Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function TFInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcription Factor Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function TranscriptInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcript",InfoWidget.prototype.constructor.call(this,a,b,c)}function TranscriptOrangeInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcript",InfoWidget.prototype.constructor.call(this,a,b,c)}function VCFVariantInfoWidget(a,b,c){null==c&&(c=new Object),c.title="VCF variant Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function ConsequenceTypeFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("ConsequenceTypeFilterFormPanel"),this.target,this.height=400,this.title="Consequence Type",this.border=!1,this.autoRender=!0,this.collapsible=!0,this.titleCollapse=!1,this.collapsed=!1,this.headerConfig,this.consequenceTypes=[],this.fields=[{name:"name",type:"string"},{name:"acc",type:"string"}],this.columns=[{xtype:"treecolumn",flex:2,sortable:!1,dataIndex:"name",tooltipType:"qtip"},{text:"",flex:1,dataIndex:"acc",renderer:function(a,b,c){var d="http://www.sequenceontology.org/miso/current_release/term/"+a;return" <a href="+d+' target="_blank">'+a+"</a>"}}],_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function FormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FormPanel"),this.target,this.autoRender=!0,this.height,this.width,this.title,this.collapsible=!1,this.titleCollapse=!1,this.submitButtonId="submit-btn",this.submitButtonText="Search",this.clearButtonText="Clear",this.barItems=[],this.border=!0,this.filters=[],this.mode="accordion",this.toolbarPosition="top",this.headerConfig,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function GoFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("GoFilterFormPanel"),this.target,this.autoRender=!0,this.title="Go",this.border=!1,this.collapsible=!0,this.titleCollapse=!1,this.headerConfig,this.testRegion="",this.fields=[{name:"name",type:"string"},{name:"acc",type:"string"}],this.columns=[{xtype:"treecolumn",flex:2,sortable:!1,dataIndex:"name",tooltipType:"qtip"},{text:"",flex:1,dataIndex:"acc"}],_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function MafFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("MafFilterFormPanel"),this.target,this.autoRender=!0,this.title="MAF",this.border=!1,this.collapsible=!0,this.titleCollapse=!1,this.headerConfig,this.testRegion="",_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function PositionFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("PositionFilterFormPanel"),this.target,this.autoRender=!0,this.title="Position",this.border=!1,this.collapsible=!0,this.titleCollapse=!1,this.headerConfig,this.testRegion="",this.emptyText="1:1-1000000,2:1-1000000",_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function SegregationFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("SegregationFilterFormPanel"),this.target,this.autoRender=!0,this.title="Segregation",this.border=!1,this.collapsible=!0,this.titleCollapse=!1,this.headerConfig,this.testRegion="",_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function StudyFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("StudyFilterFormPanel"),this.target,this.autoRender=!0,this.title="Select Studies",this.border=!0,this.height=300,this.collapsed=!1,this.studyFilterTpl='<tpl><div class="ocb-study-filter">{studyName}</div></tpl>',this.studiesStore=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},fields:[{name:"studyName",type:"string"},{name:"studyId",type:"string"}],autoLoad:!1}),_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function VariantBrowserGrid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("Widget"),this.target,this.data=[],this.dataParser,this.responseParser,this.columns,this.attributes,this.type,this.height=400,this.pageSize=10,this.title="VariantBrowserGrid",this.autoRender=!0,this.border=!1,this.responseRoot="response[0].result",this.responseTotal="response[0].numTotalResults",this.startParam="skip",this.plugins="bufferedrenderer",this.viewConfigListeners="",_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function VariantEffectGrid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantEffectGrid"),this.target,this.autoRender=!0,this.storeConfig={},this.gridConfig={},this.headerConfig,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function VariantFileBrowserPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantFileBrowserPanel"),this.target,this.title="File Browser",this.height=800,this.autoRender=!0,this.studies=[],_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function VariantGenotypeGrid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantGenotypeGrid"),this.autoRender=!0,this.storeConfig={},this.gridConfig={},this.height=500,this.target,this.columns=[{text:"Sample",dataIndex:"sample",flex:1},{text:"Genotype",dataIndex:"genotype",flex:1},{text:"Sex",dataIndex:"sex",flex:1},{text:"Phenotype",dataIndex:"phenotype",flex:1}],_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function VariantStatsPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantStatsPanel"),this.target,this.title="Stats",this.height=500,this.autoRender=!0,this.statsTpl=new Ext.XTemplate('<table class="ocb-stats-table"><tr><td class="header">Minor Allele Frequency:</td><td>{maf} ({mafAllele})</td></tr>','<tr><td class="header">Minor Genotype Frequency:</td><td>{mgf} ({mgfAllele})</td></tr>','<tr><td class="header">Mendelian Errors:</td><td>{mendelianErrors}</td></tr>','<tr><td class="header">Missing Alleles:</td><td>{missingAlleles}</td></tr>','<tr><td class="header">Missing Genotypes:</td><td>{missingGenotypes}</td></tr>',"</table>"),_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function VariantWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantWidget"),this.target,this.width,this.height,this.autoRender=!0,this.data=[],this.host,this.closable=!0,this.filters={segregation:!0,maf:!0,effect:!0,region:!0,gene:!0},this.headerConfig,this.attributes=[],this.columns=[],this.samples=[],this.defaultToolConfig={headerConfig:{baseCls:"ocb-title-2"},effect:!0,genomeViewer:!0,genotype:!0,stats:!0},this.tools=[],this.dataParser,this.responseParser,this.responseRoot="response[0].result",this.responseTotal="response[0].numTotalResults",this.startParam="skip",this.browserGridConfig={title:"variant browser grid",border:!1},this.toolPanelConfig={title:"Variant data",border:!1},this.toolsConfig={headerConfig:{baseCls:"ocb-title-2"}},_.extend(this.filters,a.filters),_.extend(this.browserGridConfig,a.browserGridConfig),_.extend(this.defaultToolConfig,a.defaultToolConfig),delete a.filters,delete a.defaultToolConfig,_.extend(this,a),this.selectedToolDiv,this.rendered=!1,this.autoRender&&this.render()}function CheckBrowser(a){Ext.isIE&&window.console&&"undefined"==typeof window.console.time&&(console.time=function(a,b){if(a){var c=(new Date).getTime();console.timeCounters||(console.timeCounters={});var d="KEY"+a.toString();!b&&console.timeCounters[d]||(console.timeCounters[d]=c)}},console.timeEnd=function(a){var b=(new Date).getTime();if(console.timeCounters){var c="KEY"+a.toString(),d=console.timeCounters[c];if(d){var e=b-d,f=a+": "+e+"ms";console.info(f),delete console.timeCounters[c]}return e}});var b=!1;switch(a){case"renato":Ext.chromeVersion>=16&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=10&&(b=!0);break;case"variant":Ext.chromeVersion>=16&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=10&&(b=!0);break;default:Ext.chromeVersion>=40&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=37&&(b=!0),Ext.operaVersion>=29&&(b=!0)}0==b&&(console.log("--------------------------------------------"+b),$("#checkBrowser").html("This application provides the best user experience with Google Chrome and Apple Safari, otherwise some latencies may be experienced when browsing due to some problems in Firefox.").css("width","540px").css("height","40px").css("position","absolute").css("margin-left","300px").css("margin-top","26px").css("padding","5px").css("border","1px solid #F1D031").css("background","#FFFFA3").css("color","#555").css("position","absolute").css("z-index","50000").click(function(){$("#checkBrowser").fadeOut(function(){$(this).remove()})}))}function GenericFormPanel(a){var b=this;_.extend(this,Backbone.Events),this.analysis,this.form=null,this.paramsWS={},this.testing=!1,this.closable=!0,this.minimizable=!0,this.labelWidth=150,this.type,this.style,this.title,this.resizable,this.width=500,this.height=600,this.border=!0,this.formBorder=!0,this.taskbar,this.bodyPadding,this.headerConfig,this.buttonConfig={width:200,height:30},_.extend(this,a),this.runAnalysisSuccess=function(a){""!==a.errorMsg?Ext.Msg.show({title:"Error",msg:a.errorMsg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}):(Utils.msg("Job Launched","It will be listed soon"),b.testing||b.clean(),console.log(a),"window"==b.type&&b.panel.hide())},this.on(this.handlers)}function HeaderWidget(a){_.extend(this,Backbone.Events);this.id=Utils.genId("HeaderWidget"),this.target,this.autoRender=!0,this.userData,this.appname="My new App",this.description="",this.suiteId=-1,this.checkTimeInterval=5e3,this.version="",this.allowLogin=!0,this.allowJobs=!0,this.width,this.height=60,this.chunkedUpload=!1,this.enableTextModeUW=!0,this.applicationMenuEl,this.homeLink=".",this.helpLink=".",this.tutorialLink=".",this.aboutHTML=".",_.extend(this,a),this.els={},this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function JobListWidget(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("JobListWidget"),this.target,this.autoRender=!0,this.RUNING_COLOR="#298c63",this.QUEUED_COLOR="Darkorange",this.FINISHED_COLOR="#0068cc",this.ERROR_COLOR="#b30000",_.extend(this,a),this.on(this.handlers),this.buttonFilterFunction=null,this.textFilterFunction=function(a){var c=b.searchField.getValue().toLowerCase();return!(a.data.name.toLowerCase().indexOf(c)<0)},this.rendered=!1,this.autoRender&&this.render()}function LoginWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("LoginWidget"),this.suiteId,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function OpencgaBrowserWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("uploadWidget"),this.targetId,this.suiteId,this.chunkedUpload=!1,this.width=800,this.height=575,this.title="Cloud data",this.enableTextModeUW=!0,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function ProfileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("ProfileWidget"),this.suiteId,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function ResultTable(a,b,c,d){this.id="ResultTable"+Math.round(1e7*Math.random()),this.targetId=null,this.jobId=a,this.fileName=b,this.tags=c,this.numRows=10,this.flex=null,this.collapsible=!0,this.border=!0,this.cls=null,"undefined"!=typeof d&&(this.targetId=d.targetId||this.targetId,this.numRows=d.numRows||this.numRows,this.flex=d.flex||this.flex,this.collapsible=d.collapsible||this.collapsible,this.border=d.border||this.border,this.cls=d.cls||this.cls,this.tableLayout=d.tableLayout||this.tableLayout),this.table=null}function ResultWidget(a){this.extItems=[],this.collapseInformation=!1,this.drawIndex=!0,this.drawInformation=!0,this.title="",this.height,this.width,_.extend(this,a),this.panelId=null,this.type,this.networkViewerId=null,this.genomeMapsId=null}function UploadWidget(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("uploadWidget"),this.targetId=null,this.suiteId=null,this.chunkedUpload=!1,this.enableTextMode=!0,"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId,this.suiteId=a.suiteId||this.suiteId,this.opencgaBrowserWidget=a.opencgaBrowserWidget||this.opencgaBrowserWidget,this.chunkedUpload=a.chunkedUpload||this.chunkedUpload),this.uploadObjectToBucketSuccess=function(a){""===a.errorMsg?(Utils.msg("Object upload",'</span class="emph">'+a.result[0].msg+"</span>"),b.uploadComplete(a.result[0].msg)):(Ext.Msg.alert("Object upload",a.errorMsg),b.uploadFailed(a.errorMsg)),b.trigger("object:upload",{sender:b,data:a.result[0].msg})},this.uploadButtonId=this.id+"_uploadButton",this.uploadFieldId=this.id+"_uploadField",this.selectedDataType=null,_.extend(this,a),this.on(this.handlers)}function CircosVertexRenderer(a){this.shape="circle",this.size=30,this.color="#FAFAFA",this.strokeSize=2,this.strokeColor="#888888",this.opacity=.8,this.labelSize=12,this.labelColor="#111111",this.labelPositionX=0,this.labelPositionY=0,this.labelText="",this.area=1,this.strokeArea=1,this.xAttribute="x",this.yAttribute="y",this.labelAdjust,this.pieSlices=[],this.donutSlices=[],this.shapeEl,this.vertexEl,this.targetEl,this.selectEl,this.groupEl,this.vertex,this.selected=!1,this.labelX=0,this.labelY=0;for(var b in a)hasOwnProperty.call(a,b)&&null!=a[b]&&(isNaN(a[b])?this[b]=a[b]:this[b]=parseFloat(a[b]))}function DefaultEdgeRenderer(a){_.extend(this,Backbone.Events),this.shape="directed",this.shaft="line",this.bidirectional="false",this.size=1,this.color="#cccccc",this.strokeSize=2,this.strokeColor="#aaaaaa",this.opacity=1,this.labelSize=0,this.labelColor="#111111",this.labelText="",this.el,this.edgeEl,this.labelEl,this.targetEl,this.edge,this.selected=!1,this.sourceCoords,this.targetCoords,this.sourceRenderer,this.targetRenderer;for(var b in a)hasOwnProperty.call(a,b)&&null!=a[b]&&(this[b]=a[b]);this.size=parseFloat(this.size),this.strokeSize=parseFloat(this.strokeSize),this.opacity=parseFloat(this.opacity),this.labelSize=parseFloat(this.labelSize)}function DefaultVertexRenderer(a){_.extend(this,Backbone.Events),this.shape="circle",this.size=20,this.color="#9fc6e7",this.strokeSize=1,this.strokeColor="#9fc6e7",this.opacity=.8,this.labelSize=12,this.labelColor="#111111",this.labelText="",this.el,this.vertexEl,this.targetEl,this.selectEl,this.groupEl,this.vertex,this.selected=!1,_.extend(this,a)}function Edge(a){this.id="e"+Utils.genId(),this.relation="",this.source,this.target,this.weight,this.directed,this.overlapCount,this.attributes={},this.renderer=new DefaultEdgeRenderer;for(var b in a)hasOwnProperty.call(a,b)&&(this[b]=a[b]);this.renderer&&(this.renderer.edge=this)}function Vertex(a){this.id="v"+Utils.genId(),this.edges=[],this.edgesIndex={},this.position=new Point,this.renderer=new CircosVertexRenderer,this.attributes={};for(var b in a)hasOwnProperty.call(a,b)&&(this[b]=a[b]);this.renderer&&(this.renderer.coords=this.position,this.renderer.vertex=this)}function DataSource(){}function FileDataSource(a){DataSource.prototype.constructor.call(this),_.extend(this,Backbone.Events),this.file,this.maxSize=524288e3,this.type="text",_.extend(this,a)}function StringDataSource(a){DataSource.prototype.constructor.call(this),_.extend(this,Backbone.Events),this.str=a}function TabularDataAdapter(a,b){var c=this;if(this.dataSource=a,this.async=!0,null!=b&&null!=b.async&&(this.async=b.async),this.fileLines=[],this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b),c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}this.onLoad=new Event}function UrlDataSource(a,b){DataSource.prototype.constructor.call(this),this.url=a,this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=",null!=b&&null!=b.proxy&&("boolean"==typeof b.proxy?0==b.proxy?this.proxy=!1:this.url=this.proxy+a:"string"==typeof b.proxy&&(this.url=b.proxy+a)),this.success=new Event,this.error=new Event}function FeatureDataAdapter(a,b){_.extend(this,Backbone.Events),this.dataSource=a,this.gzip=!0,this.params={},null!=b&&(null!=b.gzip&&(this.gzip=b.gzip),null!=b.species&&(this.species=b.species),null!=b.params&&(this.params=b.params)),this.featureCache=new FileFeatureCache({chunkSize:1e4,gzip:this.gzip}),this.chromosomesLoaded={}}function BamAdapter(a){if(_.extend(this,Backbone.Events),"undefined"!=typeof a){this.host=a.host||this.host,this.category=a.category||this.category,this.resource=a.resource||this.resource,this.params=a.params||this.params,this.filters=a.filters||this.filters,this.options=a.options||this.options,this.species=a.species||this.species;var b=a.featureCache||{}}if(null!=a&&null!=a.featureConfig&&(null!=a.featureConfig.filters&&(this.filtersConfig=a.featureConfig.filters),null!=a.featureConfig.options)){this.optionsConfig=a.featureConfig.options;for(var c=0;c<this.optionsConfig.length;c++)1==this.optionsConfig[c].checked&&(this.options[this.optionsConfig[c].name]=!0,this.params[this.optionsConfig[c].name]=!0)}this.featureCache=new BamCache(b)}function BEDDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.parseFunction,null!=b&&null!=b.parseFunction&&(this.parseFunction=b.parseFunction),this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function CellBaseAdapter(a){_.extend(this,Backbone.Events),_.extend(this,a),this.on(this.handlers),this.configureCache(),this.debug=!1}function DasAdapter(a){_.extend(this,Backbone.Events),this.id=Utils.genId("DasAdapter"),this.gzip=!0,this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=",this.url,this.species,this.featureCache,this.params={},_.extend(this,a),this.on(this.handlers),this.featureCache=new FeatureCache(this.featureCache)}function EnsemblAdapter(a){_.extend(this,Backbone.Events),_.extend(this,a),this.on(this.handlers),this.cache=new FeatureChunkCache(this.cacheConfig)}function FeatureTemplateAdapter(a){_.extend(this,Backbone.Events),this.templateVariables={},this.multiRegions=!0,this.histogramMultiRegions=!0,this.chromosomeSizes,_.extend(this,a),this.configureCache(),this.debug=!1}function GFF2DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function GFF3DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function GTFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function OpencgaAdapter(a){_.extend(this,Backbone.Events),_.extend(this,a),this.on(this.handlers),this.configureCache(),this.debug=!1}function VCFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},this.header="",this.samples=[],null!=b&&null!=b.async&&(this.async=b.async)}function AttributeNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.ignoreColumns={},this.renameColumns={},this.useFirstLineAsColumnNames=!1,_.extend(this,a),this.attributes=[],this.columns=[],this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);b.parse(c)}}function DOTDataAdapter(a){NetworkDataAdapter.prototype.constructor.call(this,a),this.vertexSubgraph={},this.addedVertex={}}function JSONNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.jsonObject,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.jsonObject=JSON.parse(c)}}function SIFNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.separator="\t",this.graph=new JsoGraph,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c)}this.addedVertex,this.addedEdges}function TextNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.separator=/\t/,this.graph=new JsoGraph,_.extend(this,a),this.on(this.handlers),this.rawData,this.async)this.dataSource.on("success",function(a){b.rawData=a,b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);b.rawData=c,this.parse(c)}this.columnLength,this.addedVertex,this.addedEdges}function XLSXNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.graph=new JsoGraph,this.xlsx,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c)}}function IndexedDBStore(a){this.debug=!1,this.profile=!1,_.extend(this,Backbone.Events),this.lru=[],this.cacheId="DataBase",this.opening=!1,this.timeout=30,_.extend(this,a),window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.version=iDBVersion,this.cacheId||console.log("IndexedDBStore: not supplied cacheId to constructor. Using default DataBase..."),iDBInstances.push(this)}function MemoryStore(a){_.extend(this,Backbone.Events),_.extend(this,a),this.init()}function FeatureChunkCache(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FeatureChunkCache"),this.defaultChunkSize=5e4,this.defaultCategory="defaultCategory",this.limit,_.extend(this,a),"MemoryStore"==this.storeType?this.store=new MemoryStore({}):this.store=new IndexedDBStore({cacheId:this.cacheId}),this.verbose=!1}function FileFeatureCache(a){this.args=a,this.id=Math.round(1e7*Math.random()),this.chunkSize=5e4,this.gzip=!0,this.maxSize=10485760,this.size=0,null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip&&(this.gzip=a.gzip)),this.cache={},this.chunksDisplayed={},this.maxFeaturesInterval=0,this.gzip=!1}function BamCache(a){this.args=a,this.id=Math.round(1e7*Math.random()),this.chunkSize=5e4,this.gzip=!0,this.maxSize=10485760,this.size=0,null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip&&(this.gzip=a.gzip)),this.cache={},this.maxFeaturesInterval=0,this.gzip=!1}function NavigationBar(a){_.extend(this,Backbone.Events);this.id=Utils.genId("NavigationBar"),this.target,this.autoRender=!0,this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase",this.cellBaseVersion="v3",this.species="Homo sapiens",this.increment=3,this.componentsConfig={menuButton:!1,leftSideButton:!1,restoreDefaultRegionButton:!0,regionHistoryButton:!0,speciesButton:!0,chromosomesButton:!0,karyotypeButtonLabel:!0,chromosomeButtonLabel:!0,regionButtonLabel:!0,zoomControl:!0,windowSizeControl:!0,positionControl:!0,moveControl:!0,autoheightButton:!0,compactButton:!0,searchControl:!0},this.zoom=100,this.quickSearchDisplayKey="name",_.extend(this.componentsConfig,a.componentsConfig),delete a.componentsConfig,_.extend(this,a),this.region=new Region(this.region),this.currentChromosomeList=[],this.on(this.handlers),this.els={},this.zoomChanging=!1,this.regionChanging=!1,this.rendered=!1,this.autoRender&&this.render()}function ChromosomePanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("ChromosomePanel"),this.target,this.autoRender=!0,this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase",this.cellBaseVersion="v3",this.pixelBase,this.species="hsapiens",this.width=600,this.height=75,this.collapsed=!1,this.collapsible=!1,this.hidden=!1,_.extend(this,a),this.region=new Region(this.region),this.lastChromosome="",this.data,this.on(this.handlers),this.regionChanging=!1,this.rendered=!1,this.autoRender&&this.render()}function KaryotypePanel(a){_.extend(this,Backbone.Events),this.target,this.autoRender=!0,this.id=Utils.genId("KaryotypePanel"),this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase",this.cellBaseVersion="v3",this.pixelBase,this.species,this.width=600,this.height=75,this.collapsed=!1,this.collapsible=!0,this.hidden=!1,_.extend(this,a),this.region=new Region(this.region),this.lastSpecies=this.species,this.chromosomeList,this.data2,this.on(this.handlers),this.regionChanging=!1,this.rendered=!1,this.autoRender&&this.render()}function StatusBar(a){_.extend(this,Backbone.Events);this.id=Utils.genId("StatusBar"),this.target,this.autoRender=!0,_.extend(this,a),this.region=new Region(this.region),this.rendered=!1,this.autoRender&&this.render()}function TrackListPanel(a){_.extend(this,Backbone.Events),this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase",this.cellBaseVersion="v3",this.target,this.autoRender=!0,this.id=Utils.genId("TrackListPanel"),this.collapsed=!1,this.collapsible=!1,this.hidden=!1,this.tracks=[],this.tracksIndex={},this.parentLayout,this.mousePosition,this.windowSize,this.zoomMultiplier=1,this.showRegionOverviewBox=!1,this.height=0,_.extend(this,a),this.region=new Region(this.region),this.width-=18,this.status,this.visualRegion=new Region(this.region),this._setPixelBase(),this.on(this.handlers),this.regionChanging=!1,this.rendered=!1,this.autoRender&&this.render()}function Track(a){if(this.id=Utils.genId("track"),this.dataAdapter,this.renderer,this.histogramRendererName="HistogramRenderer",this.resizable=!0,this.autoHeight=!1,this.targetId,this.title,this.minHistogramRegionSize=3e8,this.maxLabelRegionSize=3e8,this.width=200,this.height=100,this.visibleRegionSize,this.visible=!0,this.contentVisible=!0,this.closable=!1,this.fontClass="ocb-font-roboto ocb-font-size-14",this.externalLink="",_.extend(this,a),this.pixelBase,this.svgCanvasWidth=5e5,this.pixelPosition=this.svgCanvasWidth/2,this.svgCanvasOffset,this.status,this.histogram,this.histogramLogarithm,this.histogramMax,this.interval,this.svgCanvasLeftLimit,this.svgCanvasRightLimit,this.invalidZoomText,this.renderedArea={},this.chunksDisplayed={},"handlers"in this)for(eventName in this.handlers)this.on(eventName,this.handlers[eventName]);this.rendered=!1,this.autoRender&&this.render()}function AlignmentTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.defaultRenderer=this.renderer,this.histogramRenderer=new window[this.histogramRendererName](a),this.dataType="features",_.extend(this,a)}function FeatureTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.defaultRenderer=this.renderer,this.histogramRenderer=new window[this.histogramRendererName](a),this.featureType="Feature",_.extend(this,a),this.resource=this.dataAdapter.resource,this.species=this.dataAdapter.species,this.dataType="features"}function GeneTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.minTranscriptRegionSize,this.defaultRenderer=this.renderer,this.histogramRenderer=new HistogramRenderer(a),_.extend(this,a),this.exclude}function Renderer(a){}function AlignmentRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-roboto ocb-font-size-11",this.toolTipfontClass="ocb-tooltip-font",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function BamRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-roboto ocb-font-size-11",this.toolTipfontClass="ocb-tooltip-font",_.isObject(a)?_.extend(this,a):_.extend(this,FEATURE_TYPES.bam),this.on(this.handlers)}function ConservedRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),_.extend(this,a)}function FeatureClusterRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.histogramHeight=75,this.multiplier=7,this.fontClass="ocb-font-roboto ocb-font-size-11",this.toolTipfontClass="ocb-tooltip-font",_.extend(this,a)}function FeatureRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-roboto ocb-font-size-11",this.toolTipfontClass="ocb-tooltip-font",null==a&&(a=FEATURE_TYPES.undefined),_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function GeneRenderer(a){Renderer.call(this,a),
_.extend(this,Backbone.Events),this.fontClass="ocb-font-roboto ocb-font-size-11",this.toolTipfontClass="ocb-tooltip-font",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function HistogramRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.histogramHeight=75,this.histogramColor="#428bca",this.maxValue=10,this.updateScale(a),_.extend(this,a)}function SequenceRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-ubuntumono ocb-font-size-16",this.toolTipfontClass="ocb-tooltip-font",_.extend(this,a)}function VariantRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-roboto ocb-font-size-11",this.toolTipfontClass="ocb-tooltip-font",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function VcfMultisampleRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-roboto ocb-font-size-11",this.toolTipfontClass="ocb-tooltip-font",_.extend(this,FEATURE_TYPES.variant),this.on(this.handlers)}function GenomeViewer(a){_.extend(this,Backbone.Events);this.id=Utils.genId("GenomeViewer"),this.autoRender=!0,this.version='Powered by <a target="_blank" href="http://www.genomemaps.org/">Genome Maps</a>',this.target,this.width,this.height,this.cellBaseHost="http://bioinfo.hpc.cam.ac.uk/cellbase",this.cellBaseVersion="v3",this.quickSearchResultFn,this.quickSearchDisplayKey="name",this.drawNavigationBar=!0,this.drawKaryotypePanel=!0,this.drawChromosomePanel=!0,this.drawOverviewTrackListPanel=!0,this.overviewZoomMultiplier=8,this.karyotypePanelConfig={hidden:!1,collapsed:!1,collapsible:!0},this.chromosomePanelConfig={hidden:!1,collapsed:!1,collapsible:!0},this.regionPanelConfig={hidden:!1,collapsed:!1,collapsible:!0},this.navigationBarConfig={},this.drawStatusBar=!0,this.resizable=!0,this.sidePanel=!0,this.trackListTitle="Detailed information",this.trackPanelScrollWidth=18,this.zoom,this.chromosomes,this.chromosomeList,_.extend(this,a),this.chromosomes=this.getChromosomes(),this.species.chromosomes=this.chromosomes,this.defaultRegion=new Region(this.region),this.sidePanelWidth=this.sidePanel?25:0,this.on(this.handlers),this.fullscreen=!1,this.resizing=!1,this.changingRegion=!1,this.rendered=!1,this.autoRender&&this.render()}var Utils={characters:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",number:{sign:function(a){return a?a<0?-1:1:0}},formatNumber:function(a){return a.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},formatText:function(a,b){return a=a.replace(new RegExp(b,"gi")," "),a=a.charAt(0).toUpperCase()+a.slice(1)},titleCase:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},camelCase:function(a){return a.toLowerCase().replace(/[.-_\s](.)/g,function(a,b){return b.toUpperCase()})},camelToSpace:function(a){var b=a.replace(/([A-Z])/g," $1").toLowerCase().trim();return b.charAt(0).toUpperCase()+b.slice(1)},closest:function(a,b){for(var c=a.matches?"matches":"msMatchesSelector";a&&!a[c](b);)a=a.parentElement;return a},isFunction:function(a){return"function"==typeof a||a instanceof Function},parseDate:function(a){return a.substring(4,6)+"/"+a.substring(6,8)+"/"+a.substring(0,4)+" "+a.substring(8,10)+":"+a.substring(10,12)+":"+a.substring(12,14)},genId:function(a){return a=a||"",a=0==a.length?a:a+"-",a+this.randomString(4)+this.getRandomInt(1e3,9999)},randomString:function(a){a=a||10;for(var b="",c=0;c<a;c++)b+=this.characters.charAt(this.getRandomInt(0,this.characters.length-1));return b},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},endsWithIgnoreCase:function(a,b){var c=new RegExp("^.*\\.("+b+")$","i");return c.test(a)},endsWith:function(a,b){return a.length>=b.length&&a.substr(a.length-b.length)==b},addQueryParamtersToUrl:function(a,b){var c="?";b.indexOf("?")!=-1&&(c="&");var d=Utils.queryString(a);return""!=d&&(d=c+d),b+d},queryString:function(a){var b=[];for(var c in a)null!=a[c]&&void 0!=a[c]&&b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")},randomColor:function(){for(var a="",b=0;b<6;b++)a+=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f"][Math.floor(16*Math.random())];return"#"+a},colorLuminance:function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a=String(a).replace(/#/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;d<3;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},getSpeciesFromAvailable:function(a,b){for(var c in a)for(var d=0;d<a[c].length;d++){var e=a[c][d];if(e.id===b||e.scientificName.toLowerCase()===b.toLowerCase())return e}},getSpeciesCode:function(a){var b,c=a.split(" ");return b=c.length<3?(c[0].charAt(0)+c[1]).toLowerCase():(c[0].charAt(0)+c[1]+c[c.length-1].replace(/[\/_().\-]/g,"")).toLowerCase()},basicValidationForm:function(a){var b=!0,c="";return void 0!==a.$.outdir.selectedFile&&"FOLDER"==a.$.outdir.selectedFile.type||(c+="Error: Please select an output folder.\n",b=!1),void 0!==a.$.inputFile.selectedFile&&"FILE"==a.$.inputFile.selectedFile.type||(c+="Error: Please select an input file.\n",b=!1),""==a.$.jobName.value&&(c+="Error: Please add a job name.\n",b=!1),b||alert(c),b},getUrl:function(a){return OpencgaManager.files.download({id:a,query:{sid:Cookies("bioinfo_sid")},request:{url:!0}})},getFileContent:function(a,b){OpencgaManager.files.content({id:b,query:{sid:Cookies("bioinfo_sid")},request:{success:function(b){a(b)},error:function(){this.message="Server error, try again later."}}})},loadExampleFile:function(a,b,c){OpencgaManager.files.contentExample({query:{toolName:b,fileName:c},request:{success:function(b){a(b)},error:function(){console.log("utils.js223:Server error, try again later.")}}})},downloadExampleFile:function(a,b){var c=OpencgaManager.files.downloadExample({query:{toolName:a,fileName:b},request:{url:!0}}),d=document.createElement("a");d.href=c;var e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});d.dispatchEvent(e)},argsParser:function(a,b){if(a.toolName==b.tool)for(var c in b)if("object"==typeof b[c])void 0!==a.$[c]&&(a.$[c].selectedFile=b[c]);else{var d=a.shadowRoot.querySelectorAll('input[name="'+c+'"]');if(void 0!==a.$[c])switch(a.$[c].type){case"checkbox":a.$[c].checked=b[c];default:a.$[c].value=b[c]}for(var e=0;e<d.length;e++){var f=d[e];f.value==b[c]&&(f.checked=!0)}}},getLinks:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push(Utils.getLink(d))}return b},getLink:function(a){var b="http://www.ebi.ac.uk/QuickGO/GTerm?id=";if(a.indexOf("(")>=0){var c=a.split("(");c.length>1&&(c=c[1]),c=c.split(")")[0]}else c=a;return 0==c.indexOf("IPR")&&(b="http://www.ebi.ac.uk/interpro/entry/"),b+=c},myRound:function(a,b){return b="undefined"!=typeof b?b:2,a=parseFloat(a),a=Math.abs(a)>=1?a.toFixed(b):a.toPrecision(b),a=parseFloat(a)},formatNumber:function(a,b){return a=Utils.myRound(a,b),Math.abs(a)>0&&Math.abs(a)<.001&&(a=a.toExponential()),a},getSpecies:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.value==a)return d}return null},test:function(){return this},cancelFullscreen:function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},launchFullScreen:function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()},parseJobCommand:function(a){var b={},c=a.commandLine.split(/ -{1,2}/g),d='<table cellspacing="0" style="max-width:400px;border-collapse: collapse;border:1px solid #ccc;"><tbody>';d+='<tr style="border-collapse: collapse;border:1px solid #ccc;font-weight:bold;">',d+='<td style="min-width:50px;border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">Parameter</td>',d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">Value</td>',d+="</tr>";for(var e=1;e<c.length;e++){var f=c[e],g=f.split(/ {1}/g),h="",i="";g.length<2?(h=g[0],i="<span color:darkgray;font-weight:bold;>This paramenter is a flag</span>"):(h=g[0],i=g[1]),b[h]=i,i=i.replace(/\/httpd\/bioinfo\/opencga\/analysis\/.+\/examples\//,""),i=i.replace("/httpd/bioinfo/opencga/accounts/",""),i=i.replace(/,/g,", "),d+='<tr style="border-collapse: collapse;border:1px solid #ccc;">',d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;color:steelblue;font-weight:bold;white-space: nowrap;">'+h+"</td>",d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+i+"</td>",d+="</tr>"}return d+="</tbody></table>",{html:d,data:b}},htmlTable:function(a){var b="";b+='<table cellspacing="0" style="border-collapse: collapse;border:1px solid #ccc;"><tbody>';for(var c in a)b+='<tr style="border-collapse: collapse;border:1px solid #ccc;">',b+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;color:steelblue;font-weight:bold;white-space: nowrap;">'+c+"</td>",b+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+a[c]+"</td>",b+="</tr>";return b+="</tbody></table>"},msg:function(a,b){var c=document.createElement("div");c.classList.add("jso-msg-hidden");var d=document.createElement("div");d.textContent=a;var e=document.createElement("div");e.textContent=b,c.appendChild(d),c.appendChild(e),document.body.appendChild(c),c.addEventListener("click",function(){document.body.removeChild(c),c=null}),setTimeout(function(){c.classList.add("jso-msg-shown")},10),setTimeout(function(){c&&c.classList.remove("jso-msg-shown")},4e3),setTimeout(function(){c&&(document.body.removeChild(c),c=null)},4400)},repeat:function(a,b){if(null==a)throw new TypeError("can't convert "+a+" to object");var c=""+a;if(b=+b,b!=b&&(b=0),b<0)throw new RangeError("repeat count must be non-negative");if(b==1/0)throw new RangeError("repeat count must be less than infinity");if(b=Math.floor(b),0==c.length||0==b)return"";if(c.length*b>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var d="";1==(1&b)&&(d+=c),b>>>=1,0!=b;)c+=c;return d},clone:function(a){return JSON.parse(JSON.stringify(a))},timeDiff:function(a,b){var c=new Date(Date.parse(a)),d=new Date(Date.parse(b));if(isNaN(c)||isNaN(d))return"";if(c<d)var e=d-c;else var e=c-d;var f=Math.floor(e/1e3/60/1440),g=f+" Days ";0===f&&(g="");var h=new Date(e),i=h.getHours()-1,j=i+" hour",k=h.getMinutes()+" minute",l=h.getSeconds()+" second";return j+=1!==i?"s ":" ",k+=1!==h.getMinutes()?"s ":" ",l+=1!==h.getSeconds()?"s ":" ",0===i&&(j=""),0===h.getMinutes()&&(k=""),0===h.getSeconds()&&(l=""),g+j+k+l},deleteIndexedDB:function(){window.indexedDB.webkitGetDatabaseNames().onsuccess=function(a,b){var c=a.target.result;for(var d in c)indexedDB.deleteDatabase(c[d])}},subsetArray:function(a,b,c){var d=[];b=b<0?0:b,c=c>=a.length?a.length:c;for(var e=b;e<c;e++)d.push(a[e]);return d},applyFunctionBatch:function(a,b,c){for(var d=b,e=this.subsetArray(a,0,d);e.length>0;)c(e),e=this.subsetArray(a,d,d+b),d+=b}};Utils.images={add:"data:image/gif;base64,R0lGODlhEAAQAIcAAD2GNUKNNkOPOESMO0WNPEmPP0iNQUmPQlOVTFWWTVCZQVeeRV6cVmGeWGSgVWSgV2aiWGejW2WrVWirU2uqWGqsW2yqWm61WG+1WG+1WXS3W3S3XHC4WXK5W3O6XHG+X3asZ3iuaHe8YHi0ZH+yany6ZH28Zn2+Z3m9bn25an25a3+5bUD/QHDBY3nBZHrGa3zDa37BaX7Hb4K1boO1boa3cYi4d4y7doq5eYm+eI2+e5O/f4HMdYbJeobJfIXNeYrCeY/CfYnIf4rPfZW/gozLgY7MhI7Sg5LFgJXAgpfHhZfMhZPNiJjLhpjMh5jMipvBl5vBmJTTipbTiZXUipbUi5fVi5nRi53YkqTOlKbPlqbQlqDZlaDZlqXbm6rUnavUnKbIoKfJoa/fpa/fprPZpbTZpbTaprLbqLPdqbXbqLfaqrTdqrXfrLbdrLjVr7jdr7vcr7rWsbfgr77itr3ktsTcuMXducXowMvmw87pydTrz9fu0tzx2ODy3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAACwALAAAAAAQABAAAAi/AFkIHEiwoME7SWrMwCHH4MAdWfLs0QNnRQiHN+L4qeOlyxg8QCAU3LGmDxYmRqpQOTJHRYSBdpTw4SJFyJ8/P2DIaLNAjEAibsgU8YHiZgURHq4gaSCQBh0rPW5K/cMhxpcCAkmkGcJj6k0OJ8AMEGjjyZQXLSR85dBhiY4EAt9MYOPig4ivFzacEQBlIIgUaJByyIBBQxkLBwo6GKHGiYkSTcxQAODwgYIgW7TkCGDAocAwDAoQQBDFs2mCAQEAOw==",del:"data:image/gif;base64,R0lGODlhEAAQAIcAAED/QLpSNL9TOr5WOb5cQL9cQMFNM8RQNMBVPcBZP8xSPNBPPttWS9ddUcJnTMRkTMdrVM1gUc5iVMxmVclrVs1oWNZgVNZuZNtpZdxraN5ratxuadRxZd14c955dOZWTOZYTOZZTulZTelbT+ZWUOZaUuddWepcUOxfVOBlXO5mUuljW+pmXO5qXvBkVvNzXeNrYeNuY+FvcOJwZuJ7deR4ceJ5eeN4eeJ/feN/fOl7cOh6del/ePJ3Y/N5Y+qDfe6Efe+Gfu6KdfaCaPaEbPCFcPCDe/CMd/GOeviGcPiMdvCRf/eRfveTfvmSfvqTf/iUf9ymltynl+6Mge2Tju6Sj/SOgfqah/qdi/GclvGdluGpnvSgnvSinvWjn/qjkfupnPqrneGroOqwrOuzr/Ono/WmoferofarovWsofWvpfKtqvivpPS0qvi2qPm5r/q6rvC1tfC2tvjDvvzHuvnLxPnTzPzUzf3b1P3c2P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAAALAAAAAAQABAAAAi6AAEIHEiwoEE5ODRk8EDG4EAbVObYqdNmxgWHMtbkgfMFCxg6OiQUvFEGz5UlSKA4UeImRoWBcX7cwdJECJGbRHywWSBGYA41YY6gGEq0hxUeFARuePOkiJ6nUEW00IJAIIYzSYZAjcoiywCBHaYweSGirNkRRmg8EDiGARoXKsyKAFHCy4EoAznASIPihIgQH0h0sVCgYIQUZoKsMAGES4MADico2FGlSg0DBBwK3AIhgQAHUjSLJhgQADs=",enable:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAKfSURBVDjLpZPrS1NhHMf9O3bOdmwDCWREIYKEUHsVJBI7mg3FvCxL09290jZj2EyLMnJexkgpLbPUanNOberU5taUMnHZUULMvelCtWF0sW/n7MVMEiN64AsPD8/n83uucQDi/id/DBT4Dolypw/qsz0pTMbj/WHpiDgsdSUyUmeiPt2+V7SrIM+bSss8ySGdR4abQQv6lrui6VxsRonrGCS9VEjSQ9E7CtiqdOZ4UuTqnBHO1X7YXl6Daa4yGq7vWO1D40wVDtj4kWQbn94myPGkCDPdSesczE2sCZShwl8CzcwZ6NiUs6n2nYX99T1cnKqA2EKui6+TwphA5k4yqMayopU5mANV3lNQTBdCMVUA9VQh3GuDMHiVcLCS3J4jSLhCGmKCjBEx0xlshjXYhApfMZRP5CyYD+UkG08+xt+4wLVQZA1tzxthm2tEfD3JxARH7QkbD1ZuozaggdZbxK5kAIsf5qGaKMTY2lAU/rH5HW3PLsEwUYy+YCcERmIjJpDcpzb6l7th9KtQ69fi09ePUej9l7cx2DJbD7UrG3r3afQHOyCo+V3QQzE35pvQvnAZukk5zL5qRL59jsKbPzdheXoBZc4saFhBS6AO7V4zqCpiawuptwQG+UAa7Ct3UT0hh9p9EnXT5Vh6t4C22QaUDh6HwnECOmcO7K+6kW49DKqS2DrEZCtfuI+9GrNHg4fMHVSO5kE7nAPVkAxKBxcOzsajpS4Yh4ohUPPWKTUh3PaQEptIOr6BiJjcZXCwktaAGfrRIpwblqOV3YKdhfXOIvBLeREWpnd8ynsaSJoyESFphwTtfjN6X1jRO2+FxWtCWksqBApeiFIR9K6fiTpPiigDoadqCEag5YUFKl6Yrciw0VOlhOivv/Ff8wtn0KzlebrUYwAAAABJRU5ErkJggg==",warning:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAIsSURBVDjLpVNLSJQBEP7+h6uu62vLVAJDW1KQTMrINQ1vPQzq1GOpa9EppGOHLh0kCEKL7JBEhVCHihAsESyJiE4FWShGRmauu7KYiv6Pma+DGoFrBQ7MzGFmPr5vmDFIYj1mr1WYfrHPovA9VVOqbC7e/1rS9ZlrAVDYHig5WB0oPtBI0TNrUiC5yhP9jeF4X8NPcWfopoY48XT39PjjXeF0vWkZqOjd7LJYrmGasHPCCJbHwhS9/F8M4s8baid764Xi0Ilfp5voorpJfn2wwx/r3l77TwZUvR+qajXVn8PnvocYfXYH6k2ioOaCpaIdf11ivDcayyiMVudsOYqFb60gARJYHG9DbqQFmSVNjaO3K2NpAeK90ZCqtgcrjkP9aUCXp0moetDFEeRXnYCKXhm+uTW0CkBFu4JlxzZkFlbASz4CQGQVBFeEwZm8geyiMuRVntzsL3oXV+YMkvjRsydC1U+lhwZsWXgHb+oWVAEzIwvzyVlk5igsi7DymmHlHsFQR50rjl+981Jy1Fw6Gu0ObTtnU+cgs28AKgDiy+Awpj5OACBAhZ/qh2HOo6i+NeA73jUAML4/qWux8mt6NjW1w599CS9xb0mSEqQBEDAtwqALUmBaG5FV3oYPnTHMjAwetlWksyByaukxQg2wQ9FlccaK/OXA3/uAEUDp3rNIDQ1ctSk6kHh1/jRFoaL4M4snEMeD73gQx4M4PsT1IZ5AfYH68tZY7zv/ApRMY9mnuVMvAAAAAElFTkSuQmCC",edit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB80lEQVR42o2T30tTURzArb8ioiAI6kHoZeF7CGE/IISCUDNCqAeL3rIWPfSwByskYUEJIhSChBhJFAiNqMVYPqRuc4tcW3NLt3C7u3d3d3c/+nS+0GRK0134cC6c8/ncc+7ltgFt6jqgcCg6duGQYq84deoBR6lU0iqVSq1arfI/1Dxut3u0Htke6BC5UChgmuYm+XyeXC5HOp1GIsnQNJHJi3x/7WJh/CSLT9r7Rd4jAVlgWRa2bSOjYBgGmqaRyWQwkq9Y8wyhLb0BI0VuaRrfo671xoDIwmakWCyi6zrr36bILt/HXp1l7cNDioEZqnEvgYmr1paAOgYy1u/l3NrqHNngPWpFL8XodTa+3CD8YoCvz/o078i5o1sC29FT78kG7lCzfJgrl7ESvejLThLPuxk8fbhP3KaBVFCdeX7on9yP9bOHfPAu0bEzmKkg4jQNpEKzhOduqW1/xIoNUEpcQlM7WXl6Cj39Q9Y0D4Q/TRJ662Tx3WOS/guYsV42Fm4THe/G/B2T97Jz4OVwJ+hxImPn8Tj381k91TfShfErIvLuAde1Y9g+N7Z/FL/rBDODR8gmgpTL5To7B3o69zF8pR3Pg7PMT90kn47LJ22kaeCPghapidP4Lxy3bduUiVZktdaQH7AxcFAiUm0Rhzji/gUhbp0s2Zf2xwAAAABJRU5ErkJggg==",info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJ1SURBVHjafJJdSJNhFMd/z3QzLWdZrnQmSA2DPqRCK4KuhIq66kLoAy/qoqCguqqL6JsgLwoKKhCMSIy6CDKKRFZZYYQRVhJl02nWmG5uc19u7/vuPV0lW7QOnIsHnt+P8z/Pg4gw26aZ0263uzEUCn2IxWJjXq/3JqBETLIZ8gkePLhfKyKy/Z5HHJf7xe0Jic/n65mejizPK0inUiSTKUSE0dHRhxf6JoSDb4Rjr4QDz0REJBgMtmczFrJKKYVSCjCYnPR/W1FuAwQSGjbHXAA0LRXKZnIm0NJpgAKvd/hSOBz2iIj0eiPS2vtDYsmUPH/uPg9YshklIrOyCb+/eUG5ve3au5C99W2AqGbgKivk8R4X1lSkv2pJZaNmmBQVWWeZnAiGoa+3KovdyBjsW2kn/SvK4Jcgtaf7cDqrGkQMUDkBcgXVS2tOHjp8dG2jOXT1yo5lYOpgFTB0wKTAOqdQMlqOoDD7EE8kREwGXr/oWTg4HjxONAklBayuKSUeT/hFTxrwnwlAMa8I1qyrP3H95RiQgUiC/RsWM+wZ6jIME0M38wtSM0mmojM4nc6mzr5xKDQgnWb/pmoedT29EU3pTMUS+QVKKerq6kqnI3EVHwmAplO8qBh7WTFnzpz9bOg6FovlfxGEixfOrfT6YxCOQ1rDUaIAG4EJ38+PAwNb/95Bzj8ITAZwLHbMT0yHw3N33YVwEnQDqss41VzPkaalX6Iz+m6Xy/Xp34JAAICR7187nLWuvbe6h9C0DA2uRTTVV9J++87OlpaWJxUVFf9+xj+1cfOWls6OO93Nq1zblMVm9flG3pcvXNPm90+E/777ewB+UIqdqtYXHAAAAABJRU5ErkJggg==",bucket:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QkQDC8RTstxRAAAAGBJREFUOMtjYBgswIWBgeE/idiFgYGBgRFqwH8GBoYGEi1tYGBgYGRBE9QjUvMlGANmgCsDA8NuElzRANXDwAQV2ENGuO1BNoBsMGoAlQ3wJTIdNEDVYgU+ROQBH6rmQgAWgB19xco60wAAAABJRU5ErkJggg==",dir:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDNzU0RUNBNzU3OEIxMUUyOEM3QzkxOEZDOTU1RTdFMCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDNzU0RUNBODU3OEIxMUUyOEM3QzkxOEZDOTU1RTdFMCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkM3NTRFQ0E1NTc4QjExRTI4QzdDOTE4RkM5NTVFN0UwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkM3NTRFQ0E2NTc4QjExRTI4QzdDOTE4RkM5NTVFN0UwIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+S/WxbAAAAERJREFUeNpi/P//PwMlgJFSA1g2bNiAzYQLQOwIxB8IGcCEQ9wAiPcDsQBBF+CRAxnynlwXEA1GDRg1gCqZiWIDAAIMADidE0PBoGsZAAAAAElFTkSuQmCC",r:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90CDRIvNbHTpbwAAADjSURBVDjLpZFBbsIwEEUfVRZYahcVK3qKXoauMFK5C91nkyUB+xC5BqeAA7SKq1B5ugl2EiC04UkjayzN17NnROTRWvvJFbTWL8CBHqbGWOlSlqVkWSbGWAGm3aGHZiMiAByPP6FOd1rP2W7NvhvSCvDe10E+VJPFQpPnm1ZIcsmgPgJVVZGmaejX63y/XL4/AV/JJYPTCeDcN7PZWyuwKAqA8wARqSsGKDVGqXGjV8H07AnRQPq21TK8+YSBAQMN4hb6Df7wB/5eA+4zmEyehxk451itPrhFksSxUeP+lf+z+wXwdayJk/mqtgAAAABJRU5ErkJggg==",box:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwRAVvTmTAAAAK/SURBVDjLpZM9bFxFGEXPNzPvZ+39sb2xHceREjDQBwlDCqqIiiotokAghYKEjvSkQkKJkEiB0lOkoAHaBAokFCQKUATIIOLIMbHWrHfX+7zvvZk3MzQODUgU3PJK5+g2F/5n5N/Kb66/1NNK3hAxr4HcFqVuvfju18V/Cu58sPmMVnJZ4K32Qr+t8za+KnCz4kCUuiGibm5euTv5h+CL958/nxj1XivVF+e6C9TVhPmFdbROgEhwNU1d4m09UaJuInLjhct3DgDUh5ee7j14PLxulLvYP/0seadPkub88Wib0eB3bDkmxgbRoFPpxeCuKvjsyQIzOyqImT7/y8Mh++NveW7jLFmrx6m1NlWxz6PHA7otQ7tloAmYJE9isOeeCJRtIrULLLUTjsqG7+//xs72z7jZgCTNONlVJKEiuobW0jqSaoiet19dFQATJcc2FSFEciNoLYwOHcPDASvdjM5cQntxlbR9gqacoFSK84VsnOrkH11Zdmp0FFXjobSeCFgXSDS0Eo11ge7yGXSaU092UUlCaEpC8FK4tDcu4rzZ2a/S+bWI94HSAgFigDQD24Cvp4gIOp0juBJvC2L07B1Uc/Mtg9k7sHMbywZrA3lLECV4AtaCpAp79CcmzXHlhOBrAJrGyNbOVBY7qTO1C9r5EKyPSttAiJEs01SuQStFkrdp6gKd5AzHjixVxCDxp+1paZRUxoc4Kp36bndYbS53U5WlCq0CMYIPMY7GI0mNpiqmGK0oK4jIveGkPgRqfTBt3A8Pqtvrq52HtglnGh9XIaKUkCQ6nj6RyWBsmdXCtFI/bu2Fq5c+3roGzIAgWokCDNACOhfOLb781Ip+vd+RC2dXWibROkxKvvp1z376yZe7d4HpMdz8/YVjiQYyoA30Ti6la2++0n/n83vTW/e3ix1gcgzXgPchBoC/AFu/UBF5InryAAAAAElFTkSuQmCC",bluebox:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwTE5pcivoAAALsSURBVDjLXZPPaxxlGMc/77wz+3N2k822tWsTIrQFe/BWEKxKCV5UohdFhJ60p6rgUfpP6C0K4kHx0ENEkV7aElHwUikhFVosRGoTm83+3pnZnXfed2beHtItIQ98+Z6+H57nga8AsNYKDkYcEofcHvKZEEJYcSTszPzqL3fmf3+w/+a51tytby9d6D0N5UecGeBZ8MPv/jh9fy/6dKzMpVPHmvWdbl/XCvKn5Wbl6+ufrNwGssMgYa2VgFj58sZr7VB/LqX3zlKrydJzTTzXxdqcx90hO+0Bk2l8Z74i1z6+cOba5VfOqGeAb3579M/NR53T40xwrDGHFALPEUjn4LoMi0ktwWTKXqCIqAVrbyycvHj2hHYBR+bO8Q/Ov0imEzZ2xrRDRalQwC9LLBalUgaJQy+tU6gvIBJbv3j2RA4IFxDdICFa9ulMCrz/UgOs5kEwpeh57I4Nt/dzsmLOYlEThgFjUePp33IHoD9SJAbuTVyudRweixJvnVtg3/i00wpLPiwQ0hkO6YYKawWj0UjONqAfKHwDkxTqqeW/RHA3hO2+Zqk05e5wTD9KmOqMKDEUqoLNzU0PyF2AQaBoaIhiw0h6TIwgUDCODb5NiWJNlKREyhAozXwOW1tbFSmlcAHbD2KaytCdGgyWglfEs4LeNKeaa4axYRgpwlgTTTXVDDqdTslaewAYh4kNlKUbZsTGonOwCYwm1vq5Ft1AMYgU08SQR5o0gziOcRxHuoCNtdl6uPHX6/Vmi3Yyh9I5IoEgMdkgT9x+qJhEGrdQo77cJMuy+4DJskwLa60DOCtf3HhZpfZKtVx+L3x+sfCv8CFxTINd72HfodQ4aQp5fP24/v/Hd4Nf/5RSJmma6lkXZn1wPvvq5qndsbhS9esf/Zy/UEtzxnURfn8+/fuHV7m353mecV1XSym1lDI72kaxvr5e3N7eruyP0tpG/e3LK/rW2mLNUb7vm3K5nFarVdNqtbJer2dXV1fzJ6cDpboAZRAGAAAAAElFTkSuQmCC",refresh:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAK8AAACvABQqw0mAAAAAd0SU1FB90CFA8bKScXIjIAAAJ1SURBVDjLlVJdSJNRGH7es+/7NlduWFLTKAskwjJqZYiBglJhLKguqou6EFkFIkLQH9IPBFI3BsouzMJupGYRajcqmeBFhWBU5oUgpZikrSnzZ9v3nW/ndKEbziXUAwfOOe/7Puc9z/MCq1DwMmB1NX/rzfCNnsc/gK08lPgnnT8Cs33BULg0HI4YKdkHX9DqKwKArXXv1bTMTFcoyruC89E8MxaDw659t6rKhIUwRBLdP2t2v/5bBwQA+5pH8ibnIj3BucgWIQRASw8RERTGYFUtsGmWYUXKmqmr7t4UAnal54GQ8lq8MBlyOU0CEnA67MiwqfvHbhZ+Smgg6o9eV2L8Nhk6wI2lZeggrpvE+TTjxgxxQ4IbmJsJYSa00JQiotnguacJ8zIZOmDosAnzTpowt8tGj0s0ejZqprnDKmPHSNebjHDkUPatt4cTTbZ+LsmO79XK52dZxTNp9/ovAEDnaM62lo8HHrd9SVfiOelVryrSq9vrEx0s8sW2tuEzDgDgT875bcIsjy6owwAwHhjnYT5bGTL29PiHyuwAMO873aL/Ct5PiPjwXe5vq7KJW2hdJxENMFInGCkhIblLj80WRoyxGxZmh1XJGlSIlV8s6A8kuVDXn+MF6JHC7GBkBSNlOSRgiihMsQhAgJGGNNU1atc2HPG6O8YSBABwt2/nGyFlGSCSB4UIBMuyoQKMFNiUjIApRH5t8YfpFOOrO/JrhZBVUiJLxq2ipIkY8Z36uivpC6txqb3YbhqhIingFlLmxmLSKyXAGAaYqh13aFjfcHJwfE2ClSitK9psc85PMVC3M999orX4Kcf/wuPb27VW7A+O2QVVA1M1CQAAAABJRU5ErkJggg==",newitem:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAtxJREFUeNqM0llIVHEUBvDv3vlfZ8ac6zZtWpmamtliUUHRDlFJWlEYLdBLtG/QBlFJQUTSU089RZRlG4EvkS9NlqkpldHyYLk1OurcOzp30vHO/y6nBwsSIvzgvBw+fpyHA8MwwDmHbdsjQwSbCACkYDBYp6pqU3Fxcfyf/Z+eYRjQOQf+Bnw+30IiIsMwhizL4n3lV6mn7BzZtm1yzn8SETU0NKz+J2ARobe3t85/+SI1506j9hOHqTEO9FYEtR/ZTx/n5FDH6eOkquoni2g00NjUtEzTtBYioneLCulVHKg2yUkNmelUn5VOtUlueu0SqDE/m4iIIpFI64fm5vU65xAMIlicR9rOn/UEKytgmQbYuARAEDAqRLCiQxBFhtTNWzDzxk1LcjgkFhuKIhLR2qJKcN5Al/q7reF/cXUHoA0MtA9Gh4klJIxz6ro+PZiVC0uOw1jimJEDWZbTDhw8lCi0+/3PtUeV696ePIPUnIwxAf3fOjG/7AK8e/e9ZH2K0uWdPRdivANm3NguED1OJBYWQunvDwgAXIqifO54+CC7/tSxMQELL11B/r6D3cnJybniQDis25Ikfn1wD2GdQLIMISkF5JFhudwgjwySkyCkpILkRER0wpf7d2FJkqSoapQRRPCYjoLDR+EY70VXbS2YxCC4nAARbAAQBJBlwTIMZJRsQN7W7eA6t9O8XkE0jRhWLV2y+Gdm9q0dT6rMhLw8dPn7EAoEMBSLIcpjCPUEEPD3gU1Kw+6qZ6TPKrizq3TbAjUUIkFRVYAIkkfG99bWp4P1b7Z0vq5BXtFGPN6zE6Zuo7SiAh01PkycV4jJRRt96VOmrOHhMESHiBEAgMkNlGwqmXC78mG1DXtQdruTgx/eF5g6x9Tly1pCmtYjMSnxatnFTeXXyn8wxiCMAgxz5EmcTjCXCynxblf1C9910eFwrl254nh/dDhqcQ5zeBgAwBiDIAr4NQAWJarVjshqqgAAAABJRU5ErkJggg=="};var SVG={create:function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)c.setAttribute(d,b[d]);return c},addChild:function(a,b,c,d){var e=document.createElementNS("http://www.w3.org/2000/svg",b);for(var f in c)e.setAttribute(f,c[f]);return this._insert(a,e,d)},addChildImage:function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg","image");for(var e in b)"xlink:href"==e?d.setAttributeNS("http://www.w3.org/1999/xlink","href",b[e]):d.setAttribute(e,b[e]);return this._insert(a,d,c)},_insert:function(a,b,c){if(null==c)a.appendChild(b);else{var d=c+1;0==c&&(d=0);var e=a.childNodes[d];e?a.insertBefore(b,e):a.appendChild(b)}return b},init:function(a,b){return this.addChild(a,"svg",b)},_polarToCartesian:function(a,b,c,d){var e=(d-90)*Math.PI/180;return{x:a+c*Math.cos(e),y:b+c*Math.sin(e)}},describeArc:function(a,b,c,d,e){var f=this._polarToCartesian(a,b,c,e),g=this._polarToCartesian(a,b,c,d),h=e-d<=180?"0":"1",i=["M",f.x,f.y,"A",c,c,0,h,0,g.x,g.y].join(" ");return i}};Region.prototype={load:function(a){return _.isString(a)?this.parse(a):(this.chromosome=this._checkChromosomeAlias(a)||this.chromosome,"undefined"!=typeof a.position&&(a.start=parseInt(a.position),a.end=a.start),_.isUndefined(a.start)?this.start=parseInt(this.start):this.start=parseInt(a.start),void(_.isUndefined(a.end)?this.end=parseInt(this.end):this.end=parseInt(a.end)))},parse:function(a){_.isObject(a)&&this.load(obj);var b=/^([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+$/,c=/^([a-zA-Z0-9_])+\:([0-9])+$/;if(b.test(a)||c.test(a)){var d=a.split(":");if(2==d.length){var e=d[1].split("-");this.chromosome=d[0],this.start=parseInt(e[0]),2==e.length?this.end=parseInt(e[1]):this.end=this.start}return!0}return!1},multiParse:function(a){_.isObject(a)&&this.load(obj);var b=/^([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+(,([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+)*$/,c=/^\[([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+(,([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+)*\]$/,d=a;c.test(a)&&(d=a.slice(1,a.length-1));var e=[];if(b.test(d))for(var f=d.split(","),g=0;g<f.length;g++)e.push(new Region(f[g]));return e},center:function(){return this.start+Math.floor(this.length()/2)},length:function(){return this.end-this.start+1},equals:function(a){return this.chromosome===a.chromosome&&this.start===a.start&&this.end===a.end},toString:function(a){var b;return b=1==a?this.chromosome+":"+Utils.formatNumber(this.start)+"-"+Utils.formatNumber(this.end):this.chromosome+":"+this.start+"-"+this.end},_checkChromosomeAlias:function(a){for(var b=0;b<Region.chromosomeAlias.length;b++){var c=Region.chromosomeAlias[b];if(c in a)return a[c]}}},Region.chromosomeAlias=["chromosome","sequenceName"],Grid.prototype={getPanel:function(){return this.grid},getStore:function(){return this.store},loadData:function(a){this.store.loadData(a)},remove:function(a){this.store.remove(a)},removeAll:function(){this.store.removeAll()},clear:function(){this.store.removeAll()},add:function(a){this.store.add(a)},count:function(){return this.store.count()},getAt:function(a){if(a>=0)return this.store.getAt(a)},refresh:function(){this.grid.getView().refresh()},getData:function(){for(var a=[],b=0;b<this.count();b++)a.push(this.getAt(b));return a},addAll:function(a){for(var b=0;b<a.length;b++)this.add(a[b])},insert:function(a,b){this.store.insert(a,b)},addColumn:function(a,b,c){for(var d=this.model.getFields(),e=0;e<d.length;e++)if(d.name==a&&d[e].type.type==b)return!1;var f=new Ext.create("Ext.data.Field",{name:"prueba",type:"auto"}),g=new Ext.create("Ext.grid.column.Column",{text:"Prueba",dataIndex:"prueba"});d.push(f),this.model.setFields(d),console.log(this.model.getFields()),this.grid.columns.push(g)},createModel:function(a,b){this.model=Ext.define(a,{extend:"Ext.data.Model",fields:b})},createStore:function(){this.store=Ext.create("Ext.data.Store",{model:this.model,data:[],autoLoad:!1})},setLoading:function(a){this.grid.setLoading(a)}},FeatureBinarySearchTree.prototype={constructor:FeatureBinarySearchTree,add:function(a){var b,c={value:a,left:null,right:null};if(null===this._root)return this._root=c,
!0;for(b=this._root;;)if(c.value.end<b.value.start){if(null===b.left)return b.left=c,!0;b=b.left}else{if(!(c.value.start>b.value.end))return!1;if(null===b.right)return b.right=c,!0;b=b.right}},contains:function(a){for(var b={value:a,left:null,right:null},c=!1,d=this._root;!c&&d;)b.value.end<d.value.start?d=d.left:b.value.start>d.value.end?d=d.right:c=!0;return c}};var CellBaseManager={host:"undefined"==typeof window.CELLBASE_HOST?"http://bioinfo.hpc.cam.ac.uk/cellbase":window.CELLBASE_HOST,version:"undefined"==typeof window.CELLBASE_VERSION?"v3":window.CELLBASE_VERSION,get:function(a){var b=a.success,c=a.error,d=0!=a.async,e=["success","error","async"],f={};for(var g in a)hasOwnProperty.call(a,g)&&null!=a[g]&&e.indexOf(g)==-1&&(f[g]=a[g]);var h=CellBaseManager.url(f);if("undefined"!=typeof h){null!=window.CELLBASE_LOG&&CELLBASE_LOG===!0&&console.log(h);var i,j=new XMLHttpRequest;return j.onload=function(){var a=this.getResponseHeader("Content-Type");if("application/json"===a){var c=JSON.parse(this.response);"function"==typeof b&&b(c),i=c}else console.log("Cellbase returned a non json object or list, please check the url."),console.log(h),console.log(this.response)},j.onerror=function(){console.log("CellBaseManager: Ajax call returned "+this.statusText),"function"==typeof c&&c(this)},j.open("GET",h,d),j.send(),i}},url:function(a){null==a&&(a={}),null==a.params&&(a.params={});var b=this.version;null!=a.version&&(b=a.version);var c=this.host;null!=a.host&&(c=a.host),delete a.host,delete a.version;var d={host:c,version:b};for(var e in a)hasOwnProperty.call(a,e)&&null!=a[e]&&(d[e]=a[e]);var f="";null!=d.query&&(f="/"+d.query.toString()),d.species&&null!=d.species.id&&(null!=d.species.assembly&&(d.params.assembly=d.species.assembly.name),"chromosome"===d.subCategory&&delete d.params.assembly,d.species=Utils.getSpeciesCode(d.species.scientificName));var g;return g="meta"===d.category?d.host+"/webservices/rest/"+d.version+"/"+d.category+"/"+d.subCategory:d.host+"/webservices/rest/"+d.version+"/"+d.species+"/"+d.category+"/"+d.subCategory+f+"/"+d.resource,g=Utils.addQueryParamtersToUrl(d.params,g)}},OpencgaManager={host:"undefined"==typeof window.OPENCGA_HOST?"http://ws1.babelomics.org/opencga-0.7":window.OPENCGA_HOST,version:"undefined"==typeof window.OPENCGA_VERSION?"v1":window.OPENCGA_VERSION,users:{login:function(a){return OpencgaManager._doRequest(a,"users","login")},logout:function(a){return OpencgaManager._doRequest(a,"users","logout")},read:function(a){return OpencgaManager._doRequest(a,"users","info")},update:function(a){return OpencgaManager._doRequest(a,"users","update")},updateEmail:function(a){return OpencgaManager._doRequest(a,"users","change-email")},updatePassword:function(a){return OpencgaManager._doRequest(a,"users","change-password")},resetPassword:function(a){return OpencgaManager._doRequest(a,"users","reset-password")},create:function(a){return OpencgaManager._doRequest(a,"users","create")},"delete":function(a){return OpencgaManager._doRequest(a,"users","delete")}},projects:{list:function(a){return OpencgaManager._doRequest(a,"projects","all-projects")},read:function(a){return OpencgaManager._doRequest(a,"projects","info")},update:function(a){return OpencgaManager._doRequest(a,"projects","update")},create:function(a){return OpencgaManager._doRequest(a,"projects","create")},"delete":function(a){return OpencgaManager._doRequest(a,"projects","delete")},studies:function(a){return OpencgaManager._doRequest(a,"projects","studies")}},studies:{list:function(a){return OpencgaManager._doRequest(a,"studies","all-studies")},read:function(a){return OpencgaManager._doRequest(a,"studies","info")},update:function(a){return OpencgaManager._doRequest(a,"studies","update")},create:function(a){return OpencgaManager._doRequest(a,"studies","create")},"delete":function(a){return OpencgaManager._doRequest(a,"studies","delete")},analysis:function(a){return OpencgaManager._doRequest(a,"studies","analysis")},jobs:function(a){return OpencgaManager._doRequest(a,"studies","jobs")},samples:function(a){return OpencgaManager._doRequest(a,"studies","samples")},variants:function(a){return OpencgaManager._doRequest(a,"studies","variants")},files:function(a){return OpencgaManager._doRequest(a,"studies","files")}},cohorts:{create:function(a){return OpencgaManager._doRequest(a,"cohorts","create")},update:function(a){return OpencgaManager._doRequest(a,"cohorts","update")}},files:{list:function(a){return OpencgaManager._doRequest(a,"files","list")},fetch:function(a){return OpencgaManager._doRequest(a,"files","fetch")},alignments:function(a){return OpencgaManager._doRequest(a,"files","alignments")},variants:function(a){return OpencgaManager._doRequest(a,"files","variants")},read:function(a){return OpencgaManager._doRequest(a,"files","info")},info:function(a){return OpencgaManager._doRequest(a,"files","info")},"delete":function(a){return OpencgaManager._doRequest(a,"files","delete")},index:function(a){return OpencgaManager._doRequest(a,"files","index")},search:function(a){return OpencgaManager._doRequest(a,"files","search")},filesByFolder:function(a){return OpencgaManager._doRequest(a,"files","files")},content:function(a){return OpencgaManager._doRequest(a,"files","content")},contentGrep:function(a){return OpencgaManager._doRequest(a,"files","content-grep")},createFolder:function(a){return OpencgaManager._doRequest(a,"files","create-folder")},setHeader:function(a){return OpencgaManager._doRequest(a,"files","set-header")},contentExample:function(a){return OpencgaManager._doRequest(a,"files","content-example")},downloadExample:function(a){return OpencgaManager._doRequest(a,"files","download-example")},update:function(a){return OpencgaManager._doRequest(a,"files","update")},download:function(a){return OpencgaManager._doRequest(a,"files","download")},upload:function(a){return OpencgaManager._doRequest(a,"files","upload")},upload2:function(a){var b={sid:Cookies("bioinfo_sid"),studyId:a.studyId};b.path=a.relativeFilePath,OpencgaManager.files.search({query:b,request:{success:function(b){if(""===b.response[0].errorMsg||null==b.response[0].errorMsg)if(0==b.response[0].result.length){var c=OpencgaManager._url({query:{sid:a.sid},request:{}},"files","upload");a.url=c,OpencgaManager._uploadFile(a)}else a.error("File already exists",b.response[0].result);else a.error(b.response[0].errorMsg)},error:function(){a.error("Server error, try again later.")}}})}},jobs:{create:function(a){return OpencgaManager._doRequest(a,"jobs","create")},"delete":function(a){return OpencgaManager._doRequest(a,"jobs","delete")},info:function(a){return OpencgaManager._doRequest(a,"jobs","info")}},samples:{info:function(a){return OpencgaManager._doRequest(a,"samples","info")},search:function(a){return OpencgaManager._doRequest(a,"samples","search")},update:function(a){return OpencgaManager._doRequest(a,"samples","update")}},util:{proxy:function(a){return OpencgaManager._doRequest(a,"util","proxy")}},tools:{search:function(a){return OpencgaManager._doRequest(a,"tools","search")},info:function(a){return OpencgaManager._doRequest(a,"tools","info")},help:function(a){return OpencgaManager._doRequest(a,"tools","help")},update:function(a){return OpencgaManager._doRequest(a,"tools","update")},"delete":function(a){return OpencgaManager._doRequest(a,"tools","delete")}},_url:function(a,b,c){var d=OpencgaManager.host;"undefined"!=typeof a.request.host&&null!=a.request.host&&(d=a.request.host);var e=OpencgaManager.version;"undefined"!=typeof a.request.version&&null!=a.request.version&&(e=a.request.version);var f="";"undefined"!=typeof a.id&&null!=a.id&&(f="/"+a.id);var g=d+"/webservices/rest/"+e+"/"+b+f+"/"+c;return g=Utils.addQueryParamtersToUrl(a.query,g)},_doRequest:function(a,b,c){var d=OpencgaManager._url(a,b,c);if(a.request.url===!0)return d;var e="GET";"undefined"!=typeof a.request.method&&null!=a.request.method&&(e=a.request.method);var f=!0;"undefined"!=typeof a.request.async&&null!=a.request.async&&(f=a.request.async),null!=window.OPENCGA_LOG&&OPENCGA_LOG===!0&&console.log(d);var g=new XMLHttpRequest;return g.onload=function(){var b=this.getResponseHeader("Content-Type");if("application/json"===b){var c=JSON.parse(this.response);""===c.error||null==c.error?a.request.success(c,this):(null!=window.OPENCGA_LOG&&OPENCGA_LOG===!0&&(console.log("! ----    OpencgaManager -------"),console.log(c.error),console.log(c),console.log("! ----    OpencgaManager -------")),a.request.error(c,this))}else a.request.success(this.response,this)},g.onerror=function(b){a.request.error({error:"Request error.",errorEvent:b},this)},g.open(e,d,f),g.send(),d},_uploadFile:function(a){var b,c,d=a.url,e=a.inputFile,f=a.fileName,g=a.userId,h=a.studyId,i=a.relativeFilePath,j=a.fileFormat,k=a.bioFormat,l=a.description,m=a.callbackProgress,n=!0,o={},p={},q=0,r=e,s=2097152,t=r.size,u=Math.max(Math.ceil(t/s),1),v=function(a){var b=new XMLHttpRequest;b.open("POST",d,!1),b.send(a);var c=JSON.parse(b.responseText);return c.response[0]},w=function(a,b,c){return"undefined"!=typeof c[a]&&c[a].size==b},x=function(a){var b=r.slice(a.start,a.end);if(0==w(a.id,b.size,o)){var c=new FormData;c.append("chunk_content",b),c.append("chunk_id",a.id),c.append("chunk_size",b.size),c.append("filename",f),c.append("userId",g),c.append("studyId",h),c.append("relativeFilePath",i),a.last&&(c.append("last_chunk",!0),c.append("total_size",t),c.append("fileFormat",j),c.append("bioFormat",k),console.log(k),c.append("description",l)),y(c,a,function(b){OpencgaManager.__fix_fileBioformat(b,k,function(b){m(a,u,b)}),a.last||x(p[a.id+1])})}else m(a,u),a.last||x(p[a.id+1])},y=function(a,b,c){var e=new XMLHttpRequest;e.open("POST",d,!0),e.onload=function(a){b.done=!0,console.log("chunk done"),c(JSON.parse(e.responseText))},e.send(a)};if(n){var z=new FormData;z.append("resume_upload",n),z.append("filename",f),z.append("userId",g),z.append("studyId",h),z.append("relativeFilePath",i),o=v(z)}for(b=0,c=s;b<t;){var A=!1;q==u-1&&(A=!0),p[q]={id:q,start:b,end:c,done:!1,last:A},b=c,c=b+s,q++}x(p[0])},__fix_fileBioformat:function(a,b,c){if(null!=a.response[0].result){var d=a.response[0].result[0];OpencgaManager.files.update({id:d.id,query:{sid:Cookies("bioinfo_sid"),bioformat:b},request:{success:function(b){var d=b.response[0].result[0];a.response[0].result[0]=d,c(a)},error:function(a){}}})}else c(a)}},EnsemblManager={host:"http://beta.rest.ensembl.org",get:function(a){var b=a.success,c=a.error,d=!(!_.isUndefined(a.async)&&!_.isNull(a.async))||a.async,e=_.omit(a,["success","error","async"]),f=EnsemblManager.url(e);if("undefined"!=typeof f){console.log(f);var g;return $.ajax({type:"GET",url:f,dataType:"json",async:d,success:function(a,c,d){$.isPlainObject(a)||$.isArray(a)?(_.isFunction(b)&&b(a),g=a):(console.log("Cellbase returned a non json object or list, please check the url."),console.log(f),console.log(a))},error:function(a,b,d){console.log("CellBaseManager: Ajax call returned : "+d+"\t"+b+"\t"+a.statusText+" END"),_.isFunction(c)&&c(a,b,d)}}),g}},url:function(a){$.isPlainObject(a)||(a={}),$.isPlainObject(a.params)||(a.params={});var b=EnsemblManager.host;if("undefined"!=typeof a.host&&(b=a.host),"undefined"==typeof b)return void console.log("CELLBASE_HOST is not configured");delete a.host;var c={host:b},d={"content-type":"application/json"};_.extend(c,a),_.extend(c.params,d),$.isPlainObject(c.species)&&(c.species=Utils.getSpeciesCode(c.species.text));var e=c.host+"/"+c.category+"/"+c.subCategory+"/"+c.species+"/"+c.query;return e=Utils.addQueryParamtersToUrl(c.params,e)}};FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()},FileWidget.prototype.getFileFromServer=function(){},FileWidget.prototype.loadFileFromLocal=function(){},FileWidget.prototype.getFileUpload=function(){var a=this;return this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",flex:1,padding:1,emptyText:"Choose a file",allowBlank:!1,anchor:"100%",buttonText:"Browse local",listeners:{change:{fn:function(){a.panel.setLoading();var b=document.getElementById(a.uploadField.fileInputEl.id).files[0];a.trackNameField.setValue(b.name),a.fileNameLabel.setText('<span class="emph">'+b.name+'</span> <span class="info">(local)</span>',!1),a.loadFileFromLocal(b),a.panel.setLoading(!1)}}}}),this.uploadField},FileWidget.prototype.draw=function(){var a=this;if(null==this.openDialog){var b=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">No file loaded</span>'}),b.add([this.featureCountLabel]);var c=Ext.create("Ext.toolbar.Toolbar");c.add(this.getFileUpload()),this.panel=Ext.create("Ext.panel.Panel",{border:!1,height:230,title:"Previsualization",bbar:b}),this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:!1,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});var d=Ext.create("Ext.panel.Panel",{border:!1,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});this.wum&&(null!=Cookies("bioinfo_sid")?this.sessionInitiated():this.sessionFinished()),this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{}),this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){a.trigger("okButton:click",{fileName:a.file.name,adapter:a.adapter}),a.openDialog.close()}}),this.openDialog=Ext.create("Ext.window.Window",{title:"Open "+this.title+" file",width:600,resizable:!1,items:[c,d],buttons:[this.btnOk,{text:"Cancel",handler:function(){a.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()},FileWidget.prototype.sessionInitiated=function(){},FileWidget.prototype.sessionFinished=function(){},BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,BEDFileWidget.prototype.draw=FileWidget.prototype.draw,BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,BEDFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,BEDFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,BEDFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new BEDDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.on("file:load",function(a){}),b.btnOk.enable()},BEDFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new BEDDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this._loadChartInfo(),this.btnOk.enable()},GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,GFFFileWidget.prototype.draw=FileWidget.prototype.draw,GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,GFFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,GFFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,GFFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;switch(this.file=a,this.version){case"2":case 2:this.adapter=new GFF2DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species});break;case"3":case 3:this.adapter=new GFF3DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species})}this.adapter.on("file:load",function(a){}),b.btnOk.enable()},GFFFileWidget.prototype.loadFileFromServer=function(a){switch(this.file={name:a.filename},this.version){case"2":case 2:this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;case"3":case 3:this.adapter=new GFF3DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species})}this._loadChartInfo(),this.btnOk.enable()},GTFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,GTFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,GTFFileWidget.prototype.draw=FileWidget.prototype.draw,GTFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,GTFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,GTFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,GTFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,GTFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new GTFDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.onLoad.addEventListener(function(a){console.log(b.adapter.featuresByChromosome),b._loadChartInfo()}),b.btnOk.enable()},GTFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new GTFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this._loadChartInfo(),this.btnOk.enable()},TrackSettingsWidget.prototype={setFilters:function(a){this.trackSvg.setFilters(a)},draw:function(){for(var a=this,b=[],c=[],d=0;d<this.filtersConfig.length;d++){var e,f=this.filtersConfig[d].text,g=this.filtersConfig[d].name,h=[];e=null==this.filters[g];for(var i=0;i<this.filtersConfig[d].values.length;i++)h.push({text:this.filtersConfig[d].values[i],leaf:!0,checked:e,iconCls:"icon-blue-box"});var j={text:g,expanded:!0,checked:e,iconCls:"icon-box",children:h},k=Ext.create("Ext.data.TreeStore",{root:j,fields:["text","name"]});b.push({xtype:"treepanel",useArrows:!0,bodyPadding:"10 0 10 0",title:f,border:!1,store:k,listeners:{checkchange:function(a,b,c){a.isRoot()&&a.eachChild(function(a){a.set("checked",b)})},afterrender:function(b){var c=b.getStore().getRootNode(),d=c.get("text");if(null!=a.filters[d])for(var e=0;e<a.filters[d].length;e++){var f=c.findChild("text",a.filters[d][e]);f.set("checked",!0),f.save}}}}),c.push(k)}var l=Ext.create("Ext.panel.Panel",{title:"Display settings",bodyPadding:10,items:[{xtype:"textfield",value:a.trackSvg.getTitle(),fieldLabel:"TrackName",allowBlank:!1,listeners:{change:function(b,c){b.isValid()&&(a.trackSvg.setTitle(c),a.treeRecord.set("text",c),a.treeRecord.save())}}}]}),m=Ext.create("Ext.tab.Panel",{title:"Filters",items:b});Ext.create("Ext.window.Window",{id:this.id+"window",title:"Settings",width:500,modal:!0,items:[l,m],buttons:[{text:"Ok",id:this.id+"okButton",handler:function(){for(var b={},d=0;d<c.length;d++){var e=c[d].getRootNode(),f=e.get("text"),g=[],h=0;e.eachChild(function(a){h++,a.data.checked&&g.push(a.get("text"))}),g.length==h&&(g=[]),b[f]=g}console.log(b),a.setFilters(b),Ext.getCmp(a.id+"window").destroy()}},{text:"Cancel",handler:function(){a.trackSvg.setTitle(n),a.treeRecord.set("text",n),a.treeRecord.save(),Ext.getCmp(a.id+"window").destroy()}}]}).show();var n=a.trackSvg.getTitle()}},UrlWidget.prototype.draw=function(){null==this.panel&&this.render(),this.panel.show()},UrlWidget.prototype.render=function(){var a=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,width:this.width-55,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var b=this.value.split("/das/")[1].split("/")[0];a.trackNameField.setValue(b)}}}}),this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){a.form.setLoading();var b=new DasAdapter({url:a.urlField.getValue(),featureCache:{gzip:!1,chunkSize:1e4},handlers:{"url:check":function(b){console.log(b.data),a.contentArea.setValue(b.data),a.form.setLoading(!1)},error:function(){a.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin"),a.form.setLoading(!1)}}});b.checkUrl()}}),this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:!1,value:a.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",flex:1}),this.panelSettings=Ext.create("Ext.panel.Panel",{layout:"hbox",border:!1,title:"Track name",cls:"panel-border-top",bodyPadding:10,width:this.width-2,items:[this.trackNameField]}),this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height}),this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false",items:[this.urlField,this.checkButton]}),this.form=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.contentArea,this.panelSettings]}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,layout:"fit",resizable:!1,items:[this.form],buttons:[{text:"Add",handler:function(){a.trigger("addButton:click",{name:a.trackNameField.getValue(),url:a.urlField.getValue()}),a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}})},VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,VCFFileWidget.prototype.draw=FileWidget.prototype.draw,VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,VCFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,VCFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,VCFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new VCFDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.on("file:load",function(a){console.log(b.adapter.featuresByChromosome)}),b.btnOk.enable()},VCFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new VCFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this.btnOk.enable()},InfoWidget.prototype.draw=function(a){console.log(a),this.query=a.query,this.feature=a.feature,this.adapter=a.adapter,this.panel=Ext.getCmp(this.title+" "+this.query),null==this.panel?(this.render(),this.panel.show(),this.getData()):this.panel.show()},InfoWidget.prototype.render=function(){this.panel=Ext.create("Ext.window.Window",{title:this.title+" "+this.query,id:this.title+" "+this.query,minimizable:!0,constrain:!0,closable:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:[this.getTreePanel()],buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})},InfoWidget.prototype.getTreePanel=function(){var a=this.getdataTypes();this.checkDataTypes(a);var b=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Options",children:a}}),c=Ext.create("Ext.tree.Panel",{title:"Detailed information",bodyPadding:10,flex:1,border:!1,store:b,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){this.optionClick(b.data)}}});return c},InfoWidget.prototype.doGrid=function(a,b,c,d){for(var e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{[values.name]} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})',startCollapsed:!0}),f=[],g=0;g<b.length;g++)f.push({type:"string",dataIndex:b[g]});var f={ftype:"filters",local:!0,filters:f};Ext.define(c,{extend:"Ext.data.Model",fields:b});var h=Ext.create("Ext.data.Store",{groupField:d,model:c}),i=Ext.create("Ext.grid.Panel",{id:this.id+c,store:h,title:c,border:!1,cls:"ocb-border-left-lightgrey",flex:3,features:[e,f],viewConfig:{enableTextSelection:!0},columns:a,bbar:["->",{text:"Clear Grouping",handler:function(){e.disable()}}]});return i},InfoWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)},InfoWidget.prototype.getdataTypes=function(){return[]},InfoWidget.prototype.optionClick=function(){},InfoWidget.prototype.getData=function(){},InfoWidget.prototype.getGeneTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {id} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Location/View?g={id}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',"</div><br>",'<div><span class="w75 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w75 infokey s90">Biotype: </span> {biotype}</div>','<div><span class="w75 infokey s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></div>','<div><span class="w75 infokey s90">Source: </span> <span class="s110">{source}</span></div>','<div><span class="w75 infokey s90">Status: </span> {status}</div>')},InfoWidget.prototype.getTranscriptTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {id} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={id}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',"</div><br>",'<div><span class="w100 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w100 infokey s90">Biotype: </span> {biotype}</div>','<div><span class="w100 infokey s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></div>',"",'<div><span class="w100 infokey s90">CDS &nbsp; (start-end): </span> {genomicCodingStart}-{genomicCodingEnd} <span style="margin-left:50px" class="w100 infokey s90">CDNA (start-end): </span> {cdnaCodingStart}-{cdnaCodingEnd}</div>','<div><span class="w100 infokey s90">Protein: </span> {proteinID}</div>','<div><span class="w100 infokey s90">External DB: </span> {externalDb}</div>','<div><span class="w100 infokey s90">Status: </span> {status}</div><br>')},InfoWidget.prototype.getSnpTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{id}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Variation/Summary?v={id}">Ensembl</a>',"</div><br>",'<div><span class="w140 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w140 infokey s90">Source: </span> <span class="s110">{source}</span></div>','<div><span class="w140 infokey s90">Type: </span> <span class="s110">{type}</span></div>','<div><span class="w140 infokey s90">Allele string: </span> {alleleString}</div>','<div><span class="w140 infokey s90">Ancestral allele: </span> {ancestralAllele}</div>','<div><span class="w140 infokey s90">Display SO consequence type: </span> {displayConsequenceType}</div>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div>')},InfoWidget.prototype.getExonTemplate=function(){return new Ext.XTemplate('<span><span class="panel-border-bottom"><span class="ssel s110">{id}</span></span></span><br><br>','<span><span class="infokey s90"> Location: </span> <span class="">{chromosome}:{start}-{end} </span></span><br>','<span><span class="infokey s90"> Genomic coding (start-end) : </span> <span class="">{genomicCodingStart}-{genomicCodingEnd} </span></span><br>','<span><span class="infokey s90"> cDNA (start-end) : </span> <span class="">{cdnaCodingStart}-{cdnaCodingEnd} </span></span><br>','<span><span class="infokey s90"> CDS (start-end) : </span> <span class="">{cdsStart}-{cdsEnd} </span></span><br>','<span><span class="infokey s90"> Phase: </span> {phase}</span><br>')},InfoWidget.prototype.getProteinTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {primaryAccession} </span></span></div>',"<br>",'<div><span class="w100 infokey s90">Full name: </span> <span class="">{fullName}</span></div>','<div><span class="w100 infokey s90">Gene name: </span> <span class="">{geneName}</span></div>','<div><span class="w100 infokey s90">Organism: </span> <span class="">{organism}</span></div>')},InfoWidget.prototype.getVCFVariantTemplate=function(){return new Ext.XTemplate('<div><span><span class="panel-border-bottom"><span class="ssel s130">{chromosome}:{start}-{alternate}</span> &nbsp; <span class="emph s120"> {id} </span></span></span></div><br>','<div><span class="w75 infokey s90">Alt: </span> {alternate}</div>','<div><span class="w75 infokey s90">Ref: </span> {reference}</div>','<div><span class="w75 infokey s90">Quality: </span> {quality}</div>','<div><span class="w75 infokey s90">Format: </span> {format}</div>','<div><span class="w75 infokey s90">Samples: </span> {samples}</div>','<div><span class="w75 infokey s90">Info: <br></span> {info}</div>')},InfoWidget.prototype.getPWMTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{accession}</span> &nbsp; <span class="emph s120"> {tfName} </span></span></div>',"<br>",'<div><span class="w100 infokey s90">Type: </span> <span class="">{source}</span></div>','<div><span class="w100 infokey s90">Source: </span> <span class="">{type}</span></div>','<div><span class="w100 infokey s90">Description: </span> <span class="">{description}</span></div>','<div><span class="w100 infokey s90">Length: </span> <span class="">{length}</span></div>','<div><span class="w100 infokey s90">Frequencies: </span> <span class="">{[this.parseFrequencies(values.frequencies)]}</span></div>',{parseFrequencies:function(a){return"<div>"+a.replace(/,/gi,"<br>")+"</div>"}})},InfoWidget.prototype.getProteinXrefTemplate=function(){return new Ext.XTemplate('<div><span class="w75 emph s100">{[values.source.toUpperCase()]}</span> &nbsp; <span class="emph w125 s100"> {[this.generateLink(values)]} <span class="info">&raquo;</span> </span></div>',{generateLink:function(a){if(null==a.source)return"";switch(a.source.toUpperCase()){case"GO":return'<a TARGET="_blank" href="http://amigo.geneontology.org/cgi-bin/amigo/term_details?term='+a.name+'">'+a.name+"</a>";case"REACTOME":return'<a TARGET="_blank" href="http://www.reactome.org/cgi-bin/eventbrowser_st_id?ST_ID='+a.name+'">'+a.name+"</a>";case"KEGG":return'<a TARGET="_blank" href="http://www.genome.jp/dbget-bin/www_bget?'+a.name+'">'+a.name+"</a>";case"INTACT":return'<a TARGET="_blank" href="http://www.ebi.ac.uk/intact/pages/interactions/interactions.xhtml?query='+a.name+'">'+a.name+"</a>";case"MINT":return'<a TARGET="_blank" href="http://mint.bio.uniroma2.it/mint/search/search.do?queryType=protein&interactorAc='+a.name+'">'+a.name+"</a>";case"DIP":return'<a TARGET="_blank" href="http://dip.doe-mbi.ucla.edu/dip/Browse.cgi?ID='+a.name+'">'+a.name+"</a>";case"STRING":return'<a TARGET="_blank" href="http://string-db.org/newstring_cgi/show_network_section.pl?identifier=P51587">'+a.name+"</a>";case"MIM":return'<a TARGET="_blank" href="http://www.omim.org/entry/'+a.name+'">'+a.name+"</a>";case"PHARMGKB":return'<a TARGET="_blank" href="http://www.pharmgkb.org/do/serve?objId='+a.name+'&objCls=Gene">'+a.name+"</a>";case"ORPHANET":return'<a TARGET="_blank" href="http://www.orpha.net/consor/cgi-bin/OC_Exp.php?lng=EN&Expert='+a.name+'">'+a.name+"</a>";
}}})},InfoWidget.prototype.getSnpTranscriptTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{[this.getStableId(values)]}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={[this.getStableId(values)]}">Ensembl</a>',"</div><br>",'<div><span class="w140 infokey s90">CDS &nbsp; (start - end): </span> {cdsStart} - {cdsEnd} <span style="margin-left:50px" class="w100 infokey s90">cDNA (start - end): </span> {cdnaStart} - {cdnaEnd}</div>','<div><span class="w140 infokey s90">Translation (start - end): </span> {translationStart} - {translationEnd}</div>','<div><span class="w140 infokey s90">Peptide allele: </span> {peptideAlleleString}</div>','<div><span class="w140 infokey s90">Codon: </span> {codonAlleleString}</div>','<div><span class="w140 infokey s90">HGVS Genomic: </span> {hgvsGenomic}','<div><span class="w140 infokey s90">HGVS Protein: </span> {hgvsProtein}','<div><span class="w140 infokey s90">HGVS Transcript: </span> {hgvsTranscript}','<div><span class="w140 infokey s90">Polyphen prediction: </span> {polyphenPrediction}','<span style="margin-left:50px" class="w140 infokey s90">Polyphen score: </span> {polyphenScore}</div>','<div><span class="w140 infokey s90">Sift prediction: </span> {siftPrediction}','<span style="margin-left:50px" class="w140 infokey s90">Sift score: </span> {siftScore}</div>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div><br>',{getStableId:function(a){return""!=a.transcriptId?a.transcriptId:"Intergenic SNP"}})},InfoWidget.prototype.getConsequenceTypeTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{transcriptId}</span> &nbsp; </span></div><br>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div><br>')},InfoWidget.prototype.getPhenotypeTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{phenotypeDescription}</span> &nbsp; <span class="emph s120"> {source} </span></span></div><br>','<div><span class="w150 infokey s90">PValue: </span>{PValue}</div>','<div><span class="w150 infokey s90">Assoc. gene name: </span>{associatedGeneName}</div>','<div><span class="w150 infokey s90">Assoc. variant risk allele: </span>{associatedVariantRiskAllele}</div>','<div><span class="w150 infokey s90">Phenotype description: </span>{phenotypeDescription}</div>','<div><span class="w150 infokey s90">Phenotype name: </span>{phenotypeName}</div>','<div><span class="w150 infokey s90">Risk allele freq in controls: </span>{riskAlleleFrequencyInControls}</div>','<div><span class="w150 infokey s90">Source: </span>{source}</div>','<div><span class="w150 infokey s90">Study name: </span>{studyName}</div>','<div><span class="w150 infokey s90">Study type: </span>{studyType}</div>','<div><span class="w150 infokey s90">Study URL: </span>{studyUrl}</div>','<div><span class="w150 infokey s90">Study description: </span>{studyDescription}</div>')},InfoWidget.prototype.getPopulationTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{population}</span> &nbsp; <span class="emph s120"> {source} </span></span></div><br>','<div><span class="w140 infokey s90">Ref allele:  </span>{refAllele} ({refAlleleFrequency})</div>','<div><span class="w140 infokey s90">Other allele:  </span>{otherAllele} ({otherAlleleFrequency})</div>','<div><span class="w140 infokey s90">Ref allele homozygote:  </span>{refAlleleHomozygote} ({refAlleleHomozygoteFrequency})</div>','<div><span class="w140 infokey s90">Allele heterozygote:  </span>{alleleHeterozygote} ({alleleHeterozygoteFrequency})</div>','<div><span class="w140 infokey s90">Other allele homozygote:  </span>{otherAlleleHomozygote} ({otherAlleleHeterozygoteFrequency})</div>','<div><span class="w140 infokey s90">Source:  </span>{source}</div>','<div><span class="w140 infokey s90">Population:  </span>{population}</div>')},InfoWidget.prototype.getVariantEffectTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{consequenceTypeObo}</span> &nbsp; <span class="emph s120"> {featureBiotype} </span></span></div><br>')},GeneInfoWidget.prototype.draw=InfoWidget.prototype.draw,GeneInfoWidget.prototype.render=InfoWidget.prototype.render,GeneInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,GeneInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,GeneInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,GeneInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,GeneInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,GeneInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"},{text:"Xrefs"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]},GeneInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getGenePanel(this.data).show());break;case"Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Xrefs":this.panel.add(this.getXrefGrid(this.data.transcripts,"Xref","transcript").show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.transcripts,"GO","transcript").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.transcripts,"Interpro","transcript").show());break;case"Reactome":this.panel.add(this.getXrefGrid(this.data.transcripts,"Reactome","transcript").show());break;case"Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());break;case"3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}},GeneInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},GeneInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},GeneInfoWidget.prototype.getXrefGrid=function(a,b,c){for(var d=[],e=0;e<a.length;e++)for(var f=0;f<a[e].xrefs.length;f++){var g=a[e].xrefs[f];if("Xref"==b){var h=g.dbName.toLowerCase();"go"!=h&&"interpro"!=h&&"reactome"!=h&&(g.transcript=a[e].id,d.push(g))}else g.dbName.toLowerCase()==b.toLowerCase()&&(g.transcript=a[e].id,d.push(g))}if(d.length<=0)return this.notFoundPanel;if(null==this[b+"Grid"]){var c=c,i=b,j=["description","id","dbName","transcript"],k=[{header:"Display Id",dataIndex:"id",flex:1},{header:"DB name",dataIndex:"dbName",flex:1},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(k,j,i,c),this[b+"Grid"].store.loadData(d)}return this[b+"Grid"]},GeneInfoWidget.prototype.getTfbsGrid=function(a){if(a.length<=0)return this.notFoundPanel;var b="";if(null!=a[0].id){var c=[];b="transcriptId";for(var d=0;d<a.length;d++)if(transcript=a[d],null!=transcript.tfbs){for(var e=0;e<transcript.tfbs.length;e++)transcript.tfbs[e].transcriptId=transcript.id;c=c.concat(transcript.tfbs)}a=c}if(null==this.tfbsGrid){var b=b,f="TFBS",g=["chromosome","start","end","strand","tfName","relativeStart","relativeEnd","targetGeneName","score","sequence","transcriptId"],h=[{header:"Name",dataIndex:"tfName",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2.5},{header:"Relative (start-end)",xtype:"templatecolumn",tpl:"{relativeStart}-{relativeEnd}",flex:1.5},{header:"Target gene",dataIndex:"targetGeneName",flex:1},{header:"Score",dataIndex:"score",flex:1},{header:"Sequence",dataIndex:"sequence",flex:1}];this.tfbsGrid=this.doGrid(h,g,f,b),this.tfbsGrid.store.loadData(a)}return this.tfbsGrid},GeneInfoWidget.prototype.getMirnaTargetGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaTargetGrid){var b="",c="miRNA targets",d=["chromosome","start","end","strand","mirbaseId","score","experimentalMethod","source"],e=[{header:"Id",dataIndex:"mirbaseId",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Score",dataIndex:"score",flex:1},{header:"Exp. Method",dataIndex:"experimentalMethod",flex:1},{header:"source",dataIndex:"source",flex:1}];this.mirnaTargetGrid=this.doGrid(e,d,c,b),this.mirnaTargetGrid.store.loadData(a)}return this.mirnaTargetGrid},GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneInfoWidget.prototype.get3Dprotein=function(a){var b=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"ocb-border-left-lightgrey",flex:3,autoScroll:!0});var c=[];$.ajax({url:(new CellBaseManager).host+"/v3/"+b.species+"/feature/id/"+this.query+"/xref?dbname=pdb&of=json",async:!1,success:function(a){if(""!=a){c=a[0];for(var d=0;d<c.length;d++){var e=c[d].id,f=Ext.create("Ext.panel.Panel",{title:e,bodyCls:"ocb-background-black",html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+e+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){var b=a.title;ChemDoodle.default_backgroundColor="#000000";var c=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+b,300,300);c.gl?(c.specs.set3DRepresentation("Ball and Stick"),c.specs.proteins_ribbonCartoonize=!0,c.handle=null,c.timeout=15,c.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,c.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,c.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,c.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,c.nextFrame=function(a){var b=[];mat4.identity(b);var c=a/1e3,d=Math.PI/15;mat4.rotate(b,d*c,[1,0,0]),mat4.rotate(b,d*c,[0,1,0]),mat4.rotate(b,d*c,[0,0,1]),mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+b+".pdb",function(a){var b=ChemDoodle.readPDB(a);c.loadMolecule(b),c.startAnimation()})):(c.emptyMessage="Your browser does not support WebGL",c.displayMessage())}}});b.p3dProtein.add(f)}}else b.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein},GeneInfoWidget.prototype.getEnsembleId=function(){},GeneInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"gene",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0])}})},GeneInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},GeneOrangeInfoWidget.prototype.draw=InfoWidget.prototype.draw,GeneOrangeInfoWidget.prototype.render=InfoWidget.prototype.render,GeneOrangeInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,GeneOrangeInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,GeneOrangeInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,GeneOrangeInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,GeneOrangeInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,GeneOrangeInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Functional information",children:[{text:"GO"},{text:"KEGG"},{text:"Interpro"}]}]},GeneOrangeInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getGenePanel(this.data).show());break;case"Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,"Interpro").show());break;case"KEGG":this.panel.add(this.getXrefGrid(this.data.kegg,"KEGG").show())}},GeneOrangeInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},GeneOrangeInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},GeneOrangeInfoWidget.prototype.getXrefGrid=function(a,b){if(a.length<=0)return this.notFoundPanel;if(null==this[b+"Grid"]){var c="",d=b,e=["description","displayId"],f=[{header:"Display Id",dataIndex:"displayId",flex:1},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(f,e,d,c),this[b+"Grid"].store.loadData(a)}return this[b+"Grid"]},GeneOrangeInfoWidget.prototype.getTfbsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.tfbsGrid){var b="",c="TFBS",d=["chromosome","start","end","strand","tfName","relativeStart","relativeEnd","targetGeneName","score","sequence"],e=[{header:"Name",dataIndex:"tfName",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2.5},{header:"Relative (start-end)",xtype:"templatecolumn",tpl:"{relativeStart}-{relativeEnd}",flex:1.5},{header:"Target gene",dataIndex:"targetGeneName",flex:1},{header:"Score",dataIndex:"score",flex:1},{header:"Sequence",dataIndex:"sequence",flex:1}];this.tfbsGrid=this.doGrid(e,d,c,b),this.tfbsGrid.store.loadData(a)}return this.tfbsGrid},GeneOrangeInfoWidget.prototype.getMirnaTargetGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaTargetGrid){var b="",c="miRNA targets",d=["chromosome","start","end","strand","mirbaseId","score","experimentalMethod","source"],e=[{header:"Id",dataIndex:"mirbaseId",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Score",dataIndex:"score",flex:1},{header:"Exp. Method",dataIndex:"experimentalMethod",flex:1},{header:"source",dataIndex:"source",flex:1}];this.mirnaTargetGrid=this.doGrid(e,d,c,b),this.mirnaTargetGrid.store.loadData(a)}return this.mirnaTargetGrid},GeneOrangeInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneOrangeInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneOrangeInfoWidget.prototype.get3Dprotein=function(a){var b=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"panel-border-left",flex:3,autoScroll:!0});var c=[];$.ajax({url:"http://ws.bioinfo.cipf.es/cellbase/rest/v1/hsa/feature/id/"+this.query+"/xref?dbname=pdb",async:!1,success:function(a){if(""!=a){c=a.trim().split("\n");for(var d=0;d<c.length;d++){var e=c[d].trim(),f=Ext.create("Ext.panel.Panel",{title:e,bodyCls:"ocb-background-black",html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+e+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){var b=a.title;ChemDoodle.default_backgroundColor="#000000";var c=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+b,300,300);c.gl?(c.specs.set3DRepresentation("Ball and Stick"),c.specs.proteins_ribbonCartoonize=!0,c.handle=null,c.timeout=15,c.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,c.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,c.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,c.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,c.nextFrame=function(a){var b=[];mat4.identity(b);var c=a/1e3,d=Math.PI/15;mat4.rotate(b,d*c,[1,0,0]),mat4.rotate(b,d*c,[0,1,0]),mat4.rotate(b,d*c,[0,0,1]),mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+b+".pdb",function(a){var b=ChemDoodle.readPDB(a);c.loadMolecule(b),c.startAnimation()})):(c.emptyMessage="Your browser does not support WebGL",c.displayMessage())}}});b.p3dProtein.add(f)}}else b.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein},GeneOrangeInfoWidget.prototype.getEnsembleId=function(){},GeneOrangeInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,c){a.dataReceived(JSON.parse(c.result))}),b.get("feature","gene",this.query,"fullinfo")},GeneOrangeInfoWidget.prototype.dataReceived=function(a){this.data=a[0][0],console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},MirnaInfoWidget.prototype.draw=InfoWidget.prototype.draw,MirnaInfoWidget.prototype.render=InfoWidget.prototype.render,MirnaInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,MirnaInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,MirnaInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,MirnaInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,MirnaInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,MirnaInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Information",children:[{text:"miRNA"},{text:"Transcript"},{text:"Gene"}]},{text:"Regulatory",children:[{text:"Target Genes"}]},{text:"Disease",children:[{text:"Related Diseases"}]}]},MirnaInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"miRNA":this.panel.add(this.getMirnaPanel(this.data.mirna).show());break;case"Transcript":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.genes).show());break;case"Target Genes":this.panel.add(this.getTargetGenesGrid(this.data.targetGenes).show());break;case"Related Diseases":this.panel.add(this.getMirnaDiseasesGrid(this.data.mirnaDiseases).show())}},MirnaInfoWidget.prototype.getMirnaPanel=function(a){if(a.mirnaMature.length<=0&&a.mirnaGenes.length<=0)return this.notFoundPanel;if(null==this.mirnaPanel){for(var b=this.getMirnaMatureTemplate(),c=this.getMirnaGeneTemplate(),d=[],e=0;e<a.mirnaMature.length;e++){var f=Ext.create("Ext.container.Container",{padding:5,data:a.mirnaMature[e],tpl:b});d.push(f)}for(var e=0;e<a.mirnaGenes.length;e++){var g=Ext.create("Ext.container.Container",{padding:5,data:a.mirnaGenes[e],tpl:c});d.push(g)}this.mirnaPanel=Ext.create("Ext.panel.Panel",{title:"miRNA",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:d})}return this.mirnaPanel},MirnaInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},MirnaInfoWidget.prototype.getGenePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.genePanel){for(var b=this.getGeneTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.genePanel=Ext.create("Ext.panel.Panel",{title:"Genes ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.genePanel},MirnaInfoWidget.prototype.getTargetGenesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.targetGenesGrid){var b="",c="targetGenes",d=["externalName","stableId","biotype","chromosome","start","end","strand","description"],e=[{header:"Name",dataIndex:"externalName",flex:1},{header:"Stable Id",dataIndex:"stableId",flex:2},{header:"Biotype",dataIndex:"biotype",flex:1.5},{header:"Chr",dataIndex:"chromosome",flex:.5},{header:"Start",dataIndex:"start",flex:1},{header:"End",dataIndex:"end",flex:1},{header:"Strand",dataIndex:"strand",flex:.5},{header:"Description",dataIndex:"description",flex:1}];this.targetGenesGrid=this.doGrid(e,d,c,b),this.targetGenesGrid.store.loadData(a)}return this.targetGenesGrid},MirnaInfoWidget.prototype.getMirnaDiseasesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaDiseasesGrid){var b="",c="mirnaDiseases",d=["mirnaDiseaseId","mirnaGene","mirbaseId","diseaseName","pubmedId","description"],e=[{header:"Name",dataIndex:"mirbaseId",flex:1.5},{header:"Disease",dataIndex:"diseaseName",flex:1.5},{header:"PubMed id",dataIndex:"pubmedId",flex:1},{header:"Description",dataIndex:"description",flex:3}];this.mirnaDiseasesGrid=this.doGrid(e,d,c,b),this.mirnaDiseasesGrid.store.loadData(a)}return this.mirnaDiseasesGrid},MirnaInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseDataAdapter(this.species);b.successed.addEventListener(function(c){a.dataReceived(b.toJSON())}),b.fill("regulatory","mirna_mature",this.feature.getName(),"fullinfo"),console.log(this.feature.getName())},MirnaInfoWidget.prototype.dataReceived=function(a){var b=JSON.parse(a);this.data=b[0],console.log(this.data),this.optionClick({text:"miRNA",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},MirnaInfoWidget.prototype.getMirnaMatureTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">miRNA mature</span> &nbsp; <span class="emph s120"> {mirbaseId} </span></span></p>',"<br>",'<p><span class="w140 dis s90">miRBase Accession: </span> <span class="">{mirbaseAcc}</span></p>','<span class="w140 dis s90">Sequence: </span> <span class="">{sequence}</span>')},MirnaInfoWidget.prototype.getMirnaGeneTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">miRNA gene</span> &nbsp; <span class="emph s120"> {mirbaseId} </span></span></p>',"<br>",'<p><span class="w140 dis s90">miRBase Accession: </span> <span class="">{mirbaseAcc}</span></p>','<span class="w140 dis s90">Sequence: </span> <span class="">{sequence}</span>','<p><span class="w140 dis s90">Status: </span> <span class="">{status}</span></p>')},ProteinInfoWidget.prototype.draw=InfoWidget.prototype.draw,ProteinInfoWidget.prototype.render=InfoWidget.prototype.render,ProteinInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,ProteinInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,ProteinInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,ProteinInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Sumary",children:[{text:"Long"},{text:"Seq"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Interactions"},{text:"Variations"}]},ProteinInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"":break;case"":break;case"Reactome":break;case"Interpro":break;case"":break;case"":break;case"":}},SnpInfoWidget.prototype.draw=InfoWidget.prototype.draw,SnpInfoWidget.prototype.render=InfoWidget.prototype.render,SnpInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,SnpInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,SnpInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,SnpInfoWidget.prototype.getSnpTemplate=InfoWidget.prototype.getSnpTemplate,SnpInfoWidget.prototype.getSnpTranscriptTemplate=InfoWidget.prototype.getSnpTranscriptTemplate,SnpInfoWidget.prototype.getConsequenceTypeTemplate=InfoWidget.prototype.getConsequenceTypeTemplate,SnpInfoWidget.prototype.getPhenotypeTemplate=InfoWidget.prototype.getPhenotypeTemplate,SnpInfoWidget.prototype.getPopulationTemplate=InfoWidget.prototype.getPopulationTemplate,SnpInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Consequence type"},{text:"Annotated phenotype"}]},SnpInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Transcripts":this.panel.add(this.getSnpTranscriptPanel(this.data.transcriptVariations).show());break;case"Consequence type":this.panel.add(this.getConsequenceTypePanel(this.data.transcriptVariations).show());break;case"Annotated phenotype":this.panel.add(this.getPhenotypePanel(this.data.phenotype).show())}},SnpInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getSnpTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel},SnpInfoWidget.prototype.getSnpTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpTranscriptGrid){for(var b=this.getSnpTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.snpTranscriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.snpTranscriptGrid},SnpInfoWidget.prototype.getConsequenceTypePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.consequencePanel){for(var b=(this.getConsequenceTypeTemplate(),[]),c=0;c<a.length;c++)for(var d=0;d<a[c].consequenceTypes.length;d++){var e=a[c].consequenceTypes[d];a[c].consequenceType=e,b.push(a[c])}var f="consequenceType",g="transcriptVariation",h=["transcriptId","consequenceType"],i=[{header:"Transcript id",dataIndex:"transcriptId",flex:1},{header:"Consequence type",dataIndex:"consequenceType",flex:1}];this.consequencePanel=this.doGrid(i,h,g,f),this.consequencePanel.store.loadData(b)}return this.consequencePanel},SnpInfoWidget.prototype.getPhenotypePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.phenotypePanel){for(var b=this.getPhenotypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.phenotypePanel=Ext.create("Ext.panel.Panel",{title:"Phenotype ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.phenotypePanel},SnpInfoWidget.prototype.getPopulationPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.populationPanel){for(var b=this.getPopulationTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.populationPanel=Ext.create("Ext.panel.Panel",{title:"Population ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.populationPanel},SnpInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"snp",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0])}})},SnpInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TFInfoWidget.prototype.draw=InfoWidget.prototype.draw,TFInfoWidget.prototype.render=InfoWidget.prototype.render,TFInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TFInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TFInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TFInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TFInfoWidget.prototype.getProteinTemplate=InfoWidget.prototype.getProteinTemplate,TFInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TFInfoWidget.prototype.getPWMTemplate=InfoWidget.prototype.getPWMTemplate,TFInfoWidget.prototype.getProteinXrefTemplate=InfoWidget.prototype.getProteinXrefTemplate,TFInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Information",children:[{text:"Protein"},{text:"Transcript"},{text:"Gene"}]},{text:"Regulatory",children:[{text:"PWM"
},{text:"Target Genes"}]},{text:"Protein Features",children:[{text:"Protein profile"},{text:"Mutation sites"},{text:"Pathways"},{text:"Protein interactions"},{text:"Related Diseases"}]}]},TFInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Protein":this.panel.add(this.getProteinPanel(this.data.proteins).show());break;case"Transcript":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"PWM":this.panel.add(this.getPWMPanel(this.data.pwm).show());break;case"Target Genes":this.panel.add(this.getTargetGenesGrid(this.data.targetGenes).show());break;case"Protein profile":this.panel.add(this.getProteinFeatureGrid(this.data.protein_feature,"Protein profile").show());break;case"Mutation sites":this.panel.add(this.getProteinFeatureGrid(this.data.protein_feature,"Mutation sites").show());break;case"Pathways":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Pathway").show());break;case"Protein interactions":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Interaction").show());break;case"Related Diseases":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Disease").show())}},TFInfoWidget.prototype.getProteinPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.proteinPanel){var b=this.getProteinTemplate();this.proteinPanel=Ext.create("Ext.panel.Panel",{title:"Protein",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a[0],tpl:b})}return this.proteinPanel},TFInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},TFInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},TFInfoWidget.prototype.getPWMPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.pwmPanel){for(var b=this.getPWMTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.pwmPanel=Ext.create("Ext.panel.Panel",{title:"PWM ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.pwmPanel},TFInfoWidget.prototype.getTargetGenesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.targetGenesGrid){var b="",c="targetGenes",d=["externalName","stableId","biotype","chromosome","start","end","strand","description"],e=[{header:"Name",dataIndex:"externalName",flex:1},{header:"Stable Id",dataIndex:"stableId",flex:2},{header:"Biotype",dataIndex:"biotype",flex:1.5},{header:"Chr",dataIndex:"chromosome",flex:.5},{header:"Start",dataIndex:"start",flex:1},{header:"End",dataIndex:"end",flex:1},{header:"Strand",dataIndex:"strand",flex:.5},{header:"Description",dataIndex:"description",flex:1}];this.targetGenesGrid=this.doGrid(e,d,c,b),this.targetGenesGrid.store.loadData(a)}return this.targetGenesGrid},TFInfoWidget.prototype.getProteinFeatureGrid=function(a,b){if(null==this[b+"Grid"]){for(var c=new Array,d=new Array,e=0;e<a.length;e++)"mutagenesis site"==a[e].type?d.push(a[e]):c.push(a[e]);if(null!=b){if("Protein profile"==b)var a=c;if("Mutation sites"==b)var a=d}if(a.length<=0)return this.notFoundPanel;var f="",g=b,h=["type","start","end","original","variation","description"],i=[{header:"Type",dataIndex:"type",flex:1.5},{header:"Start",dataIndex:"start",flex:.5},{header:"End",dataIndex:"end",flex:.5},{header:"Original",dataIndex:"original",flex:.7},{header:"Variation",dataIndex:"variation",flex:.7},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(i,h,g,f),this[b+"Grid"].store.loadData(a)}return this[b+"Grid"]},TFInfoWidget.prototype.getProteinXrefPanel=function(a,b){if(a.length<=0)return this.notFoundPanel;if(null==this[b+"panel"]){for(var c=this.getProteinXrefTemplate(),d=new Array,e=new Array,f=new Array,g=0;g<a.length;g++){var h=a[g].source;"Go"!=h&&"Reactome"!=h&&"KEGG"!=h||d.push(a[g]),"IntAct"!=h&&"MINT"!=h&&"DIP"!=h&&"String"!=h||e.push(a[g]),"MIN"!=h&&"PharmGKB"!=h&&"Orphanet"!=h||f.push(a[g])}if(null!=b)switch(b){case"Pathway":a=d;break;case"Interaction":a=e;break;case"Disease":a=f}for(var i=[],g=0;g<a.length;g++){var j=Ext.create("Ext.panel.Panel",{border:!1,bodyPadding:5,data:a[g],tpl:c});i.push(j)}this[b+"panel"]=Ext.create("Ext.panel.Panel",{title:b+" ("+g+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:i})}return this[b+"panel"]},TFInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseDataAdapter(this.species);b.successed.addEventListener(function(c){a.dataReceived(b.toJSON())}),b.fill("regulatory","tf",this.feature.getName(),"fullinfo"),console.log(this.feature.getName())},TFInfoWidget.prototype.dataReceived=function(a){var b=JSON.parse(a);this.data=b[0],console.log(this.data),this.optionClick({text:"Protein",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TranscriptInfoWidget.prototype.draw=InfoWidget.prototype.draw,TranscriptInfoWidget.prototype.render=InfoWidget.prototype.render,TranscriptInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TranscriptInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TranscriptInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TranscriptInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TranscriptInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TranscriptInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate,TranscriptInfoWidget.prototype.get3Dprotein=GeneInfoWidget.prototype.get3Dprotein,TranscriptInfoWidget.prototype.getGenePanel=GeneInfoWidget.prototype.getGenePanel,TranscriptInfoWidget.prototype.getXrefGrid=GeneInfoWidget.prototype.getXrefGrid,TranscriptInfoWidget.prototype.getTfbsGrid=GeneInfoWidget.prototype.getTfbsGrid,TranscriptInfoWidget.prototype.getMirnaTargetGrid=GeneInfoWidget.prototype.getMirnaTargetGrid,TranscriptInfoWidget.prototype.getProteinFeaturesGrid=GeneInfoWidget.prototype.getProteinFeaturesGrid,TranscriptInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"},{text:"Xrefs"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Variation",children:[{text:"SNPs"},{text:"Mutations"}]},{text:"Regulatory",children:[{text:"TFBS"},{text:"miRNA targets"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]},TranscriptInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case"Xrefs":this.panel.add(this.getXrefGrid([this.data],"Xref","dbName").show());break;case"GO":this.panel.add(this.getXrefGrid([this.data],"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid([this.data],"Interpro").show());break;case"Reactome":this.panel.add(this.getXrefGrid([this.data],"Reactome").show());break;case"SNPs":this.panel.add(this.getSnpsGrid(this.data.snps).show());break;case"Mutations":this.panel.add(this.getMutationsGrid(this.data.mutations).show());break;case"TFBS":this.panel.add(this.getTfbsGrid(this.data.tfbs).show());break;case"miRNA targets":this.panel.add(this.getMirnaTargetGrid(this.data.mirnaTargets).show());break;case"Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());break;case"3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}},TranscriptInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel},TranscriptInfoWidget.prototype.getExonsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid},TranscriptInfoWidget.prototype.getSnpsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpsGrid){var b="",c="SNPs",d=["chromosome","start","end","name","strand","alleleString","displaySoConsequence"],e=[{header:"Name",dataIndex:"name",flex:2},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Alleles",dataIndex:"alleleString",flex:.7},{header:"Most severe SO term",dataIndex:"displaySoConsequence",flex:2}];this.snpsGrid=this.doGrid(e,d,c,b),this.snpsGrid.store.loadData(a)}return this.snpsGrid},TranscriptInfoWidget.prototype.getMutationsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mutationsGrid){var b="",c="Mutations",d=["chromosome","start","end","mutationAa","mutationCds","primaryHistology","source"],e=[{header:"Mutation AA",dataIndex:"mutationAa",flex:1},{header:"Mutation CDS",dataIndex:"mutationCds",flex:1.5},{header:"Location: chr:start-end",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:1.7},{header:"Primary histology",dataIndex:"primaryHistology",flex:1},{header:"Source",dataIndex:"source",flex:1}];this.mutationsGrid=this.doGrid(e,d,c,b),this.mutationsGrid.store.loadData(a)}return this.mutationsGrid},TranscriptInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"transcript",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0].transcripts)}})},TranscriptInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TranscriptOrangeInfoWidget.prototype.draw=InfoWidget.prototype.draw,TranscriptOrangeInfoWidget.prototype.render=InfoWidget.prototype.render,TranscriptOrangeInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TranscriptOrangeInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TranscriptOrangeInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TranscriptOrangeInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TranscriptOrangeInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TranscriptOrangeInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate,TranscriptOrangeInfoWidget.prototype.getGenePanel=GeneOrangeInfoWidget.prototype.getGenePanel,TranscriptOrangeInfoWidget.prototype.getXrefGrid=GeneOrangeInfoWidget.prototype.getXrefGrid,TranscriptOrangeInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"}]},{text:"Functional information",children:[{text:"GO"},{text:"KEGG"},{text:"Interpro"}]}]},TranscriptOrangeInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,"Interpro").show());break;case"KEGG":this.panel.add(this.getXrefGrid(this.data.kegg,"KEGG").show())}},TranscriptOrangeInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel},TranscriptOrangeInfoWidget.prototype.getExonsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid},TranscriptOrangeInfoWidget.prototype.getSnpsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpsGrid){var b="",c="SNPs",d=["chromosome","start","end","name","strand","alleleString","displaySoConsequence"],e=[{header:"Name",dataIndex:"name",flex:2},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Alleles",dataIndex:"alleleString",flex:.7},{header:"Most severe SO term",dataIndex:"displaySoConsequence",flex:2}];this.snpsGrid=this.doGrid(e,d,c,b),this.snpsGrid.store.loadData(a)}return this.snpsGrid},TranscriptOrangeInfoWidget.prototype.getMutationsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mutationsGrid){var b="",c="Mutations",d=["chromosome","start","end","mutationAa","mutationCds","primaryHistology","source"],e=[{header:"Mutation AA",dataIndex:"mutationAa",flex:1},{header:"Mutation CDS",dataIndex:"mutationCds",flex:1.5},{header:"Location: chr:start-end",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:1.7},{header:"Primary histology",dataIndex:"primaryHistology",flex:1},{header:"Source",dataIndex:"source",flex:1}];this.mutationsGrid=this.doGrid(e,d,c,b),this.mutationsGrid.store.loadData(a)}return this.mutationsGrid},TranscriptOrangeInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,c){a.dataReceived(JSON.parse(c.result))}),b.get("feature","transcript",this.query,"fullinfo")},TranscriptOrangeInfoWidget.prototype.dataReceived=function(a){this.data=a[0],console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},VCFVariantInfoWidget.prototype.draw=InfoWidget.prototype.draw,VCFVariantInfoWidget.prototype.render=InfoWidget.prototype.render,VCFVariantInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,VCFVariantInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,VCFVariantInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,VCFVariantInfoWidget.prototype.getVCFVariantTemplate=InfoWidget.prototype.getVCFVariantTemplate,VCFVariantInfoWidget.prototype.getVariantEffectTemplate=InfoWidget.prototype.getVariantEffectTemplate,VCFVariantInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Variant effect"},{text:"Header"},{text:"Samples"}]}]},VCFVariantInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data.feature).show());break;case"Variant effect":this.panel.add(this.getEffectPanel(this.data.consequenceType).show());break;case"Header":this.panel.add(this.getHeaderPanel(this.data.header).show());break;case"Samples":this.panel.add(this.getSamplesGrid(this.data.feature.sampleData,this.data.samples,this.data.feature.format).show());break;case"Population":}},VCFVariantInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getVCFVariantTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel},VCFVariantInfoWidget.prototype.getEffectPanel=function(a){if(a.length<=0)return this.notFoundPanel;for(var b=0;b<a.length;b++)a[b].consequence=a[b].consequenceType+" - "+a[b].consequenceTypeObo,""==a[b].featureName&&(a[b].featureName="-"),""==a[b].geneId&&(a[b].geneId="-"),""==a[b].transcriptId&&(a[b].transcriptId="-"),""==a[b].featureBiotype&&(a[b].featureBiotype="-"),""==a[b].aaPosition&&(a[b].aaPosition="-"),""==a[b].aminoacidChange&&(a[b].aminoacidChange="-");if(null==this.effectGrid){var c="consequence",d="effectGridModel",e=["featureName","geneId","transcriptId","featureBiotype","aaPosition","aminoacidChange","consequence"],f=[{header:"Feature",dataIndex:"featureName",flex:1},{header:"Gene Id",dataIndex:"geneId",flex:1.5},{header:"Transcript Id",dataIndex:"transcriptId",flex:1.5},{header:"Feat.Biotype",dataIndex:"featureBiotype",flex:1},{header:"aa Position",dataIndex:"aaPosition",flex:1},{header:"aa Change",dataIndex:"aminoacidChange",flex:1}];this.effectGrid=this.doGrid(f,e,d,c),this.effectGrid.store.loadData(a)}return this.effectGrid},VCFVariantInfoWidget.prototype.getHeaderPanel=function(a){return""==a?this.notFoundPanel:(null==this.headerPanel&&(this.headerPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,html:a})),this.headerPanel)},VCFVariantInfoWidget.prototype.getSamplesGrid=function(a,b,c){var d=a.split("\t").slice(9);if(d.length<=0)return this.notFoundPanel;for(var e=new Array(b.length),f=0,g=e.length;f<g;f++)e[f]={id:b[f],info:d[f]};if(null==this.samplesGrid){var h="",i="VCF samples",j=["id","info"],k=[{header:"Identifier",dataIndex:"id",flex:1},{header:c,dataIndex:"info",flex:5}];this.samplesGrid=this.doGrid(k,j,i,h),this.samplesGrid.store.loadData(e)}return this.samplesGrid},VCFVariantInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=this.feature.chromosome+":"+this.feature.start+":"+this.feature.reference+":"+this.feature.alternate;CellBaseManager.get({host:"http://ws-beta.bioinfo.cipf.es/cellbase/rest",version:"v2",species:Utils.getSpeciesCode(this.species.text).substring(0,3),category:"genomic",subCategory:"variant",query:b,resource:"consequence_type",success:function(b){a.dataReceived(b)}})},VCFVariantInfoWidget.prototype.dataReceived=function(a){this.data=new Object,this.data.header=this.adapter.header,this.data.samples=this.adapter.samples,this.data.feature=this.feature,this.data.consequenceType=a,this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},ConsequenceTypeFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){var a=this.panel.getRootNode();a.cascadeBy(function(a){a.set("checked",!1)})},getValues:function(){var a=this.panel.getRootNode(),b=[];return a.cascadeBy(function(a){a.get("checked")&&a.isLeaf()&&b.push(a.get("name"))}),b.length>0?{conseq_type:b}:{}},_createPanel:function(){Ext.define("Tree Model",{extend:"Ext.data.Model",fields:this.fields});var a=Ext.create("Ext.data.TreeStore",{model:"Tree Model",proxy:{type:"memory",data:this.consequenceTypes,reader:{type:"json"}}}),b=Ext.create("Ext.tree.Panel",{title:this.title,border:this.border,useArrows:!0,rootVisible:!1,store:a,multiSelect:!0,singleExpand:!0,hideHeaders:!0,height:this.height,collapsible:this.collapsible,titleCollapse:this.titleCollapse,collapsed:this.collapsed,header:this.headerConfig,columns:this.columns,listeners:{checkchange:function(a,b){a.cascadeBy(function(a){a.set("checked",b)})}}});return b},getPanel:function(){return this.panel}},FormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id);for(var a=[],b=0;b<this.filters.length;b++){var c=this.filters[b];a.push(c.getPanel())}this.panel=this._createPanel(),this.filtersPanel.add(a),"tabs"==this.mode&&this.filtersPanel.setActiveTab(0)},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){for(var a=0;a<this.filters.length;a++){var b=this.filters[a];b.clear()}},getValues:function(){for(var a={},b=0;b<this.filters.length;b++){var c=this.filters[b];_.extend(a,c.getValues())}return a},update:function(){this.panel&&this.panel.update()},_createPanel:function(){var a=this,b=[{xtype:"button",text:this.clearButtonText,tooltip:this.clearButtonText,handler:function(){a.clear(),Utils.msg("Clear","Successful")}},{xtype:"button",id:this.submitButtonId,text:this.submitButtonText,tooltip:this.submitButtonText,formBind:!0,flex:1,handler:function(){a.trigger("submit",{values:a.getValues(),sender:a})}}];b=b.concat(this.barItems);switch(this.mode){case"tabs":this.filtersPanel=Ext.create("Ext.tab.Panel",{border:!1,plain:!0});break;case"accordion":this.filtersPanel=Ext.create("Ext.container.Container",{layout:{type:"accordion",titleCollapse:!0,multi:!0}});break;case"vbox":this.filtersPanel=Ext.create("Ext.container.Container",{margin:"5 0 0 0",layout:{type:"vbox",align:"stretch"},defaults:{margin:"5 0 0 0"}})}var c=Ext.create("Ext.form.Panel",{border:this.border,height:this.height,width:this.width,title:this.title,header:this.headerConfig,collapsible:this.collapsible,titleCollapse:this.titleCollapse,margin:"0 20 0 0",autoScroll:!0,items:[{xtype:"container",width:"100%",bodyPadding:5,defaults:{margin:"10"},layout:{type:"hbox"},items:b},this.filtersPanel]});return c}},GoFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=Ext.create("Ext.form.field.TextArea",{id:this.id+"go",name:"go",margin:"0 0 0 5",width:"100%",fieldLabel:"Go Term",labelAlign:"top"});return Ext.create("Ext.form.Panel",{bodyPadding:"5",margin:"0 0 5 0",buttonAlign:"center",layout:"vbox",title:this.title,border:this.border,collapsible:this.collapsible,titleCollapse:this.titleCollapse,header:this.headerConfig,allowBlank:!1,items:a})},getPanel:function(){return this.panel},getValues:function(){var a=this.panel.getValues();for(key in a)""==a[key]&&delete a[key];return a},clear:function(){this.panel.reset()}},MafFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=Ext.create("Ext.form.FieldContainer",{layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",labelAlign:"right",fieldLabel:"1000G MAF < ",name:"maf_1000g_controls",labelWidth:110},{xtype:"textfield",labelAlign:"right",fieldLabel:"EVS MAF < ",labelWidth:110,name:"maf_evs_controls"}]}),b=Ext.create("Ext.form.FieldContainer",{layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",margin:"0 20 0 0",html:'<span style="color:gray">1000G Populations</span>'},{xtype:"textfield",labelAlign:"right",fieldLabel:"African MAF < ",labelWidth:110,name:"maf_1000g_afr_controls"},{xtype:"textfield",labelAlign:"right",fieldLabel:"American MAF < ",labelWidth:110,name:"maf_1000g_ame_controls"},{xtype:"textfield",labelAlign:"right",fieldLabel:"Asian MAF < ",labelWidth:110,name:"maf_1000g_asi_controls"},{xtype:"textfield",labelAlign:"right",fieldLabel:"European MAF < ",labelWidth:110,name:"maf_1000g_eur_controls"}]});return Ext.create("Ext.form.Panel",{title:this.title,border:this.border,collapsible:this.collapsible,titleCollapse:this.titleCollapse,header:this.headerConfig,bodyPadding:5,margin:"0 0 5 0",buttonAlign:"center",layout:{type:"vbox",align:"stretch"},allowBlank:!1,items:[a,b]})},getPanel:function(){return this.panel},getValues:function(){var a=this.panel.getValues();for(key in a)""==a[key]&&delete a[key];return a},clear:function(){this.panel.reset()}},PositionFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=Ext.create("Ext.form.field.TextArea",{id:this.id+"snp",name:"snp",margin:"0 0 0 5",width:"100%",fieldLabel:"SNP id",labelAlign:"top",regex:/^[rs]s\d+$/}),b=Ext.create("Ext.form.field.TextArea",{id:this.id+"region",name:"region",emptyText:this.emptyText,margin:"0 0 0 5",width:"100%",fieldLabel:"Chromosomal Location",labelAlign:"top",value:this.testRegion}),c=Ext.create("Ext.form.field.TextArea",{id:this.id+"gene",name:"gene",margin:"0 0 0 5",width:"100%",fieldLabel:"Gene / Transcript",labelAlign:"top"});return Ext.create("Ext.form.Panel",{bodyPadding:"5",margin:"0 0 5 0",buttonAlign:"center",layout:"vbox",title:this.title,border:this.border,collapsible:this.collapsible,titleCollapse:this.titleCollapse,header:this.headerConfig,allowBlank:!1,items:[a,b,c]})},getPanel:function(){return this.panel},getValues:function(){var a=this.panel.getValues();for(key in a)""==a[key]&&delete a[key];return a},clear:function(){this.panel.reset()}},SegregationFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){for(var a=Ext.create("Ext.form.FieldContainer",{margin:"0 0 0 100",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"label",text:"0/0",flex:1},{xtype:"label",text:"0/1",flex:1},{xtype:"label",text:"1/1",flex:1},{xtype:"label",text:"./.",flex:1}]}),b=[a],c=0;c<this.samples.length;c++){var d=this.samples[c];b.push(Ext.create("Ext.form.FieldContainer",{fieldLabel:d,labelWidth:100,flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"checkbox",name:"sampleGT_"+d,inputValue:"0/0,0|0",flex:1},{xtype:"checkbox",name:"sampleGT_"+d,inputValue:"0/1,1/0,0|1,1|0",flex:1},{xtype:"checkbox",name:"sampleGT_"+d,inputValue:"1/1,1|1",flex:1},{xtype:"checkbox",name:"sampleGT_"+d,inputValue:"./.,.|.",flex:1}]}))}return Ext.create("Ext.form.Panel",{title:this.title,border:this.border,collapsible:this.collapsible,titleCollapse:this.titleCollapse,header:this.headerConfig,bodyPadding:"5",margin:"0 0 5 0",buttonAlign:"center",layout:{type:"vbox",align:"stretch"},allowBlank:!1,items:b})},getPanel:function(){return this.panel},getValues:function(){var a=this.panel.getValues();for(key in a)""==a[key]&&delete a[key];return a},clear:function(){this.panel.reset()}},StudyFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=this,b=Ext.create("Ext.form.field.Text",{emptyText:"search",listeners:{change:function(){var b=this.getValue();if(""==b)a.studiesStore.clearFilter();else{var c=new RegExp(b,"i");a.studiesStore.filterBy(function(a){return c.test(a.get("studyName"))})}}}}),c=Ext.create("Ext.grid.Panel",{store:this.studiesStore,autoScroll:!0,border:this.border,loadMask:!0,hideHeaders:!1,enableColumnHide:!1,plugins:"bufferedrenderer",features:[{ftype:"summary"}],height:this.height,viewConfig:{emptyText:"No studies found",enableTextSelection:!0,markDirty:!1,listeners:{itemclick:function(a,b){},itemcontextmenu:function(a,b,c,d,e){}}},selModel:{listeners:{selectionchange:function(a,b){}}},columns:[{xtype:"checkcolumn",dataIndex:"uiactive",width:50,sortable:!1},{text:"Name",dataIndex:"studyName",flex:10,xtype:"templatecolumn",tpl:this.studyFilterTpl,sortable:!0}]}),d=Ext.create("Ext.form.Panel",{bodyPadding:"5",margin:"0 0 5 0",buttonAlign:"center",border:!1,title:this.title,height:this.height,collapsed:this.collapsed,layout:{type:"vbox",align:"stretch"},items:[b,c]});return d},getPanel:function(){return this.panel},getValues:function(){for(var a=[],b=this.studiesStore.query().items,c=0;c<b.length;c++){var d=b[c],e=d.get("uiactive");e&&a.push(d.get("studyId"))}var f={};return a.length>0&&(f.studies=a),f},clear:function(){this.panel.reset()}},VariantBrowserGrid.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=this;this.model=Ext.define("Variant",{extend:"Ext.data.Model",idProperty:"iid",fields:this.attributes}),this.store=Ext.create("Ext.data.Store",{pageSize:this.pageSize,model:this.model,remoteSort:!0,proxy:{type:"memory",enablePaging:!0},listeners:{beforeload:function(b,c,d){a.trigger("variant:clear",{sender:a})}}});for(var b=0;b<this.samples.length;b++){var c=this.samples[b];this._addSampleColumn(c)}this.paging=Ext.create("Ext.PagingToolbar",{store:a.store,id:a.id+"_pagingToolbar",pageSize:a.pageSize,displayInfo:!0,displayMsg:"Variants {0} - {1} of {2}",emptyMsg:"No variants to display"});var d=Ext.create("Ext.grid.Panel",{title:this.title,store:this.store,border:this.border,header:this.headerConfig,loadMask:!0,columns:this.columns,plugins:this.plugins,animCollapse:!1,height:this.height,overflowX:!0,
features:[{ftype:"summary"}],viewConfig:{emptyText:"No records to display",enableTextSelection:!0,listeners:this.viewConfigListeners},tbar:this.paging});return d.getSelectionModel().on("selectionchange",function(b,c){if(c.length){var d=c[0].data;a.trigger("variant:change",{sender:a,args:d})}}),this.grid=d,d},load:function(a){var b=this;this.store.destroy(),"undefined"!=typeof this.dataParser?this.dataParser(a):this._parserFunction(a),this.store=Ext.create("Ext.data.Store",{pageSize:this.pageSize,model:this.model,data:a,remoteSort:!0,proxy:{type:"memory",enablePaging:!0},listeners:{beforeload:function(a,c,d){b.trigger("variant:clear",{sender:b})},load:function(a,c,d,e,f){b.setLoading(!1)}}}),this.grid.reconfigure(this.store,this.columnsGrid),this.paging.bindStore(this.store),this.paging.doRefresh()},loadUrl:function(a,b){var c=this;this.store.destroy(),console.log("filter"),console.log(b),this.store=Ext.create("Ext.data.Store",{pageSize:this.pageSize,model:this.model,remoteSort:!0,proxy:{url:a,type:"ajax",startParam:this.startParam,useDefaultXhrHeader:!1,reader:{root:this.responseRoot,totalProperty:this.responseTotal,transform:function(a){var b=[];return"undefined"!=typeof c.responseParser&&(b=c.responseParser(a)),"undefined"!=typeof c.dataParser?c.dataParser(b):c._parserFunction(b),a}},extraParams:b,actionMethods:{create:"GET",read:"GET",update:"GET",destroy:"GET"}},listeners:{load:function(a,b,d,e,f){"undefined"!=typeof this.dataParser?c.dataParser(b):_.isNull(b)||(c._parserFunction(b),c.grid.getSelectionModel().select(0,!0)),c.setLoading(!1)},beforeload:function(a,b,d){c.trigger("variant:clear",{sender:c})}}}),this.grid.reconfigure(this.store,this.columnsGrid),this.paging.bindStore(this.store),this.store.load()},_parserFunction:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.hgvs&&c.hgvs.genomic&&c.hgvs.genomic.length>0&&(c.hgvs_name=c.hgvs.genomic[0])}},setLoading:function(a){this.panel.setLoading(a)},_addSampleColumn:function(a){for(var b=this,c=0;c<b.attributes.length;c++)if(b.attributes[c].name==a)return!1;b.attributes.push({name:a,type:"string"});for(var c=0;c<b.columns.length;c++){var d=b.columns[c];"Samples"==d.text&&d.columns.push({text:a,dataIndex:a,flex:1,sortable:!1})}this.store.setFields(this.attributes)}},VariantEffectGrid.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.chartDiv=document.createElement("div"),$(this.chartDiv).css({height:"200px"}),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){this.store.removeAll(),this._updateChart([],[])},load:function(a){var b=this,c=b._prepareEffectData(a);b.grid.setLoading(!0),b.clear(),this.store.loadData(c);var d=[],e=[];this._updateChart(d,e),this.trigger("load:finish",{sender:b}),this.grid.setLoading(!1)},_updateChart:function(a,b){var c=$(this.chartDiv).highcharts();c&&(c.xAxis[0].setCategories(a,!1),c.series[0].setData(b,!1),c.redraw())},_createPanel:function(){var a={storeId:"EffectStore",groupField:"featureId",pageSize:10,fields:[{name:"position",type:"string"},{name:"allele",type:"string"},{name:"cDnaPosition",type:"int"},{name:"canonical",type:"boolean"},{name:"cdsPosition",type:"int"},{name:"consequenceTypes",type:"string"},{name:"featureBiotype",type:"string"},{name:"featureId",type:"string"},{name:"featureStrand",type:"string"},{name:"featureType",type:"string"},{name:"geneId",type:"string"},{name:"geneName",type:"string"},{name:"geneNameSource",type:"string"},{name:"proteinPosition",type:"int"},{name:"variantToTranscriptDistance",type:"int"},{name:"polyphenScore",type:"number"},{name:"siftScore",type:"number"}],data:[],autoLoad:!1,proxy:{type:"memory"}};_.extend(a,this.storeConfig),this.store=Ext.create("Ext.data.Store",a);var b={title:"Effects",store:this.store,loadMask:!0,border:!0,height:200,header:this.headerConfig,viewConfig:{emptyText:"No records to display",enableTextSelection:!0},plugins:["bufferedrenderer"],columns:[{text:"Location",dataIndex:"position",flex:1},{text:"Conseq. Types",dataIndex:"consequenceTypes",flex:1},{text:"Feature",columns:[{text:"Id",dataIndex:"featureId",flex:1},{text:"Strand",dataIndex:"featureStrand",flex:1},{text:"Biotype",dataIndex:"featureBiotype",flex:1},{text:"Type",dataIndex:"featureType",flex:1}]},{text:"Genes",columns:[{text:"Id",dataIndex:"geneId",flex:1},{text:"Name",dataIndex:"geneName",flex:1},{text:"Source",dataIndex:"geneNameSource",flex:1}]},{text:"Protein Position",dataIndex:"proteinPosition",flex:1},{text:"Distance to Transcript",dataIndex:"variantToTranscriptDistance",flex:1},{text:"Scores",columns:[{text:"Polyphen",dataIndex:"polyphenScore",flex:1},{text:"SIFT",dataIndex:"siftScore",flex:1}]}],viewConfig:{emptyText:"No records to display"}};_.extend(b,this.gridConfig),this.grid=Ext.create("Ext.grid.Panel",b),$(this.chartDiv).highcharts({chart:{type:"bar"},title:{text:null},xAxis:{title:{text:"Populations",align:"high"}},yAxis:{min:0,max:1,title:{text:"Minimum Allele Frequency",align:"high"},labels:{overflow:"justify"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},credits:{enabled:!1},series:[{name:"MAF"}]});var c=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},overflowY:!0,padding:10,items:[this.grid,{xtype:"panel",margin:"10 0 0 0",border:!1,title:"Population Frequencies",header:this.headerConfig,contentEl:this.chartDiv}],height:this.height});return c},_prepareEffectData:function(a){var b=[],c=a.chromosome,d=a.start,e=a.referenceAllele;console.log(a);for(var f in a.effects)for(var g=0,h=a.effects[f].length;g<h;g++){var i=a.effects[f][g];i.position=c+":"+d+" "+e+" > "+f,i.consequenceTypes=i.consequenceTypes.join(","),i.polyphenScore=a.proteinSubstitutionScores.polyphenScore,i.siftScore=a.proteinSubstitutionScores.siftScore,b.push(i)}return b},_prepareFrequencyData:function(a){var b=[];return b.push({name:"maf1000G",maf:Math.random()}),b.push({name:"maf1000GAfrican",maf:Math.random()}),b.push({name:"maf1000GAmerican",maf:Math.random()}),b.push({name:"maf1000GAsian",maf:Math.random()}),b.push({name:"maf1000GEuropean",maf:Math.random()}),b.push({name:"mafNhlbiEspAfricanAmerican",maf:Math.random()}),b.push({name:"mafNhlbiEspEuropeanAmerican",maf:Math.random()}),b}},VariantFileBrowserPanel.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},load:function(a){this.panel.removeAll(!0);for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push(this._createStudyPanel(d))}this.panel.add(b)},_createPanel:function(){var a=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"}});return this.studies.length>0&&this.load(this.studies),a},_createStudyPanel:function(a){for(var b=[],c=0;c<a.files.length;c++){var d=a.files[c];b.push(this._createFilePanel(d))}var e=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},overflowY:!0,padding:10,items:b}),f=Ext.create("Ext.container.Container",{items:[{xtype:"box",cls:"eva-header-3",overCls:"eva-pointer eva-underline",html:a.studyName,listeners:{afterrender:function(){this.getEl().on("click",function(){e.isHidden()?e.show():e.hide()})}}},e]});return f},_createFilePanel:function(a){var b=Ext.create("Ext.container.Container",{layout:"vbox",items:[{xtype:"box",cls:"eva-header-5",margin:"5 5 5 10",html:a.fileName},{xtype:"container",layout:"hbox",items:[{xtype:"container",data:a.stats,tpl:new Ext.XTemplate('<table class="eva-stats-table"><tr><td class="header">Variants count:</td><td>{variantsCount}</td></tr>','<tr><td class="header">Samples count:</td><td>{samplesCount}</td></tr>','<tr><td class="header">SNPs count:</td><td>{snpsCount}</td></tr>','<tr><td class="header">Indels count:</td><td>{indelsCount}</td></tr>','<tr><td class="header">Pass count:</td><td>{passCount}</td></tr>','<tr><td class="header">Ti/Tv Ratio:</td><td>{[this.titv(values)]}</td></tr>','<tr><td class="header">Mean quality:</td><td>{meanQuality}</td></tr>',"</table>",{titv:function(a){var b=a.transitionsCount/a.transversionsCount;return b.toFixed(2)}}),margin:"5 5 5 10"}]}]});return b},setLoading:function(a){this.panel.setLoading(a)}},VariantGenotypeGrid.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){this.studiesContainer.removeAll(!0)},load:function(a){this.clear();var b=[];for(var c in a){var d=a[c];b.push(this._createStudyPanel(d))}this.studiesContainer.add(b)},_createPanel:function(){this.studiesContainer=Ext.create("Ext.container.Container",{layout:{type:"accordion",titleCollapse:!0,multi:!0}});var a=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},overflowY:!0,padding:10,items:[{xtype:"box",cls:"ocb-header-4",html:"<h4>Studies</h4s>",margin:"5 0 10 10"},this.studiesContainer],height:this.height});return a},_createStudyPanel:function(a){var b=a.stats?a.stats:{},c=a.samplesData?a.samplesData:{},d=[];for(var e in c){var f=c[e];d.push({sample:e,genotype:f.GT})}if(console.log(d),_.isEmpty(d))var g={xtype:"container",html:"<p>No Genotypes available</p>",margin:"5 0 10 10"};else{var h,i=Ext.create("Ext.data.Store",{pageSize:10,fields:[{name:"sample",type:"string"},{name:"genotype",type:"string"},{name:"sex",type:"string"},{name:"phenotype",type:"string"}],data:d,proxy:{type:"memory"}}),g=Ext.create("Ext.grid.Panel",{store:i,loadMask:!0,width:400,height:300,margin:20,viewConfig:{emptyText:"No records to display",enableTextSelection:!0},plugins:["bufferedrenderer"],columns:this.columns}),j=this._getGenotypeCount(b.genotypesCount);if(j.length>0)var i=Ext.create("Ext.data.Store",{fields:["genotype","count"],data:j})}var k;if(projects)for(var l=0;l<projects.length;l++)projects[l].studyId===a.studyId&&(k='<a href="?eva-study='+projects[l].studyId+'" target="_blank">'+projects[l].studyName+"</a> ("+projects[l].studyId+")");else k='<a href="?eva-study='+a.studyId+'" target="_blank">'+a.studyId+"</a>";var m=Ext.create("Ext.panel.Panel",{title:k,border:!0,layout:{type:"hbox",align:"stretch"},items:[g,h]});return m},_getGenotypeCount:function(a){var b=[];for(var c in a)b.push({genotype:c,count:a[c]});return b}},VariantStatsPanel.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){this.studiesContainer.removeAll(!0)},load:function(a){this.clear();var b=[];for(var c in a){var d=a[c],e=this._createStudyPanel(d);b.push(e)}this.studiesContainer.add(b)},_createPanel:function(){this.studiesContainer=Ext.create("Ext.container.Container",{layout:{type:"accordion",titleCollapse:!0,multi:!0}});var a=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},overflowY:!0,padding:10,items:[{xtype:"box",cls:"ocb-header-4",html:"<h4>Studies</h4>",margin:"5 0 10 10"},this.studiesContainer],height:this.height});return a},_createStudyPanel:function(a){var b=a.stats?a.stats:{},c=a.attributes?a.attributes:{},d={};_.extend(d,c),delete d.src,delete d.ACC;var e;if(projects)for(var f=0;f<projects.length;f++)projects[f].studyId===a.studyId&&(e='<a href="?eva-study='+projects[f].studyId+'" target="_blank">'+projects[f].studyName+"</a> ("+projects[f].studyId+")");else e='<a href="?eva-study='+a.studyId+'" target="_blank">'+a.studyId+"</a>";var g=Ext.create("Ext.panel.Panel",{title:e,border:!1,layout:"vbox",overflowX:!0,items:[{xtype:"container",data:d,tpl:new Ext.XTemplate('<table class="ocb-attributes-table"><tr>','<tpl foreach=".">','<td class="header">{$}</td>',"</tpl></tr><tr>",'<tpl foreach=".">',"<td>{.}</td>","</tpl>","</tr></table>"),margin:"10 5 5 10"},{xtype:"box",cls:"ocb-header-5",margin:"5 5 5 10",html:"<h5>Stats</h5>"},{xtype:"container",layout:"hbox",items:[{xtype:"container",data:b,tpl:this.statsTpl,margin:"5 5 5 10"}]}]}),h=this._getGenotypeCount(b.genotypesCount);if(h.length>0){Ext.create("Ext.data.Store",{fields:["genotype","count"],data:h})}return g},_getGenotypeCount:function(a){var b=[];for(var c in a)b.push({genotype:c,count:a[c]});return b}},VariantWidget.prototype={render:function(){var a=this;this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.variantBrowserGridDiv=document.createElement("div"),this.variantBrowserGridDiv.setAttribute("class","ocb-variant-widget-grid"),this.div.appendChild(this.variantBrowserGridDiv),this.variantBrowserGrid=this._createVariantBrowserGrid(this.variantBrowserGridDiv),this.tabPanelDiv=document.createElement("div"),this.tabPanelDiv.setAttribute("class","ocb-variant-tab-panel"),this.div.appendChild(this.tabPanelDiv),this.toolTabPanel=Ext.create("Ext.tab.Panel",{title:this.toolPanelConfig.title,border:this.toolPanelConfig.border,margin:"10 0 0 0",plain:!0,animCollapse:!1,header:this.toolPanelConfig.headerConfig,collapseDirection:Ext.Component.DIRECTION_BOTTOM,titleCollapse:!0,overlapHeader:!0,defaults:{hideMode:"offsets",autoShow:!0},listeners:{tabchange:function(b,c,d,e){a.selectedToolDiv=c.contentEl,a.lastVariant&&a.trigger("variant:change",{variant:a.lastVariant,sender:a})}}});var b=[];this.defaultToolConfig.stats&&(this.variantStatsPanelDiv=document.createElement("div"),this.variantStatsPanelDiv.setAttribute("class","ocb-variant-stats-panel"),this.variantStatsPanel=this._createVariantStatsPanel(this.variantStatsPanelDiv),b.push({title:"File and Stats",contentEl:this.variantStatsPanelDiv})),this.defaultToolConfig.effect&&(this.variantEffectGridDiv=document.createElement("div"),this.variantEffectGridDiv.setAttribute("class","ocb-variant-effect-grid"),this.variantEffectGrid=this._createVariantEffectGrid(this.variantEffectGridDiv),b.push({title:"Effect and Annotation",contentEl:this.variantEffectGridDiv})),this.defaultToolConfig.genotype&&(this.variantGenotypeGridDiv=document.createElement("div"),this.variantGenotypeGridDiv.setAttribute("class","ocb-variant-genotype-grid"),this.variantGenotypeGrid=this._createVariantGenotypeGrid(this.variantGenotypeGridDiv),b.push({title:"Genotype",contentEl:this.variantGenotypeGridDiv})),this.defaultToolConfig.genomeViewer&&(this.genomeViewerDiv=document.createElement("div"),this.genomeViewerDiv.setAttribute("class","ocb-gv"),$(this.genomeViewerDiv).css({border:"1px solid lightgray"}),this.genomeViewer=this._createGenomeViewer(this.genomeViewerDiv),b.push({title:"Genomic Context",border:0,contentEl:this.genomeViewerDiv}));for(var c=0;c<this.tools.length;c++){var d=this.tools[c],e=document.createElement("div");d.tool.target=e,b.push({title:d.title,contentEl:e})}this.toolTabPanel.add(b),this.rendered=!0},draw:function(){if(this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),!this.targetDiv)return void console.log("target not found");this.targetDiv.appendChild(this.div),this.variantBrowserGrid.draw(),this.toolTabPanel.render(this.tabPanelDiv);for(var a=0;a<this.toolTabPanel.items.items.length;a++)this.toolTabPanel.setActiveTab(a);this.defaultToolConfig.effect&&this.variantEffectGrid.draw(),this.defaultToolConfig.genotype&&this.variantGenotypeGrid.draw(),this.defaultToolConfig.genomeViewer&&this.genomeViewer.draw(),this.defaultToolConfig.stats&&this.variantStatsPanel.draw();for(var a=0;a<this.tools.length;a++){var b=this.tools[a];b.tool.draw()}this.toolTabPanel.setActiveTab(0)},_createVariantBrowserGrid:function(a){var b=this,c=new VariantBrowserGrid({title:this.browserGridConfig.title,target:a,data:this.data,border:this.browserGridConfig.border,dataParser:this.dataParser,responseRoot:this.responseRoot,responseTotal:this.responseTotal,responseParser:this.responseParser,startParam:this.startParam,attributes:this.attributes,columns:this.columns,samples:this.samples,headerConfig:this.headerConfig,handlers:{"variant:change":function(a){b.lastVariant=a.args,b.trigger("variant:change",{variant:b.lastVariant,sender:b})},"variant:clear":function(a){b.trigger("variant:clear",{sender:b})}}});return c},_createVariantEffectGrid:function(a){var b=this,c=new VariantEffectGrid({target:a,headerConfig:this.defaultToolConfig.headerConfig,gridConfig:{flex:1,layout:{align:"stretch"}},handlers:{"load:finish":function(a){}}});return this.variantBrowserGrid.on("variant:clear",function(a){c.clear(!0)}),this.on("variant:change",function(d){if(a===b.selectedToolDiv){var e=(d.variant,b._loadExampleData());c.load(e)}}),c},_createVariantStatsPanel:function(a){var b=this,c=new VariantStatsPanel({target:a,headerConfig:this.defaultToolConfig.headerConfig,handlers:{"load:finish":function(a){}}});return this.variantBrowserGrid.on("variant:clear",function(a){c.clear(!0)}),this.on("variant:change",function(d){if(a===b.selectedToolDiv){var e=d.variant;e.files&&c.load(e.files)}}),c},_createVariantGenotypeGrid:function(a){var b=this,c=new VariantGenotypeGrid({target:a,headerConfig:this.defaultToolConfig.headerConfig,gridConfig:{flex:1,layout:{align:"stretch"}},handlers:{"load:finish":function(a){}}});return this.variantBrowserGrid.on("variant:clear",function(a){c.clear(!0)}),b.on("variant:change",function(d){if(a===b.selectedToolDiv){var e=d.variant;e.files&&c.load(e.files)}}),c},_createGenomeViewer:function(a){var b=this,c=new Region({chromosome:"13",start:32889611,end:32889611}),d=new GenomeViewer({sidePanel:!1,target:a,border:!1,resizable:!0,width:this.width,region:c,trackListTitle:"",drawNavigationBar:!0,drawKaryotypePanel:!1,drawChromosomePanel:!1,drawRegionOverviewPanel:!0,overviewZoomMultiplier:50,navigationBarConfig:{componentsConfig:{restoreDefaultRegionButton:!1,regionHistoryButton:!1,speciesButton:!1,chromosomesButton:!1,karyotypeButton:!1,chromosomeButton:!1,regionButton:!1,windowSizeControl:!1}}}),e=new FeatureRenderer(FEATURE_TYPES.gene);e.on({"feature:click":function(a){console.log(a)}});var f=new FeatureTrack({minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,height:100,renderer:e,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",params:{exclude:"transcripts,chunkIds"},species:d.species,cacheConfig:{chunkSize:1e5}})}),g=new SequenceTrack({height:30,visibleRegionSize:200,renderer:new SequenceRenderer,dataAdapter:new SequenceAdapter({category:"genomic",subCategory:"region",resource:"sequence",species:d.species})}),h=new GeneTrack({title:"Gene",minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,minTranscriptRegionSize:2e5,height:140,renderer:new GeneRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:d.species,params:{exclude:"transcripts.tfbs,transcripts.xrefs,transcripts.exons.sequence"},cacheConfig:{chunkSize:1e5}})}),i=new FeatureTrack({title:"SNP",featureType:"SNP",minHistogramRegionSize:1e4,maxLabelRegionSize:3e3,height:100,renderer:new FeatureRenderer(FEATURE_TYPES.snp),dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"snp",params:{exclude:"transcriptVariations,xrefs,samples"},species:d.species,cacheConfig:{chunkSize:1e4}})});return d.addOverviewTrack(f),d.addTrack([g,h,i]),this.on("variant:change",function(c){if(a===b.selectedToolDiv){var e=c.variant,f=new Region(e);_.isUndefined(d)||d.setRegion(f)}}),d},retrieveData:function(a,b){this.variantBrowserGrid.loadUrl(a,b)},setLoading:function(a){this.variantBrowserGrid.setLoading(a)},_loadExampleData:function(){var a={chromosome:"1",start:10001,end:10001,referenceAllele:"T",genes:[],effects:{G:[{allele:"G",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000456328",featureType:"Transcript",featureBiotype:"processed_transcript",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!0,variantToTranscriptDistance:1868},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000488147",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4403},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000541675",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"G",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000450305",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:2009},{allele:"G",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000515242",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1871},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000538476",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4410},{allele:"G",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000518655",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1873},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000438504",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!0,variantToTranscriptDistance:4362},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000423562",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"G",featureId:"ENSR00000668495",featureType:"RegulatoryFeature",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1566],canonical:!1,variantToTranscriptDistance:-1}],A:[{allele:"A",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000456328",featureType:"Transcript",featureBiotype:"processed_transcript",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!0,variantToTranscriptDistance:1868},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000488147",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4403},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000541675",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"A",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000450305",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:2009},{allele:"A",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000515242",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1871},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000538476",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4410},{allele:"A",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000518655",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1873},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000438504",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!0,variantToTranscriptDistance:4362},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000423562",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"A",featureId:"ENSR00000668495",featureType:"RegulatoryFeature",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1566],canonical:!1,variantToTranscriptDistance:-1}],C:[{allele:"C",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000456328",featureType:"Transcript",featureBiotype:"processed_transcript",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!0,variantToTranscriptDistance:1868},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000488147",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4403},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000541675",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"C",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000450305",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:2009},{allele:"C",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000515242",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1871},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000538476",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4410},{allele:"C",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000518655",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1873},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000438504",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!0,variantToTranscriptDistance:4362},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000423562",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"C",featureId:"ENSR00000668495",featureType:"RegulatoryFeature",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1566],canonical:!1,variantToTranscriptDistance:-1}],"-":[{allele:"-",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000456328",featureType:"Transcript",featureBiotype:"processed_transcript",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!0,variantToTranscriptDistance:1868},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000488147",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4403},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000541675",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"-",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000450305",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:2009},{allele:"-",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000515242",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1871},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000538476",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4410},{allele:"-",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000518655",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1873},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000438504",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],
canonical:!0,variantToTranscriptDistance:4362},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000423562",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"-",featureId:"ENSR00000668495",featureType:"RegulatoryFeature",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1566],canonical:!1,variantToTranscriptDistance:-1}]},frequencies:{maf1000G:.6,maf1000GAfrican:.5,maf1000GAmerican:.4,maf1000GAsian:.3,maf1000GEuropean:.2,mafNhlbiEspAfricanAmerican:.1,mafNhlbiEspEuropeanAmerican:.2},proteinSubstitutionScores:{polyphenScore:-1,siftScore:-1},regulatoryEffect:{motifPosition:0,motifScoreChange:0,highInformationPosition:!1}};return a}},GenericFormPanel.prototype.draw=function(){var a=this;return null==this.panel&&("window"==this.type?this.panel=Ext.create("Ext.window.Window",{title:this.title,closable:this.closable,minimizable:this.minimizable,resizable:this.resizable,layout:"fit",items:{border:0,items:[this.getForm()]},listeners:{minimize:function(){this.hide()},close:function(){this.hide()}}}):this.panel=Ext.create("Ext.panel.Panel",{title:this.title,closable:this.closable,style:this.style,overflowY:"auto",items:[this.getForm()],border:this.border,bodyPadding:this.bodyPadding,header:this.headerConfig,listeners:{beforeclose:function(){return a.panel.up().remove(a.panel,!1),console.log("closing"),!1}}}),this.panelId=this.panel.getId()),this.panel},GenericFormPanel.prototype.show=function(){"undefined"!=typeof this.panel&&this.panel.show()},GenericFormPanel.prototype.hide=function(){"undefined"!=typeof this.panel&&this.panel.hide()},GenericFormPanel.prototype.getForm=function(){if(null==this.form){var a=this.getPanels();a.push(this.getJobPanel()),this.form=Ext.create("Ext.form.Panel",{border:0,width:this.width,height:this.height,autoScroll:!0,trackResetOnLoad:!0,bodyPadding:5,layout:{type:"vbox",align:"stretch"},items:a,bbar:{layout:{pack:"end"},items:[this.getRunButton()]}})}return this.form},GenericFormPanel.prototype.getPanels=function(){},GenericFormPanel.prototype.getJobPanel=function(){this.jobNameField=Ext.create("Ext.form.field.Text",{id:this.id+"jobname",name:"jobname",fieldLabel:"Name",labelWidth:this.labelWidth,emptyText:"Job name",allowBlank:!1}),this.jobDescriptionField=Ext.create("Ext.form.field.TextArea",{id:this.id+"jobdescription",name:"jobdescription",labelWidth:this.labelWidth,fieldLabel:"Description",emptyText:"Description"});var a=(this.createOpencgaBrowserCmp({id:Utils.genId("jobFolder"),fieldLabel:"Folder",dataParamName:"outdir",mode:"folderSelection",defaultFileLabel:"Default job folder",allowBlank:!0}),Ext.create("Ext.panel.Panel",{title:"Job information",header:this.headerFormConfig,border:this.formBorder,bodyPadding:10,defaults:{margin:"5 0 0 0"},buttonAlign:"center",items:[this.jobNameField,this.jobDescriptionField]}));return a},GenericFormPanel.prototype.getRunButton=function(){var a=this;return Ext.create("Ext.button.Button",{text:"Run",width:this.buttonConfig.width,height:this.buttonConfig.height,disabled:!0,cls:"btn btn-default",formBind:!0,handler:function(){a.paramsWS={};var b=a.getForm().getForm().getValues();for(var c in b)a.paramsWS[c]=b[c];a.beforeRun(),a.run()}})},GenericFormPanel.prototype.setAccountParams=function(){this.paramsWS.sessionid=$.cookie("bioinfo_sid"),this.paramsWS.accountid=$.cookie("bioinfo_account")},GenericFormPanel.prototype.beforeRun=function(){},GenericFormPanel.prototype.run=function(){delete this.paramsWS.browseFieldLabel,this.setAccountParams(),""===this.paramsWS.outdir&&delete this.paramsWS.outdir,this.testing?console.log("@@ Watch out!!! testing flag is on, so job will not launched."):(OpencgaManager.runAnalysis({analysis:this.analysis,paramsWS:this.paramsWS,success:this.runAnalysisSuccess}),this.trigger("after:run",{sender:this})),console.log("@@ Form paramsWS"),console.log(this.paramsWS)},GenericFormPanel.prototype.clean=function(){for(var a=this.form.query("field"),b=0;b<a.length;b++){var c=a[b];c.reset()}},GenericFormPanel.prototype.createCombobox=function(a,b,c,d,e,f){return Ext.create("Ext.form.field.ComboBox",{id:a,name:a,fieldLabel:b,store:c,queryMode:"local",displayField:"name",valueField:"value",value:c.getAt(d).get("value"),labelWidth:e,margin:f,editable:!1,allowBlank:!1})},GenericFormPanel.prototype.createCheckBox=function(a,b,c,d,e,f){return Ext.create("Ext.form.field.Checkbox",{id:a,name:a,boxLabel:b,checked:c||!1,disabled:e,margin:d||"0 0 0 0"})},GenericFormPanel.prototype.createRadio=function(a,b,c,d){var e=Ext.create("Ext.form.field.Radio",{id:a+"_"+this.id,boxLabel:a,inputValue:a,checked:c,name:b,hidden:d});return e},GenericFormPanel.prototype.createLabel=function(a,b){var c=Ext.create("Ext.form.Label",{id:a+"_"+this.id,margin:b||"15 0 0 0",html:'<span class="emph">'+a+"</span>"});return c},GenericFormPanel.prototype.createTextFields=function(a){var b=Ext.create("Ext.form.field.Text",{id:a+"_"+this.id,fieldLabel:a,name:a});return b},GenericFormPanel.prototype.createOpencgaBrowserCmp=function(a){var b=this,c=Ext.create("Ext.form.field.Text",{id:a.id,fieldLabel:a.fieldLabel,labelAlign:a.labelAlign,labelWidth:b.labelWidth,width:a.width,editable:!1,name:"browseFieldLabel",value:a.defaultFileLabel||"browse file...",allowBlank:a.allowBlank||!1,listeners:{focus:function(){null!=a.beforeClick&&a.beforeClick(a),b.opencgaBrowserWidget.once("select",function(b){"undefined"!=typeof b&&(c.setValue(b.id),d.setValue(b.pathQuery),a.onSelect&&a.onSelect(b))}),b.opencgaBrowserWidget.show({mode:a.mode,allowedTypes:a.allowedTypes})}}}),d=Ext.create("Ext.form.field.Text",{id:a.id+"hidden",editable:!1,hidden:!0,name:a.dataParamName,value:"",allowBlank:a.allowBlank||!1});return Ext.create("Ext.form.FieldContainer",{hidden:a.hidden,items:[c,d]})},HeaderWidget.prototype={render:function(){var a=this,b="";this.applicationMenuEl&&(b='<li id="appMenu" class="menu">&nbsp;<i class="fa fa-chevron-right"></i>&nbsp; <span class="">Menu</span></li>');var c="";this.allowJobs&&(c='<li id="jobs" class="right hidden"><i class="fa fa-tasks"></i> &nbsp;jobs</li>');var d='   <ul class="ocb-header">'+b+'       <li class="title"> &nbsp; '+this.appname+'       </li>       <li id="description" class="description">'+this.description+'       </li>       <li id="support" class="right"> &nbsp; <i class="fa fa-support"></i>&nbsp;       </li>       <li id="signin" class="right"><i class="fa fa-sign-in"></i> &nbsp;sign in       </li>'+b+'       <li id="profile" class="right hidden"><i class="fa fa-user"></i> &nbsp;profile       </li>       <li id="upload" class="right hidden"><i class="fa fa-cloud-upload"></i> &nbsp;upload & manage       </li>       <li id="logout" class="right hidden"><i class="fa fa-sign-out"></i> &nbsp;logout       </li>       <li id="user" class="right hidden text">       </li>   </ul>',e='   <ul class="ocb-help-menu unselectable">       <li id="homeHelp" class="right"><i class="fa fa-home"></i> &nbsp;home       </li>       <li id="documentation" class="right"><i class="fa fa-book"></i> &nbsp;documentation       </li>       <li id="tutorial" class="right"><i class="fa fa-list-alt"></i> &nbsp;tutorial       </li>       <li id="about" class="right"><i class="fa fa-info"></i> &nbsp; about       </li>   </ul>';this.div=$('<div class="ocb-header-widget unselectable">'+d+"</div>")[0],$(this.div).css({height:this.height+"px",position:"relative"}),this.supportMenuEl=$(e)[0],$(this.div).append(this.supportMenuEl),this.applicationMenuEl&&$(this.div).append(this.applicationMenuEl);for(var f=$(this.div).find("ul").children(),g=0;g<f.length;g++){var h=f[g].getAttribute("id");h&&(this.els[h]=f[g])}$(this.div).mouseleave(function(){a.toogleSupportMenu(!1)}),$(this.div).click(function(b){b.target===a.els.support||b.target.parentNode===a.els.support?a.toogleSupportMenu():a.toogleSupportMenu(!1)}),$(this.els.appMenu).click(function(){a.toogleAppMenu()}),$(this.els.homeHelp).click(function(){window.location.href=a.homeLink}),$(this.els.documentation).click(function(){window.open(a.helpLink)}),$(this.els.tutorial).click(function(){window.open(a.tutorialLink)}),$(this.els.about).click(function(){a.trigger("about:click",{sender:a})}),$(this.els.signin).click(function(){a.loginWidget.show()}),$(this.els.logout).click(function(){OpencgaManager.users.logout({id:Cookies("bioinfo_user"),query:{sid:Cookies("bioinfo_sid")},request:{success:a.logoutSuccess,error:a.logoutSuccess}}),Cookies.expire("bioinfo_sid"),Cookies.expire("bioinfo_user"),a.sessionFinished(),a.trigger("logout",{sender:this})}),$(this.els.profile).click(function(){a.profileWidget.show()}),$(this.els.upload).click(function(){a.opencgaBrowserWidget.show({mode:"manager"})}),$(this.els.jobs).click(function(){a.trigger("jobs:click",{sender:a})}),$(this.els.projects).click(function(){a.trigger("projects:click",{sender:a})}),this.logoutSuccess=function(a){""!==a.response[0].errorMsg&&null!=a.response[0].errorMsg||console.log(a)},this.getUserInfoSuccess=function(b){(""===b.response[0].errorMsg||null==b.response[0].errorMsg)&&b.response[0].result.length>0&&(a.setUserData(b.response[0].result[0]),a.trigger("user:change",{sender:this,response:b.response[0].result[0]}),console.log("userData has been modified since last call"))},this.loginWidget=this._createLoginWidget(),this.profileWidget=this._createProfileWidget(),this.opencgaBrowserWidget=this._createOpencgaBrowserWidget(),this.projectBrowser=this._createProjectBrowser(),this.rendered=!0},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),this.loginWidget.draw(),this.profileWidget.draw(),this.opencgaBrowserWidget.draw(),void(null!=Cookies("bioinfo_sid")?this.sessionInitiated():this.sessionFinished())):void console.log("target not found")},getHeight:function(){return this.height},toogleAppMenu:function(a){this.applicationMenuEl&&(a===!0?($(this.applicationMenuEl).addClass("ocb-app-menu-shown"),$(this.els.appMenu).children("i").removeClass("fa-chevron-right"),$(this.els.appMenu).children("i").addClass("fa-chevron-left")):a===!1?($(this.applicationMenuEl).removeClass("ocb-app-menu-shown"),$(this.els.appMenu).children("i").addClass("fa-chevron-right"),$(this.els.appMenu).children("i").removeClass("fa-chevron-left")):($(this.applicationMenuEl).toggleClass("ocb-app-menu-shown"),$(this.els.appMenu).children("i").toggleClass("fa-chevron-right"),$(this.els.appMenu).children("i").toggleClass("fa-chevron-left")))},toogleSupportMenu:function(a){this.supportMenuEl&&(a===!0?$(this.supportMenuEl).addClass("ocb-help-menu-shown"):a===!1?$(this.supportMenuEl).removeClass("ocb-help-menu-shown"):$(this.supportMenuEl).toggleClass("ocb-help-menu-shown"))},_createLoginWidget:function(){var a=this,b=new LoginWidget({suiteId:this.suiteId,autoRender:!0,handlers:{"session:initiated":function(){a.sessionInitiated(),a.trigger("login",{sender:this})}}});return b},_createProfileWidget:function(){var a=new ProfileWidget({autoRender:!0});return a},_createOpencgaBrowserWidget:function(){var a=this,b=new OpencgaBrowserWidget({suiteId:this.suiteId,chunkedUpload:this.chunkedUpload,enableTextModeUW:this.enableTextModeUW,autoRender:!0,handlers:{"need:refresh":function(){a.getUserInfo()}}});return b},_createProjectBrowser:function(){var a=document.createElement("jso-project-browser");return a},setUserData:function(a){this.userData=a,this.opencgaBrowserWidget.setUserData(a),console.log(a),this.projectBrowser.projectList=a.projects},getUserInfo:function(){var a=null;null!=this.userData&&(a=this.userData.lastActivity);var b=Cookies("bioinfo_user");b?OpencgaManager.users.read({id:b,query:{sid:Cookies("bioinfo_sid"),lastActivity:a},request:{success:this.getUserInfoSuccess,error:this.logoutSuccess}}):(console.log("cookie: bioinfo_user, is not set, session will be finished..."),this.sessionFinished())},_getUserText:function(){var a=Cookies("bioinfo_user");return a.indexOf("anonymous_")!=-1&&(a="anonymous"),'<span style="color:darkred">'+a+"</span>"},sessionInitiated:function(){var a=this;this.els.user.innerHTML=this._getUserText(),this.loginWidget.hide(),$(this.els.signin).addClass("hidden"),$(this.els.logout).removeClass("hidden"),$(this.els.profile).removeClass("hidden"),$(this.els.upload).removeClass("hidden"),$(this.els.projects).removeClass("hidden"),$(this.els.user).removeClass("hidden"),$(this.els.jobs).removeClass("hidden"),this.userInfoInterval||(this.getUserInfo(),this.userInfoInterval=setInterval(function(){a.getUserInfo()},this.checkTimeInterval))},sessionFinished:function(){$(this.els.logout).addClass("hidden"),$(this.els.profile).addClass("hidden"),$(this.els.upload).addClass("hidden"),$(this.els.projects).addClass("hidden"),$(this.els.user).addClass("hidden"),$(this.els.jobs).addClass("hidden"),$(this.els.signin).removeClass("hidden"),$(this.els.user).html(""),$(this.els.user).removeClass("hidden"),clearInterval(this.userInfoInterval),delete this.userInfoInterval,this.profileWidget.hide(),this.opencgaBrowserWidget.hide(),this.opencgaBrowserWidget.removeUserData()},setDescription:function(a){$(this.els.description).html(a)},setWidth:function(a){this.width=a}},JobListWidget.prototype={render:function(){this.div=$("<div></div>")[0],this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},show:function(){this.panel.show()},hide:function(){this.panel.hide()},toggle:function(){this.panel.isVisible()?this.panel.hide():this.panel.show()},setAccountData:function(a){this.accountData=a;for(var b,c=[],d=0;d<this.accountData.projects.length;d++)for(var e=0;e<this.accountData.projects[d].jobs.length;e++)b=this.accountData.projects[d].jobs[e],"undefined"!=typeof this.tools[b.toolName]&&(b.date=Utils.parseDate(b.date),c.push(b));this.store.loadData(c),this._updateButtons(c)},_createPanel:function(){var a=this,b=new Ext.XTemplate(['<tpl for=".">','<div class="ocb-job-list-widget-item">','<div style="color:#596F8F">{[ this.getNewIcon(values) ]} {name}</div>','<div> <span class="{[ this.getClass(values) ]}">{toolName}{execution} </span> </div>','<div><span style="color: {[ this.getStatusColor(values) ]};">{status}</span> <span style="color: dimgray;font-size:12px;"> &nbsp; &nbsp; {date} </span> </div>',"</div>","</tpl>",{getStatusColor:function(b){var c="#000000";switch(b.status){case"running":c=a.RUNING_COLOR;break;case"finished":c=a.FINISHED_COLOR;break;case"queued":c=a.QUEUED_COLOR;break;case"execution_error":case"queue_error":c=a.ERROR_COLOR}return c}},{getNewIcon:function(b){var c="";switch(0===b.visites&&(c+='<i style="color:'+a.FINISHED_COLOR+'" class="fa fa-exclamation-circle"></i> '),b.status){case"running":c+='<i style="color:'+a.RUNING_COLOR+'" class="fa fa-cog"></i>';break;case"queued":c+='<i style="color:'+a.QUEUED_COLOR+'" class="fa fa-clock-o"></i>';break;case"finished":c+='<i style="color:'+a.FINISHED_COLOR+'" class="fa fa-check-circle"></i>';break;case"execution_error":case"queue_error":c+='<i style="color:'+a.ERROR_COLOR+'" class="fa fa-times-circle"></i>'}return c}},{getClass:function(a){return a.toolName.replace(".","_")}}]);this.store=Ext.create("Ext.data.Store",{fields:["commandLine","date","description","diskUsage","status","finishTime","inputData","jobId","message","name","outputData","ownerId","percentage","projectId","toolName","visites"],sorters:[{property:"date",direction:"DESC"}],autoLoad:!1});var c=Ext.create("Ext.view.View",{padding:15,store:this.store,tpl:b,trackOver:!0,autoScroll:!0,overItemCls:"ocb-job-list-widget-item-hover",itemSelector:".ocb-job-list-widget-item",listeners:{itemclick:function(b,c){console.log(c.data),console.log(c.data.id),a.trigger("item:click",{sender:a,item:c})},itemcontextmenu:function(b,c,d,e,f){f.stopEvent();var g={sender:a,record:c,originalEvent:f};return a._itemContextMenuHandler(g),a.trigger("item:contextmenu",g),!1}}});this.searchField=Ext.create("Ext.form.field.Text",{emptyText:"search...",enableKeyEvents:!0,flex:1,listeners:{change:function(){a._setFilters()}}}),this.btnAllId=this.id+"_btnAll",this.btnFinishedId=this.id+"_btnFinished",this.btnVisitedId=this.id+"_btnVisited",this.btnRunningId=this.id+"_btnRunning",this.btnQueuedId=this.id+"_btnQueued",this.btnErrorId=this.id+"_btnError";var d=Ext.create("Ext.panel.Panel",{height:"80vh",width:"250px",layout:"fit",items:[c],dockedItems:[{xtype:"toolbar",dock:"top",height:40,items:[{xtype:"button",id:this.id+"btnSort",tooltip:"Change order",text:'<i class="fa fa-sort"></i>',handler:function(){"DESC"==a.sort?(a.sort="ASC",a.store.sort("date","ASC")):(a.sort="DESC",a.store.sort("date","DESC"))}},{xtype:"button",id:this.id+"btnClear",text:'<i class="fa fa-eraser"></i>',tooltip:"Clear search box",handler:function(){a.searchField.setValue("")}},this.searchField]},{xtype:"toolbar",docked:"top",height:39,items:[{id:this.btnAllId,text:" ",tooltip:"Total jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnFinishedId,text:" ",tooltip:"Finished jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnVisitedId,text:" ",tooltip:"Visited jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnRunningId,text:" ",tooltip:"Running jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnQueuedId,text:" ",tooltip:"Queued jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnErrorId,text:" ",tooltip:"Error jobs",handler:function(){a._setButtonFilterFunction(this)}}]}]});return d},_setButtonFilterFunction:function(a){switch(a.id){case this.btnFinishedId:this.buttonFilterFunction=function(a){return 0==a.data.visites};break;case this.btnVisitedId:this.buttonFilterFunction=function(a){return a.data.visites>0&&a.data.status.indexOf("error")===-1};break;case this.btnRunningId:this.buttonFilterFunction=function(a){return a.data.visites==-1};break;case this.btnQueuedId:this.buttonFilterFunction=function(a){return a.data.visites==-2};break;case this.btnErrorId:this.buttonFilterFunction=function(a){return a.data.status.indexOf("error")!=-1};break;default:this.buttonFilterFunction=null}this._setFilters()},_setFilters:function(){this.store.clearFilter(),"function"==typeof this.buttonFilterFunction?this.store.addFilter([this.buttonFilterFunction,this.textFilterFunction]):this.store.addFilter(this.textFilterFunction)},_updateButtons:function(a){var b=this._getJobCounter(a);0==b.all?Ext.getCmp(this.btnAllId).hide():Ext.getCmp(this.btnAllId).show(),0==b.finished?Ext.getCmp(this.btnFinishedId).hide():Ext.getCmp(this.btnFinishedId).show(),0==b.visited?Ext.getCmp(this.btnVisitedId).hide():Ext.getCmp(this.btnVisitedId).show(),0==b.running?Ext.getCmp(this.btnRunningId).hide():Ext.getCmp(this.btnRunningId).show(),0==b.queued?Ext.getCmp(this.btnQueuedId).hide():Ext.getCmp(this.btnQueuedId).show(),0==b.error?Ext.getCmp(this.btnErrorId).hide():Ext.getCmp(this.btnErrorId).show(),Ext.getCmp(this.btnAllId).setText(b.all),Ext.getCmp(this.btnFinishedId).setText('<i style="color:'+this.FINISHED_COLOR+'" class="fa fa-exclamation-circle"></i> '+b.finished),Ext.getCmp(this.btnVisitedId).setText('<i style="color:'+this.FINISHED_COLOR+'" class="fa fa-check-circle"></i> '+b.visited),Ext.getCmp(this.btnRunningId).setText('<i style="color:'+this.RUNING_COLOR+'" class="fa fa-cog"></i> '+b.running),Ext.getCmp(this.btnQueuedId).setText('<i style="color:'+this.QUEUED_COLOR+'" class="fa fa-clock-o"></i> '+b.queued),Ext.getCmp(this.btnErrorId).setText('<i style="color:'+this.ERROR_COLOR+'" class="fa fa-times-circle"></i> '+b.error)},_getJobCounter:function(a){for(var b=0,c=0,d=0,e=0,f=0,g=0;g<a.length;g++){var h=a[g];h.visites>0?h.status.indexOf("error")!=-1?f++:c++:(0==h.visites&&(h.status.indexOf("error")!=-1?f++:b++),h.visites==-1&&d++,h.visites==-2&&e++)}return{all:a.length,visited:c,finished:b,running:d,queued:e,error:f}},_itemContextMenuHandler:function(a){var b=a.record,c=Ext.create("Ext.menu.Menu",{plain:!0,items:[{text:"Delete Job",icon:Utils.images.del,handler:function(a,c){b&&Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(a){"yes"==a&&OpencgaManager.deleteJob({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.data.id,success:function(a){""===a.errorMsg?Utils.msg("Delete job",'</span class="emph">'+a.result[0].msg+"</span>"):Ext.Msg.alert("Delete job, try again later.",a.errorMsg)}})})}}]});c.showAt(a.originalEvent.getXY())}},LoginWidget.prototype={show:function(){this.panel.show()},hide:function(){this.panel.hide(),this.ShowBack()},render:function(){var a=this;this.loginSuccess=function(b){null!=a.panel&&a.panel.setLoading(!1),console.log(b),""===b.response[0].errorMsg||null==b.response[0].errorMsg?(Cookies.set("bioinfo_sid",b.response[0].result[0].sessionId),Cookies.set("bioinfo_user",b.response[0].result[0].userId),a.trigger("session:initiated",{sender:a})):(Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.response[0].errorMsg+"</span>",!1),Cookies.expire("bioinfo_sid"),Cookies.expire("bioinfo_user"))},this.createUserSuccess=function(b){if(a.panel.setLoading(!1),""===b.response[0].errorMsg){var c=b.response[0].result[0].id;Ext.getCmp(a.labelEmailId).setText('<span class="ok">'+c+" created</span>",!1)}else Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.response[0].errorMsg+"</span>",!1),Cookies.expire("bioinfo_sid"),Cookies.expire("bioinfo_user")},this.resetPasswordSuccess=function(b){a.panel.setLoading(!1),""===b.response[0].errorMsg||null==b.response[0].errorMsg?Ext.getCmp(a.labelEmailId).setText('<span class="emph">OK</span>',!1):Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.response[0].errorMsg+"</span>",!1)},this.labelEmailId=this.id+"labelEmail",this.labelPassId=this.id+"labelPass",this.fldEmailId=this.id+"fldEmail",this.fldPasswordId=this.id+"fldPassword",this.fldNpass1Id=this.id+"fldNpass1",this.fldNpass2Id=this.id+"fldNpass2",this.btnSignId=this.id+"fldSign",this.btnAnonymousId=this.id+"btnAnonymous",this.btnForgotId=this.id+"btnForgot",this.btnNewaccId=this.id+"btnNewacc",this.btnSendId=this.id+"btnSend",this.btnBackId=this.id+"btnBack",this.btnRegisterId=this.id+"btnRegister",this.rendered=!0},draw:function(){return this.rendered?void(this.panel=this._createPanel(this.targetId)):void console.info("Login Widget is not rendered yet")},_createPanel:function(a){var b=this,c=Ext.create("Ext.toolbar.TextItem",{id:this.labelEmailId,padding:3,text:'<span class="info">Type your user ID and password</span>'}),d=Ext.create("Ext.form.Panel",{id:this.id+"formPanel",bodyPadding:20,height:225,width:350,border:0,bbar:{items:[c]},items:[{id:this.id+"userId",xtype:"textfield",value:Cookies("bioinfo_user"),fieldLabel:"user ID",hidden:!1,listeners:{scope:this,change:this.checkUserId}},{id:this.fldPasswordId,xtype:"textfield",fieldLabel:"password",inputType:"password",listeners:{specialkey:function(a,c){c.getKey()==c.ENTER&&b.sign()}}},{id:this.fldEmailId,xtype:"textfield",fieldLabel:"e-mail",hidden:!0,listeners:{change:function(){b.checkemail()},specialkey:function(a,c){c.getKey()==c.ENTER&&b.sign()}}},{id:this.id+"userName",xtype:"textfield",fieldLabel:"name",hidden:!0,listeners:{scope:this,change:this.checkName}},{id:this.fldNpass1Id,xtype:"textfield",fieldLabel:"password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.fldNpass2Id,xtype:"textfield",fieldLabel:"re-password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.btnAnonymousId,xtype:"checkboxfield",padding:"10 0 0 0",boxLabel:'Anonymous login <p class="tip s90">Your work will be lost after logout</p>',margin:"0 0 0 50",listeners:{change:function(a,c,d,e){c?(Ext.getCmp(b.id+"userId").disable(),Ext.getCmp(b.fldPasswordId).disable()):(Ext.getCmp(b.id+"userId").enable(),Ext.getCmp(b.fldPasswordId).enable())}}}]}),e=Ext.create("Ext.window.Window",{id:this.id+"windowPanel",title:"Sign in",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,items:{border:0,layout:{type:"vbox",align:"stretch"},items:[d],bbar:{layout:{pack:"center"},items:[{id:this.btnSignId,text:"Sign in"},{id:this.btnForgotId,text:"Forgot yout password?"},{id:this.btnNewaccId,text:"New user"},{id:this.btnSendId,text:"Send",hidden:!0},{id:this.btnRegisterId,text:"Register",hidden:!0},{id:this.btnBackId,text:"Back",hidden:!0}]}},listeners:{minimize:function(){b.panel.hide()}}});return Ext.getCmp(this.btnForgotId).on("click",this.ShowForgot,this),Ext.getCmp(this.btnBackId).on("click",this.ShowBack,this),Ext.getCmp(this.btnNewaccId).on("click",this.ShowNewacc,this),Ext.getCmp(this.btnSignId).on("click",this.sign,this),Ext.getCmp(this.btnSendId).on("click",this.sendRecover,this),Ext.getCmp(this.btnRegisterId).on("click",this.register,this),Ext.getCmp(this.btnAnonymousId).on("change",this.anonymousSelected,this),e}},LoginWidget.prototype.sign=function(){Ext.getCmp(this.btnAnonymousId).getValue()?(this.anonymousSign(),this.panel.setLoading("Waiting server...")):this.checkUserId()&&(OpencgaManager.users.login({id:this.getLogin(),query:{password:this.getPassword()},request:{success:this.loginSuccess}}),this.panel.setLoading("Waiting server..."),Cookies.set("bioinfo_user",this.getLogin()))},LoginWidget.prototype.anonymousSign=function(){},LoginWidget.prototype.register=function(){this.checkUserId()&&this.checkemail()&&this.checkName()&&this.checkpass()?OpencgaManager.users.create({query:{userId:this.getLogin(),name:this.getUserName(),email:this.getEmail(),password:this.getPasswordReg()},request:{success:this.createUserSuccess}}):Ext.getCmp(this.labelEmailId).setText('<span class="info">Fill all fields</span>',!1)},LoginWidget.prototype.sendRecover=function(){this.checkUserId()&&this.checkemail()&&(OpencgaManager.users.resetPassword({id:this.getLogin(),query:{email:this.getEmail()},request:{success:this.resetPasswordSuccess}}),this.panel.setLoading("Waiting server..."))},LoginWidget.prototype.getLogin=function(){return Ext.getCmp(this.id+"userId").getValue()},LoginWidget.prototype.getUserName=function(){return Ext.getCmp(this.id+"userName").getValue()},LoginWidget.prototype.getEmail=function(){return Ext.getCmp(this.fldEmailId).getValue()},LoginWidget.prototype.getPassword=function(){return CryptoJS.SHA1(Ext.getCmp(this.fldPasswordId).getValue()).toString()},LoginWidget.prototype.getPasswordReg=function(){return CryptoJS.SHA1(Ext.getCmp(this.fldNpass1Id).getValue()).toString()},LoginWidget.prototype.ShowForgot=function(){Ext.getCmp(this.fldEmailId).reset(),Ext.getCmp(this.fldEmailId).show(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).hide(),Ext.getCmp(this.btnAnonymousId).hide(),Ext.getCmp(this.fldNpass1Id).hide(),Ext.getCmp(this.fldNpass2Id).hide(),Ext.getCmp(this.btnSignId).hide(),Ext.getCmp(this.btnForgotId).hide(),Ext.getCmp(this.btnNewaccId).hide(),Ext.getCmp(this.btnSendId).show(),Ext.getCmp(this.btnBackId).show(),Ext.getCmp(this.btnRegisterId).hide(),Ext.getCmp(this.id+"userId").reset(),Ext.getCmp(this.id+"userName").hide(),Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your user ID and email to send a new password</span>',!1),Ext.getCmp(this.id+"userId").setFieldLabel("user ID",!1),Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1)},LoginWidget.prototype.ShowBack=function(){Ext.getCmp(this.fldEmailId).hide(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).show(),Ext.getCmp(this.btnAnonymousId).show(),Ext.getCmp(this.fldNpass1Id).hide(),Ext.getCmp(this.fldNpass2Id).hide(),Ext.getCmp(this.btnSignId).show(),Ext.getCmp(this.btnForgotId).show(),Ext.getCmp(this.btnNewaccId).show(),Ext.getCmp(this.btnSendId).hide(),Ext.getCmp(this.btnBackId).hide(),Ext.getCmp(this.btnRegisterId).hide(),Ext.getCmp(this.id+"userId").reset(),Ext.getCmp(this.id+"userName").hide(),Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your user ID and password</span>',!1),Ext.getCmp(this.id+"userId").setFieldLabel("user ID",!1)},LoginWidget.prototype.ShowNewacc=function(){Ext.getCmp(this.fldEmailId).reset(),Ext.getCmp(this.fldEmailId).show(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).hide(),Ext.getCmp(this.btnAnonymousId).hide(),Ext.getCmp(this.fldNpass1Id).show(),Ext.getCmp(this.fldNpass2Id).show(),Ext.getCmp(this.btnSignId).hide(),Ext.getCmp(this.btnForgotId).hide(),Ext.getCmp(this.btnNewaccId).hide(),Ext.getCmp(this.btnSendId).hide(),Ext.getCmp(this.btnBackId).show(),Ext.getCmp(this.btnRegisterId).show(),Ext.getCmp(this.id+"userId").reset(),Ext.getCmp(this.id+"userName").reset(),Ext.getCmp(this.id+"userName").show(),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),Ext.getCmp(this.id+"userName").setFieldLabel("name",!1),Ext.getCmp(this.id+"userId").setFieldLabel("user ID",!1),Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1),Ext.getCmp(this.fldNpass1Id).setFieldLabel("password",!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel("re-password",!1),Ext.getCmp(this.id+"userId").setValue("")},LoginWidget.prototype.checkpass=function(){var a=Ext.getCmp(this.fldNpass1Id).getValue(),b=Ext.getCmp(this.fldNpass2Id).getValue(),c=new RegExp("[ *]");return!c.test(a)&&a.length>3?a==b?(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="ok">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="ok">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),!0):(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText('<span class="err">Password does not match</span>',!1),!1):(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText('<span class="err">Password minimum length is 4</span>',!1),!1)},LoginWidget.prototype.anonymousSelected=function(a,b){b?Ext.getCmp(this.labelEmailId).setText('<span class="ok">Anonymous selected</span>',!1):Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your user ID and password</span>',!1)},LoginWidget.prototype.checkemail=function(a,b,c){Ext.getCmp(this.btnAnonymousId).reset();var d=Ext.getCmp(this.fldEmailId).getValue(),e=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return e.test(d)?(Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="ok">e-mail</span>',!1),!0):(Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="err">e-mail</span>',!1),!1)},LoginWidget.prototype.checkName=function(a,b,c){var d=Ext.getCmp(this.id+"userName").getValue();return""!=d&&null!=d?(Ext.getCmp(this.id+"userName").setFieldLabel('<span class="ok">name</span>',!1),!0):(Ext.getCmp(this.id+"userName").setFieldLabel('<span class="err">name</span>',!1),!1)},LoginWidget.prototype.checkUserId=function(a,b,c){var d=Ext.getCmp(this.id+"userId").getValue();return""!=d&&null!=d?(Ext.getCmp(this.id+"userId").setFieldLabel('<span class="ok">user ID</span>',!1),!0):(Ext.getCmp(this.id+"userId").setFieldLabel('<span class="err">user ID</span>',!1),!1)},OpencgaBrowserWidget.prototype={show:function(a){_.isUndefined(a)||(this.mode=a.mode,this.allowedTypes=a.allowedTypes),console.log(this.mode),console.log(this.allowedTypes),this.panel.show();
},hide:function(){this.panel.hide()},render:function(){this.searchFieldId=this.id+"_searchField",this.rendered=!0},draw:function(){return this.rendered?(this.uploadWidget=this._createUploadWidget(),void(this.panel=this._createPanel(this.targetId))):void console.info("Login Widget is not rendered yet")},_createUploadWidget:function(){var a=this,b=new UploadWidget({suiteId:this.suiteId,opencgaBrowserWidget:this,chunkedUpload:this.chunkedUpload,enableTextMode:this.enableTextModeUW,handlers:{"object:upload":function(b){"done"==b.data.status&&a.trigger("need:refresh",{sender:a})}}});return b},_createPanel:function(a){var b=this;this.filesStore=Ext.create("Ext.data.Store",{fields:["oid","fileBioType","fileType","fileFormat","fileName","multiple","diskUsage","creationTime","responsible","organization","date","description","status","statusMessage","members"],data:[]}),this.refreshBucketAction=Ext.create("Ext.Action",{icon:Utils.images.refresh,text:"Refresh bucket",handler:function(a,c){var d=b.folderTree.getSelectionModel().getSelection()[0];d&&d.data.isBucket&&OpencgaManager.refreshBucket({accountId:$.cookie("bioinfo_account"),bucketId:d.data.text,sessionId:$.cookie("bioinfo_sid"),success:function(a){""===a.errorMsg?(Utils.msg("Refresh Bucket",'</span class="emph">'+a.result[0].msg+"</span>"),b.trigger("need:refresh",{sender:b})):Ext.Msg.alert("Refresh bucket",a.errorMsg)}})}}),this.renameBucketAction=Ext.create("Ext.Action",{text:"Rename bucket",handler:function(a,c){var d=b.folderTree.getSelectionModel().getSelection()[0];d&&d.data.isBucket&&Ext.Msg.prompt("Rename bucket","Please enter a new name:",function(a,c){"ok"==a&&(c=c.replace(/[^a-z0-9-_.\/\s]/gi,"").trim(),OpencgaManager.renameBucket({accountId:$.cookie("bioinfo_account"),bucketId:d.data.bucketId,newBucketId:c,sessionId:$.cookie("bioinfo_sid"),success:function(a){""===a.errorMsg?(b.trigger("need:refresh",{sender:b}),Utils.msg("Rename bucket",'</span class="emph">'+a.result[0].msg+"</span>")):Ext.Msg.alert("Rename bucket",a.errorMsg)}}))},null,null,"new name")}});var c=Ext.create("Ext.Action",{icon:Utils.images.info,text:"Create index",handler:function(a,c){var d=b.filesGrid.getSelectionModel().getSelection()[0];d&&OpencgaManager.indexer({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:d.data.bucketId,objectId:d.data.oid,success:function(a){console.log(a),Utils.msg("indexer",a),d.data.indexerId=a}})}}),d=(Ext.create("Ext.Action",{text:"Show name",handler:function(a,c){var d=b.filesGrid.getSelectionModel().getSelection()[0];d&&Utils.msg("objectId",""+d.get("oid"))}}),Ext.create("Ext.Action",{icon:Utils.images.del,text:"Delete this file",handler:function(a,c){var d=b.filesGrid.getSelectionModel().getSelection()[0];d&&Ext.MessageBox.confirm("Confirm",'Are you sure you want to delete this file?<p class="emph">'+d.data.fileName+"<p>",function(a){"yes"==a&&(console.log("deleting"),OpencgaManager.deleteObjectFromBucket({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:d.data.bucketId,objectId:d.data.oid,success:function(a){""===a.errorMsg?(Utils.msg("Deleting",'</span class="emph">'+a.result[0].msg+"</span>"),b.filesGrid.store.remove(d)):Ext.Msg.alert("Deleting",a.errorMsg)}}))})}}));this.filesGrid=Ext.create("Ext.grid.Panel",{store:this.filesStore,flex:3,border:!1,viewConfig:{listeners:{itemcontextmenu:function(a,b,e,f,g){g.stopEvent();var h=[];console.log(b),"bam"!=b.data.fileFormat&&"vcf"!=b.data.fileFormat||h.push(c),h.push(d);var i=Ext.create("Ext.menu.Menu",{plain:!0,items:h});return i.showAt(g.getXY()),!1}}},selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,c){if(b.selectButton.disable(),c.length>0){b.selectedFileNode=c[0].data;var d=c[0].data.fileType,e=c[0].data.fileFormat;if("fileSelection"===b.mode&&"dir"===d)return;if(console.log(b.allowedTypes),"undefined"!=typeof b.allowedTypes&&b.allowedTypes.indexOf(e)==-1)return b.selectButton.disable(),void console.log("file format NOT allowed -"+e+"- ");if("folderSelection"===b.mode&&"dir"!==d)return;console.log("file format allowed -"+e+"- "),b.selectButton.enable()}else b.selectButton.disable()}}},columns:[{text:"File type",xtype:"actioncolumn",menuDisabled:!0,align:"center",width:54,icon:Utils.images.bluebox,renderer:function(a,b,c){this.icon=Utils.images[c.data.fileType],this.tooltip=c.data.fileType}},{text:"Name",dataIndex:"fileName",flex:2},{text:"Creation time",dataIndex:"creationTime",flex:1}]}),this.container=Ext.create("Ext.panel.Panel",{title:" ",border:!1,minWidth:125,flex:3,layout:{type:"hbox",align:"stretch"},items:[this.folderTree,this.filesGrid]}),this.selectButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){var a=b.selectedFileNode.oid.replace(/\//g,":");b.trigger("select",{id:b.selectedFileNode.oid,idQuery:a,pathQuery:"buckets:"+b.selectedFileNode.bucketId+":"+a,path:"buckets/"+b.selectedFileNode.bucketId+"/"+b.selectedFileNode.oid,bucketId:b.selectedFileNode.bucketId}),b.panel.hide()}}),this.activeUploadsCont=Ext.create("Ext.panel.Panel",{title:"Active uploads",animCollapse:!1,hidden:!0,bodyPadding:"10 0 10 0",autoScroll:!0,height:125,border:0,cls:"ocb-border-top-lightgrey",items:[]});var e={items:[]};switch(this.mode){case"folderSelection":var f;f={text:"New folder",handler:function(){b.createFolder()}},e.items.splice(0,0,f),f={text:"New bucket",handler:function(){b.createBucket()}},e.items.splice(0,0,f),this.filesStore.filter("fileType",/dir/);break;case"manager":var f;f={text:"Upload local file",handler:function(){b.drawUploadWidget()}},e.items.splice(0,0,f),f={text:"New folder",handler:function(){b.createFolder()}},e.items.splice(0,0,f),f={text:"New bucket",handler:function(){b.createBucket()}},e.items.splice(0,0,f),this.selectButton.hide();break;default:var f;f={text:"Upload local file",handler:function(){b.drawUploadWidget()}},e.items.push(f),f={text:"New folder",handler:function(){b.createFolder()}},e.items.push(f),f={text:"New bucket",handler:function(){b.createBucket()}},e.items.push(f)}1==this.chunkedUpload&&e.items.push({id:this.id+"activeUploadsButton",text:"Active uploads",enableToggle:!0,pressed:!1,toggleHandler:function(){this.pressed?b.activeUploadsCont.show():b.activeUploadsCont.hide()}});var g=Ext.create("Ext.window.Window",{title:"Upload & Manage",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,height:this.height,minHeight:this.height,width:this.width,minWidth:this.width,resizable:!0,layout:"fit",items:{border:0,layout:{type:"vbox",align:"stretch"},items:[this.container,this.activeUploadsCont],tbar:e,bbar:{layout:{pack:"end"},defaults:{width:100},items:[{text:"Close",handler:function(){b.filesGrid.getSelectionModel().deselectAll(),b.trigger("select"),b.panel.hide()}},this.selectButton]}},listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}});return this._updateFolderTree(),g},setUserData:function(a){this.accountData=a,this.rendered&&this._updateFolderTree()},removeUserData:function(){this.folderStore.getRootNode().removeAll(),this.allStore.getRootNode().removeAll(),this.filesStore.removeAll()},_updateFolderTree:function(){var a=function(a,b){for(var c=0;c<b.length;c++)if(b[c].text==a)return c;return-1},b=[],c=[];if(null!=this.accountData&&null!=this.accountData.accountId){this.filesStore.removeAll();for(var d=0;d<this.accountData.buckets.length;d++){for(var e=[],f=[],g=0;g<this.accountData.buckets[d].objects.length;g++){var h=this.accountData.buckets[d].objects[g];h.bucketId=this.accountData.buckets[d].id,null!=h.id&&(h.oid=h.id,delete h.id);var i=h.oid.split("/");"dir"==h.fileType?(h.expanded=!0,h.icon=Utils.images.dir):(h.leaf=!0,h.icon=Utils.images.r);for(var j=e,k=f,l=0;l<i.length;l++){var m=a(i[l],j);if(m!=-1)j=j[m].children;else{var n=[],o=j.push({text:i[l],children:n})-1;if("undefined"==typeof i[l+1])for(key in h)"children"!=key&&(j[o][key]=h[key]);j=n}var m=a(i[l],k);if(m!=-1)k=k[m].children;else{var n=[];if("dir"==h.fileType){var o=k.push({text:i[l],children:n})-1;if("undefined"==typeof i[l+1])for(key in h)"children"!=key&&(k[o][key]=h[key])}k=n}}}c.push({text:this.accountData.buckets[d].name,bucketId:this.accountData.buckets[d].name,oid:"",expanded:!0,isBucket:!0,children:e}),b.push({text:this.accountData.buckets[d].name,bucketId:this.accountData.buckets[d].name,oid:"",expanded:!0,isBucket:!0,children:f})}}if(this._createFolderTree(b,c),null!=this.selectedFolderNode){var p=this.folderTree.getRootNode().findChild(this.selectedFolderNode.field,this.selectedFolderNode.value,!0);null!=p&&this.folderTree.getSelectionModel().select(p)}if(null!=this.selectedFileNode){var q=this.filesGrid.getStore().findExact("oid",this.selectedFileNode.oid);q!=-1&&this.filesGrid.getSelectionModel().select(q)}},addUpload:function(a,b){var c=Ext.create("Ext.ProgressBar",{text:"Ready",width:250,margin:"4 6 0 6"}),d=Ext.create("Ext.Component",{html:a.name.substr(0,67),width:430,margin:"7 6 0 6"}),e=Ext.create("Ext.Button",{text:'<span style="color:#1155cc">Cancel</span>',margin:"3 6 0 4",width:50,handler:function(){b.terminate(),f.destroy()}}),f=Ext.create("Ext.container.Container",{padding:"3 6 0 6",layout:"hbox",items:[d,c,e]});b.onmessage=function(a){var b=a.data;console.log("@@@@@@@@@@@@@@@@ WORKER event message"),console.log(b),c.updateProgress((b.chunkId+1)/b.total,"uploading part "+(b.chunkId+1)+" of "+b.total,!1),1==b.finished&&e.setText('<span style="color:#1155cc">Done </span>')},this.activeUploadsCont.add(f),Ext.getCmp(this.id+"activeUploadsButton").toggle(!0)},viewBuckets:function(){var a=this;a.panel.removeAll(!1),a.panel.add(a.container)},viewUploads:function(){var a=this;a.panel.removeAll(!1),a.panel.add(a.activeUploadsCont)}},OpencgaBrowserWidget.prototype.setFilter=function(){var a=this,b=this.viewOrigin.getSelectionModel().getSelection()[0],c=this.viewSuite.getSelectionModel().getSelection()[0];if(this.folderStore.clearFilter(),null!=b)switch(b.data.suiteId){case"all":break;case"Uploaded Data":this.folderStore.filter(function(a){return a.data.jobId<0});break;case"Job Generated":this.folderStore.filter(function(a){return a.data.jobId>0})}if(null!=c)switch(c.data.suiteId){case 1:break;default:this.folderStore.filter(function(a){return a.data.suiteId==c.data.suiteId})}this.folderStore.filter(function(b){var c=Ext.getCmp(a.searchFieldId).getValue().toLowerCase();return!(b.data.name.toLowerCase().indexOf(c)<0)})},OpencgaBrowserWidget.prototype.checkTags=function(a){for(var b=0;b<this.tags.length;b++)if(this.tags[b].indexOf("|")>-1){for(var c=this.tags[b].split("|"),d=!1,e=0;e<c.length;e++)a.indexOf(c[e])>-1&&(d=!0);if(!d)return!1}else if(a.indexOf(this.tags[b])==-1)return!1;return!0},OpencgaBrowserWidget.prototype.createBucket=function(){var a=this;Ext.Msg.prompt("New Bucket","Please enter a name and description for the new bucket:",function(b,c){"ok"==b&&(c=c.replace(/[^a-z0-9-_.\s]/gi,"").trim(),OpencgaManager.createBucket({bucketId:c,description:"",accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),success:function(b){""===b.errorMsg?a.trigger("need:refresh",{sender:a}):Utils.msg("Create project",b.errorMsg),a.panel.setLoading(!1),Ext.getBody().unmask()}}))},null,null,"New bucket")},OpencgaBrowserWidget.prototype._getFolderTreeSelection=function(){var a=this.folderTree.getSelectionModel().getSelection();if(a.length<1)return Utils.msg("No folder selected","Please select a bucket or a folder."),null;var b,c=a[0],d="";if(null!=c.data.fileType&&"dir"==c.data.fileType){var e=c.getPath("text","/").substr(1),f=e.split("/",2);d=e.replace(f.join("/"),"").substr(1)+"/",b=f[1]}else b=c.data.text;return{bucketId:b,directory:d}},OpencgaBrowserWidget.prototype.drawUploadWidget=function(){var a=this,b=this._getFolderTreeSelection();null!=b&&a.uploadWidget.draw(b)},OpencgaBrowserWidget.prototype.createFolder=function(){var a=this;if(this.accountData.buckets.length<1)Ext.MessageBox.alert("No buckets found","Please create and select a bucket.");else{var b=this._getFolderTreeSelection();null!=b&&Ext.Msg.prompt("New folder","Please enter a name for the new folder:",function(c,d){"ok"==c&&(d=d.replace(/[^a-z0-9-_.\s]/gi,""),d=d.trim()+"/",OpencgaManager.createDirectory({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:b.bucketId,objectId:b.directory+d,success:function(b){""===b.errorMsg?(Utils.msg("Create folder",'</span class="emph">'+b.result[0].msg+"</span>"),a.trigger("need:refresh",{sender:a})):Ext.Msg.alert("Create folder",b.errorMsg)}}))},null,null,"New Folder")}},OpencgaBrowserWidget.prototype._createFolderTree=function(a,b){var c=this;if(this.container){var d=this.container.child("treepanel");d&&this.container.remove(d,!1).destroy(),this.allStore=Ext.create("Ext.data.TreeStore",{id:this.id+"allStore",fields:["text","oid"],root:{expanded:!0,text:"Drive",children:b}});var e=Ext.create("Ext.data.TreeStore",{fields:["text","oid"],root:{expanded:!0,text:"Drive",children:a},listeners:{beforeinsert:function(a,b){if(b.isLeaf())return!1}}});this.folderStore=e;var f=Ext.create("Ext.tree.Panel",{border:!1,autoScroll:!0,useArrows:!0,rootVisible:!1,hideHeaders:!0,expanded:!0,flex:1,style:{borderColor:"lightgray",borderStyle:"solid",borderWidth:"0px 1px 0 0"},columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,editor:{xtype:"textfield",allowBlank:!1}}],viewConfig:{markDirty:!1,plugins:{ptype:"treeviewdragdrop"},listeners:{drop:function(a,b,d,e,f){var g=b.records[0];if(g.isLeaf()&&g.data.index!=g.removedFrom&&g.data.checked){var h=g.data.trackId;c.setTrackIndex(h,g.data.index)}},itemcontextmenu:function(a,b,d,e,f){f.stopEvent();var g=[];if(console.log(b),b.data.isBucket){g.push(c.refreshBucketAction),g.push(c.renameBucketAction);var h=Ext.create("Ext.menu.Menu",{plain:!0,items:g});h.showAt(f.getXY())}return!1}}},listeners:{selectionchange:function(a,b,d){var e=b[0];if("undefined"!=typeof e){var f,g;null!=e.data.isBucket?(f="text",g=!1):(f="oid",g=!0);var h=c.allStore.getRootNode().findChild(f,e.data[f],g),i=[];c.selectedFolderNode={value:h.data[f],field:f};for(var j in h.data.children)i.push(h.data.children[j]);c.container.setTitle(h.getPath("text"," / ")),c.filesStore.loadData(i),"folderSelection"==c.mode&&(c.selectedFileNode=h.data,c.selectButton.enable())}},viewready:function(a,b){if("undefined"==typeof c.selectedFolderNode){var d=a.getRootNode().getChildAt(0);"undefined"!=typeof d&&a.getSelectionModel().select(d)}},checkchange:function(a,b){},itemmouseenter:function(a,b){},itemmouseleave:function(a,b){}},store:e});this.folderTree=f}this.container&&(this.container.getLayout().animate=!1,this.container.insert(0,f),f.expand(),this.container.getLayout().animate=!0)},ProfileWidget.prototype={show:function(){this.panel.show()},hide:function(){this.panel.hide()},render:function(){var a=this;this.changePasswordSuccess=function(b){a.panel.setLoading(!1),""===b.response[0].errorMsg||null==b.response[0].errorMsg?(Ext.getCmp(a.id+"fldOld").setValue(null),Ext.getCmp(a.id+"fldNew1").setValue(null),Ext.getCmp(a.id+"fldNew2").setValue(null),Ext.getCmp(a.id+"labelPass").update('<span class="info">OK</span>',!1)):Ext.getCmp(a.id+"labelPass").update('<span class="err">'+b.response[0].errorMsg+"</span>",!1)},this.changeEmailSuccess=function(b){a.panel.setLoading(!1),""===b.response[0].errorMsg||null==b.response[0].errorMsg?(Ext.getCmp(a.id+"fldEmail").setValue(null),Ext.getCmp(a.id+"fldEmail").setFieldLabel("e-mail",!1),Ext.getCmp(a.id+"labelPass").update('<span class="info">OK</span>',!1)):Ext.getCmp(a.id+"labelPass").update('<span class="err">'+b.response[0].errorMsg+"</span>",!1)},this.rendered=!0},draw:function(){return this.rendered?void(this.panel=this._createPanel(this.targetId)):void console.info("Login Widget is not rendered yet")},_createPanel:function(a){var b=this,c=Ext.create("Ext.Component",{width:200,id:this.id+"labelPass",html:"Modify your password or email."}),d=Ext.create("Ext.form.Panel",{title:"Change password",bodyPadding:15,width:350,border:!1,items:[{id:this.id+"fldOld",name:"password",xtype:"textfield",fieldLabel:"Old password",inputType:"password"},{id:this.id+"fldNew1",name:"new_password1",xtype:"textfield",fieldLabel:"New password",inputType:"password",listeners:{scope:this,change:this.checkpass}},{id:this.id+"fldNew2",name:"new_password2",xtype:"textfield",fieldLabel:"Confirm new",inputType:"password",listeners:{scope:this,change:this.checkpass}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){b.changePassword()}}]}),e=Ext.create("Ext.form.Panel",{title:"Change email",bodyPadding:15,width:350,border:!1,items:[{id:this.id+"fldEmail",name:"new_email",xtype:"textfield",fieldLabel:"e-mail",listeners:{change:function(){b.checkemail()}}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){b.changeEmail()}}]}),f=Ext.create("Ext.panel.Panel",{width:350,border:!1,layout:"accordion",items:[d,e],listeners:{tabchange:function(){b.clearAllFields()}}}),g=Ext.create("Ext.window.Window",{title:"Profile",resizable:!1,minimizable:!0,constrain:!0,height:350,layout:"fit",closable:!1,modal:!0,items:{border:0,layout:"fit",items:[f],bbar:{layout:{pack:"start"},items:[c,"->",{text:"Close",handler:function(){b.panel.hide()}}]}},listeners:{minimize:function(){b.panel.hide()}}});return g},getOldPassword:function(){return CryptoJS.SHA1(Ext.getCmp(this.id+"fldOld").getValue()).toString()},getNewPassword:function(){return CryptoJS.SHA1(Ext.getCmp(this.id+"fldNew1").getValue()).toString()},getEmail:function(){return Ext.getCmp(this.id+"fldEmail").getValue()},clearAllFields:function(){Ext.getCmp(this.id+"fldOld").setValue(null),Ext.getCmp(this.id+"fldNew1").setValue(null),Ext.getCmp(this.id+"fldNew2").setValue(null),Ext.getCmp(this.id+"fldEmail").setValue(null),Ext.getCmp(this.id+"labelPass").update("&nbsp",!1)},changeEmail:function(){this.checkemail()&&(OpencgaManager.users.req({path:{id:Cookies("bioinfo_user"),action:"change-email"},query:{nemail:this.getEmail(),sid:Cookies("bioinfo_sid")},request:{success:this.changeEmailSuccess}}),this.panel.setLoading("Waiting for the server to respond..."))},changePassword:function(){this.checkpass()&&(OpencgaManager.users.req({path:{id:Cookies("bioinfo_user"),action:"change-password"},query:{password:this.getOldPassword(),npassword:this.getNewPassword(),sid:Cookies("bioinfo_sid")},request:{success:this.changePasswordSuccess}}),this.panel.setLoading("Waiting for the server to respond..."))},checkpass:function(){var a=Ext.getCmp(this.id+"fldNew1").getValue(),b=Ext.getCmp(this.id+"fldNew2").getValue(),c=Ext.getCmp(this.id+"fldOld").getValue(),d=new RegExp("[ *]");return""!=c?!d.test(a)&&a.length>3?a==b?(Ext.getCmp(this.id+"labelPass").update('<span class="ok">Passwords match</span>',!1),!0):(Ext.getCmp(this.id+"labelPass").update('<span class="err">Passwords does not match</span>',!1),!1):(Ext.getCmp(this.id+"labelPass").update('<span class="err">Password must be at least 4 characters</span>',!1),!1):(Ext.getCmp(this.id+"labelPass").update('<span class="err">Old password is empty</span>',!1),!1)},checkemail:function(){var a=Ext.getCmp(this.id+"fldEmail").getValue(),b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)?(Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="ok">e-mail</span>',!1),!0):(Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="err">e-mail</span>',!1),""==a&&Ext.getCmp(this.id+"fldEmail").setFieldLabel("e-mail",!1),!1)}},ResultTable.prototype.draw=function(){this.render()},ResultTable.prototype.render=function(){var a=this,b=null,c=new Array,d=new Array;this.tableSkel=this.tableLayout,this.colNames=this.tableSkel.colNames,this.colVisibilty=this.tableSkel.colVisibility,this.colTypes=this.tableSkel.colTypes,b=this.tableSkel.numRows,c=new Array,d=new Array;for(var e=0;e<this.colNames.length;e++)1==this.colVisibilty[e]&&(c.push({header:this.colNames[e],dataIndex:this.colNames[e],width:10*this.colNames[e].length+30}),d.push({name:this.colNames[e],type:this.colTypes[e]}));if("text"==this.tableSkel.type){var f=new WumAdapter;f.onPoll.addEventListener(function(b,c){for(var d=a.parse(c),e=[],f=0;f<d.length;f++){var g=Ext.create("Ext.container.Container",{data:d[0],tpl:a.getTemplate(a.tableSkel.colNames)});e.push(g)}this.table=Ext.create("Ext.container.Container",{items:e,margin:"0 0 0 50",renderTo:a.targetId})}),f.poll(this.jobId,this.fileName,!1,$.cookie("bioinfo_sid"))}else{var g=OpencgaManager.tableurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,filename:this.fileName});console.log(g),null==b&&(b=this.numRows);var h=b;this.st=Ext.create("Ext.data.Store",{fields:d,pageSize:h,remoteSort:!1,proxy:{url:g,type:"ajax",reader:{type:"json",root:"items",totalProperty:"total"},extraParams:{colNames:this.colNames.join(","),colVisibility:this.colVisibilty.join(",")},actionMethods:{read:"POST"}}}),this.st.loadPage(1);var i=75+30*h;this.table=Ext.create("Ext.grid.Panel",{title:this.fileName,collapsible:this.collapsible,flex:this.flex,store:this.st,border:this.border,cls:this.cls,columns:c,height:i,dockedItems:[{xtype:"pagingtoolbar",store:this.st,dock:"top",displayInfo:!0}],renderTo:this.targetId})}},ResultTable.prototype.parse=function(a){for(var b=this,c=a.split("\n"),d=[],e=0;e<c.length;e++)if("#"!=c[e].charAt(0)&&""!=c[e]){for(var f=c[e].split("\t"),g={},h=0;h<f.length;h++)""!=f[h]&&(g[b.tableSkel.colNames[h].replace(/ /g,"_")]=f[h]);d.push(g)}return d},ResultTable.prototype.getTemplate=function(a){for(var b="<p>",c=0;c<a.length;c++)b+='<span class="dis s90">'+a[c]+" </span> {"+a[c].replace(/ /g,"_")+"} &nbsp; &nbsp; &nbsp;";return b+="</p>",new Ext.XTemplate(b)},ResultWidget.prototype={id:"ResultWidget"+Math.round(1e4*Math.random()),draw:function(a,b){var c=this;this.job=b.data,this.job.command=Utils.parseJobCommand(this.job),this.jobId=this.job.id,this.id=this.jobId+this.id,this.panelId="ResultWidget_"+this.jobId,this.panel=Ext.getCmp(this.panelId);var d=this.title;if(d=""===this.title?this.job.name:this.title+" - "+this.job.name,null==this.panel)if("window"==this.type?this.panel=Ext.create("Ext.window.Window",{id:this.panelId,bodyStyle:"background:white;",title:d,closable:!0,height:this.height,width:this.width,autoScroll:!0,overflowY:"auto",maximizable:!0,layout:{type:"vbox",align:"stretch"}}):(this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:0,title:d,closable:!0,autoScroll:!0,layout:{type:"vbox",align:"stretch"}}),Ext.getCmp(this.targetId).add(this.panel)),this.panel.setLoading("Loading job info..."),this.job.status.indexOf("error")!==-1)this.panel.add(this._getJobInfo()),this.panel.add(this._getErrorInfo()),OpencgaManager.jobInfo({accountId:$.cookie("bioinfo_account"),sessionId:a,jobId:this.jobId,success:function(a){}}),this.panel.setLoading(!1);else{var e=OpencgaManager.jobResultUrl({accountId:$.cookie("bioinfo_account"),sessionId:a,jobId:this.jobId,format:"json"});console.log(e),$.getScript(e,function(){c.panel.setLoading(!1),c.result=RESULT;var a=c.result[c.layoutName].layout;a.outputItems=c.job.outputData.sort(a.sortOutputItems),a.job=c.job,"undefined"!=typeof a.oldXML&&c._parseOldXML(a),c.render(c.result),"window"==c.type?c.panel.show():Ext.getCmp(c.targetId).setActiveTab(c.panel)})}else"window"==this.type?this.panel.show():Ext.getCmp(this.targetId).setActiveTab(this.panel)},render:function(a){var b=this;console.log(this.application);var c,d=function(a){for(var c=[],d=0;d<a.length;d++)c.push(Ext.create("Ext.Component",{cls:"ocb-pointer",overCls:"u err",resultId:b.jobId+a[d].title.replace(/ /g,""),html:a[d].title,listeners:{afterrender:function(a){this.getEl().on("click",function(){var c=$("#"+a.resultId).position();if("undefined"!=typeof c){var d=c.top;$(b.panel.getEl().dom).children().scrollTop(d-10)}var e=Ext.getCmp(a.resultId),f=e.up();f.isXType("tabpanel")&&f.setActiveTab(e)})}}}));return Ext.create("Ext.panel.Panel",{title:"Result index",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,margin:10,bodyPadding:10,items:c})},e=(new Ext.XTemplate('<span class="s120">{title}</span>','<span class="ok"> {pathi} </span>','<span class="info"> {date}</span><br>'),function(a){for(var c,d=[],e=0;e<a.renderers.length;e++){var f=a.renderers[e];c=b._processRenderer(a,f),d.push(c)}return Ext.create("Ext.container.Container",{title:a.title,margin:"0 0 5 0",items:d})}),f=function(a,c){var d;if("undefined"!=typeof a.children){"function"==typeof a.children&&(a.children=a.children()),d=[];for(var g=0;g<a.children.length;g++)d.push(f(a.children[g]));if(1==c){var h;return h="tabs"==a.presentation?Ext.create("Ext.tab.Panel",{plain:!0,border:0,layout:{type:"vbox",align:"stretch"},defaults:{padding:10},items:d}):Ext.create("Ext.container.Container",{items:d}),Ext.create("Ext.panel.Panel",{title:"Result details",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,margin:10,bodyPadding:10,items:[h]})}return _.isUndefined(a.title),Ext.create("Ext.panel.Panel",{id:b.jobId+a.title.replace(/ /g,""),title:a.title,border:!1,header:{baseCls:"ocb-panel-title"},margin:"0 0 20 0",bodyPadding:5,items:[{xtype:"container",items:d}]})}return e(a)},g=a[this.layoutName].layout;if("custom"===g.presentation?"children"in g&&"function"==typeof g.children&&(g.children=g.children(),this._processCustomItem(g.children),c=g.children):c=f(g,!0),this.drawInformation===!0&&this.panel.add(this._getJobInfo()),this.panel.add(this._getJobActions({items:this.args})),this.drawIndex===!0){var h=d(a[this.layoutName].layout.children);this.panel.insert(h)}this.panel.add(c)},_processRenderer:function(a,b){var c,d=this;switch(b.type){case"note":c=Ext.create("Ext.Component",{html:b.html,item:a,cls:"inlineblock whiteborder"});break;case"message":c=Ext.create("Ext.Component",{html:'<div class="alert alert-'+a.type+'" style="text-align: center;font-size: 20px">'+a.title+"</div>",item:a,padding:3});break;case"html":c=Ext.create("Ext.Component",{html:b.html});break;case"text":c=Ext.create("Ext.Component",{html:'<span class="key">'+a.title+': </span> <span class="emph">'+a.file+"</span>",item:a,cls:"inlineblock whiteborder"});break;case"file":c=Ext.create("Ext.Component",{html:'<span class="key">'+a.title+'</span><span class="file">'+a.file+"</span>",item:a,padding:3,overCls:"encima",cls:"inlineblock whiteborder",listeners:{afterrender:function(){var a=this.item;this.getEl().on("click",function(){console.log(a),OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:d.jobId,filename:a.file,zip:!0})})}}});break;case"image":var e=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:d.jobId,filename:a.file});c=Ext.create("Ext.Img",{src:e,listeners:{render:function(a){this.mon(this.getEl(),"load",function(b){a.setWidth(this.getWidth()),a.setHeight(this.getHeight())})}}});break;case"piechart":var f,e=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:d.jobId,filename:a.file});$.ajax({type:"GET",async:!1,url:e,success:function(a){if(""!=a){for(var b=a.split("\n"),c=[],d=[],e=[],g=[],h=0,i=0;i<b.length;i++)c.push(b[i].split("\t")),""!=c[i][0]&&d.push(c[i][0]),null!=c[i][1]&&(h+=parseFloat(c[i][1]),e.push(c[i][1]));for(var i=0;i<e.length;i++)g.push(Math.round(parseFloat(e[i])/h*100));d=d.toString().replace(/,/gi,"|"),f="https://chart.googleapis.com/chart?cht=p&chs=600x300&chd=t:"+g+"&chl="+d+"&chtt=Consequence+types&chts=000000,14.5"}}}),c=Ext.create("Ext.Img",{src:f,listeners:{render:function(a){this.mon(this.getEl(),"load",function(b){a.setWidth(this.getWidth()),a.setHeight(this.getHeight())})}}});break;case"scatter":var e=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:d.jobId,filename:a.file}),g=[];$.ajax({type:"GET",async:!1,url:e,success:function(a){var a=JSON.parse(a);g="function"==typeof b.processData?b.processData(a):a}});var h=Ext.create("Ext.data.JsonStore",{fields:b.fields,data:g}),i=Ext.create("Ext.chart.Chart",{renderTo:Ext.getBody(),width:500,height:200,animate:!1,store:h,axes:[{type:"Numeric",position:"left",fields:b.y.fields,title:b.y.title,grid:!0,maximum:b.y.max},{type:"Numeric",position:"bottom",fields:b.x.fields,title:b.x.title,grid:!0}],series:[{tips:{trackMouse:!0,style:{backgroundColor:"white"},renderer:function(a,c){var d=c.storeItem.get(b.x.field),e=c.storeItem.get(b.y.field),f="<div>"+b.x.field+': <span style="font-weight: bold">'+d+"</span></div><div>"+b.y.field+': <span style="font-weight: bold">'+e+"</span></div>";this.update(f)}},type:"scatter",renderer:function(a,c,d,e,f){if("undefined"!=typeof b.config)return Ext.apply(d,b.config(c.data))},markerConfig:{type:"circle",radius:2,size:5},axis:"left",xField:b.x.field,yField:b.y.field}]});c=Ext.create("Ext.container.Container",{margin:"10 0 0 0",items:[{xtype:"box",html:'<span class="key s120">'+a.title+"</span>"},i]});break;case"memory-grid":var e=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:d.jobId,filename:a.file}),g=[],j=[];$.ajax({type:"GET",async:!1,url:e,success:function(a){var a=JSON.parse(a);g=b.data(a),j=b.fields(a)}});for(var h=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},fields:j,data:g}),k=[],l=0;l<j.length;l++)k.push({header:j[l],dataIndex:j[l],flex:1});c=Ext.create("Ext.grid.Panel",{title:a.title,flex:1,store:h,height:200,width:400,loadMask:!0,plugins:["bufferedrenderer"],columns:k});break;case"grid":var m="resultTable_"+d.jobId+a.file,n=new ResultTable(d.jobId,a.file,a.tags,{targetId:m,tableLayout:b.tableLayout});c=Ext.create("Ext.Component",{flex:1,resultTable:n,html:'<div id="'+m+'" style="padding:5px;"> </div>',listeners:{afterrender:function(a){a.resultTable.draw()}}});break;case"file-paging-grid":for(var o=[],p=[],j=b.tableLayout.fields,k=b.tableLayout.columns,q=b.tableLayout.visibility,r=b.tableLayout.types,l=(b.tableLayout.order,0);l<j.length;l++)if(1==q[l]){var s=j[l],t=k[l];t.width=10*s.length+30,o.push({name:s,type:r[l]}),p.push(t)}var e=OpencgaManager.tableurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:d.jobId,filename:a.file}),h=Ext.create("Ext.data.Store",{pageSize:10,fields:o,remoteSort:!0,proxy:{url:e,type:"ajax",reader:{root:"items",totalProperty:"total",transform:function(a){return a}},extraParams:{colNames:j.join(","),colVisibility:q.join(",")},actionMethods:{create:"GET",read:"GET",update:"GET",destroy:"GET"}}});h.load();var u=Ext.create("Ext.PagingToolbar",{store:h,pageSize:10,displayInfo:!0,displayMsg:"Rows {0} - {1} of {2}",emptyMsg:"No rows to display"});c=Ext.create("Ext.grid.Panel",{title:a.title,store:h,border:!0,header:{baseCls:"ocb-panel-title"},loadMask:!0,columns:p,plugins:"bufferedrenderer",height:b.height,width:b.width,features:[{ftype:"summary"}],viewConfig:{emptyText:"No records to display",enableTextSelection:!0},tbar:u});break;case"vcf-grid":var m="resultTable_"+d.jobId+a.file,v={name:"Stats Samples Table",colNames:["CHROM","POS","ID","REF","ALT","QUAL","FILTER","INFO","FORMAT"],colTypes:["string","int","string","string","string","string","string","string","string"],colVisibility:[1,1,1,1,1,1,1,1,1],colOrder:[0,1,2,3,,4,5,6,7,8,9]},w=$.cookie("bioinfo_sid"),x=$.cookie("bioinfo_account");OpencgaManager.jobFileGrep({pattern:"^#CHR.*",ignoreCase:"true",multi:!1,filename:a.file,sessionId:w,accountId:x,jobId:d.jobId,async:!1,success:function(b,e,f){for(var g=b.trim().split("\t"),h=9;h<g.length;h++)v.colNames.push(g[h]),v.colTypes.push("string"),v.colVisibility.push(1),v.colOrder.push(g[h-1]+1);var i=new ResultTable(d.jobId,a.file,a.tags,{targetId:m,tableLayout:v});c=Ext.create("Ext.Component",{flex:1,resultTable:i,html:'<div id="'+m+'" style="padding:5px;"> </div>',listeners:{afterrender:function(a){a.resultTable.draw()}}})}});break;case"table":var e=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:d.jobId,filename:a.file});$.ajax({
type:"GET",async:!1,url:e,success:function(a){var d='<table class="ocb-attributes-table"><tbody>',e=a.split("\n");try{var f=e[0];if(b.header&&"#"===f.charAt(0)){f=f.substr(1);var g=f.split("\t");d+="<thead>";for(var h=0;h<g.length;h++){var i=g[h];d+='<td class="header">'+i+"</td>"}d+="</thead>"}}catch(j){}d+="<tbody>";for(var k=0;k<e.length;k++){var l=e[k];if("#"!=l.charAt(0)&&""!=l.trim()){d+="<tr>";for(var g=l.split("\t"),h=0;h<g.length;h++){var i=g[h];d+="<td>"+i+"</td>"}d+="</tr>"}}d+="</tbody></table>",c=Ext.create("Ext.Component",{flex:1,html:d})}});break;case"network-viewer":var y=d._createNetworkViewer(a,b);c=Ext.create("Ext.container.Container",{contentEl:y});break;case"genome-viewer":var y=document.createElement("div");$(y).css({height:"1200px"});var z=document.createElement("div");$(z).css({width:"1500px",marginTop:"10px",border:"1px solid lightgray"});var A=document.createElement("div");$(A).css({width:"1500px",height:"300px"}),y.appendChild(A),y.appendChild(z),c=Ext.create("Ext.Component",{flex:1,contentEl:y,listeners:{afterrender:function(){var a=d._createGenomeViewer(z);d._createVariantFilterWidget(A,a,d.result[d.layoutName].layout.variantFilterFiles,b.tableLayout)}}});break;case"variant-stats-widget":var B=800;c=Ext.create("Ext.container.Container",{height:B,width:"95%",style:{position:"relative"},listeners:{afterrender:function(){var a=new VariantStatsWidget({targetId:c,height:B,closable:!1,border:!0,job:d.job,autoRender:!0});a.draw()}}});break;case"variant-widget":var B=800;c=Ext.create("Ext.container.Container",{height:B,width:"95%",style:{position:"relative"},listeners:{afterrender:function(){var a=OpencgaManager.getJobAnalysisUrl($.cookie("bioinfo_account"),d.job.id)+"/variantsMongo";console.log("URL: "+a);var b=new VariantWidget({targetId:c,height:B,closable:!1,border:!0,url:a,job:d.job,autoRender:!0});b.draw()}}})}return c},_processCustomItem:function(a){if("renderers"in a){for(var b=[],c=0;c<a.renderers.length;c++){var d=a.renderers[c];b.push(this._processRenderer(a,d))}delete a.renderers,a.xtype="container",a.margin=5,a.items=b}else if("items"in a)for(var c=0;c<a.items.length;c++)this._processCustomItem(a.items[c])},_getErrorInfo:function(){var a=Ext.create("Ext.container.Container",{margin:10});return $.ajax({type:"GET",async:!1,url:OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,filename:"sge_err.log"}),success:function(b){a.add({title:"Error log",bodyPadding:"0 10",border:!1,header:{baseCls:"ocb-panel-title"},style:{borderBottom:"1px solid lightgray"},maxHeight:400,overflowY:!0,html:"<pre>"+b+"</pre>"})}}),$.ajax({type:"GET",async:!1,url:OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,filename:"sge_out.log"}),success:function(b){a.add({title:"Out log",bodyPadding:"0 10",margin:"20 0 0 0",border:!1,header:{baseCls:"ocb-panel-title"},style:{borderBottom:"1px solid lightgray"},maxHeight:400,overflowY:!0,html:"<pre>"+b+"</pre>"})}}),a},_getJobInfo:function(){var a=new Ext.XTemplate('<div class="s110">','<div style="display:inline-block;color:steelblue;width: 45px;">Id: </div>{id}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Name: </div>{name}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Tool: </div>{toolName}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Date: </div>{date}<br>',"</div>",'<p class="tip emph">{description}</p>','<p class="">{command.html}</p>'),b=Ext.create("Ext.panel.Panel",{title:"Information",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,collapsed:this.collapseInformation,margin:10,bodyPadding:10,items:[{xtype:"box",data:this.job,tpl:a}]});return b},_getJobActions:function(a){var b=this,a=a||{},c=Ext.create("Ext.container.Container",{margin:10,bodyPadding:10,layout:{type:"hbox",align:"stretch"},defaults:{margin:"0 5 0 5"},items:[{xtype:"button",text:"download",handler:function(){OpencgaManager.downloadJob({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId})}},{xtype:"button",text:"delete",handler:function(){Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(a){"yes"==a&&OpencgaManager.deleteJob({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,success:function(a){""===a.errorMsg?Utils.msg("Delete job",'</span class="emph">'+a.result[0].msg+"</span>"):Ext.Msg.alert("Delete job, try again later.",a.errorMsg)}})})}}]});return"undefined"!=typeof a.items&&c.add(a.items),c},_createGenomeViewer:function(a){var b=this,c=new GenomeViewer({cellBaseHost:"http://bioinfo.hpc.cam.ac.uk/cellbase/webservices/rest",cellBaseVersion:"v3",target:a,width:$(a).width(),region:new Region(DEFAULT_SPECIES.region),availableSpecies:AVAILABLE_SPECIES,species:DEFAULT_SPECIES,sidePanel:!1,resizable:!1,karyotypePanelConfig:{collapsed:!1,collapsible:!0},chromosomePanelConfig:{collapsed:!1,collapsible:!0},navigationBarConfig:{componentsConfig:{}},handlers:{"region:change":function(a){console.log(a)}}}),d=[];this.sequence=new SequenceTrack({height:30,visibleRegionSize:200,renderer:new SequenceRenderer,dataAdapter:new SequenceAdapter({category:"genomic",subCategory:"region",resource:"sequence",species:c.species})}),d.push(this.sequence),this.gene=new GeneTrack({title:"Gene",minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,minTranscriptRegionSize:2e5,height:140,renderer:new GeneRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:c.species,params:{exclude:"transcripts.tfbs,transcripts.xrefs,transcripts.exons.sequence"},cacheConfig:{chunkSize:1e5}})}),d.push(this.gene);var e=new FeatureRenderer(FEATURE_TYPES.gene);e.on({"feature:click":function(a){console.log(a)}});var f=new FeatureTrack({minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,height:100,renderer:e,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",params:{exclude:"transcripts,chunkIds"},species:c.species,cacheConfig:{chunkSize:1e5}})});c.addOverviewTrack(f),this.snp=new FeatureTrack({title:"SNP",featureType:"SNP",minHistogramRegionSize:1e4,maxLabelRegionSize:3e3,height:100,renderer:new FeatureRenderer(FEATURE_TYPES.snp),dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"snp",params:{exclude:"transcriptVariations,xrefs,samples"},species:c.species,cacheConfig:{chunkSize:1e4}})}),d.push(this.snp),c.addTrack(d),c.draw(),c.chromosomePanel.hide(),c.karyotypePanel.hide();var g=this.result[b.layoutName].layout.filteredFile;return _.isUndefined(g)?console.log("No filtered VCF file."):OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:g,zip:!1,success:function(a){a.indexOf("ERROR")!=-1&&console.error(a);var b=new VCFDataAdapter(new StringDataSource(a),{async:!1,species:c.species}),d=new FeatureTrack({targetId:null,id:"VCF file",title:g,height:150,minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,renderer:new FeatureRenderer(FEATURE_TYPES.vcf),dataAdapter:b});c.addTrack(d)}}),c},_createVariantFilterWidget:function(a,b,c,d){var e=new VariantFilterWidget(this.jobId,{width:$(a).width(),height:$(a).height(),targetId:a,viewer:b,fileNames:c,tableLayout:d});return e.getPanel(a),e},_createNetworkViewer:function(a,b){var c=document.createElement("div");c.style.width=b.width+2+"px",c.style.height=b.height+2+"px",c.style.border="1px solid lightgray",c.style.marginTop="10px";var d=new NetworkViewer({target:c,autoRender:!0,sidePanel:!1,border:!1,width:b.width,height:b.height,session:new NetworkSession,handlers:{"select:vertices":function(a){},"select:edges":function(a){},"change:vertexAttributes":function(a){},"change:edgeAttributes":function(a){}}});return d.draw(),"utils"in b&&$.ajax({type:"POST",url:OpencgaManager.getUtilsUrl()+b.utils.name,data:b.utils.params,dataType:"json",success:function(a,c,e){b.utils.success(a,d)},error:function(a,b,c){console.log("error")}}),c},_parseOldXML:function(a){OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:a.job.id,filename:a.oldXML,zip:!1,async:!1,success:function(b){var c=$.parseXML(b);a.xml=$(c)}})}},UploadWidget.prototype={getTypeValidation:function(a){return function(b){var c=new RegExp("^.*\\.("+a+")$","i");return c.test(b)}}},UploadWidget.prototype.draw=function(a){this.opencgaLocation=a;var b={9:[{text:"ID List",children:[{text:"SNP",tag:"idlist:snp"},{text:"Gene/Transcript",tag:"idlist:gene:transcript"}]},{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf",validate:this.getTypeValidation("vcf")},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"BAM",tag:"bam",validate:this.getTypeValidation("bam")},{text:"BAI",tag:"bai",validate:this.getTypeValidation("bai")},{text:"Expression",tag:"expression"}]}],6:[{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf"},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"PED",tag:"ped"}]}],11:[{text:"Annotation",tag:"annotation"},{text:"ID List",children:[{text:"Gene",tag:"idlist:gene"},{text:"Ranked",tag:"ranked"}]}],12:[{text:"Abundances",tag:"abundances"}],100:[{text:"Sequence",tag:"sequence"}],22:[{text:"Tabbed text file",tag:"txt",validate:this.getTypeValidation("txt|text")},{text:"CEL compressed file",tag:"cel",validate:this.getTypeValidation("zip|tar|tar.gz|tgz")}],85:[{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf",validate:this.getTypeValidation("vcf")},{text:"PED",tag:"ped",validate:this.getTypeValidation("ped")}]}],cellmaps:[{text:"Network",children:[{text:"SIF",tag:"sif",validate:this.getTypeValidation("sif")},{text:"Expresion matrix",tag:"txt",validate:this.getTypeValidation("txt")},{text:"Text",tag:"txt",validate:this.getTypeValidation("txt")}]}]};"undefined"==typeof b[this.suiteId]?this.render([{text:"No data types defined"}]):(this.checkDataTypes(b[this.suiteId]),this.render(b[this.suiteId]))},UploadWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))},UploadWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].expanded=!0,this.checkDataTypes(a[b].children)):a[b].leaf=!0},UploadWidget.prototype.render=function(a){var b=this;if(null==this.panel){var c=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Data type",children:a}}),d=400,e=250,f=Ext.create("Ext.tree.Panel",{header:{baseCls:"header-form"},title:'Select your data type <span style="color:gray">(req)</span>',bodyPadding:"10 0 0 0",height:d,border:!1,width:e,store:c,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){b.data.leaf?(this.selectedDataType=b.data.tag,this.selectedDataTypeObj=b.data,this.dataTypeLabel.update('<span class="info">Type:</span><span class="ok"> OK </span>')):(this.selectedDataType=void 0,this.selectedDataTypeObj=void 0,this.dataTypeLabel.update('<span class="info">Select a data type</span><span class="err"> !!!</span>')),this.validate()}}});this.nameField=Ext.create("Ext.form.field.Text",{name:"datalabel",fieldLabel:"Data name",labelWidth:110,msgTarget:"side",enableKeyEvents:!0,listeners:{scope:this,change:function(a){""!=a.getValue()?this.dataNameLabel.update('<span class="info">Name:</span><span class="ok"> OK </span>'):this.dataNameLabel.update('<span class="info">Enter the data name</span><span class="err"> !!!</span>'),this.validate()}}}),this.textArea=Ext.create("Ext.form.field.TextArea",{name:"datadescription",fieldLabel:"Data description",labelWidth:110,msgTarget:"side"}),this.organizationField=Ext.create("Ext.form.field.Text",{name:"organization",fieldLabel:"Organization",labelWidth:110,msgTarget:"side"}),this.responsableField=Ext.create("Ext.form.field.Text",{name:"responsable",fieldLabel:"Responsible",labelWidth:110,msgTarget:"side"}),this.acquisitiondate=Ext.create("Ext.form.field.Text",{name:"acquisitiondate",fieldLabel:"Acquisition date",labelWidth:110,msgTarget:"side"});var g=350,h=Ext.create("Ext.panel.Panel",{title:"Aditional information",header:{baseCls:"header-form"},width:g,border:!1,height:d,bodyPadding:15,items:[this.nameField,this.textArea,this.organizationField,this.responsableField,this.acquisitiondate]});this.dataTypeLabel=Ext.create("Ext.Component",{html:'<span class="info">Select a data type</span>'}),this.dataNameLabel=Ext.create("Ext.Component",{html:'<span class="info">Enter the data name</span>'}),this.dataFieldLabel=Ext.create("Ext.Component",{html:'<span class="info">Select a data file</span>'}),this.originCheck=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",hidden:!this.enableTextMode,boxLabel:"Text mode",margin:"0 0 0 0",listeners:{scope:this,change:function(){this.originCheck.getValue()?(this.dataFieldLabel.update('<span class="ok">'+this.editor.getValue().length+'</span><span class="info"> chars</span>'),this.uploadField.hide(),this.editor.show(),this.uploadField.setRawValue(null)):(this.dataFieldLabel.update('<span class="info">Select a data file</span>'),this.editor.hide(),this.uploadField.show(),this.editor.setRawValue(null)),this.validate()}}});var i=Ext.create("Ext.button.Button",{id:this.uploadButtonId,text:"Upload",disabled:!0,handler:function(){b.chunkedUpload?b.uploadFile2():b.uploadFile()}});this.editor=Ext.create("Ext.form.field.TextArea",{xtype:"textarea",emptyText:"Paste or write your file directly",hidden:!0,name:"file",width:"100%",height:100,enableKeyEvents:!0,listeners:{scope:this,change:function(){this.dataFieldLabel.update('<span class="ok">'+this.editor.getValue().length+'</span> <span class="info"> chars</span>'),this.validate()}}}),this.createUploadField(),this.pan3=Ext.create("Ext.panel.Panel",{title:"Data file",header:{baseCls:"header-form"},colspan:2,border:!1,padding:5,bodyPadding:15,width:e+g,items:[this.editor,this.uploadField]}),this.panel=Ext.create("Ext.window.Window",{title:"Upload a data file",iconCls:"icon-upload",resizable:!1,constrain:!0,closable:!1,modal:!0,items:{border:0,layout:{type:"vbox",align:"stretch"},items:[this.pan3,{xtype:"container",padding:5,layout:{type:"hbox",align:"stretch"},items:[f,h]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{pack:"end"},defaults:{width:100},items:[{text:"Close",handler:function(){b.panel.minimize()}},i]},{xtype:"toolbar",dock:"bottom",items:[this.originCheck,"->",this.dataTypeLabel,this.dataFieldLabel]}]},listeners:{scope:this,minimize:function(){this.panel.hide(),this.uploadField.setRawValue(null),this.editor.setRawValue(null),this.originCheck.setValue(!1)}}})}this.panel.show()},UploadWidget.prototype.createUploadField=function(){this.uploadField=Ext.create("Ext.form.field.File",{id:this.uploadFieldId,xtype:"filefield",name:"file",msgTarget:"side",emptyText:"Choose a file",width:500,allowBlank:!1,buttonText:"Upload local file...",buttonAlign:"left",rtl:!1,listeners:{scope:this,change:function(){this.fileSelected(),this.validate()}}})},UploadWidget.prototype.validate=function(){var a=!0;"undefined"!=typeof this.selectedDataTypeObj&&"undefined"!=typeof this.selectedDataTypeObj.validate&&(a=this.selectedDataTypeObj.validate(Ext.getCmp(this.uploadFieldId).getValue())),!a||null==this.selectedDataType||""==this.uploadField.getRawValue()&&""==this.editor.getValue()?(Ext.getCmp(this.uploadButtonId).disable(),this.dataTypeLabel.update('<span class="info">Type:</span><span class="err"> Not valid </span>')):(Ext.getCmp(this.uploadButtonId).enable(),this.dataTypeLabel.update('<span class="info">Type:</span><span class="ok"> OK </span>')),this.originCheck.getValue()&&(""==this.nameField.getValue()?Ext.getCmp(this.uploadButtonId).disable():Ext.getCmp(this.uploadButtonId).enable())},UploadWidget.prototype.fileSelected=function(){var a=this.uploadField.fileInputEl.id,b=document.getElementById(a).files[0];if(b){var c=0;c=b.size>1048576?(Math.round(100*b.size/1048576)/100).toString()+"MB":(Math.round(100*b.size/1024)/100).toString()+"KB",this.dataFieldLabel.update('<span class="info">Size: </span><span class="ok">'+c+"</span>")}},UploadWidget.prototype.uploadFile=function(){Ext.getBody().mask("Uploading file..."),this.panel.disable();var a=new FormData,b=null;if(this.originCheck.getValue())b=this.nameField.getValue(),a.append("file",this.editor.getValue());else{var c=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0];b=c.name,a.append("file",c)}var d=$.cookie("bioinfo_sid"),e=this.opencgaLocation.directory+b;e=e.replace(new RegExp("/","gi"),":"),a.append("name",this.nameField.getValue()),a.append("fileFormat",this.selectedDataType),a.append("responsible",this.responsableField.getValue()),a.append("organization",this.organizationField.getValue()),a.append("date",this.acquisitiondate.getValue()),a.append("description",this.textArea.getValue()),a.append("objectid",e),a.append("sessionid",d),this.objectID=this.opencgaLocation.bucketId+":"+e,OpencgaManager.uploadObjectToBucket({accountId:$.cookie("bioinfo_account"),sessionId:d,bucketId:this.opencgaLocation.bucketId,objectId:e,formData:a,success:this.uploadObjectToBucketSuccess})},UploadWidget.prototype.uploadFile2=function(){var a=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0],b=this.opencgaLocation.directory+a.name;b=b.replace(new RegExp("/","gi"),":");var c=new Worker(WORKERS_PATH+"worker-fileupload.js");this.opencgaBrowserWidget.addUpload(a,c),c.postMessage({host:OPENCGA_HOST,accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),file:a,objectId:b,fileFormat:this.selectedDataType,bucketId:this.opencgaLocation.bucketId,resume:!0}),this.panel.hide()},UploadWidget.prototype.uploadComplete=function(a){Ext.Msg.show({title:"Upload status",msg:a}),this.panel.enable(),Ext.getBody().unmask(),this.panel.hide()},UploadWidget.prototype.uploadFailed=function(a){Ext.Msg.show({title:"Upload status",msg:"There was an error attempting to upload the file."}),this.panel.enable(),Ext.getBody().unmask()},CircosVertexRenderer.prototype={get:function(a){return this[a]},set:function(a,b,c){if(isNaN(b)||(b=parseFloat(b)),this[a]=b,this._checkListProperties())this.complex=!0,this.update();else switch(this.complex=!1,a){case"opacity":this.opacity=parseFloat(this.opacity),this.groupEl.setAttribute("opacity",this.opacity);break;case"labelSize":case"labelPositionY":case"labelPositionX":this.labelPositionX=parseFloat(this.labelPositionX),this.labelPositionY=parseFloat(this.labelPositionY),this.labelSize=parseFloat(this.labelSize),this._renderLabelEl();break;case"shape":case"color":case"strokeSize":case"size":case"strokeColor":case"area":case"strokeArea":default:this.size=parseInt(this.size),this.strokeSize=parseInt(this.strokeSize),this.area=parseInt(this.area),this.strokeArea=parseInt(this.strokeArea),c!==!1&&this.update()}},_checkListProperties:function(){var a=0,b=0;Array.isArray(this.color)&&0==a&&(a=this.color.length),Array.isArray(this.size)&&(0!=a&&1!=a||(a=this.size.length),1!=this.size.length&&this.size.length<a&&(a=this.size.length)),Array.isArray(this.area)&&(0!=a&&1!=a||(a=this.area.length),1!=this.area.length&&this.area.length<a&&(a=this.area.length)),Array.isArray(this.strokeColor)&&0==b&&(b=this.strokeColor.length),Array.isArray(this.strokeSize)&&(0!=b&&1!=b||(b=this.strokeSize.length),1!=this.strokeSize.length&&this.strokeSize.length<b&&(b=this.strokeSize.length)),Array.isArray(this.strokeArea)&&(0!=b&&1!=b||(b=this.strokeArea.length),1!=this.strokeArea.length&&this.strokeArea.length<b&&(b=this.strokeArea.length)),this.pieSlices=[];var c;if(a>0)for(var d=0;d<a;d++)c={},Array.isArray(this.color)?1==this.color.length?c.color=this.color[0]:c.color=this.color[d]:c.color=this.color,Array.isArray(this.size)?1==this.size.length?c.size=this.size[0]:c.size=this.size[d]:c.size=this.size,Array.isArray(this.area)?1==this.area.length?c.area=this.area[0]:c.area=this.area[d]:c.area=this.area,c.labelSize=this.labelSize,c.labelOffset=0,this.pieSlices.push(c);if(this.donutSlices=[],b>0)for(var d=0;d<b;d++)c={},Array.isArray(this.strokeColor)?1==this.strokeColor.length?c.color=this.strokeColor[0]:c.color=this.strokeColor[d]:c.color=this.strokeColor,Array.isArray(this.strokeSize)?1==this.strokeSize.length?c.size=this.strokeSize[0]:c.size=this.strokeSize[d]:c.size=this.strokeSize,Array.isArray(this.strokeArea)?1==this.strokeArea.length?c.size=this.strokeArea[0]:c.area=this.strokeArea[d]:c.area=this.strokeArea,c.labelSize=this.labelSize,c.labelOffset=0,this.donutSlices.push(c);return(0!=this.pieSlices.length||0!=this.donutSlices.length)&&(0==this.pieSlices.length&&this.pieSlices.push({color:this.color,size:this.size,area:this.area,labelSize:this.labelSize,labelOffset:0}),0==this.donutSlices.length&&this.donutSlices.push({color:this.strokeColor,size:this.strokeSize,area:this.strokeArea,labelSize:this.labelSize,labelOffset:0}),!0)},render:function(a){this.targetEl=a.target,this._setLabelText(this.vertex.id),this._checkListProperties()?(this.complex=!0,this._render()):this._render()},remove:function(){this.groupEl&&this.groupEl.parentNode&&this.groupEl.parentNode.removeChild(this.groupEl)},update:function(){this.remove(),this._render()},select:function(a){a&&this.selectEl.setAttribute("fill",a),this.groupEl.insertBefore(this.selectEl,this.groupEl.firstChild),this.groupEl&&this.groupEl.parentNode&&this.groupEl.parentNode.appendChild(this.groupEl),this.selected=!0},deselect:function(){this._removeSelect(),this.selected=!1},move:function(){var a=this._getMidSize();this.groupEl.setAttribute("transform","translate("+[this.coords.x-a,this.coords.y-a].join(",")+")")},setLabelContent:function(a){null==a&&(a=""),this._setLabelText(a),this.labelEl&&this.update()},getSize:function(){return this._getFigureSize()},toJSON:function(){return{shape:this.shape,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelPositionX:this.labelPositionX,labelPositionY:this.labelPositionY,labelText:this.labelText,area:this.area,strokeArea:this.strokeArea,pieSlices:this.pieSlices,donutSlices:this.donutSlices}},_setLabelText:function(a){this.labelText=a.toString(),this.labelLines=this.labelText.split(/\\n/),this.labelLinesLength=this.labelLines.length;for(var b=0,c=0;c<this.labelLinesLength;c++){var d=this.labelLines[c],e=this._textWidthBySize(d,this.labelSize);e>b&&(b=e)}this._textWidth=1.2*b,this._textHeight=this.labelLinesLength*this.labelSize*1.2},_getMidSize:function(){var a=Array.isArray(this.size)?this._slicesMax(this.pieSlices):this.size,b=Array.isArray(this.strokeSize)?this._slicesMax(this.donutSlices):this.strokeSize;if(this.size<0){var a=Math.max(this._textWidth,this._textHeight);return(a+b)/2}return(this.size+b)/2},_getFigureSize:function(){var a=Array.isArray(this.size)?this._slicesMax(this.pieSlices):this.size,b=Array.isArray(this.strokeSize)?this._slicesMax(this.donutSlices):this.strokeSize;if(this.size<0){var a=Math.max(this._textWidth,this._textHeight);return a+2*b}return this.size+2*b},_textWidthBySize:function(a,b){return a.length*b/2+a.length*b/10},_renderLabelEl:function(){var a=this._getMidSize();null==this.labelEl?this.labelEl=SVG.create("text",{"network-type":"vertex-label"}):this.groupEl.contains(this.labelEl)&&this.groupEl.removeChild(this.labelEl),this.labelEl.setAttribute("font-size",this.labelSize),this.labelEl.setAttribute("fill",this.labelColor),this.labelEl.textContent="";for(var b=this.labelLines.length,c=this.labelPositionY+a+this.labelSize/3-(b-1)*this.labelSize/2,d=0;d<b;d++){var e=this.labelLines[d],f=this._textWidthBySize(e,this.labelSize),g=SVG.addChild(this.labelEl,"tspan",{"network-type":"vertex-label",x:this.labelPositionX+a-f/2,y:c+d*this.labelSize});g.textContent=e}this.groupEl.appendChild(this.labelEl)},_drawSelectShape:function(){if(this.complex===!0)this._drawSelectCircleShape();else switch(this.shape){case"circle":this._drawSelectCircleShape();break;case"ellipse":this._drawSelectEllipseShape();break;case"square":this._drawSelectSquareShape();break;case"rectangle":this._drawSelectRectangleShape();break;case"textfit":this._drawSelectRectangleShape()}},_drawSelectCircleShape:function(){var a=this._getMidSize(),b=this._getFigureSize();this.selectEl=SVG.create("circle",{r:b/2*1.3,cx:a,cy:a,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectEllipseShape:function(){var a=this._getMidSize(),b=this._getFigureSize(),c=b,d=.65*b;this.size<0&&(c=this._textWidth+this.strokeSize,d=this._textHeight+this.strokeSize),this.selectEl=SVG.create("ellipse",{cx:a,cy:a,rx:c,ry:d,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectSquareShape:function(){var a=this._getMidSize();this._getFigureSize();this.selectEl=SVG.create("rect",{x:a-2.6*a/2,y:a-2.6*a/2,width:2.6*a,height:2.6*a,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectRectangleShape:function(){var a=this._getMidSize(),b=3*a*1.3,c=2*a*1.3;this.size<0&&(b=1.2*(this._textWidth+this.strokeSize)*1.3,c=1.2*(this._textHeight+this.strokeSize)*1.3),this.selectEl=SVG.create("rect",{x:a-b/2,y:a-c/2,width:b,height:c,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_removeSelect:function(){this.selectEl&&this.selectEl.parentNode&&this.selectEl.parentNode.removeChild(this.selectEl)},_render:function(){if(this.complex===!0)this._renderSlices(),this._drawSelectShape(),this._renderLabelEl();else{var a=this._getMidSize();this._getFigureSize();this._drawSelectShape(),this.groupEl=SVG.create("g",{id:this.vertex.id,transform:"translate("+[this.coords.x-a,this.coords.y-a].join(",")+")",cursor:"pointer",opacity:this.opacity,"network-type":"vertex-g"}),this._renderLabelEl();var b;switch(this.shape){case"circle":b=SVG.create("circle",{r:a,cx:a,cy:a,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});break;case"ellipse":var c=1.5*a,d=a;this.size<0&&(c=.7*this._textWidth,d=.7*this._textHeight),b=SVG.create("ellipse",{cx:a,cy:a,rx:c,ry:d,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});break;case"square":b=SVG.create("rect",{x:0,y:0,width:2*a,height:2*a,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});break;case"rectangle":var e=3*a,f=2*a;this.size<0&&(e=1.2*this._textWidth,f=1.2*this._textHeight),b=SVG.create("rect",{x:a-e/2,y:a-f/2,width:e,height:f,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"})}this.groupEl.insertBefore(b,this.labelEl)}this.targetEl.appendChild(this.groupEl),this.selected&&this.select()},_renderSlices:function(){maxPieSize=this._slicesMax(this.pieSlices),maxPieSize<0&&(maxPieSize=Math.max(this._textWidth,this._textHeight)),maxDonutSize=this._slicesMax(this.donutSlices);var a=maxPieSize+maxDonutSize,b=a/2;this.groupEl=SVG.create("g",{id:this.vertex.id,transform:"translate("+[this.coords.x-b,this.coords.y-b].join(",")+")",cursor:"pointer",opacity:this.opacity,"network-type":"vertex-g"});for(var c=this._sumAreas(this.pieSlices),d=359.999/c,e=0,f=0;f<this.pieSlices.length;f++){var g=this.pieSlices[f],h=g.size;g.size<0&&(h=maxPieSize);var i=g.area*d,j=e,k=j+i;e+=i;var l=SVG.describeArc(b,b,h/2+.2,j,k);SVG.addChild(this.groupEl,"path",{d:l+["L",b,b].join(" "),fill:g.color,"network-type":"vertex"});if("undefined"!=typeof g.text){var m,n,o=j+i/2,p=SVG._polarToCartesian(b,b,maxPieSize/2,o),q=SVG._polarToCartesian(b,b,b+g.labelOffset,o),r=this._textWidthBySize(g.text,g.labelSize);if(q.x>p.x?p.y>q.y?(m=q.x,n=q.y):(m=q.x,n=q.y+.7*g.labelSize):p.y>q.y?(m=q.x-r-1,n=q.y):(m=q.x-r-1,n=q.y+.7*g.labelSize),g.labelOffset>=0){SVG.addChild(this.groupEl,"line",{x1:p.x,y1:p.y,x2:q.x,y2:q.y,stroke:"#999999","stroke-width":"0.7","network-type":"vertex-label"})}var s=SVG.addChild(this.groupEl,"text",{x:m,y:n,"font-size":g.labelSize,fill:this.labelColor,"network-type":"vertex-label"});s.textContent=g.text}}for(var c=this._sumAreas(this.donutSlices),d=359.9999/c,e=0,f=0;f<this.donutSlices.length;f++){var g=this.donutSlices[f],i=g.area*d,j=e,k=j+i;e+=i;var l=SVG.describeArc(b,b,maxPieSize/2+g.size/2,j,k);SVG.addChild(this.groupEl,"path",{d:l,stroke:g.color,"stroke-width":g.size,fill:"none","network-type":"vertex"},0);if("undefined"!=typeof g.text){var m,n,o=j+i/2,p=SVG._polarToCartesian(b,b,b+g.labelOffset,o),q=SVG._polarToCartesian(b,b,b+g.labelOffset,o),r=this._textWidthBySize(g.text,g.labelSize);if(q.x>p.x?p.y>q.y?(m=q.x,n=q.y):(m=q.x,n=q.y+g.labelSize/2):p.y>q.y?(m=q.x-r-3,n=q.y):(m=q.x-r-3,n=q.y+g.labelSize/2),g.labelOffset>=0){SVG.addChild(this.groupEl,"line",{x1:p.x,y1:p.y,x2:q.x,y2:q.y,stroke:"#999999","stroke-width":"0.7","network-type":"vertex-label"})}var s=SVG.addChild(this.groupEl,"text",{x:m,y:n,"font-size":g.labelSize,fill:this.labelColor,"network-type":"vertex-label"});s.textContent=g.text}}},_sumAreas:function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];b+=parseFloat(d.area)}return b},_slicesMax:function(a){for(var b=-1,c=0;c<a.length;c++)b=Math.max(b,parseFloat(a[c].size));return b},drawLink:function(a){var b=30,c=60,d=270,e=290,f=a.coords,g=a.target,h="",i=this.radius-10,j=(SVG._polarToCartesian(f.x,f.y,i,b),SVG._polarToCartesian(f.x,f.y,i,c)),k=(SVG._polarToCartesian(f.x,f.y,i,d),SVG._polarToCartesian(f.x,f.y,i,e));h+=SVG.describeArc(f.x,f.y,i,b,c)+" ",h+=["Q",f.x,f.y,k.x,k.y," "].join(" "),h+=SVG.describeArc(f.x,f.y,i,d,e)+" ",h+=["Q",f.x,f.y,j.x,j.y," "].join(" ");SVG.addChild(g,"path",{d:h,stroke:"red","stroke-width":2,opacity:1,fill:"crimson",visibility:"visible",opacity:.7,"z-index":10,"network-type":"vertex"})},drawSectors:function(a){for(var b,c=a.coords,d=(a.color,a.target),e=4,f=360*e/(2*Math.PI*this.radius),g=this._calculateTotalSize(this.sectors),h=360/g,i=0,j=[],k=0;k<this.sectors.length;k++)b=this.sectors[k],b.angleSize=b.size*h-f,b.angleStart=i+f/2,b.angleEnd=b.angleStart+b.angleSize,i+=b.angleSize+f,j.push(SVG.describeArc(c.x,c.y,this.radius,b.angleStart,b.angleEnd)+" ");for(var k=0;k<j.length;k++){SVG.addChild(d,"path",{d:j[k],stroke:this.sectors[k].color,"stroke-width":10,fill:"none","network-type":"vertex"})}}},DefaultEdgeRenderer.prototype={get:function(a){return this[a]},set:function(a,b){switch(isNaN(b)||(b=parseFloat(b)),this[a]=b,a){case"color":this.edgeEl.setAttribute("stroke",this.color),this.updateShape();break;case"size":this.size=parseInt(this.size),this.edgeEl.setAttribute("stroke-width",this._getStrokeWidth()),this.updateShape();break;case"bidirectional":case"shape":this.updateShape();break;case"shaft":this.updateShaft();break;case"labelSize":this.labelSize=parseInt(this.labelSize),this.setLabelContent(this.labelText);break;case"opacity":this.edgeEl.setAttribute("opacity",this.opacity);break;default:this.update()}},_getStrokeWidth:function(){return 1+this.size/2},render:function(a){this.targetEl=a.target,this.sourceCoords=this.edge.source.position,this.targetCoords=this.edge.target.position,this.sourceRenderer=this.edge.source.renderer,this.targetRenderer=this.edge.target.renderer,this._render()},remove:function(){this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)},update:function(){this.edgeEl.setAttribute("stroke",this.color),this.edgeEl.setAttribute("stroke-width",this._getStrokeWidth()),this.labelSize<=0?(this.labelEl.setAttribute("font-size",1),this.labelEl.setAttribute("fill","transparent")):(this.labelEl.setAttribute("font-size",this.labelSize),this.labelEl.setAttribute("fill",this.labelColor)),this.updateShaft(),this.updateShape()},updateShape:function(){!this.edgeEl,"undirected"===this.shape?(this.edgeEl.removeAttribute("marker-end"),this.edgeEl.removeAttribute("marker-start")):"true"==this.bidirectional?(this.edgeEl.setAttribute("marker-end","url("+this._getMarkerArrowId("end")+")"),this.edgeEl.setAttribute("marker-start","url("+this._getMarkerArrowId("start")+")")):(this.edgeEl.setAttribute("marker-end","url("+this._getMarkerArrowId("end")+")"),
this.edgeEl.removeAttribute("marker-start")),this.move()},updateShaft:function(){!this.edgeEl,this.selected&&this._renderSelect(),this.selected||this._removeSelect()},select:function(){this.selected||this._renderSelect()},deselect:function(){this.selected&&this._removeSelect()},setLabelContent:function(a){null==a&&(a=""),this._setLabelText(a),this._renderLabelEl()},move:function(){var a=this._calculateEdgePath();this.edgeEl.setAttribute("d",a.d),this._renderLabelEl(a)},_calculateEdgePath:function(){var a,b,c;if(this.edge.source===this.edge.target){var d=.6*this.sourceRenderer.getSize(),e=1.8*this.sourceRenderer.getSize();b=this.sourceCoords.x-this.sourceRenderer.getSize(),c=this.sourceCoords.y-this.sourceRenderer.getSize();var f=this.sourceRenderer.getSize()/2;a=["M",this.sourceCoords.x-f,this.sourceCoords.y,"L",this.sourceCoords.x-d,this.sourceCoords.y,"C",this.sourceCoords.x-e,this.sourceCoords.y,this.sourceCoords.x,this.sourceCoords.y-e,this.sourceCoords.x,this.sourceCoords.y-d,"L",this.targetCoords.x,this.targetCoords.y-f].join(" ")}else{var g=this.targetCoords.x-this.sourceCoords.x,h=this.targetCoords.y-this.sourceCoords.y,i=Math.atan(h/g);isNaN(i)&&(i=0);var j=(this.sourceCoords.x+this.targetCoords.x)/2,k=(this.sourceCoords.y+this.targetCoords.y)/2,l="";if(0===this.edge.overlapCount)b=j-Math.sin(i),c=k+Math.cos(i);else{var m=15,n=this.edge.overlapCount%2,o=1,p=1;0===n&&(o=0,p=-1);var q=(this.edge.overlapCount+o)/2*m*p,r=q/1.33,s=j-Math.sin(i)*q,t=k+Math.cos(i)*q;b=j-Math.sin(i)*r,c=k+Math.cos(i)*r,l=["C",s,t,s,t].join(" ")}var u=this._getPerimeterPositions(i);a=["M",u.sx,u.sy,l,u.tx,u.ty].join(" ")}return{d:a,xl:b,yl:c}},_getPerimeterPositions:function(a){var b,c,d,e,f,g,h,i=this.targetCoords.x>=this.sourceCoords.x?1:-1,j=this.sourceRenderer.getSize()/2,k=this.targetRenderer.getSize()/2,l=this.sourceRenderer._textWidth+this.sourceRenderer.strokeSize,m=this.sourceRenderer._textHeight+this.sourceRenderer.strokeSize,n=this.targetRenderer._textWidth+this.targetRenderer.strokeSize,o=this.targetRenderer._textHeight+this.targetRenderer.strokeSize,p=Math.cos(a),q=Math.sin(a),r=Math.abs(p),s=Math.abs(q);if(1==this.sourceRenderer.complex)b=this.sourceCoords.x+i*p*j,c=this.sourceCoords.y+i*q*j;else switch(this.sourceRenderer.shape){case"square":f=j/r,g=j/s,h=f<=g?f:g,b=this.sourceCoords.x+i*p*h,c=this.sourceCoords.y+i*q*h;break;case"rectangle":this.sourceRenderer.size<0?(f=.6*l/r,g=.6*m/s):(f=1.5*j/r,g=j/s),h=f<=g?f:g,b=this.sourceCoords.x+i*p*h,c=this.sourceCoords.y+i*q*h;break;case"ellipse":this.sourceRenderer.size<0?(b=this.sourceCoords.x+i*p*l*.7,c=this.sourceCoords.y+i*q*m*.7):(b=this.sourceCoords.x+i*p*j*1.5,c=this.sourceCoords.y+i*q*j);break;case"circle":default:b=this.sourceCoords.x+i*p*j,c=this.sourceCoords.y+i*q*j}if(1==this.targetRenderer.complex)d=this.targetCoords.x-i*p*k,e=this.targetCoords.y-i*q*k;else switch(this.targetRenderer.shape){case"square":f=k/r,g=k/s,h=f<=g?f:g,d=this.targetCoords.x-i*p*h,e=this.targetCoords.y-i*q*h;break;case"rectangle":this.targetRenderer.size<0?(f=.6*n/r,g=.6*o/s):(f=1.5*k/r,g=k/s),h=f<=g?f:g,d=this.targetCoords.x-i*p*h,e=this.targetCoords.y-i*q*h;break;case"ellipse":this.targetRenderer.size<0?(d=this.targetCoords.x-i*p*n*.7,e=this.targetCoords.y-i*q*o*.7):(d=this.targetCoords.x-i*p*k*1.5,e=this.targetCoords.y-i*q*k);break;case"circle":default:d=this.targetCoords.x-i*p*k,e=this.targetCoords.y-i*q*k}return{sx:b,sy:c,tx:d,ty:e}},_render:function(){this.el=SVG.create("g",{cursor:"pointer",id:this.edge.id,opacity:this.opacity,"network-type":"edge-g"});var a=this._calculateEdgePath();this.edgeEl=SVG.addChild(this.el,"path",{d:a.d,opacity:this.opacity,stroke:this.color,"stroke-width":this._getStrokeWidth(),cursor:"pointer",fill:"none","network-type":"edge"},1),"undirected"===this.shape?(this.edgeEl.removeAttribute("marker-end"),this.edgeEl.removeAttribute("marker-start")):"true"==this.bidirectional?(this.edgeEl.setAttribute("marker-end","url("+this._getMarkerArrowId("end")+")"),this.edgeEl.setAttribute("marker-start","url("+this._getMarkerArrowId("start")+")")):(this.edgeEl.setAttribute("marker-end","url("+this._getMarkerArrowId("end")+")"),this.edgeEl.removeAttribute("marker-start")),this._setLabelText(this.edge.id),this._renderLabelEl(a),SVG._insert(this.targetEl,this.el,1),this.selected&&this._renderSelect(),this.selected||this._removeSelect()},_setLabelText:function(a){this.labelText=a,this.labelLines=this.labelText.split(/\\n/)},_renderLabelEl:function(a){null==a&&(a=this._calculateEdgePath()),null==this.labelEl?this.labelEl=SVG.create("text",{"network-type":"edge-label"}):this.el.contains(this.labelEl)&&this.el.removeChild(this.labelEl),this.labelEl.setAttribute("font-size",this.labelSize),this.labelSize<=0?(this.labelEl.setAttribute("font-size",1),this.labelEl.setAttribute("fill","transparent")):(this.labelEl.setAttribute("font-size",this.labelSize),this.labelEl.setAttribute("fill",this.labelColor)),this.labelEl.textContent="";for(var b=this.labelLines.length,c=a.yl-(b-1)*this.labelSize/2,d=0;d<b;d++){var e=this.labelLines[d],f=SVG.addChild(this.labelEl,"tspan",{"network-type":"edge-label",x:a.xl,y:c+d*this.labelSize});f.textContent=e}this.el.appendChild(this.labelEl)},_renderSelect:function(){this.edgeEl.setAttribute("stroke-dasharray","10, 5"),this.selected=!0},_removeSelect:function(){"dashed"!==this.shaft?this.edgeEl.removeAttribute("stroke-dasharray"):this.edgeEl.setAttribute("stroke-dasharray","3, 2"),this.selected=!1},_getMarkerArrowId:function(a){var b=this.size*-2-1,c="arrow-"+this.shape+"-"+b.toString().replace(".","_")+"-"+this.size.toString().replace(".","_")+"-"+this.color.replace("#","")+a,d="#"+c;return this.targetEl.querySelector(d)||this._addArrowShape(this.shape,b,this.color,this.size,this.targetEl,c,a),d},_addArrowShape:function(a,b,c,d,e,f,g){var h=e.querySelector("defs");h||(h=SVG.addChild(e,"defs",{},0)),"undefined"==typeof c&&(c="#000000");var i=1;"start"==g&&(i=-1);var j=this._getStrokeWidth(),k=j/2,l=8+d,m=3+d,n=SVG.addChild(h,"marker",{id:f,orient:"auto",refX:l*i,refY:m,markerUnits:"userSpaceOnUse",style:"overflow:visible;"});switch(a){case"directed":var o=["M0,0","L",1*i,m,"L",0,2*m,"L",l*i,m+k,"L",l*i,m-k,"Z"].join(" ");SVG.addChild(n,"path",{fill:c,d:o});break;case"inhibited":var p=l/2,q=m+k,r=l,s=3*m+k;SVG.addChild(n,"path",{fill:c,d:["M",i*p,-q,"L",i*p,s,"L",i*r,s,"L",i*r,-q,"Z"].join(" ")});break;case"dot":SVG.addChild(n,"circle",{fill:c,cx:i*l/2,cy:m,r:l/2});break;case"odot":SVG.addChild(n,"circle",{fill:c,cx:i*l/2,cy:m,r:l/2}),SVG.addChild(n,"circle",{fill:"white",cx:i*l/2,cy:m,r:l/2-j})}},toJSON:function(){return{shape:this.shape,shaft:this.shaft,bidirectional:this.bidirectional,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelText:this.labelText}}},DefaultVertexRenderer.prototype={get:function(a){return this[a]},set:function(a,b){switch(this[a]=b,a){case"color":this.vertexEl.setAttribute("fill",this.color);break;case"strokeColor":this.vertexEl.setAttribute("stroke",this.strokeColor);break;case"opacity":this.groupEl.setAttribute("opacity",this.opacity);break;case"labelSize":this.labelEl.setAttribute("font-size",this.labelSize),this._calculateLabelX();break;case"size":case"strokeSize":switch(this.shape){case"circle":this._updateCircleSize();break;case"ellipse":this._updateEllipseSize();break;case"square":this._updateSquareSize();break;case"rectangle":this._updateRectangleSize()}break;default:console.log("update"),this.update()}},setConfig:function(a){_.extend(this,a)},render:function(a){this.targetEl=a.target,this.vertex=a.vertex,this.coords=a.coords,this._render()},remove:function(){$(this.el).remove()},update:function(){this.remove(),this._render()},select:function(){this.selected||this._renderSelect()},deselect:function(){this.selected&&this._removeSelect()},move:function(a,b){var c=parseFloat(this.el.getAttribute("x")),d=parseFloat(this.el.getAttribute("y"));this.el.setAttribute("x",c+a),this.el.setAttribute("y",d+b)},setLabelContent:function(a){"undefined"!=typeof this.labelEl&&("string"===$.type(a)&&a.length>0&&(this.labelText=a,this.labelEl.textContent=a),this._calculateLabelX())},getSize:function(){return this.size+this.strokeSize},_render:function(){switch(this.shape){case"circle":this._drawCircleShape();break;case"ellipse":this._drawEllipseShape();break;case"square":this._drawSquareShape();break;case"rectangle":this._drawRectangleShape()}this.selected&&this._renderSelect()},_renderSelect:function(){switch(this.shape){case"circle":this._drawSelectCircleShape();break;case"ellipse":this._drawSelectEllipseShape();break;case"square":this._drawSelectSquareShape();break;case"rectangle":this._drawSelectRectangleShape()}this.selected=!0},_removeSelect:function(){$(this.el).find('[network-type="select-vertex"]').remove(),this.selected=!1},_calculateOffset:function(){var a=this.size+this.strokeSize,a=a+.3*a,b=a/2;return{size:a,midOffset:b}},_calculateLabelX:function(a){"undefined"==typeof a&&(a=this._calculateOffset());var b=a.midOffset-this.labelEl.textContent.length*this.labelSize/4;b=b<0?0:b;var c=a.midOffset+this.labelSize/3;this.labelEl.setAttribute("x",b),this.labelEl.setAttribute("y",c)},_drawCircleShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"circle",{cx:a.midOffset,cy:a.midOffset,r:this.size/2,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:a.midOffset,y:a.midOffset,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateCircleSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("r",this.size/2),this.vertexEl.setAttribute("cx",a.midOffset),this.vertexEl.setAttribute("cy",a.midOffset),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawEllipseShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"ellipse",{cx:a.midOffset,cy:a.midOffset,rx:this.size/1.7,ry:this.size/2.5,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateEllipseSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("cx",a.midOffset),this.vertexEl.setAttribute("cy",a.midOffset),this.vertexEl.setAttribute("rx",this.size/1.7),this.vertexEl.setAttribute("ry",this.size/2.5),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawSquareShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"rect",{x:a.midOffset-this.size/2,y:a.midOffset-this.size/2,width:this.size,height:this.size,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateSquareSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("x",a.midOffset-this.size/2),this.vertexEl.setAttribute("y",a.midOffset-this.size/2),this.vertexEl.setAttribute("width",this.size),this.vertexEl.setAttribute("height",this.size),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawRectangleShape:function(){var a=this._calculateOffset(),b=.3*this.size,c=b/2,d=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),e=SVG.addChild(d,"g",{opacity:this.opacity}),f=SVG.addChild(e,"rect",{x:a.midOffset-this.size/2-c,y:a.midOffset-this.size/2+c,width:this.size+b,height:this.size-b,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(d,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var g=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(g=this.labelText),this.labelEl.textContent=g,this._calculateLabelX(a),this.el=d,this.groupEl=e,this.vertexEl=f,this.targetEl.appendChild(d)},_updateRectangleSize:function(){var a=this._calculateOffset(),b=.3*this.size,c=b/2;this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("x",a.midOffset-this.size/2-c),this.vertexEl.setAttribute("y",a.midOffset-this.size/2+c),this.vertexEl.setAttribute("width",this.size+b),this.vertexEl.setAttribute("height",this.size-b),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawSelectCircleShape:function(){var a=this._calculateOffset();this.selectEl=SVG.addChild(this.el,"circle",{r:a.midOffset,cx:a.midOffset,cy:a.midOffset,opacity:"0.5",fill:"#777777","network-type":"select-vertex"},0)},_updateSelectShapeSize:function(a){this.selectEl.setAttribute("r",a.midOffset),this.selectEl.setAttribute("cx",a.midOffset),this.selectEl.setAttribute("cy",a.midOffset)},_drawSelectEllipseShape:function(){this._drawSelectCircleShape()},_drawSelectSquareShape:function(){this._drawSelectCircleShape()},_drawSelectRectangleShape:function(){this._drawSelectCircleShape()},toJSON:function(){return{shape:this.shape,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelText:this.labelText}}},Edge.prototype={getSource:function(){return this.source},setSource:function(a){this.source=a},getTarget:function(){return this.target},setTarget:function(a){this.target=a},render:function(a){this.renderer.render(a)},setRenderer:function(a){a&&(this.renderer=a,this.renderer.edge=this)},toJSON:function(){return{id:this.id,source:this.source,target:this.target,weight:this.weight,directed:this.directed,relation:this.relation,renderer:this.renderer,attributes:this.attributes}}},GraphLayout={_init:function(){for(var a in this.verticesList){var b=this.verticesList[a];"undefined"==typeof b.x&&(b.x=0),"undefined"==typeof b.y&&(defda,b.y=0),"undefined"==typeof b.z&&(b.z=0),this.vertices[b.id]=b}},getRandomArbitrary:function(a,b){return Math.random()*(b-a)+a},applyRandom3d:function(){for(var a in this.vertices){var b=this.vertices[a];b.x=this.getRandomArbitrary(-300,300),b.y=this.getRandomArbitrary(-300,300),b.z=this.getRandomArbitrary(10,600)}},sphereSurface:function(a,b,c,d){for(var e=a.length,f=0;f<a.length;f++){var g=a[f],h=b.config.getVertexConfig(g),i=h.coords,j=Math.acos(-1+2*f/e),k=Math.sqrt(e*Math.PI)*j;i.x=c*Math.cos(k)*Math.sin(j),i.y=c*Math.sin(k)*Math.sin(j),i.z=c*Math.cos(j)+d}},random2d:function(a,b,c){for(var d,e,f=a.graph.vertices,g=0,h=f.length;g<h;g++){var i=f[g];d=this.getRandomArbitrary(0,b),e=this.getRandomArbitrary(0,c),i.position.x=d,i.position.y=e,i.renderer.move(),a._updateEdgeCoords(i)}},circle:function(a,b,c,d){var e=a.graph.vertices;"undefined"!=typeof d&&(e=d);for(var f,g,h,i=(c-100)/2,j=b/2,k=c/2,l=0,m=e.length;l<m;l++){var h=a.graph.getVertexById(e[l].id);f=j+i*Math.sin(2*l*Math.PI/e.length),g=k+i*Math.cos(2*l*Math.PI/e.length),h.position.x=f,h.position.y=g,h.renderer.move(),a._updateEdgeCoords(h)}},force:function(a){var b=a.network,c=a.network.graph,d=a.network.vAttr,e=a.network.eAttr,f=a.width,g=a.height,h=a.friction,i=a.gravity,j=a.chargeDistance,k=a.linkStrength,l=a.linkDistance,m=a.charge,n=a.attributes,o=a.end,p=a.simulation;"undefined"==typeof a.config?{vertices:{},edges:{}}:a.config;if("undefined"==typeof b)return void console.log("graph not defined");var q=[],r=[],s=[],t=d3.layout.force();t.size([f,g]),"undefined"!=typeof h&&t.friction(h),"undefined"!=typeof i&&t.gravity(i),"undefined"!=typeof j&&t.chargeDistance(j);var u=b.graph.vertices,v=b.graph.edges;console.time("Force directed preload");for(var w=0,x=u.length;w<x;w++){var y=u[w],z={id:y.id,index:w,x:y.position.x,y:y.position.y};q.push(z),r[y.id]=z}t.nodes(q);for(var w=0,x=v.length;w<x;w++){var A=v[w];"undefined"!=typeof A&&s.push({id:A.id,source:r[A.source.id],target:r[A.target.id]})}if(t.links(s),"undefined"!=typeof l?n&&"none"!=n.linkDistance?t.linkDistance(function(a){var b=c.getEdgeById(a.id),e=d.getRow(b.id)[n.linkDistance],f=isNaN(e)?1.7*(b.source.renderer.getSize()+b.target.renderer.getSize()):e*l;return f}):t.linkDistance(l):t.linkDistance(function(a){var b=c.getEdgeById(a.id);return b.source.renderer.getSize()+1.7*b.target.renderer.getSize()}),"undefined"!=typeof k&&(n&&"none"!=n.linkStrength?t.linkStrength(function(a){var b=d.getRow(a.id)[n.linkStrength],c=isNaN(b)?1:b*k;return c}):t.linkStrength(k)),"undefined"!=typeof m?n&&"none"!=n.charge?t.charge(function(a){var b=c.getVertexById(a.id),d=e.getRow(b.id)[n.charge],f=isNaN(d)?b.renderer.getSize()*-13:d*m;return f}):t.charge(m):t.charge(function(a){var b=c.getVertexById(a.id);return b.renderer.getSize()*-13}),console.timeEnd("Force directed preload"),t.on("end",function(a){console.log(a),o(q)}),p===!0)t.on("tick",function(a){o(q),console.log(t.alpha()),t.alpha()<.025&&t.stop()}),t.start();else{console.time("D3 Force directed layout"),t.start();for(var B=0;t.alpha()>.025&&(t.tick(),!(B++>1e3)););t.stop(),console.timeEnd("D3 Force directed layout")}},tree:function(a){var b=a.network,c=b.graph,d=(b.vAttr,b.eAttr,a.width),e=a.height,f=(c.vertices,c.edges,{name:a.root.id,vertex:a.root,children:null}),g={};this._getTreeNode(f,g);var h=d3.layout.tree().sort(null).size([d,e]),i=h.nodes(f);a.end(i)},_getTreeNode:function(a,b){b[a.vertex.id]=!0;for(var c=0;c<a.vertex.edges.length;c++){var d=a.vertex.edges[c];if(d.target!==a.vertex&&1!=b[d.target.id]){var e=d.target;null==a.children&&(a.children=[]);for(var f=0,g=0;g<e.edges.length;g++){var h=e.edges[g];h.target===e&&1!=b[h.source.id]&&f++}0==f&&a.children.push({name:e.id,size:e.renderer.size,vertex:e,children:null})}}if(null!=a.children)for(var c=0;c<a.children.length;c++){var i=a.children[c];this._getTreeNode(i,b)}},forceTree:function(a){var b=a.network,c=(b.graph,b.vAttr,b.eAttr,a.width);d3;var d=d3.layout.force();d.size([c,height]),d.charge(-320),d.linkDistance(50);for(var e=[],f=[],g=[],h=0,i=vertices.length;h<i;h++){var j=vertices[h],k={id:j.id,index:h,x:j.position.x,y:j.position.y};g.push(k),e[j.id]=k}d.nodes(g);for(var h=0,i=edges.length;h<i;h++){var l=edges[h];"undefined"!=typeof l&&f.push({id:l.id,source:e[l.source.id],target:e[l.target.id]})}d.links(f),d.on("end",function(a){console.log(a),endFunction(g)}),console.time("D3 Force directed layout"),d.start();for(var m=0;d.alpha()>.025;){d.tick();var n=8*d.alpha();if(f.forEach(function(a,b){a.source.y-=n,a.target.y+=n}),m++>1e3)break}d.stop(),console.timeEnd("D3 Force directed layout")},tree2:function(a){var b=a.network,c=b.graph,d=(b.vAttr,b.eAttr,a.width),e=a.height,f=(c.vertices,c.edges,a.end),g=d3.layout.force().charge(function(a){return a._children?-a.size/100:a.children?-100:-30}).linkDistance(function(a){return a.target._children?50:30}).size([d,e]),h={name:a.root.id,vertex:a.root,fixed:!0,size:a.root.renderer.size,px:0,py:0,children:null},i={};this._getTreeNode(h,i);var j=this._flatten(h,d,e),k=d3.layout.tree().links(j);h.px||(h.px=h.x=d/2,h.py=h.y=(h.children?4.5:Math.sqrt(h.size)/10)+2),g.nodes(j).links(k),g.on("end",function(a){console.log(a),f(j)}),console.time("D3 Force directed layout"),g.start();for(var l=0;g.alpha()>.025&&(g.tick(),g.nodes().forEach(function(a){if(!a.fixed){var b,c,f=(a.children?4.5:Math.sqrt(a.size)/10)+4,g=30;if(a.children||a._children){var h=0;a.parent&&(h=a.parent.y),a.py=a.y=h+a.depth*g+f}b=Math.min(0,d-f-a.x)+Math.max(0,f-a.x),c=Math.min(0,e-f-a.y)+Math.max(0,f-a.y),a.x+=2*Math.max(-g,Math.min(g,b)),a.y+=2*Math.max(-g,Math.min(g,c)),b=Math.min(0,d-f-a.px)+Math.max(0,f-a.px),c=Math.min(0,e-f-a.py)+Math.max(0,f-a.py),a.px+=2*Math.max(-g,Math.min(g,b)),a.py+=2*Math.max(-g,Math.min(g,c)),a.parent&&(a.y=Math.max(a.y,a.parent.y+g),a.py=Math.max(a.py,a.parent.py+g))}}),!(l++>1e3)););g.stop(),console.timeEnd("D3 Force directed layout")},_flatten:function(a,b,c){function d(a,b,c,e){if(a.children){var f=j[c+1]||0;j[c+1]=f+a.children.length,k=Math.max(k,c+1),a.size=a.children.reduce(function(b,e,g){return b+d(e,a,c+1,f+g)},0)}return a.id||(a.id=++i),a.parent=b,a.depth=c,a.px||(a.y=c,a.x=e),h.push(a),a.size}var e,f,g,h=[],i=0,j=[1],k=1;for(a.size=d(a,null,0),e=1,i=j.length;--i>0;)e=Math.max(e,j[i]);for(f=(b-20)/e,g=(c-20)/k,i=h.length;--i>=0;){var l=h[i];l.px||(l.y*=g,l.y+=10+g/2,l.x*=f,l.x+=10+f/2)}return h},grid:function(a){this._doCytoscapeLayout(a,"grid")},breadthfirst:function(a){this._doCytoscapeLayout(a,"breadthfirst")},_doCytoscapeLayout:function(a,b,c){null==c&&(c={});var d=a.network,e=(a.network.graph,a.width),f=a.height,g=d.graph.vertices,h=d.graph.edges,i=a.end,j=cytoscape({}),k=this._createCytoscapeEles(g,h);k=j.add(k),c.name=b,c.boundingBox={x1:0,y1:0,w:e,h:f},k.layout(c),i(k)},_createCytoscapeEles:function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d];c.push({group:"nodes",data:{id:f.id}})}for(var d=0,e=b.length;d<e;d++){var g=b[d];c.push({group:"edges",data:{id:g.id,source:g.source.id,target:g.target.id}})}return c},concentric:function(a){for(var b=a.network,c=(a.network.graph,a.width),d=a.height,e=b.graph.vertices,f=b.graph.edges,g=a.end,h=a.concentricAttribute,i=cytoscape({}),j=[],k=0,l=e.length;k<l;k++){var m=e[k],n=0;null==h||"none"==h||isNaN(parseFloat(m.attributes[h]))||(n=parseFloat(m.attributes[h]));var o={group:"nodes",data:{id:m.id,concentric:n}};j.push(o)}for(var k=0,l=f.length;k<l;k++){var p=f[k],q={group:"edges",data:{id:p.id,source:p.source.id,target:p.target.id}};j.push(q)}j=i.add(j);var r={name:"concentric",boundingBox:{x1:0,y1:0,w:c,h:d},minNodeSpacing:30};null!=a.concentricAttribute&&"none"!=a.concentricAttribute&&(r.concentric=function(a){return a.data("concentric")}),null!=a.startAngle&&(r.startAngle=parseFloat(a.startAngle)),null!=a.sweep&&(r.sweep=parseFloat(a.sweep)),null!=a.minNodeSpacing&&(r.minNodeSpacing=parseFloat(a.minNodeSpacing)),null!=a.clockwise&&(r.clockwise=a.clockwise),null!=a.equidistant&&(r.equidistant=a.equidistant),null!=a.avoidOverlap&&(r.avoidOverlap=a.avoidOverlap),console.log(r),j.layout(r),g(j)},cose:function(a){for(var b=a.network,c=(a.network.graph,a.width),d=a.height,e=b.graph.vertices,f=b.graph.edges,g=a.end,h=a.nodeRepulsionAttribute,i=a.idealEdgeLengthAttribute,j=a.edgeElasticityAttribute,k=cytoscape({}),l=[],m=0,n=e.length;m<n;m++){var o=e[m],p=4e5;isNaN(parseFloat(a.nodeRepulsion))||(p=parseFloat(a.nodeRepulsion)),null==h||"none"==h||isNaN(parseFloat(o.attributes[h]))||(p=parseFloat(o.attributes[h]));var q={group:"nodes",data:{id:o.id,nodeRepulsion:p}};l.push(q)}for(var m=0,n=f.length;m<n;m++){var r=f[m],s=10,t=100;isNaN(parseFloat(a.idealEdgeLength))||(s=parseFloat(a.idealEdgeLength)),null==i||"none"==i||isNaN(parseFloat(r.attributes[i]))||(s=parseFloat(r.attributes[i])),isNaN(parseFloat(a.edgeElasticity))||(t=parseFloat(a.edgeElasticity)),null==j||"none"==j||isNaN(parseFloat(r.attributes[j]))||(t=parseFloat(r.attributes[j]));var u={group:"edges",data:{id:r.id,source:r.source.id,target:r.target.id,idealEdgeLength:s,edgeElasticity:t}};l.push(u)}l=k.add(l);var v={name:"cose",boundingBox:{x1:0,y1:0,w:c,h:d},refresh:1,fit:!0,animate:!1,nodeRepulsion:function(a){return parseFloat(a.data("nodeRepulsion"))},idealEdgeLength:function(a){return parseFloat(a.data("idealEdgeLength"))},edgeElasticity:function(a){return parseFloat(a.data("edgeElasticity"))},ready:function(){g(l)}};null!=a.componentSpacing&&(v.componentSpacing=parseFloat(a.componentSpacing)),null!=a.nodeOverlap&&(v.nodeOverlap=parseFloat(a.nodeOverlap)),null!=a.nestingFactor&&(v.nestingFactor=parseFloat(a.nestingFactor)),null!=a.gravity&&(v.gravity=parseFloat(a.gravity)),console.log(v),l.layout(v)}},Point=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},Point.prototype={set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},toJSON:function(){return{x:this.x,y:this.y,z:this.z}}},Vertex.prototype={removeEdge:function(a){for(var b=0;b<this.edges.length;b++)if(this.edges[b].id===a.id){this.edges.splice(b,1),delete this.edgesIndex[a.id];break}},removeEdges:function(){this.edges=[],this.edgesIndex={}},addEdge:function(a){this.containsEdge(a)===!1&&(this.edges.push(a),this.edgesIndex[a.id]=a)},containsEdge:function(a){return"undefined"!=typeof this.edgesIndex[a.id]},render:function(a){this.renderer.render(a)},setRenderer:function(a){a&&(this.renderer=a,this.renderer.coords=this.position,this.renderer.vertex=this)},toJSON:function(){return{id:this.id,position:this.position,renderer:this.renderer,attributes:this.attributes}}},DataSource.prototype.fetch=function(){},FileDataSource.prototype.fetch=DataSource.prototype.fetch,FileDataSource.prototype.error=function(){alert("File is too big. Max file size is "+this.maxSize+" bytes")},FileDataSource.prototype.fetch=function(a){var b=this;if(this.file.size<=this.maxSize){if(a){var c=new FileReader;return c.onload=function(a){b.trigger("success",a.target.result)},this.readAs(this.type,c)}var c=new FileReaderSync;return this.readAs(this.type,c)}b.error(),b.trigger("error",{sender:this})},FileDataSource.prototype.readAs=function(a,b){switch(a){case"binary":return b.readAsBinaryString(this.file);case"text":default:return b.readAsText(this.file,"UTF-8")}},StringDataSource.prototype.fetch=DataSource.prototype.fetch,StringDataSource.prototype.fetch=function(a){return a?void this.trigger("success",this.str):this.str},TabularDataAdapter.prototype.getLines=function(){return this.fileLines},TabularDataAdapter.prototype.parse=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++){var d=b[c].replace(/^\s+|\s+$/g,"");if(d=d.replace(/\//gi,""),null!=d&&d.length>0&&"#"!=d.charAt(0)){var e=d.split("\t");this.fileLines.push(e)}}},TabularDataAdapter.prototype.getLinesCount=function(){return this.fileLines.length},TabularDataAdapter.prototype.getValuesByColumnIndex=function(a){for(var b=new Array,c=0;c<this.getLinesCount();c++)null!=this.getLines()[c][a]&&b.push(this.getLines()[c][a]);return b},TabularDataAdapter.prototype.getHeuristicTypeByColumnIndex=function(a){return this.getHeuristicTypeByValues(this.getValuesByColumnIndex(a))},TabularDataAdapter.prototype.getHeuristicTypeByValues=function(a){for(var b=/^[-+]?[0-9]*\.?[0-9]+$/,c=0;c<a.length;c++)if(!b.test(new String(a[c]).replace(",",".")))return"string";return"numeric"},UrlDataSource.prototype.fetch=DataSource.prototype.fetch,UrlDataSource.prototype.fetch=function(a){var b=this,c=null;if(this.url)return $.ajax({type:"GET",url:this.url,async:a,success:function(d,e,f){a?b.success.notify(d):c=d},error:function(a,c,d){console.log("URL Data source: Ajax call returned : "+d+"\t"+c+"\t"+a.statusText+" END"),b.error.notify()}}),c},FeatureDataAdapter.prototype.getData=function(a){console.log("TODO comprobar histograma"),console.log(a.region),this.params.dataType="data",this.params.chromosome=a.region.chromosome,1!=this.chromosomesLoaded[a.region.chromosome]&&(this._fetchData(a.region),this.chromosomesLoaded[a.region.chromosome]=!0);var b=this.featureCache.getFeatureChunksByRegion(a.region);null!=b&&this.trigger("data:ready",{items:b,params:this.params,chunkSize:this.featureCache.chunkSize,cached:!0,sender:this}),a.done()},FeatureDataAdapter.prototype._fetchData=function(a){var b=this;if(null!=this.dataSource)if(this.async)this.dataSource.on("success",function(c){b.parse(c,a),b.trigger("file:load",{sender:b});var d=b.featureCache.getFeatureChunksByRegion(a);null!=d&&b.trigger("data:ready",{items:d,params:b.params,chunkSize:b.featureCache.chunkSize,cached:!0,sender:b})}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c,a)}},FeatureDataAdapter.prototype.addFeatures=function(a){this.featureCache.putFeatures(a,"data")},BamAdapter.prototype={host:null,gzip:!0,params:{}},BamAdapter.prototype.clearData=function(){this.featureCache.clear()},BamAdapter.prototype.setFilters=function(a){this.clearData(),this.filters=a;for(filter in a){var b=a[filter].toString();delete this.params[filter],""!=b&&(this.params[filter]=b)}},BamAdapter.prototype.setOption=function(a,b){a.fetch&&this.clearData(),this.options[a.name]=b;for(option in this.options)null!=this.options[a.name]?this.params[a.name]=this.options[a.name]:delete this.params[a.name]},BamAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram,this.params.histogramLogarithm=a.histogramLogarithm,this.params.histogramMax=a.histogramMax,this.params.interval=a.interval,this.params.transcript=a.transcript,this.params.chromosome=a.chromosome,this.params.resource=this.resource.id,this.params.category=this.category,this.params.species=Utils.getSpeciesCode(this.species.text),a.start<1&&(a.start=1),a.end>3e8&&(a.end=3e8);var c="data";a.histogram&&(c="histogram"+a.interval),this.params.dataType=c;for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[],h=d;h<=e;h++){var i=a.chromosome+":"+h;if(null==this.featureCache.cache[i]||null==this.featureCache.cache[i][c])f.push(h);else{var j=this.featureCache.getFeatureChunk(i);g.push(j)}}var k=function(a){var c=a.query.split(":"),d=c[1].split("-"),e={chromosome:c[0],start:d[0],end:d[1]},f="data";a.params.histogram?(f="histogram"+a.params.interval,b.featureCache.putHistogramFeaturesByRegion(a.result,e,a.resource,f)):b.featureCache.putFeaturesByRegion(a.result,e,a.resource,f);var h=b.featureCache.getFeatureChunksByRegion(e,f);g=g.concat(h),g.length>0&&b.trigger("data:ready",{items:g,params:b.params,cached:!1,sender:b})},l=[],m=!0,n=!0;if(f.length>0){for(var h=0;h<f.length;h++){if(m){var o=parseInt(f[h]*this.featureCache.chunkSize);m=!1}if(n){var p=parseInt(f[h]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);n=!1}if(null!=f[h+1])if(f[h]+1==f[h+1])n=!0;else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}}for(var h=0,r=l.length;h<r;h++){console.time("dqs");var s=$.cookie("bioinfo_sid");s=""!=s&&null!=s?s:"dummycookie",OpencgaManager.region({
accountId:this.resource.account,sessionId:s,bucketId:this.resource.bucketId,objectId:this.resource.oid,region:l[h],queryParams:this.params,success:k})}}else g.length>0&&b.trigger("data:ready",{items:g,params:this.params,cached:!1,sender:this})},BEDDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,BEDDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,BEDDataAdapter.prototype.parse=function(a,b){this.parseFunction?this.parseFunction(a,b):this._defaultParse(a,b)},BEDDataAdapter.prototype._defaultParse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("\t"),h=g[0].replace("chr","");if(h==b.chromosome){var i={label:g[3],chromosome:h,start:parseFloat(g[1]),end:parseFloat(g[2]),score:g[4],strand:g[5],thickStart:g[6],thickEnd:g[7],itemRgb:g[8],blockCount:g[9],blockSizes:g[10],blockStarts:g[11],featureType:"bed"};this.featureCache.putFeatures(i,c),null==this.featuresByChromosome[h]&&(this.featuresByChromosome[h]=0),this.featuresByChromosome[h]++,this.featuresCount++}}}},CellBaseAdapter.prototype={setSpecies:function(a){this.species=a,this.configureCache()},setHost:function(a){this.configureCache(),this.host=a},deleteCache:function(){this.cache["delete"]()},configureCache:function(){var a=this.host||CellBaseManager.host,b=this.species.id+this.species.assembly.name.replace(/[\/_().\ -]/g,""),c=a+b;this.cacheConfig||(this.cacheConfig={chunkSize:3e3}),this.cacheConfig.cacheId=c,this.cache=new FeatureChunkCache(this.cacheConfig)},getData:function(a){var b=this,c={};_.extend(c,this.params),_.extend(c,a.params);var d=a.region;if(!(d.start>3e8||d.end<1)){d.start=d.start<1?1:d.start,d.end=d.end>3e8?3e8:d.end;var e=[this.category+this.subCategory+this.resource+Utils.queryString(c)],f=a.dataType;_.isUndefined(f)&&console.log("dataType must be provided!!!");var g=c.interval?c.interval:this.cacheConfig.chunkSize;this.debug&&console.log(g),this.cache.get(d,e,f,g,function(d,h){for(var i=e[0],j="",k=0;k<e.length;k++)j+=","+e[k];j=j.slice(1);var l=d[i],m=b._groupQueries(h[i]);if(m.length>0){a.webServiceCallCount=0;for(var n=0;n<m.length;n++){a.webServiceCallCount++;var o=m[n];CellBaseManager.get({host:b.host,version:b.version,species:b.species,category:b.category,subCategory:b.subCategory,query:o.toString(),resource:b.resource,params:c,success:function(c){var d=b._cellbaseSuccess(c,e,f,g);a.webServiceCallCount--,l=l.concat(d),0===a.webServiceCallCount&&(l.sort(function(a,b){return a.chunkKey.localeCompare(b.chunkKey)}),a.done({items:l,dataType:f,chunkSize:g,sender:b}))},error:function(){console.log("Server error"),a.done()}})}}else a.done({items:l,dataType:f,chunkSize:g,sender:b})})}},_cellbaseSuccess:function(a,b,c,d){var e=Utils.randomString(4)+this.resource+" save";console.time(e);for(var f=[],g=[],h=0;h<a.response.length;h++){var i=a.response[h];if("histogram"==c)for(var j=0;j<i.result.length;j++){var k=i.result[j],l=new Region(k);f.push(l),g.push(k)}else f.push(new Region(i.id)),g.push(i.result)}var m=this.cache.putByRegions(f,g,b,c,d);return console.timeEnd(e),m},_groupQueries:function(a){for(var b=50,c=[];a.length>0;)c.push(a.splice(0,b).toString());return c}},DasAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram,this.params.interval=a.interval,this.params.transcript=a.transcript,a.start<1&&(a.start=1),a.end>3e8&&(a.end=3e8);var c="data";a.histogram&&(c="histogram"+a.interval),this.params.dataType=c;for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[],h=d;h<=e;h++){var i=a.chromosome+":"+h;if(null==this.featureCache.cache[i]||null==this.featureCache.cache[i][c])f.push(h);else{var j=this.featureCache.getFeatureChunk(i);g.push(j)}}g.length>0&&this.trigger("data:ready",{items:g,params:this.params,cached:!0});var k=!0,l=!0;if(f.length>0)for(var h=0;h<f.length;h++){var m=null;if(k){var n=parseInt(f[h]*this.featureCache.chunkSize);k=!1}if(l){var o=parseInt(f[h]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);l=!1}if(null!=f[h+1]&&f[h]+1==f[h+1]?l=!0:(m=a.chromosome+":"+n+","+o,k=!0,l=!0),m){var p=this.proxy+this.url+"?segment="+m;console.log("fullURL: "+p),$.ajax({url:p,type:"GET",dataType:"xml",error:function(){alert("error"),b.trigger("error","It is not allowed by Access-Control-Allow-Origin ")},success:function(d){b.xml=(new XMLSerializer).serializeToString(d);var e=(new XMLSerializer).serializeToString(d),d=xml2json.parser(e);if(null!=d.dasgff){var f=new Array;if("undefined"!=typeof d.dasgff.gff.segment)if("undefined"!=typeof d.dasgff.gff.segment.feature)f=d.dasgff.gff.segment.feature;else if("undefined"!=typeof d.dasgff.gff.segment[0])if(null!=d.dasgff.gff.segment[0].feature)for(var g=0;g<d.dasgff.gff.segment.length;g++)for(var h=0;h<d.dasgff.gff.segment[g].feature.length;h++)d.dasgff.gff.segment[g].feature[h].chromosome=a.chromosome,f.push(d.dasgff.gff.segment[g].feature[h]);else f.push([]);var i={chromosome:a.chromosome,start:n,end:o},j="das";b.featureCache.putFeaturesByRegion(f,i,j,c),console.log(b.featureCache.cache);var k=b.featureCache.getFeatureChunksByRegion(i);null!=k&&b.trigger("data:ready",{items:k,params:b.params,cached:!1})}}})}}},DasAdapter.prototype.checkUrl=function(){var a=this,b=this.proxy+this.url+"?segment=1:1,1";console.log("Checking URL: "+b),$.ajax({url:b,type:"GET",dataType:"xml",error:function(){alert("error"),a.trigger("error","It is not allowed by Access-Control-Allow-Origin ")},success:function(b){a.xml=(new XMLSerializer).serializeToString(b),a.trigger("url:check",{data:a.xml})}})},EnsemblAdapter.prototype={getData:function(a){var b=this;a.webServiceCallCount=0;var c={};_.extend(c,this.params),_.extend(c,a.params);var d=a.region;if(!(d.start>3e8||d.end<1)){d.start=d.start<1?1:d.start,d.end=d.end>3e8?3e8:d.end;var e=a.dataType;_.isUndefined(e)&&console.log("dataType must be provided!!!");var f=[e],g=a.params.interval?a.params.interval:this.cacheConfig.chunkSize;this.debug&&console.log(g),this.cache.get(d,f,e,g,function(d,h){if(h.length>0)for(var i=h,j=0;j<i.length;j++)a.webServiceCallCount++,b._get(i[j],c,f,g,a);d.length>0&&(0===a.webServiceCallCount&&a.done(),b.trigger("data:ready",{items:d[f[0]],dataType:e,chunkSize:g,sender:b}))})}},_get:function(a,b,c,d,e){var f=this;EnsemblManager.get({host:f.host,species:f.species,category:f.category,subCategory:f.subCategory,query:a,params:b,success:function(b){var g=f._transformResponse(b,a);f._success(g,c,void 0,d,e)}})},_success:function(a,b,c,d,e){e.webServiceCallCount--;var f=Utils.randomString(4)+this.resource+" save";console.time(f);for(var g=[],h=[],i=0;i<a.response.length;i++){var j=a.response[i];g.push(new Region(j.id)),h.push(j.result)}var k=this.cache.putByRegions(g,h,b,c,d);console.timeEnd(f),0===e.webServiceCallCount&&e.done(),k.length>0&&this.trigger("data:ready",{items:k,dataType:c,chunkSize:d,sender:_this})},_transformResponse:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.id=d.ID,delete d.ID,d.name=d.external_name,delete d.external_name,d.chromosome=d.seq_region_name,delete d.seq_region_name}var e={response:[]},f={id:b,result:a};return e.response.push(f),e}},FeatureTemplateAdapter.prototype={setSpecies:function(a){this.species=a,this.configureCache()},setHost:function(a){this.configureCache(),this.host=a},deleteCache:function(){this.cache["delete"]()},configureCache:function(){var a="";if(null!=this.species)var a=this.species.id+this.species.assembly.name.replace(/[\/_().\ -]/g,"");var b=this.uriTemplate+a;this.cacheConfig||(this.cacheConfig={chunkSize:3e3}),this.cacheConfig.cacheId=b,this.cache=new FeatureChunkCache(this.cacheConfig)},getData:function(a){var b=this,c={};_.extend(c,this.params),_.extend(c,a.params);var d=a.region,e=this._computeLimitedRegion(d.chromosome);if(!(d.start>e||d.end<1)){d.start=d.start<1?1:d.start,d.end=d.end>e?e:d.end;var f=["cat_"+Utils.queryString(this.templateVariables)+Utils.queryString(c)],g=a.dataType;_.isUndefined(g)&&console.log("dataType must be provided!!!");var h=c.interval?c.interval:this.cacheConfig.chunkSize;this.debug&&console.log(h),this.cache.get(d,f,g,h,function(e,i){for(var j=f[0],k="",l=0;l<f.length;l++)k+=","+f[l];k=k.slice(1);var m,n=e[j];if(m="histogram"!==g?b.multiRegions===!1?b._singleQueries(i[j]):b._groupQueries(i[j]):b.histogramMultiRegions===!1?b._singleQueries(i[j]):b._groupQueries(i[j]),m.length>0){a.webServiceCallCount=0;for(var o=0;o<m.length;o++){a.webServiceCallCount++;var p=m[o],q=new XMLHttpRequest;q._queryRegion=p,q._originalRegion=d,q.onload=function(){if(a.webServiceCallCount--,400!==q.status&&500!==q.status){var c;try{c=JSON.parse(this.response)}catch(d){console.log("Warning: Response is not JSON"),c=this.response}var e=b._success(c,f,g,this._queryRegion,this._originalRegion,h);n=n.concat(e)}else console.log("request.status: "+q.status);0===a.webServiceCallCount&&(n.sort(function(a,b){return a.chunkKey.localeCompare(b.chunkKey)}),a.done({items:n,dataType:g,chunkSize:h,sender:b}))},q.onerror=function(){console.log("Server error"),a.done()};var r=new URITemplate(b.uriTemplate);b.templateVariables.region=p.toString(),b.templateVariables.species=b._getSpeciesQueryString(b.species);var s=r.expand(b.templateVariables);s=Utils.addQueryParamtersToUrl(c,s),q.open("GET",s,!0),console.log(s),q.send()}}else a.done({items:n,dataType:g,chunkSize:h,sender:b})})}},_success:function(a,b,c,d,e,f){var g=[],h=[];"histogram"!==c?(h="function"==typeof this.parse?this.parse(a,c):a,g=this._getRegionsFromQueryRegions(d)):(h="function"==typeof this.parseHistogram?this.parseHistogram(a):a,g=this._getRegionsFromHistogramChunks(h,e.chromosome));var i=this.cache.putByRegions(g,h,b,c,f);return i},_groupQueries:function(a){for(var b=0;b<a.length;b++){var c=a[b];this._computeRegionSize(c)}for(var d=50,e=[];a.length>0;)e.push(a.splice(0,d).toString());return e},_singleQueries:function(a){for(var b=0;b<a.length;b++){var c=a[b];this._computeRegionSize(c)}for(var d=[],b=0;b<a.length;b++){var e=a[b];d.push(e.toString())}return d},_getSpeciesQueryString:function(a){return null==a?"":null!=this.speciesParse?this.speciesParse(a):Utils.getSpeciesCode(a.scientificName)},_getRegionsFromQueryRegions:function(a){for(var b=[],c=a.split(","),d=0;d<c.length;d++){var e=c[d];b.push(new Region(e))}return b},_getRegionsFromHistogramChunks:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=new Region(e);f.chromosome=b,c.push(f)}return c},_computeLimitedRegion:function(a){var b=3e8;return null!=this.species&&null!=this.species.chromosomes[a]&&(b=this.species.chromosomes[a].end),null==this.chromosomeSizes||null==this.chromosomeSizes[a]||isNaN(this.chromosomeSizes[a])||(b=this.chromosomeSizes[a]),b},_computeRegionSize:function(a){var b=this._computeLimitedRegion(a.chromosome);a.end>b&&(a.end=b)}},GFF2DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GFF2DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GFF2DataAdapter.prototype.parse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("\t"),h=g[0].replace("chr","");if(h==b.chromosome){var i={chromosome:h,label:g[2],start:parseInt(g[3]),end:parseInt(g[4]),score:g[5],strand:g[6],frame:g[7],group:g[8],featureType:"gff2"};this.featureCache.putFeatures(i,c),null==this.featuresByChromosome[h]&&(this.featuresByChromosome[h]=0),this.featuresByChromosome[h]++,this.featuresCount++}}}},GFF3DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GFF3DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GFF3DataAdapter.prototype.parse=function(a,b){for(var c=function(a){var b={};if("undefined"!=typeof a)for(var c=a.replace(/ /g,"").split(";"),d=0,e=c.length;d<e;d++){var f=c[d].split("=");b[f[0]]=f[1]}return b},d="value",e=a.split("\n"),f=0;f<e.length;f++){var g=e[f].replace(/^\s+|\s+$/g,"");if(null!=g&&g.length>0){var h=g.split("\t"),i=h[0].replace("chr","");if(i==b.chromosome){var j={chromosome:i,label:h[2],start:parseInt(h[3]),end:parseInt(h[4]),score:h[5],strand:h[6],frame:h[7],attributes:c(h[8]),featureType:"gff3"};this.featureCache.putFeatures(j,d),null==this.featuresByChromosome[i]&&(this.featuresByChromosome[i]=0),this.featuresByChromosome[i]++,this.featuresCount++}}}},GTFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GTFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GTFDataAdapter.prototype.parse=function(a,b){for(var c=function(a){for(var b=a.split(";"),c={},d=0,e=b.length;d<e;d++){var f=b[d].split("=");c[f[0]]=f[1]}return c},d="value",e=a.split("\n"),f=0;f<e.length;f++){var g=e[f].replace(/^\s+|\s+$/g,"");if(null!=g&&g.length>0){var h=g.split("\t"),i=h[0].replace("chr","");if(i==b.chromosome){var j={chromosome:i,label:h[2],start:parseInt(h[3]),end:parseInt(h[4]),score:h[5],strand:h[6],frame:h[7],attributes:c(h[8]),featureType:"gtf"};this.featureCache.putFeatures(j,d),null==this.featuresByChromosome[i]&&(this.featuresByChromosome[i]=0),this.featuresByChromosome[i]++,this.featuresCount++}}}},OpencgaAdapter.prototype={setSpecies:function(a){this.species=a},configureCache:function(){this.host||OpencgaManager.host;this.cacheConfig||(this.cacheConfig={chunkSize:3e3}),this.cacheConfig.cacheId="opencga"+this.resource.id,this.cache=new FeatureChunkCache(this.cacheConfig)},getData:function(a){var b=this,c={};_.extend(c,this.params),_.extend(c,a.params);var d=a.region;if(!(d.start>3e8||d.end<1)){d.start=d.start<1?1:d.start,d.end=d.end>3e8?3e8:d.end;var e=this.resource.id.toString().split(","),f=a.dataType;_.isUndefined(f)&&console.log("dataType must be provided!!!");var g=c.interval?c.interval:this.cacheConfig.chunkSize;this.debug&&console.log(g),this.cache.get(d,e,f,g,function(d,h){for(var i=e[0],j="",k=0;k<e.length;k++)j+=","+e[k];j=j.slice(1);var l=d[i],m=b._groupQueries(h[i]);if(m.length>0){a.webServiceCallCount=0;for(var n=0;n<m.length;n++){a.webServiceCallCount++;var o=m[n];c.region=o.toString(),c.interval=g,c.histogram="histogram"==f,c.process_differences=!1,OpencgaManager.files.fetch({id:j,query:c,request:{success:function(c){var d=b._opencgaSuccess(c,e,f,g,a);a.webServiceCallCount--,l=l.concat(d),0===a.webServiceCallCount&&a.done({items:l,dataType:f,chunkSize:g,sender:b})},error:function(){console.log("Server error"),a.done()}}})}}else a.done({items:l,dataType:f,chunkSize:g,sender:b})})}},_opencgaSuccess:function(a,b,c,d){var e=this.cacheConfig.cacheId+" save "+a.response.length+" samples";if(console.time(e),b.length!=a.response.length&&(console.log("ERROR: requested "+b.length+"samples, but response has "+a.response.length),console.log(a)),a.response[0]&&a.response[0].result[0]){var f=a.response[0].result[0].end-a.response[0].result[0].start+1;f!=d&&console.log("code smell: chunkSize requested: "+d+", but obtained: "+f)}for(var g=[],h=0;h<a.response.length;h++){var i=a.response[h],j=this._adaptChunks(i,b[h],c,d);g=g.concat(j)}return console.timeEnd(e),g},_groupQueries:function(a){for(var b=50,c=[];a.length>0;)c.push(a.splice(0,b).toString());return c},_decryptChunks:function(a,b){for(var c=[],d=0;d<a.length;d++)1==a[d].enc?c.push(CryptoJS.AES.decrypt(a[d],b)):c.push(a[d]);return c},_adaptChunks:function(a,b,c,d){var e,f,g=[];if("org.opencb.biodata.models.variant.Variant"==a.resultType){e=[],f=[];for(var h={},i=0;i<a.result.length;i++){var j=a.result[i],k=this.cache.getChunkId(j.start,d),l=this.cache.getChunkKey(j.chromosome,k,c,d);void 0==h[l]&&(h[l]=e.length,f.push(new Region({chromosome:j.chromosome,start:k*d,end:(k+1)*d-1})),e.push([])),e[h[l]].push(j)}g=this.cache.putByRegions(f,e,b,c,d)}else{f=[];for(var m=0;m<a.result.length;m++)f.push(new Region(a.result[m]));e=a.result,g=this.cache.putByRegions(f,e,b,c,d)}return g}},VCFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,VCFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,VCFDataAdapter.prototype.parse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("\t");if("#"===f.substr(0,1))"#"===f.substr(1,1)?this.header+=f.replace(/</gi,"&#60;").replace(/>/gi,"&#62;")+"<br>":this.samples=g.slice(9);else{var h=g[0].replace(/chr/gi,"");if(h==b.chromosome){var i=[];g[9]&&(i=g.slice(9));var j={chromosome:h,position:parseInt(g[1]),start:parseInt(g[1]),end:parseInt(g[1]),id:g[2],reference:g[3],alternate:g[4],quality:g[5],filter:g[6],info:g[7].replace(/;/gi,"<br>"),format:g[8],sampleData:f,samples:i,featureType:"vcf"};this.featureCache.putFeatures(j,c),null==this.featuresByChromosome[h]&&(this.featuresByChromosome[h]=0),this.featuresByChromosome[h]++,this.featuresCount++}}}}},AttributeNetworkDataAdapter.prototype.parse=function(a){try{a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");var b=a.split(/\n/),c=b[0].trim(),d=[];if("#"===c.substr(0,1)){d=c.split(/\t/);for(var e=0;e<b.length;e++){var f=b[e].trim();if("#"!==f.substr(0,1)){c=f;break}}}this.useFirstLineAsColumnNames&&(d=c.split(/\t/),c=b[1]);for(var g=[],h=c.split(/\t/).length,e=0;e<h;e++)if(this.renameColumns[e]?g[e]=this.renameColumns[e]:d[e]?g[e]=d[e]:g[e]="Column"+e,0==e&&(g[e]="id"),this.ignoreColumns[e]!==!0){var i={name:g[e].toString(),title:g[e].toString(),type:"text",formula:function(a){return a[this.name]}};this.columns.push(i)}if(Object.keys(this.ignoreColumns).length>0)for(var e=0;e<b.length;e++){var f=b[e].trim();if(null!=f&&f.length>0&&"#"!=f.substr(0,1)){if(0==e&&1==this.useFirstLineAsColumnNames)continue;for(var j=f.split("\t"),k={},l=0;l<j.length;l++)this.ignoreColumns[l]!==!0&&(k[g[l]]=j[l].trim());this.attributes.push(k)}}else for(var e=0;e<b.length;e++){var f=b[e].trim();if(null!=f&&f.length>0&&"#"!=f.substr(0,1)){if(0==e&&1==this.useFirstLineAsColumnNames)continue;for(var j=f.split("\t"),k={},l=0;l<j.length;l++)k[g[l]]=j[l].trim();this.attributes.push(k)}}this.trigger("data:load",{columns:this.columns,attributes:this.attributes,sender:this})}catch(m){console.log(m),console.log(m.stack),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},DOTDataAdapter.prototype.parse=function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m=a.split("\n"),n=0;n<m.length;n++){var o=m[n].replace(/^\s+|\s+$/g,"");if("#"!=o.substr(0,1)&&"/*"!=o.substr(0,2)&&"//"!=o.substr(0,2)){var p=o.substr(o.length-1,o.length);if((o.indexOf("graph")!=-1||o.indexOf("digraph")!=-1||o.indexOf("subgraph")!=-1)&&"{"==p){o.indexOf("digraph")!=-1&&this.graph.setType("directed");for(var q=n;q<m.length;q++)if(n++,o=m[q].replace(/^\s+|\s+$/g,""),"#"!=o.substr(0,1)&&"/*"!=o.substr(0,2)&&"//"!=o.substr(0,2))if(o.indexOf("->")!=-1||o.indexOf("--")!=-1){if(o.indexOf("->")!=-1?(d="->",e="directed"):(d="--",e="undirected"),i={},o.indexOf("[")!=-1&&o.indexOf("]")!=-1){g=o.substring(o.indexOf("[")+1,o.indexOf("]")).split(",");for(var r=0,s=g.length;r<s;r++)h=g[r].split("="),i[h[0].replace(/^\s+|\s+$/g,"")]=h[1].replace(/^\s+|\s+$/g,"");o=o.substring(0,o.indexOf("["))}else o=o.substring(0,o.indexOf(";"));f=o.split(d);for(var t=0,u=f.length;t<u-1;t++){if(b=f[t].replace(/^\s+|\s+$/g,"").replace(/"/g,""),c=f[t+1].replace(/^\s+|\s+$/g,"").replace(/"/g,""),"undefined"==typeof this.addedVertex[b]){var v=new Vertex({name:b});this.network.addVertex({vertex:v,vertexConfig:new VertexConfig({})}),this.addedVertex[b]=v}if("undefined"==typeof this.addedVertex[c]){var w=new Vertex({name:c});this.network.addVertex({vertex:w,vertexConfig:new VertexConfig({})}),this.addedVertex[c]=w}var x=new Edge({source:this.addedVertex[b],target:this.addedVertex[c]});this.network.addEdge({edge:x,edgeConfig:new EdgeConfig({type:e,renderer:new DefaultEdgeRenderer({shape:e})})})}}else if(o.indexOf("[")!=-1&&o.indexOf("]")!=-1){g=o.substring(o.indexOf("[")+1,o.indexOf("]")).split(","),i={};for(var r=0,s=g.length;r<s;r++)h=g[r].split("="),i[h[0].replace(/^\s+|\s+$/g,"")]=h[1].replace(/^\s+|\s+$/g,"").replace(/"/g,"").replace(/'/g,"");if(o.indexOf("graph")!=-1)j=i;else if(o.indexOf("node ")!=-1)k=i;else if(o.indexOf("edge")!=-1)l=i;else{var y=o.split("[")[0].replace(/^\s+|\s+$/g,"").replace(/"/g,"");if(i.color&&"#"!=i.color.slice(0,1)&&!isNaN(i.color.slice(-1))&&(i.color=i.color.slice(0,-1)),i.fillcolor&&"#"!=i.fillcolor.slice(0,1)&&!isNaN(i.fillcolor.slice(-1))&&(i.fillcolor=i.fillcolor.slice(0,-1)),"undefined"==typeof this.addedVertex[y]){var z=new Vertex({name:y});this.network.addVertex({vertex:z,vertexConfig:new VertexConfig({})}),this.addedVertex[y]=z}}}else if(o.indexOf("subgraph")!=-1){m[q]=m[q].replace("subgraph","graph");for(var A,B=m[q].replace(/^\s+|\s+$/g,"").split(" ")[1],C="",D=q,E=m.length;D<E;D++){C+=m[D]+"\n";var F=m[q].replace(/^\s+|\s+$/g,"");if("#"!=F.substr(0,1)&&"/*"!=F.substr(0,2)&&"//"!=F.substr(0,2)&&(F.indexOf("->")!=-1||F.indexOf("--")!=-1)){A=F.indexOf("->")!=-1?"->":"--";for(var G=F.replace(/;/g,"").split(A),t=0,u=G.length;t<u-1;t++)source=G[t].replace(/^\s+|\s+$/g,"").replace(/"/g,""),target=G[t+1].replace(/^\s+|\s+$/g,"").replace(/"/g,""),this.nodeSubgraph[source]=B,this.nodeSubgraph[target]=B}if(m[D].indexOf("}")!=-1){this.parse(C);break}q++,n++}}}}}},JSONNetworkDataAdapter.prototype.getJSON=function(){return this.jsonObject},JSONNetworkDataAdapter.prototype.parse=function(a){try{this.jsonObject=JSON.parse(a),this.trigger("data:load",{jsonObject:this.jsonObject})}catch(b){console.log(b),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},SIFNetworkDataAdapter.prototype.getGraph=function(){return this.graph},SIFNetworkDataAdapter.prototype.parse=function(a){try{a.indexOf("\t")!=-1?this.separator="\t":this.separator=" ",console.time("SIFParse"),a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");var b=a.split(/\n/);this.addedVertex={},this.addedEdges={};for(var c=0;c<b.length;c++){var d=b[c];if(null!=d&&d.length>0){for(var e=d.split(this.separator),f=0;f<e.length;f++)e[f]=e[f].trim();if("#"!=e[0].substr(0,1)){var g,h=e[0],i=""===e[1]?"r":e[1];if("undefined"==typeof this.addedVertex[h]){var j=new Vertex({id:h});this.graph.addVertex(j),this.addedVertex[h]=j}for(var f=2,k=e.length;f<k;f++){if(g=e[f],"undefined"==typeof this.addedVertex[g]){var l=new Vertex({id:g});this.graph.addVertex(l),this.addedVertex[g]=l}var m=h+"_"+i+"_"+g;if("undefined"==typeof this.addedEdges[m]){var n=new Edge({id:m,relation:i,source:this.addedVertex[h],target:this.addedVertex[g],weight:1,directed:!0});this.graph.addEdge(n),this.addedEdges[m]=n}}}}}console.timeEnd("SIFParse"),this.trigger("data:load",{graph:this.graph,sender:this})}catch(o){console.log(o),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},TextNetworkDataAdapter.prototype.getGraph=function(){return this.graph},TextNetworkDataAdapter.prototype.parse=function(a){try{"undefined"==typeof a&&(a=this.rawData),a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");var b=a.split(/\n/);this.lines=[],this.columnLength=0;for(var c=0,d=0;d<b.length;d++){var e=b[d];if(null!=e&&e.length>0){var f=e.split(this.separator);"#"!=f[0].substr(0,1)&&(this.lines.push(f),0===c&&(c=f.length,this.columnLength=c),f.length!==c&&this.trigger("error:parse",{errorMsg:"Different number of columns.",sender:this}))}}this.trigger("data:load",{lines:this.lines,sender:this})}catch(g){console.log(g),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},TextNetworkDataAdapter.prototype.parseColumns=function(a,b,c,d){this.graph=new JsoGraph,this.addedVertex={},this.addedEdges={};for(var e=0;e<this.lines.length;e++){for(var f=this.lines[e],g=0;g<f.length;g++)f[g]=f[g].trim();var h,i=f[a],j=f[b];if(h=c<0?d:f[c],"undefined"==typeof this.addedVertex[i]){var k=new Vertex({id:i});this.graph.addVertex(k),this.addedVertex[i]=k}if(b>-1){if("undefined"==typeof this.addedVertex[j]){var l=new Vertex({id:j});this.graph.addVertex(l),this.addedVertex[j]=l}var m=i+"_"+h+"_"+j;if("undefined"==typeof this.addedEdges[m]){var n=new Edge({id:m,relation:h,source:this.addedVertex[i],target:this.addedVertex[j],weight:1,directed:!0});this.graph.addEdge(n),this.addedEdges[m]=n}}}return this.graph},XLSXNetworkDataAdapter.prototype.parse=function(a){try{this.xlsx=XLSX.read(a,{type:"binary"}),this.trigger("data:load",{workbook:this.xlsx,sender:this})}catch(b){console.log(b),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},XLSXNetworkDataAdapter.prototype.parseSheet=function(a){var b=XLSX.utils.sheet_to_csv(this.xlsx.Sheets[a]);return b};var iDBInstances=[],iDBVersion=1;IndexedDBStore.prototype={_getConnection:function(a,b,c){var d=this;if(d.debug&&(console.log(d.cacheId+" opening? "+d.opening),void 0==a&&console.log("WARNING: requested to create objectStore 'undefined'")),1==d.opening)d.debug&&console.log("Database "+d.cacheId+" is already opening. To avoid block: waiting..."),setTimeout(d._getConnection.bind(d),d.timeout*(1+.25*Math.random()),a,b,c);else try{d.debug&&console.log("trying opening Database:"+d.cacheId);var e;d.opening=!0,d.debug&&console.log("lock:"+d.cacheId+", "+a+" opening = "+d.opening+" version: "+c),e=_.isUndefined(c)?window.indexedDB.open(d.cacheId):window.indexedDB.open(d.cacheId,c),e.onsuccess=function(c){d.opening=!1,d.debug&&console.log("unlock:"+d.cacheId+", "+a+" opening = "+d.opening);var e=c.target.result;e.onversionchange=function(b){d.debug&&console.log("Version change triggered, so closing database connection "+d.cacheId+", "+a+" (old version, new version, db, event)",b.oldVersion,b.newVersion,e,b),e&&(e.close(),e.closed=!0,e=void 0)},""==a||e.objectStoreNames.contains(a)?(d.debug&&console.log("connection obtained for "+d.cacheId+" and "+a,e),b(e)):(iDBVersion=Math.max(iDBVersion,e.version)+1,e.close(),e.closed=!0,e=void 0,d.version=iDBVersion,d.debug&&console.log("needed ObjectStore "+a+" in "+d.cacheId+" creating version "+iDBVersion),d._getConnection(a,b,d.version))},e.onupgradeneeded=function(b){if(d.debug&&console.log("Database upgrade needed in "+d.cacheId+", "+a),dbConnection=b.target.result,!dbConnection.objectStoreNames.contains(a)){d.debug&&console.log("creating "+a+" in Database "+d.cacheId);dbConnection.createObjectStore(a)}},e.onerror=function(b){console.log("DB Open Request Error in "+d.cacheId+", "+a),console.log(b)},e.onblocked=function(c){console.log("DB Open Request Blocked in "+d.cacheId+", "+a,c),d._getConnection(a,b)}}catch(f){console.log("catch error:"),console.error(f)}},clear:function(a){var b=this;b._getConnection(a,function(c){var d=c.transaction([a],"readwrite");d.oncomplete=function(c){console.log("IndexedDB "+b.cacheId+", "+a+" clear success!")};var e=d.objectStore(a),f=e.clear();f.onerror=function(c){console.log("IndexedDB Error trying to clear the object store "+a+" in "+b.cacheId)}})},count:function(a,b){var c=this;c._getConnection(a,function(d){var e=d.transaction([a],"readwrite"),f=e.objectStore(a),g=f.count();g.onerror=function(b){console.log("IndexedDB Error trying to count the object store "+a+" in "+c.cacheId)},g.onsuccess=function(a){b(a.target.result)}})},getObjectStoreNames:function(a){var b=this;b._getConnection("",function(b){a(b.objectStoreNames)})},close:function(){var a=this;a._getConnection(objectStoreName,function(b){b.close(),console.log("Database "+a.cacheId+" closed"),b.closed=!0,b=void 0})},destroyDB:function(){var a=this;try{var b=window.indexedDB.deleteDatabase(a.cacheId);b.onsuccess=function(b){console.log("Database "+a.cacheId+" successfully deleted")},b.onupgradeneeded=function(a){dbOpenRequest.result;console.log("Deleting Database upgrade needed")},b.onerror=function(b){console.log("Error deleting DB"+a.cacheId),console.log(b)},b.onblocked=function(b){console.log("Deleting DB Blocked. Try closing the database "+a.cacheId+" and then deleting it")}}catch(c){console.log(c)}},destroyDBs:function(){for(var a=0;a<iDBInstances.length;a++)iDBInstances[a].close(),iDBInstances[a].destroyDB()},get:function(a,b,c){var d,e=this;e.debug&&(d="IndexedDBStore.get "+a+b,console.time(d));var f=null;e._getConnection(a,function(g){var h=g.transaction([a],"readonly");h.oncomplete=function(a){e.debug&&console.timeEnd(d),g.close(),c(f)},h.onerror=function(a){console.log("There was an error in the transaction get ("+b+")"),console.log(a)};var i=h.objectStore(a),j=i.get(b);j.onsuccess=function(a){f=a.target.result}})},getAll:function(a,b,c){var d,e=this;if((e.profile||e.debug)&&(d="IndexedDBStore.getAll "+a+", with "+b.length+" keys.",console.time(d)),!(b instanceof Array&&c))return void console.error("Bad use of IndexedDBStore: getAll must receive an ObjectStoreName, an Array of keys and a callback function.");var f=new Array(b.length);e._getConnection(a,function(g){var h=g.transaction([a],"readonly");h.oncomplete=function(a){(e.profile||e.debug)&&console.timeEnd(d),g.close(),c(f)},h.onerror=function(a){console.log("There was an error in the transaction get ("+b+")"),console.log(a)};for(var i=h.objectStore(a),j=0;j<b.length;j++){var k=i.get(b[j]);k.onsuccess=function(a){return function(b){f[a]=b.target.result}}(j)}})},foreach:function(a,b,c,d){if(!(b instanceof Array&&c))return void console.error("Bad use of IndexedDBStore: foreach must receive an ObjectStoreName, an Array of keys and a callback function.");var e,f=this;(f.profile||f.debug)&&(e="IndexedDBStore.getAll "+a+", with "+b.length+" keys.",console.time(e)),f._getConnection(a,function(g){var h=g.transaction([a],"readonly");h.oncomplete=function(a){g.close(),(f.profile||f.debug)&&console.timeEnd(e),d&&d()},h.onerror=function(a){console.log("There was an error in the transaction foreach ("+b+")"),console.log(a)};for(var i=h.objectStore(a),j=0;j<b.length;j++){var k=i.get(b[j]);k.onsuccess=function(a){return function(d){c(d.target.result,b[a],a)}}(j)}})},add:function(a,b,c){var d=this;d._getConnection(a,function(d){var e=d.transaction([a],"readwrite");e.onerror=function(a){console.log("There was an error in the transaction add ("+b+", "+c+")"),console.log(a)};var f=e.objectStore(a);f.add(c,b)})},put:function(a,b,c){var d,e=this;e.debug&&(d="IndexedDBStore.put "+a+b,console.time(d)),e._getConnection(a,function(f){var g=f.transaction([a],"readwrite");g.oncomplete=function(a){e.debug&&console.timeEnd(d),f.close(),f.close=!0},g.onerror=function(a){console.log("There was an error in the transaction put("+b+", ",c,")"),console.log(a)};var h=g.objectStore(a);h.put(c,b)})},putAll:function(a,b,c){var d,e=this;return(e.profile||e.debug)&&(d="IndexedDBStore.putAll "+a+", with "+b.length,console.time(d)),b instanceof Array&&c instanceof Array&&b.length==c.length?void e._getConnection(a,function(f){var g=f.transaction([a],"readwrite");g.oncomplete=function(a){(e.profile||e.debug)&&console.timeEnd(d),f.close(),f.close=!0},g.onerror=function(a){console.log("There was an error in the transaction put("+key+", ",value,")"),console.log(a)};for(var h=g.objectStore(a),i=0;i<b.length;i++)h.put(c[i],b[i])}):void console.error("Bad use of IndexedDBStore: putAll must receive two Arrays of the same length.")},"delete":function(a,b){var c=this;c._getConnection(a,function(c){var d=c.transaction([a],"readwrite");d.onerror=function(a){console.log("There was an error in the transaction delete ("+b+")"),console.log(a)};var e=d.objectStore(a);e["delete"](b)})}},IndexedDBTest=function(){var a=new IndexedDBStore({cacheId:"test"});a.put("os-a","key-a","value-a"),a.put("os-b","key-b","value-b")},IndexedDBTest(),MemoryStore.prototype={put:function(a,b,c){"undefined"==typeof this.stores[a]&&this.init(a);var d={key:b,value:c};this.stores[a][b]=d,this.tails[a]?(this.tails[a].newer=d,d.older=this.tails[a]):this.heads[a]=d,this.tails[a]=d,this.sizes[a]++},putAll:function(a,b,c){for(var d=0;d<b.length;d++)this.put(a,b[d],c[d])},shift:function(a){"undefined"==typeof this.stores[a]&&this.init(a);var b=this.heads[a];b&&(this.heads[a].newer?(this.heads[a]=this.heads[a].newer,this.heads[a].older=void 0):this.heads[a]=void 0,b.newer=b.older=void 0,delete this.stores[a][b.key])},get:function(a,b,c){"undefined"==typeof this.stores[a]&&this.init(a);var d=this.stores[a][b];return void 0===d?void(c&&c()):d===this.tails[a]?(c&&c(d.value),d.value):(d.newer&&(d===this.heads[a]&&(this.heads[a]=d.newer),
d.newer.older=d.older),d.older&&(d.older.newer=d.newer),d.newer=void 0,d.older=this.tails[a],this.tails[a]&&(this.tails[a].newer=d),this.tails[a]=d,c&&c(d.value),d.value)},getAll:function(a,b,c){for(var d=[],e=0;e<b.length;e++)d[e]=this.get(a,b[e]);c(d)},foreach:function(a,b,c){for(var d=0;d<b.length;d++)c(this.get(a,b[d]),b[d])},init:function(a){void 0!=a?(this.sizes[a]=0,this.stores[a]={},this.heads[a]=void 0,this.tails[a]=void 0):(this.sizes={},this.stores={},this.heads={},this.tails={})},clear:function(){this.stores=null,this.init()},"delete":function(){this.clear()}},FeatureChunkCache.prototype={get:function(a,b,c,d,e){for(var f=d?d:this.defaultChunkSize,g=this.getChunkId(a.start,f),h=this.getChunkId(a.end,f),i=[],j={cachedChunks:{},uncachedRegions:{}},k=g;k<=h;k++)i.push(this.getChunkKey(a.chromosome,k,c,f));_.isArray(b)||(b=[b]);for(var l=0,m=0;m<b.length;m++)l++,j.cachedChunks[b[m]]=[],j.uncachedRegions[b[m]]=[],this.getChunks(b[m],i,function(c){return function(d){for(var h=0;h<d.length;h++){var i=parseInt((g+h)*f+f-1),k=parseInt((g+h)*f),m=new Region({chromosome:a.chromosome,start:k,end:i});_.isUndefined(d[h])?j.uncachedRegions[b[c]].push(m):j.cachedChunks[b[c]].push(d[h])}this.verbose&&console.log(j),l--,0==l&&e&&e(j.cachedChunks,j.uncachedRegions)}}(m))},getChunk:function(a,b,c){c||console.log("bad FeatureChunkCache usage: undefined callback"),a||(a=this.defaultCategory),this.store.get(a,b,c)},getChunks:function(a,b,c){c||console.log("bad FeatureChunkCache usage: undefined callback"),a||(a=this.defaultCategory),this.store.getAll(a,b,c)},joinRegions:function(a){if(a.length<=1)return a;for(var b=[],c=a[0].start,d=region[0].end,e=a[0].chromosome,f=1;f<a.length;f++)a[f].chromosome==e&&a[f].start-1<=d?a[f].end>d&&(d=a[f].end):(b.push(new Region({chromosome:e,start:c,end:d})),e=a[f].chromosome,c=a[f].start,d=a[f].end);return b.push(new Region({chromosome:e,start:c,end:d})),b},putByRegions:function(a,b,c,d,e){for(var f=e?e:this.defaultChunkSize,g=[],h=0;h<a.length;h++){var i=this.getChunkId(a[h].start,f),j=this.getChunkKey(a[h].chromosome,i,d,e);g.push(j)}return this.putChunks(g,a,b,c,!1)},putChunks:function(a,b,c,d,e){for(var f=[],g=0;g<c.length;g++)f.push(this.createEntryValue(a[g],b[g],c[g],e));return d||(d=this.defaultCategory),this.store.putAll(d,a,f),f},createEntryValue:function(a,b,c,d){var e;return e=d?{value:c,chunkKey:a,region:b,enc:d}:{value:c,chunkKey:a,region:b}},getChunkKey:function(a,b,c,d){var e=c?"_"+c:"";return e+="_"+d,a+":"+b+e},getChunkId:function(a,b){return Math.floor(a/b)},getDefaultChunkSize:function(){return this.defaultChunkSize},"delete":function(){this.store.destroyDB()}},FileFeatureCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)},FileFeatureCache.prototype.getChunkRegion=function(a){return start=this._getChunk(a.start)*this.chunkSize,end=this._getChunk(a.end)*this.chunkSize+this.chunkSize-1,{start:start,end:end}},FileFeatureCache.prototype.getFirstFeature=function(){var a;return a=this.gzip?JSON.parse(RawDeflate.inflate(this.cache[Object.keys(this.cache)[0]].data[0])):this.cache[Object.keys(this.cache)[0]].data[0]},FileFeatureCache.prototype.getFeatureChunk=function(a){return null!=this.cache[a]?this.cache[a]:null},FileFeatureCache.prototype.getFeatureChunkByDataType=function(a,b){return null!=this.cache[a]&&null!=this.cache[a][b]?this.cache[a][b]:null},FileFeatureCache.prototype.getFeatureChunksByRegion=function(a){var b,c,d,e=[];b=this._getChunk(a.start),c=this._getChunk(a.end);for(var f=b;f<=c;f++)d=a.chromosome+":"+f,null!=this.cache[d]&&e.push(this.cache[d]);return e},FileFeatureCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g,h,i,j,k;f=this._getChunk(b.start),g=this._getChunk(b.end);for(var l=f;l<=g;l++)e=b.chromosome+":"+l,null==this.cache[e]&&(this.cache[e]={},this.cache[e].key=e),null==this.cache[e][d]&&(this.cache[e][d]=[]);a.constructor!=Array&&(a=[a]);for(var m=0,n=a.length;m<n;m++){j=a[m],j.featureType=c,h=this._getChunk(j.start),i=this._getChunk(j.end),k=this.gzip?RawDeflate.deflate(JSON.stringify(j)):j;for(var l=h;l<=i;l++)l>=f&&l<=g&&(e=b.chromosome+":"+l,this.cache[e][d].push(k))}},FileFeatureCache.prototype.putFeatures=function(a,b){var c,d,e,f;a.constructor!=Array&&(a=[a]);for(var g=0,h=a.length;g<h;g++){c=a[g],e=this._getChunk(c.start),f=this._getChunk(c.end);for(var i=e;i<=f;i++)d=c.chromosome+":"+i,null==this.cache[d]&&(this.cache[d]=[],this.cache[d].key=d),null==this.cache[d][b]&&(this.cache[d][b]=[]),this.gzip?this.cache[d][b].push(RawDeflate.deflate(JSON.stringify(c))):this.cache[d][b].push(c)}},FileFeatureCache.prototype.putChunk=function(a,b){this.cache[a]=b},FileFeatureCache.prototype.getChunk=function(a){return this.cache[a]},FileFeatureCache.prototype.putCustom=function(a){a(this)},FileFeatureCache.prototype.getCustom=function(a){a(this)},FileFeatureCache.prototype.remove=function(a){for(var b=this._getChunk(a.start),c=this._getChunk(a.end),d=b;d<=c;d++){var e=a.chromosome+":"+d;this.cache[e]=null}},FileFeatureCache.prototype.clear=function(){this.size=0,this.cache={}},BamCache.prototype.putHistogramFeaturesByRegion=FileFeatureCache.prototype.putFeaturesByRegion,BamCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)},BamCache.prototype.getFeatureChunk=function(a){return null!=this.cache[a]?this.cache[a]:null},BamCache.prototype.getFeatureChunksByRegion=function(a){var b,c,d,e=[];b=this._getChunk(a.start),c=this._getChunk(a.end);for(var f=b;f<=c;f++)d=a.chromosome+":"+f,null!=this.cache[d]&&e.push(this.cache[d]);return e},BamCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g,h,i,j,k,l=a.reads,m=a.coverage;h=this._getChunk(b.start),i=this._getChunk(b.end);var n=0;console.time("BamCache.prototype.putFeaturesByRegion1");for(var o=h,p=0;o<=i;o++,p++){if(e=b.chromosome+":"+o,null!=this.cache[e]&&null!=this.cache[e][d]||(this.cache[e]={},this.cache[e][d]=[],this.cache[e].key=e,this.cache[e].start=parseInt(b.start)+p*this.chunkSize,this.cache[e].end=parseInt(b.start)+(p+1)*this.chunkSize-1),"data"===d)var q=m.all.slice(n,n+this.chunkSize),r=m.a.slice(n,n+this.chunkSize),s=m.c.slice(n,n+this.chunkSize),t=m.g.slice(n,n+this.chunkSize),u=m.t.slice(n,n+this.chunkSize),v={all:q,a:r,c:s,g:t,t:u};this.gzip?this.cache[e].coverage=RawDeflate.deflate(JSON.stringify(v)):this.cache[e].coverage=v,n+=this.chunkSize}console.timeEnd("BamCache.prototype.putFeaturesByRegion1"),console.time("BamCache.prototype.putFeaturesByRegion");var w=0;if("data"===d)for(var x=0,y=l.length;x<y;x++){j=l[x],j.featureType="bam",f=this._getChunk(j.start),g=this._getChunk(0==j.end?j.end=-1:j.end),k=this.gzip?RawDeflate.deflate(JSON.stringify(j)):j;for(var o=f,p=0;o<=g;o++,p++)o>=h&&o<=i&&(e=j.chromosome+":"+o,this.cache[e][d].push(k))}console.timeEnd("BamCache.prototype.putFeaturesByRegion"),console.log("BamCache.prototype.putFeaturesByRegion"+w)},BamCache.prototype.clear=function(){this.size=0,this.cache={},console.log("bamCache cleared")},NavigationBar.prototype={render:function(){var a=this,b='<div title="Restore previous region" style="margin-right: 5px;" id="leftSideButton" class="ocb-ctrl"><i class="fa fa-navicon"></i></div><div id="restoreDefaultRegionButton" class="ocb-ctrl"><i class="fa fa-repeat"></i></div><div title="Region history" class="ocb-dropdown" style="margin-left: 5px">   <div tabindex="-1" id="regionHistoryButton" class="ocb-ctrl"><i class="fa fa-history"></i> <i class="fa fa-caret-down"></i></div>   <ul id="regionHistoryMenu"></ul></div><div title="Species menu" class="ocb-dropdown" style="margin-left: 5px">   <div tabindex="-1" id="speciesButton" class="ocb-ctrl"><span id="speciesText"></span> <i class="fa fa-caret-down"></i></div>   <ul id="speciesMenu"></ul></div><div title="Chromosomes menu" class="ocb-dropdown" style="margin-left: 5px">   <div tabindex="-1" id="chromosomesButton" class="ocb-ctrl"><span id="chromosomesText"></span> <i class="fa fa-caret-down"></i></div>   <ul id="chromosomesMenu" style="height: 200px; overflow-y: auto;"></ul></div><div style="margin-left: 5px; float: left; " >   <label title="Toggle karyotype panel" class="ocb-ctrl" id="karyotypeButtonLabel"><input id="karyotypeButton" type="checkbox"><span style="border-right: none"><span class="ocb-icon ocb-icon-karyotype"></span></span></label>   <label title="Toggle chromosome panel" class="ocb-ctrl" id="chromosomeButtonLabel"><input id="chromosomeButton" type="checkbox"><span style="border-right: none"><span class="ocb-icon ocb-icon-chromosome"></span></span></label>   <label title="Toggle overview panel" class="ocb-ctrl" id="regionButtonLabel"><input id="regionButton" type="checkbox"><span><span class="ocb-icon ocb-icon-region"></span></span></label></div><div id="zoomControl" style="float:left;"><div title="Minimum window size" id="zoomMinButton" class="ocb-ctrl" style="margin-left: 5px;border-right: none;">Min</div><div title="Decrease window size" id="zoomOutButton" class="ocb-ctrl"><span class="fa fa-minus"></span></div><div id="progressBarCont" class="ocb-zoom-bar">   <div id="progressBar" class="back"></div>   <div id="progressBar" class="rect" style="width: '+this.zoom+'%"></div>   <div id="progressBarBall" class="ball" style="left: '+this.zoom+'%"></div></div><div title="Increase window size" id="zoomInButton" class="ocb-ctrl" style="border-right: none;"><span class="fa fa-plus"></span></div><div title="Maximum window size" id="zoomMaxButton" class="ocb-ctrl">Max</div></div><div title="Window size (Nucleotides)" id="windowSizeControl" style="float:left;margin-left: 5px;"><input id="windowSizeField" class="ocb-ctrl"  type="text" style="width: 70px;"></div><div title="Position" id="positionControl" style="float:left;margin-left: 5px"><input id="regionField" class="ocb-ctrl" placeholder="1:10000-20000" type="text" style="width: 170px;"><div id="goButton" class="ocb-ctrl" style="border-left: none;">Go!</div></div><div id="moveControl" style="float:left;font-size:18px;"><div id="moveFurtherLeftButton" class="ocb-ctrl" style="border-right: none;margin-left: 5px;"><i class="fa fa-angle-double-left"></i></div><div id="moveLeftButton" class="ocb-ctrl" style="border-right: none;"><i class="fa fa-angle-left"></i></div><div id="moveRightButton" class="ocb-ctrl" style="border-right: none;"><i class="fa fa-angle-right"></i></div><div id="moveFurtherRightButton" class="ocb-ctrl"><i class="fa fa-angle-double-right"></i></div></div><label class="ocb-ctrl"><input type="checkbox" id="autoheightButton"><span style="margin-left: 5px;font-size:18px;"><i class="fa fa-compress"></i></span></label><div id="searchControl" style="float:left;"><input id="searchField" class="ocb-ctrl"  list="searchDataList"  placeholder="gene" type="text" style="width: 90px;margin-left: 5px;">       <datalist id="searchDataList">       </datalist><div id="quickSearchButton" class="ocb-ctrl" style="border-left: none;"><i class="fa fa-search"></i></div></div><div style="float:right;margin-right:10px;" id="menuButton" class="ocb-ctrl"><i class="fa fa-navicon"></i> Configure</div>';this.div=document.createElement("div"),this.div.setAttribute("class","ocb-gv-navigation-bar unselectable"),this.div.innerHTML=b;for(var c=this.div.querySelectorAll("[id]"),d=0;d<c.length;d++){var e=c[d].getAttribute("id");e&&(this.els[e]=c[d])}for(var f in this.componentsConfig)this.componentsConfig[f]||this.els[f].classList.add("hidden");this.els.karyotypeButton.checked=!this.karyotypePanelConfig.hidden,this.els.chromosomeButton.checked=!this.chromosomePanelConfig.hidden,this.els.regionButton.checked=!this.regionPanelConfig.hidden,this.els.menuButton.addEventListener("click",function(b){a.trigger("menuButton:click",{clickEvent:b,sender:{}})}),this.els.leftSideButton.addEventListener("click",function(b){a.trigger("leftSideButton:click",{clickEvent:b,sender:{}})}),this.els.restoreDefaultRegionButton.addEventListener("click",function(b){a.trigger("restoreDefaultRegion:click",{clickEvent:b,sender:{}})}),this._addRegionHistoryMenuItem(this.region),this._setChromosomeMenu(),this._setSpeciesMenu(),this.els.chromosomesText.textContent=this.region.chromosome,this.els.speciesText.textContent=this.species.scientificName,this.els.karyotypeButton.addEventListener("click",function(){a.trigger("karyotype-button:change",{selected:this.checked,sender:a})}),this.els.chromosomeButton.addEventListener("click",function(){a.trigger("chromosome-button:change",{selected:this.checked,sender:a})}),this.els.regionButton.addEventListener("click",function(){a.trigger("region-button:change",{selected:this.checked,sender:a})}),this.els.zoomOutButton.addEventListener("click",function(){a._handleZoomOutButton()}),this.els.zoomInButton.addEventListener("click",function(){a._handleZoomInButton()}),this.els.zoomMaxButton.addEventListener("click",function(){a._handleZoomSlider(100)}),this.els.zoomMinButton.addEventListener("click",function(){a._handleZoomSlider(0)});var g=function(b){var c=a.els.progressBarCont,d=c.getBoundingClientRect(),e=b.clientX-d.left,f=100/parseInt(getComputedStyle(c).width)*e;f>0&&f<100&&(a.els.progressBarBall.style.left=f+"%")};this.els.progressBarCont.addEventListener("click",function(b){var c=this.getBoundingClientRect(),d=b.clientX-c.left,e=100/parseInt(getComputedStyle(this).width)*d;a._handleZoomSlider(e),this.removeEventListener("mousemove",g)}),this.els.progressBarBall.addEventListener("mousedown",function(b){a.els.progressBarCont.addEventListener("mousemove",g)}),this.els.progressBarBall.addEventListener("mouseleave",function(b){a.els.progressBarCont.removeEventListener("mousemove",g),a.els.progressBarBall.style.left=a.zoom+"%"}),this.els.regionField.value=this.region.toString(),this.els.regionField.addEventListener("keyup",function(b){a._checkRegion(this.value)&&13===b.which&&a._triggerRegionChange({region:new Region(this.value),sender:this})}),this.els.goButton.addEventListener("click",function(){var b=a.els.regionField.value;a._checkRegion(b)&&a._triggerRegionChange({region:new Region(b),sender:this})}),this.els.moveFurtherLeftButton.addEventListener("click",function(){a._handleMoveRegion(10)}),this.els.moveFurtherRightButton.addEventListener("click",function(){a._handleMoveRegion(-10)}),this.els.moveLeftButton.addEventListener("click",function(){a._handleMoveRegion(1)}),this.els.moveRightButton.addEventListener("click",function(){a._handleMoveRegion(-1)}),this.els.autoheightButton.addEventListener("click",function(){a.trigger("autoHeight-button:change",{selected:this.checked,sender:a})});var h="";this.els.searchField.addEventListener("keyup",function(b){this.classList.remove("error");var c=this.value;if(c.length>2&&h!==c&&13!==b.which&&(a._setQuickSearchMenu(c),h=c),13===b.which){var d=a.quickSearchDataset[c];d?a.trigger("quickSearch:select",{item:d,sender:a}):this.classList.add("error")}}),this.els.quickSearchButton.addEventListener("click",function(){a.els.searchField.classList.remove("error");var b=a.els.searchField.value,c=a.quickSearchDataset[b];c?a.trigger("quickSearch:go",{item:c,sender:a}):a.els.searchField.classList.add("error")}),this.els.windowSizeField.value=this.region.length(),this.els.windowSizeField.addEventListener("keyup",function(b){var c=this.value,d=/^([0-9])+$/;if(d.test(c)){if(this.classList.remove("error"),13===b.which){var e=parseInt(c),f=Math.floor(e/2),g=new Region({chromosome:a.region.chromosome,start:a.region.center()-f,end:a.region.center()+f});a._triggerRegionChange({region:g,sender:a})}}else this.classList.add("error")}),this.rendered=!0},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?void this.targetDiv.appendChild(this.div):void console.log("target not found")},_addRegionHistoryMenuItem:function(a){var b=this,c=document.createElement("li");c.textContent=a.toString(),this.els.regionHistoryMenu.appendChild(c),c.addEventListener("click",function(){b._triggerRegionChange({region:new Region(this.textContent),sender:b})})},_setQuickSearchMenu:function(a){if("function"==typeof this.quickSearchResultFn){for(;this.els.searchDataList.firstChild;)this.els.searchDataList.removeChild(this.els.searchDataList.firstChild);this.quickSearchDataset={};for(var b=this.quickSearchResultFn(a),c=0;c<b.length;c++){var d=b[c],e=d[this.quickSearchDisplayKey];this.quickSearchDataset[e]=d;var f=document.createElement("option");f.setAttribute("value",e),this.els.searchDataList.appendChild(f)}}else console.log("the quickSearchResultFn function is not valid")},_setChromosomeMenu:function(){for(var a=this;this.els.chromosomesMenu.firstChild;)this.els.chromosomesMenu.removeChild(this.els.chromosomesMenu.firstChild);var b=[];for(var c in this.species.chromosomes){b.push(c);var d=document.createElement("li");d.textContent=c,this.els.chromosomesMenu.appendChild(d),d.addEventListener("click",function(){var b=new Region({chromosome:this.textContent,start:a.region.start,end:a.region.end});a._triggerRegionChange({region:b,sender:a})})}this.currentChromosomeList=b},_setSpeciesMenu:function(){var a=this,b=function(b,c){var d=document.createElement("li");d.textContent=b.scientificName+" ("+b.assembly.name+")",c.appendChild(d),d.addEventListener("click",function(){a.trigger("species:change",{species:b,sender:a})})},c=function(b){var c=document.createElement("li");c.setAttribute("data-sub",!0),c.textContent=b,a.els.speciesMenu.appendChild(c);var d=document.createElement("ul");return c.appendChild(d),d};for(var d in this.availableSpecies)for(var e=c(d),f=0;f<this.availableSpecies[d].length;f++){var g=this.availableSpecies[d][f];b(g,e)}},_checkRegion:function(a){var b=new Region(a);return!b.parse(a)||b.start<0||b.end<0||_.indexOf(this.currentChromosomeList,b.chromosome)==-1?(this.els.regionField.classList.add("error"),!1):(this.els.regionField.classList.remove("error"),!0)},_handleZoomOutButton:function(){this._handleZoomSlider(Math.max(0,this.zoom-5))},_handleZoomSlider:function(a){var b=this;b.zoomChanging||(b.zoomChanging=!0,b.zoom=5*Math.round(a/5),b.trigger("zoom:change",{zoom:b.zoom,sender:b}),setTimeout(function(){b.zoomChanging=!1},700))},_handleZoomInButton:function(){this._handleZoomSlider(Math.min(100,this.zoom+5))},_handleMoveRegion:function(a){var b=(this.width-this.svgCanvasWidthOffset)/this.region.length(),c=Math.round(10*a/b);this.region.start-=c,this.region.end-=c,this.els.regionField.value=this.region.toString(),this.trigger("region:move",{region:this.region,disp:c,sender:this})},setVisible:function(a){for(key in a){var b=this.els[key];a[key]?b.classList.remove("hidden"):b.classList.add("hidden")}},setRegion:function(a,b){this.region.load(a),b&&(this.zoom=5*Math.round(b/5)),this.updateRegionControls(),this._addRegionHistoryMenuItem(a)},moveRegion:function(a){this.region.load(a),this.els.chromosomesText.textContent=this.region.chromosome,this.els.regionField.value=this.region.toString()},setSpecies:function(a){this.species=a,this.els.speciesText.textContent=this.species.scientificName,this._setChromosomeMenu()},setWidth:function(a){this.width=a},_triggerRegionChange:function(a){var b=this;this.regionChanging?this.updateRegionControls():(this.regionChanging=!0,this.trigger("region:change",a),setTimeout(function(){b.regionChanging=!1},700))},updateRegionControls:function(){this.els.chromosomesText.textContent=this.region.chromosome,this.els.regionField.value=this.region.toString(),this.els.windowSizeField.value=this.region.length(),this.els.regionField.classList.remove("error"),this.els.progressBar.style.width=this.zoom+"%",this.els.progressBarBall.style.left=this.zoom+"%"},setCellBaseHost:function(a){this.cellBaseHost=a}},ChromosomePanel.prototype={show:function(){$(this.div).css({display:"block"}),this.hidden=!1},hide:function(){$(this.div).css({display:"none"}),this.hidden=!0},setVisible:function(a){a?this.show():this.hide()},showContent:function(){$(this.svg).css({display:"inline"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("fa-plus"),$(this.collapseDiv).children().first().addClass("fa-minus")},hideContent:function(){$(this.svg).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("fa-minus"),$(this.collapseDiv).children().first().addClass("fa-plus")},setTitle:function(a){"titleDiv"in this&&$(this.titleTextDiv).html(a)},setWidth:function(a){this.width=a,this.svg.setAttribute("width",a),"undefined"!=typeof this.data&&(this.clean(),this._drawSvg(this.data))},render:function(){var a=this;if(this.div=$('<div id="chromosome-panel"></div>')[0],"title"in this&&""!==this.title){var b=$('<div id="tl-title" class="ocb-gv-panel-title unselectable"></div>')[0];$(this.div).append(b),1==this.collapsible&&(this.collapseDiv=$('<div class="ocb-gv-panel-collapse-control"><span class="fa fa-minus"></span></div>'),$(b).dblclick(function(){a.collapsed?a.showContent():a.hideContent()}),$(this.collapseDiv).click(function(){a.collapsed?a.showContent():a.hideContent()}),$(b).append(this.collapseDiv)),this.titleTextDiv=$('<div class="ocb-gv-panel-text">'+this.title+"</div>"),$(b).append(this.titleTextDiv)}this.svg=SVG.init(this.div,{width:this.width,height:this.height}),$(this.div).addClass("unselectable"),this.colors={gneg:"#eeeeee",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue",clementina:"#ffc967"},this.setVisible(!this.hidden),this.rendered=!0},setSpecies:function(a){this.species=a},clean:function(){$(this.svg).empty()},draw:function(){var a=this;return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),this.clean(),CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",query:this.region.chromosome,resource:"info",async:!1,success:function(b){a.data=b.response[0].result[0].chromosomes[0],a.data.cytobands.sort(function(a,b){return a.start-b.start}),a._drawSvg(a.data)}}),this.lastChromosome=this.region.chromosome,void(this.collapsed&&a.hideContent())):void console.log("target not found")},_drawSvg:function(a){var b=this,c=20,d=SVG.addChild(b.svg,"g",{cursor:"pointer"});this.chromosomeLength=a.size,this.pixelBase=(this.width-40)/this.chromosomeLength;for(var e=(SVG.addChild(d,"rect",{x:c,y:4,width:this.width-40+1,height:22,fill:"#555555"}),{}),f=c,g=0;g<a.cytobands.length;g++){var h=a.cytobands[g];h.pixelStart=h.start*this.pixelBase,h.pixelEnd=h.end*this.pixelBase,h.pixelSize=h.pixelEnd-h.pixelStart,"undefined"==typeof e[h.stain]&&(e[h.stain]=[]),e[h.stain].push(h);var i=f+h.pixelSize/2,j=28,k=SVG.addChild(d,"text",{x:i,y:j,"font-size":10,transform:"rotate(90, "+i+", "+j+")",fill:"black"});k.textContent=h.name,f+=h.pixelSize}for(var l in e){var m="";if("acen"!=l){for(var n=0;n<e[l].length;n++){var h=e[l][n];m+="M"+(h.pixelStart+c+1)+",15 L"+(h.pixelEnd+c)+",15 "}SVG.addChild(d,"path",{d:m,stroke:this.colors[l],"stroke-width":20,fill:"none"})}}if("undefined"!=typeof e.acen){var o=e.acen[0],p=e.acen[1],q=(SVG.addChild(d,"rect",{x:o.pixelStart+c+1,y:4,width:p.pixelEnd+c-(o.pixelStart+c+1),height:22,fill:"white"}),o.pixelStart+c+1),r=o.pixelEnd+c,s=p.pixelStart+c+1,t=p.pixelEnd+c;SVG.addChild(d,"path",{d:"M"+q+",4 L"+(r-5)+",4  L"+r+",15  L "+(r-5)+",26  L "+q+",26 z",fill:this.colors.acen}),SVG.addChild(d,"path",{d:"M"+s+",15 L"+(s+5)+",4  L"+t+",4  L "+t+",26  L "+(s+5)+",26 z",fill:this.colors.acen})}var u="",v=b.region.center(),w=v*b.pixelBase+c;$(this.svg).on("mousedown",function(a){u="setRegion"}),this.selBox=SVG.addChild(this.svg,"rect",{x:0,y:2,"stroke-width":"2",stroke:"deepskyblue",opacity:"0.5",fill:"honeydew"});var x=b.region.length()*b.pixelBase,y=SVG.addChild(d,"g");this.positionBox=SVG.addChild(y,"rect",{x:w-x/2,y:2,width:x,height:b.height-3,stroke:"orangered","stroke-width":2,opacity:.5,fill:"navajowhite",cursor:"move"}),$(this.positionBox).on("mousedown",function(a){u="movePositionBox"}),this.resizeLeft=SVG.addChild(y,"rect",{x:w-x/2,y:2,width:7,height:b.height-3,opacity:.5,fill:"orangered",visibility:"hidden"}),$(this.resizeLeft).on("mousedown",function(a){u="resizePositionBoxLeft"}),this.resizeRight=SVG.addChild(y,"rect",{x:x-5,y:2,width:7,height:b.height-3,opacity:.5,fill:"orangered",visibility:"hidden"}),$(this.resizeRight).on("mousedown",function(a){u="resizePositionBoxRight"}),$(this.positionBox).off("mouseenter"),$(this.positionBox).off("mouseleave"),$(y).mouseenter(function(a){b._recalculateResizeControls(),b._showResizeControls()}),$(y).mouseleave(function(a){b._hideResizeControls()}),$(this.svg).off("contextmenu"),$(this.svg).off("mousedown"),$(this.svg).off("mouseup"),$(this.svg).off("mousemove"),$(this.svg).off("mouseleave"),$(this.svg).contextmenu(function(a){a.preventDefault()});var z,A,B;$(this.svg).mousedown(function(a){z=a.clientX-$(this).parent().offset().left,b.selBox.setAttribute("x",z),B=b.positionBox.getAttribute("x"),""==u&&(u="setRegion"),b._hideResizeControls(),$(this).mousemove(function(a){switch(A=a.clientX-$(this).parent().offset().left,b._hideResizeControls(),u){case"resizePositionBoxLeft":var c=A-z,d=parseInt(b.positionBox.getAttribute("width"))-c;d>0&&(b.positionBox.setAttribute("x",parseInt(b.positionBox.getAttribute("x"))+c),b.positionBox.setAttribute("width",d)),z=A;break;case"resizePositionBoxRight":var c=A-z,d=parseInt(b.positionBox.getAttribute("width"))+c;d>0&&b.positionBox.setAttribute("width",d),z=A;break;case"movePositionBox":var c=A-z;b.positionBox.setAttribute("x",parseInt(b.positionBox.getAttribute("x"))+c),z=A;break;case"setRegion":case"selectingRegion":u="selectingRegion",A<z&&b.selBox.setAttribute("x",A),b.selBox.setAttribute("width",Math.abs(A-z)),b.selBox.setAttribute("height",b.height-3)}})}),$(this.svg).mouseup(function(a){if($(this).off("mousemove"),null!=z){switch(u){case"resizePositionBoxLeft":case"resizePositionBoxRight":case"movePositionBox":if(null!=A){var d=parseInt(b.positionBox.getAttribute("width")),e=parseInt(b.positionBox.getAttribute("x")),f=e,g=e+d,h=(f-c)/b.pixelBase,i=(g-c)/b.pixelBase;b._triggerRegionChange({region:new Region({chromosome:b.region.chromosome,start:h,end:i}),sender:b})}break;case"setRegion":if(z>c&&z<b.width-c){var d=b.positionBox.getAttribute("width"),f=z-d/2,g=z+d/2,h=(f-c)/b.pixelBase,i=(g-c)/b.pixelBase;b._triggerRegionChange({region:new Region({chromosome:b.region.chromosome,start:h,end:i}),sender:b})}break;case"selectingRegion":var h=(z-c)/b.pixelBase,i=(A-c)/b.pixelBase,j=Math.min(h,i),k=Math.max(h,i);b.selBox.setAttribute("width",0),b.selBox.setAttribute("height",0),b._triggerRegionChange({region:new Region({chromosome:b.region.chromosome,start:j,end:k}),sender:b})}u=""}z=null,A=null,B=b.positionBox.getAttribute("x")}),$(this.svg).mouseleave(function(a){$(this).off("mousemove"),null!=B&&b.positionBox.setAttribute("x",B),b.selBox.setAttribute("width",0),b.selBox.setAttribute("height",0),z=null,A=null,B=null,overPositionBox=!1,movingPositionBox=!1,selectingRegion=!1})},_triggerRegionChange:function(a){var b=this;this.regionChanging?this.updateRegionControls():(this.regionChanging=!0,this._limitRegionToChromosome(a.region),this.trigger("region:change",a),setTimeout(function(){b.regionChanging=!1},700))},_recalculatePositionBox:function(a){var b=a.length(),c=b*this.pixelBase,d=a.start*this.pixelBase+20;this.positionBox.setAttribute("x",d),this.positionBox.setAttribute("width",c)},_recalculateSelectionBox:function(a){var b=a.length(),c=b*this.pixelBase,d=a.start*this.pixelBase+20;this.selBox.setAttribute("x",d),this.selBox.setAttribute("width",c)},_recalculateResizeControls:function(){var a=parseInt(this.positionBox.getAttribute("x")),b=parseInt(this.positionBox.getAttribute("width"));this.resizeLeft.setAttribute("x",a-5),this.resizeRight.setAttribute("x",a+b),$(this.resizeLeft).css({cursor:"ew-resize"}),$(this.resizeRight).css({cursor:"ew-resize"})},_hideResizeControls:function(){this.resizeLeft.setAttribute("visibility","hidden"),this.resizeRight.setAttribute("visibility","hidden")},_showResizeControls:function(){this.resizeLeft.setAttribute("visibility","visible"),this.resizeRight.setAttribute("visibility","visible")},_limitRegionToChromosome:function(a){a.start=a.start<1?1:a.start,a.end=a.end>this.chromosomeLength?this.chromosomeLength:a.end},updateRegionControls:function(){this.selBox.setAttribute("width",0),this.selBox.setAttribute("height",0),this._recalculatePositionBox(this.region),this._recalculateResizeControls()},setRegion:function(a){console.log("region modified chromosome"),this.region.load(a);var b=!1;this.lastChromosome!=this.region.chromosome&&(b=!0),b&&this.draw(),this.updateRegionControls()},setCellBaseHost:function(a){this.cellBaseHost=a}},KaryotypePanel.prototype={show:function(){$(this.div).css({display:"block"}),this.hidden=!1},hide:function(){$(this.div).css({display:"none"}),this.hidden=!0},setVisible:function(a){a?this.show():this.hide()},showContent:function(){$(this.svg).css({display:"inline"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("fa-plus"),$(this.collapseDiv).children().first().addClass("fa-minus")},hideContent:function(){$(this.svg).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("fa-minus"),$(this.collapseDiv).children().first().addClass("fa-plus")},setTitle:function(a){"titleDiv"in this&&$(this.titleTextDiv).html(a)},setWidth:function(a){this.width=a,this.svg.setAttribute("width",a),"undefined"!=typeof this.chromosomeList&&(this.clean(),this._drawSvg(this.chromosomeList,this.data2))},render:function(){var a=this;if(this.div=$('<div id="karyotype-panel"></div>')[0],"title"in this&&""!==this.title){var b=$('<div id="tl-title" class="ocb-gv-panel-title unselectable"></div>')[0];$(this.div).append(b),1==this.collapsible&&(this.collapseDiv=$('<div class="ocb-gv-panel-collapse-control"><span class="fa fa-minus"></span></div>'),$(b).dblclick(function(){a.collapsed?a.showContent():a.hideContent()}),$(this.collapseDiv).click(function(){a.collapsed?a.showContent():a.hideContent()}),$(b).append(this.collapseDiv)),this.titleTextDiv=$('<div class="ocb-gv-panel-text">'+this.title+"</div>"),$(b).append(this.titleTextDiv)}this.svg=SVG.init(this.div,{width:this.width,height:this.height}),this.markGroup=SVG.addChild(this.svg,"g",{cursor:"pointer"}),$(this.div).addClass("unselectable"),this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"},this.setVisible(!this.hidden),this.rendered=!0},setSpecies:function(a){this.lastSpecies=this.species,this.species=a},clean:function(){$(this.svg).empty()},draw:function(){var a=this;if(this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),!this.targetDiv)return void console.log("target not found");this.targetDiv.appendChild(this.div),this.clean();var b=function(a,b){for(var c=!0,d=0;d<a.name.length&&1==c;d++)isNaN(a.name[d])&&(c=!1);return c?a.name-b.name:1};CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",resource:"all",async:!1,success:function(c){a.chromosomeList=c.response[0].result[0].chromosomes,a.chromosomeList.sort(b),a._drawSvg(a.chromosomeList)}}),this.collapsed&&a.hideContent()},_drawSvg:function(a){for(var b=this,c=20,d=b.width/a.length,e=2,f=0,g=0,h=a.length;g<h;g++){var i=a[g].size;i>f&&(f=i)}b.pixelBase=(b.height-10)/f,b.chrOffsetY={},b.chrOffsetX={};for(var g=0,h=a.length;g<h;g++){var j=a[g],k=j.size*b.pixelBase,l=e+f*b.pixelBase-k;b.chrOffsetY[j.name]=l;var m=!0,n=SVG.addChild(b.svg,"g",{cursor:"pointer",chr:j.name});$(n).click(function(a){var c=this.getAttribute("chr"),d=a.pageY-$(b.svg).offset().top,e=parseInt((d-b.chrOffsetY[c])/b.pixelBase),f=new Region({
chromosome:c,start:e,end:e});b._triggerRegionChange({region:f,sender:b})});for(var o=0,p=j.cytobands.length;o<p;o++){var q=j.cytobands[o],r=b.pixelBase*(q.end-q.start),s=13,t=b.colors[q.stain];if(null==t&&(t="purple"),"acen"==q.stain){var u="",v=c+s/2,w=l+r/2,x=c+s,y=l+r;m?(u=c+","+l+" "+x+","+l+" "+x+","+w+" "+v+","+y+" "+c+","+w,m=!1):u=c+","+y+" "+c+","+w+" "+v+","+l+" "+x+","+w+" "+x+","+y,SVG.addChild(n,"polyline",{points:u,stroke:"black",opacity:.8,fill:t})}else SVG.addChild(n,"rect",{x:c,y:l,width:s,height:r,stroke:"grey",opacity:.8,fill:t});l+=r}var z=SVG.addChild(b.svg,"text",{x:c+1,y:b.height,"font-size":9,fill:"black"});z.textContent=j.name,b.chrOffsetX[j.name]=c,c+=d}this.positionBox=SVG.addChild(this.svg,"line",{x1:0,y1:0,x2:0,y2:0,stroke:"orangered","stroke-width":2,opacity:.5}),this._recalculatePositionBox(this.region),this.rendered=!0,this.trigger("after:render",{sender:this})},_triggerRegionChange:function(a){var b=this;this.regionChanging?this.updateRegionControls():(this.regionChanging=!0,this.trigger("region:change",a),setTimeout(function(){b.regionChanging=!1},700))},_recalculatePositionBox:function(a){var b=a.center(),c=b*this.pixelBase+this.chrOffsetY[a.chromosome];this.positionBox.setAttribute("x1",this.chrOffsetX[a.chromosome]-10),this.positionBox.setAttribute("x2",this.chrOffsetX[a.chromosome]+23),this.positionBox.setAttribute("y1",c),this.positionBox.setAttribute("y2",c)},updateRegionControls:function(){this._recalculatePositionBox(this.region)},setRegion:function(a){this.region.load(a);var b=!1;this.lastSpecies!=this.species&&(b=!0,this.lastSpecies=this.species),b&&this.draw(),this.updateRegionControls()},addMark:function(a){var b=this,c=function(){if(null!=b.region.chromosome&&null!=b.region.start&&null!=b.chrOffsetX[b.region.chromosome]){var a=b.chrOffsetX[b.region.chromosome]-10,c=b.chrOffsetX[b.region.chromosome],d=b.region.start*b.pixelBase+b.chrOffsetY[b.region.chromosome]-4,e=b.region.start*b.pixelBase+b.chrOffsetY[b.region.chromosome],f=b.region.start*b.pixelBase+b.chrOffsetY[b.region.chromosome]+4,g=a+","+d+" "+c+","+e+" "+a+","+f+" "+a+","+d;SVG.addChild(b.markGroup,"polyline",{points:g,stroke:"black",opacity:.8,fill:"#33FF33"})}};this.rendered?c():b.on("after:render",function(a){c()})},unmark:function(){$(this.markGroup).empty()},setCellBaseHost:function(a){this.cellBaseHost=a}},StatusBar.prototype={render:function(){this.div=$('<div id="'+this.id+'" class="ocb-gv-status-bar"></div>')[0],this.rightDiv=$('<div class="ocb-gv-status-right" id="'+this.id+'position"</div>')[0],this.leftDiv=$('<div class="ocb-gv-status-left" id="'+this.id+'position"></div>')[0],$(this.div).append(this.leftDiv),$(this.div).append(this.rightDiv),this.mousePositionEl=$('<span id="'+this.id+'position"></span>')[0],this.mousePositionBase=document.createElement("span"),this.mousePositionBase.style.marginRight="5px",this.mousePositionRegion=document.createElement("span"),this.mousePositionEl.appendChild(this.mousePositionBase),this.mousePositionEl.appendChild(this.mousePositionRegion),this.versionEl=$('<span id="'+this.id+'version">'+this.version+"</span>")[0],$(this.rightDiv).append(this.mousePositionEl),$(this.leftDiv).append(this.versionEl),this.rendered=!0},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?void this.targetDiv.appendChild(this.div):void console.log("target not found")},setRegion:function(a){this.region.load(a.region),this.mousePositionBase.textContent="",this.mousePositionRegion.textContent=this.region.chromosome+":"+Utils.formatNumber(a.region.center())},setMousePosition:function(a){this.mousePositionBase.style.color=SEQUENCE_COLORS[a.base],this.mousePositionBase.textContent=a.base,this.mousePositionRegion.textContent=this.region.chromosome+":"+Utils.formatNumber(a.mousePos)}},TrackListPanel.prototype={show:function(){$(this.div).css({display:"block"}),this.hidden=!1},hide:function(){$(this.div).css({display:"none"}),this.hidden=!0},setVisible:function(a){a?this.show():this.hide()},setTitle:function(a){"titleDiv"in this&&$(this.titleDiv).html(a)},showContent:function(){$(this.tlHeaderDiv).css({display:"block"}),$(this.panelDiv).css({display:"block"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("fa-plus"),$(this.collapseDiv).children().first().addClass("fa-minus")},hideContent:function(){$(this.tlHeaderDiv).css({display:"none"}),$(this.panelDiv).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("fa-minus"),$(this.collapseDiv).children().first().addClass("fa-plus")},render:function(){var a=this;if(this.div=document.createElement("div"),this.div.classList.add("ocb-gv-tracklist"),this.windowSizeDiv=document.createElement("div"),this.windowSizeDiv.classList.add("ocb-gv-tracklist-windowsize"),"title"in this&&""!==this.title){var b=document.createElement("div");if(b.classList.add("ocb-gv-panel-title","unselectable"),b.appendChild(this.windowSizeDiv),1==this.collapsible){this.collapseDiv=document.createElement("div"),this.collapseDiv.classList.add("ocb-gv-panel-collapse-control");var c=document.createElement("span");c.classList.add("fa","fa-minus"),this.collapseDiv.appendChild(c),$(b).dblclick(function(){a.collapsed?a.showContent():a.hideContent()}),$(this.collapseDiv).click(function(){a.collapsed?a.showContent():a.hideContent()}),b.appendChild(this.collapseDiv)}var d=document.createElement("div");d.classList.add("ocb-gv-panel-text"),d.textContent=this.title,b.appendChild(d),this.div.appendChild(b)}var e=$('<div id="tl-header" class="unselectable"></div>')[0],f=$('<div id="tl-panel"></div>')[0];$(f).css({position:"relative",width:"100%"}),this.tlTracksDiv=$('<div id="tl-tracks"></div>')[0],$(this.tlTracksDiv).css({position:"relative","z-index":3}),$(this.div).append(e),$(this.div).append(f),$(f).append(this.tlTracksDiv),this.positionDiv=document.createElement("div"),this.positionDiv.classList.add("ocb-gv-tracklist-position"),this.positionLeftDiv=document.createElement("div"),this.positionLeftDiv.classList.add("ocb-gv-tracklist-position-left"),this.positionNucleotidDiv=document.createElement("div"),this.positionNucleotidDiv.classList.add("ocb-gv-tracklist-position-mid-nt"),this.positionMidPosDiv=document.createElement("div"),this.positionMidPosDiv.classList.add("ocb-gv-tracklist-position-mid-pos"),this.positionMidDiv=document.createElement("div"),this.positionMidDiv.classList.add("ocb-gv-tracklist-position-mid"),this.positionRightDiv=document.createElement("div"),this.positionRightDiv.classList.add("ocb-gv-tracklist-position-right"),this.positionDiv.appendChild(this.positionLeftDiv),this.positionDiv.appendChild(this.positionNucleotidDiv),this.positionMidDiv.appendChild(this.positionNucleotidDiv),this.positionMidDiv.appendChild(this.positionMidPosDiv),this.positionDiv.appendChild(this.positionMidDiv),this.positionDiv.appendChild(this.positionRightDiv),e.appendChild(this.positionDiv);var g=this.width/2;this._setTextPosition(),this.centerLine=$('<div id="'+this.id+'centerLine"></div>')[0],$(f).append(this.centerLine),$(this.centerLine).css({"z-index":2,position:"absolute",left:g-1,top:0,width:Math.floor(this.pixelBase),height:"calc(100% - 8px)",opacity:.5,border:"1px solid orangered","background-color":"orange"}),this.mouseLine=$('<div id="'+this.id+'mouseLine"></div>')[0],$(f).append(this.mouseLine),$(this.mouseLine).css({"z-index":1,position:"absolute",left:-20.5,top:0,width:Math.floor(this.pixelBase),height:"calc(100% - 8px)",border:"1px solid gray",opacity:.7,visibility:"hidden","background-color":"gainsboro"});var h=$('<div id="'+this.id+'selBox"></div>')[0];if($(f).append(h),$(h).css({"z-index":0,position:"absolute",left:0,top:0,height:"100%",border:"2px solid deepskyblue",opacity:.5,visibility:"hidden","background-color":"honeydew"}),this.showRegionOverviewBox){var i=$('<div id="'+this.id+'regionOverviewBoxLeft"></div>')[0],j=$('<div id="'+this.id+'regionOverviewBoxRight"></div>')[0];$(f).append(i),$(f).append(j);var k=this.region.length()*this.pixelBase,l=(this.width-k)/2;$(i).css({"z-index":0,position:"absolute",left:1,top:0,width:l,height:"calc(100% - 8px)",opacity:.5,"background-color":"lightgray"}),$(j).css({"z-index":0,position:"absolute",left:l+k,top:0,width:l,height:"calc(100% - 8px)",opacity:.5,"background-color":"lightgray"}),this.regionOverviewBoxLeft=i,this.regionOverviewBoxRight=j}$(this.div).mousemove(function(b){var c=a.region.center(),d=a.width/2,e=a.pixelBase/2,f=b.clientX-a.tlTracksDiv.getBoundingClientRect().left,g=f-e,h=g/a.pixelBase|0,i=h*a.pixelBase+d%a.pixelBase-1;$(a.mouseLine).css({left:i});var j=d/a.pixelBase|0;a.mousePosition=c+h-j,a.trigger("mousePosition:change",{mousePos:a.mousePosition,chromosome:a.region.chromosome,base:a.getMousePosition(a.mousePosition)})}),$(this.tlTracksDiv).dblclick(function(b){if(!a.regionChanging){a.regionChanging=!0;var c=a.region.length()/2,d=new Region({chromosome:a.region.chromosome,start:a.mousePosition-c,end:a.mousePosition+c});a.trigger("region:change",{region:d,sender:a}),setTimeout(function(){a.regionChanging=!1},700)}});var m,n;$(this.tlTracksDiv).mousedown(function(b){$("html").addClass("unselectable"),$(a.mouseLine).css({visibility:"hidden"});var c=b.which;switch(b.ctrlKey&&(c="ctrlKey"+b.which),c){case 1:$(this).css({cursor:"move"}),m=b.clientX;var d=0;$(this).mousemove(function(b){var c=(m-b.clientX)/a.pixelBase|0;if(c!=d){var e=d-c,f=a.region.center(),g=f-e;g>0&&(a.region.start-=e,a.region.end-=e,a._setTextPosition(),a.trigger("region:move",{region:a.region,disp:e,sender:a}),a.trigger("trackRegion:move",{region:a.region,disp:e,sender:a}),d=c)}});break;case 2:case"ctrlKey1":$(h).css({visibility:"visible"}),$(h).css({width:0}),m=b.pageX-$(a.tlTracksDiv).offset().left,$(h).css({left:m}),$(this).mousemove(function(b){n=b.pageX-$(a.tlTracksDiv).offset().left,n<m&&$(h).css({left:n}),$(h).css({width:Math.abs(n-m)})});break;case 3:}}),$(this.tlTracksDiv).mouseup(function(b){$("html").removeClass("unselectable"),$(this).css({cursor:"default"}),$(a.mouseLine).css({visibility:"visible"}),$(this).off("mousemove");var c=b.which;switch(b.ctrlKey&&(c="ctrlKey"+b.which),c){case 1:break;case 2:case"ctrlKey1":if($(h).css({visibility:"hidden"}),$(this).off("mousemove"),null!=m&&null!=n){var d=m/a.pixelBase,e=n/a.pixelBase;d+=a.visualRegion.start,e+=a.visualRegion.start,a.region.start=parseInt(Math.min(d,e)),a.region.end=parseInt(Math.max(d,e)),a.trigger("region:change",{region:a.region,sender:a}),n=null}else if(null!=m&&null==n){var f=new Region({chromosome:a.region.chromosome,start:a.mousePosition,end:a.mousePosition});a.trigger("region:change",{region:f,sender:a})}break;case 3:}}),$(this.tlTracksDiv).mouseleave(function(b){$(this).css({cursor:"default"}),$(a.mouseLine).css({visibility:"hidden"}),$(this).off("mousemove"),$("body").off("keydown.genomeViewer"),$(h).css({visibility:"hidden"}),m=null,n=null}),$(this.tlTracksDiv).mouseenter(function(b){$(a.mouseLine).css({visibility:"visible"}),$("body").off("keydown.genomeViewer"),o()});var o=function(){$("body").bind("keydown.genomeViewer",function(b){var c=0;switch(b.keyCode){case 37:c=b.ctrlKey?Math.round(100/a.pixelBase):Math.round(10/a.pixelBase);break;case 39:c=b.ctrlKey?Math.round(-100/a.pixelBase):Math.round(-10/a.pixelBase)}0!=c&&(a.region.start-=c,a.region.end-=c,a._setTextPosition(),a.trigger("region:move",{region:a.region,disp:c,sender:a}),a.trigger("trackRegion:move",{region:a.region,disp:c,sender:a}))})};this.tlHeaderDiv=e,this.panelDiv=f,this.setVisible(!this.hidden),this.rendered=!0},setHeight:function(a){},setWidth:function(a){console.log("trackListPanel setWidth ------> "+a),this.width=a-18},highlight:function(a){this.trigger("trackFeature:highlight",a)},moveRegion:function(a){this.region.load(a.region),this.visualRegion.load(a.region),this._setTextPosition(),this.trigger("trackRegion:move",a)},setSpecies:function(a){this.species=a;for(var b=0;b<this.tracks.length;b++){var c=this.tracks[b];c.setSpecies(this.species)}},setRegion:function(a){console.log("trackListPanel setRegion region ------> "+a),console.log("trackListPanel setRegion width ------> "+this.width);var b=this.width/2;if(this.region.load(a),this.visualRegion.load(a),this._setPixelBase(),$(this.centerLine).css({left:b-1,width:this.pixelBase}),$(this.mouseLine).css({width:this.pixelBase}),this._setTextPosition(),this.showRegionOverviewBox){var c=this.region.length()*this.pixelBase,d=(this.width-c)/2;$(this.regionOverviewBoxLeft).css({width:d}),$(this.regionOverviewBoxRight).css({left:d+c,width:d})}this.trigger("window:size",{windowSize:this.windowSize}),this.trigger("trackRegion:change",{region:this.visualRegion,sender:this}),this.positionNucleotidDiv.textContent="",this.status="rendering"},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.trigger("track:draw",{sender:this})):void console.log("target not found")},_checkAllTrackStatus:function(a){for(var b=0;b<this.tracks.length;b++){var c=this.tracks[b];if(c.status!=a)return!1}return!0},checkTracksReady:function(){return this._checkAllTrackStatus("ready")},addTrack:function(a){if(_.isArray(a))for(var b in a)this._addTrack(a[b]);else this._addTrack(a)},_addTrack:function(a){if(!this.rendered)return void console.info(this.id+" is not rendered yet");var b=this;if(null==a)return!1;if(this.containsTrack(a))return!1;var c=this.tracks.push(a),d=c-1;this.tracksIndex[a.id]=d,"undefined"==typeof a.dataAdapter.host&&(a.dataAdapter.host=this.cellBaseHost),"undefined"==typeof a.dataAdapter.version&&(a.dataAdapter.version=this.cellBaseVersion),a.set("pixelBase",this.pixelBase),a.set("region",this.visualRegion),a.set("width",this.width),a.setSpecies(this.species),a.set("trackListPanel",this),a.rendered||a.render(this.tlTracksDiv),a.draw(),a.set("track:draw",function(b){a.draw()}),a.set("trackRegion:change",function(c){console.log("trackListPanel trackRegion:change region ------> "+c.region),console.log("trackListPanel trackRegion:change width ------> "+b.width),a.setWidth(b.width),a.set("pixelBase",b.pixelBase),a.set("region",c.region),a.draw()}),a.set("trackRegion:move",function(c){a.set("region",c.region),a.set("pixelBase",b.pixelBase),a.move(c.disp)}),a.set("trackFeature:highlight",function(b){var c=b.attrName||"feature_id";if("attrValue"in b){b.attrValue=$.isArray(b.attrValue)?b.attrValue:[b.attrValue];for(var d in b.attrValue){var e=c+"~="+b.attrValue[d],f=$(a.svgdiv).find("g["+e+"]");$(f).each(function(){var b=$(this).find("animate");b=0==b.length?SVG.addChild(this,"animate",{attributeName:"opacity",attributeType:"XML",begin:"indefinite",from:"0.0",to:"1",begin:"0s",dur:"0.5s",repeatCount:"5"}):b[0];var c=$(f).find("rect").attr("y");$(a.svgdiv).scrollTop(c),b.beginElement()})}}}),a.on("track:close",function(a){b.removeTrack(a.sender)}),a.on("track:up",function(a){b._reallocateAbove(a.sender)}),a.on("track:down",function(a){b._reallocateUnder(a.sender)}),this.on("track:draw",a.get("track:draw")),this.on("trackRegion:change",a.get("trackRegion:change")),this.on("trackRegion:move",a.get("trackRegion:move")),this.on("trackFeature:highlight",a.get("trackFeature:highlight"))},toggleAutoHeight:function(a){for(var b=0;b<this.tracks.length;b++){var c=this.tracks[b];c.toggleAutoHeight(a)}},updateHeight:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];b.updateHeight(!0)}},containsTrack:function(a){return"undefined"!=typeof this.tracksIndex[a.id]},getTrackIndex:function(a){return this.tracksIndex[a.id]},_updateTracksIndex:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];this.tracksIndex[b.id]=a}},refreshTracksDom:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];$(b.div).detach(),$(this.tlTracksDiv).append(b.div)}this.trigger("tracks:refresh",{sender:this})},removeTrack:function(a){if(!this.containsTrack(a))return!1;this.hideTrack(a),a.remove();var b=this.getTrackIndex(a);return this.tracks.splice(b,1)[0],delete this.tracksIndex[a.id],this._updateTracksIndex(),a.off("track:close"),a.off("track:up"),a.off("track:down"),this.off("track:draw",a.get("track:draw")),this.off("trackRegion:change",a.get("trackRegion:change")),this.off("trackRegion:move",a.get("trackRegion:move")),this.off("trackFeature:highlight",a.get("trackFeature:highlight")),this.refreshTracksDom(),a},restoreTrack:function(a,b){return!this.containsTrack(a)&&(this.addTrack(a),"undefined"!=typeof b&&this.setTrackIndex(a,b),a.show(),void this.refreshTracksDom())},_reallocateAbove:function(a){if(!this.containsTrack(a))return!1;var b=this.getTrackIndex(a);if(console.log(b+" wants to move up"),b>0){var c=this.tracks[b-1],d=this.tracks[b];this.tracks[b]=c,this.tracks[b-1]=d,this.tracksIndex[c.id]=b,this.tracksIndex[d.id]=b-1,this.refreshTracksDom()}else console.log("is at top")},_reallocateUnder:function(a){if(!this.containsTrack(a))return!1;var b=this.getTrackIndex(a);if(console.log(b+" wants to move down"),b+1<this.tracks.length){var c=this.tracks[b],d=this.tracks[b+1];this.tracks[b]=d,this.tracks[b+1]=c,this.tracksIndex[d.id]=b,this.tracksIndex[c.id]=b+1,this.refreshTracksDom()}else console.log("is at bottom")},setTrackIndex:function(a,b){if(!this.containsTrack(a))return!1;var c=this.getTrackIndex(a);this.tracks.splice(c,1)[0],this.tracks.splice(b,0,a),this._updateTracksIndex(),this.refreshTracksDom()},swapTracks:function(a,b){if(!this.containsTrack(a))return!1;if(!this.containsTrack(b))return!1;var c=this.getTrackIndex(a),d=this.getTrackIndex(b);this.tracks[c]=b,this.tracks[d]=a,this.tracksIndex[a.id]=d,this.tracksIndex[b.id]=c,this.refreshTracksDom()},scrollToTrack:function(a){if(!this.containsTrack(a))return!1;var b=$(a.div).position().top;$(this.tlTracksDiv).scrollTop(b)},hideTrack:function(a){return!!this.containsTrack(a)&&(a.hide(),void this.refreshTracksDom())},showTrack:function(a){return!!this.containsTrack(a)&&(a.show(),void this.refreshTracksDom())},_setPixelBase:function(){this.pixelBase=this.width/this.region.length(),this.pixelBase=this.pixelBase/this.zoomMultiplier,this.halfVirtualBase=3*this.width/2/this.pixelBase},_setTextPosition:function(){var a=this.region.center(),b=parseInt(this.width/this.pixelBase),c=Math.ceil(b/2-1);this.visualRegion.start=Math.floor(a-c),this.visualRegion.end=Math.floor(a+c),this.positionMidPosDiv.textContent=Utils.formatNumber(a),this.positionLeftDiv.textContent=Utils.formatNumber(this.visualRegion.start),this.positionRightDiv.textContent=Utils.formatNumber(this.visualRegion.end),this.windowSize="Window size: "+Utils.formatNumber(this.visualRegion.length())+" nts",this.windowSizeDiv.innerHTML=this.windowSize},getTrackById:function(a){if("undefined"!=typeof this.tracksIndex[a]){var b=this.tracksIndex[a];return this.tracks[b]}},getSequenceTrack:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];if(b.renderer instanceof SequenceRenderer)return b}},getMousePosition:function(a){var b="";return a>0&&(b=this.getSequenceNucleotid(a)),b},getSequenceNucleotid:function(a){var b=this.getSequenceTrack();if(b){var c=b.svgCanvasFeatures.querySelector('text[data-pos="'+a+'"]');if(c)return c.textContent}return""},setNucleotidPosition:function(a){var b=this.getSequenceNucleotid(a);this.positionNucleotidDiv.style.color=SEQUENCE_COLORS[b],this.positionNucleotidDiv.textContent=b},setCellBaseHost:function(a){this.cellBaseHost=a;for(var b=0;b<this.tracks.length;b++){var c=this.tracks[b];c.dataAdapter instanceof CellBaseAdapter&&c.dataAdapter.setHost(this.cellBaseHost)}},deleteTracksCache:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];null!=b.dataAdapter.deleteCache&&b.dataAdapter.deleteCache()}}},Track.prototype={get:function(a){return this[a]},set:function(a,b){this[a]=b},hide:function(){this.visible=!1,this.div.classList.add("hidden")},show:function(){this.visible=!0,this.div.classList.remove("hidden"),this.updateHeight()},toggle:function(){this.visible?this.hide():this.show()},remove:function(){$(this.div).remove()},hideContent:function(){this.contentVisible=!1,this.contentDiv.classList.add("hidden"),this.resizeDiv.classList.add("hidden"),this.iToggleEl.classList.remove("fa-minus"),this.iToggleEl.classList.add("fa-plus")},showContent:function(){this.contentVisible=!0,this.contentDiv.classList.remove("hidden"),this.resizeDiv.classList.remove("hidden"),this.iToggleEl.classList.remove("fa-plus"),this.iToggleEl.classList.add("fa-minus"),this.updateHeight()},toggleContent:function(){this.contentVisible?this.hideContent():this.showContent()},close:function(){this.trigger("track:close",{sender:this})},up:function(){this.trigger("track:up",{sender:this})},down:function(){this.trigger("track:down",{sender:this})},setSpecies:function(a){this.species=a,this.dataAdapter.setSpecies(this.species)},setWidth:function(a){this._setWidth(a)},_setWidth:function(a){this.width=a},updateHeight:function(){this._updateHeight()},_updateHeight:function(){$(this.contentDiv).css({height:this.height+10})},enableAutoHeight:function(){console.log("enable autoHeigth"),this.autoHeight=!0,this.updateHeight()},disableAutoHeight:function(){console.log("disable autoHeigth"),this.autoHeight=!1,this.updateHeight()},toggleAutoHeight:function(a){return 1==a?void this.enableAutoHeight():0==a?void this.disableAutoHeight():1==this.autoHeight?void this.disableAutoHeight():0==this.autoHeight?void this.enableAutoHeight():void 0},setTitle:function(a){$(this.titleText).html(a)},setLoading:function(a){a?(this.status="rendering",$(this.loadingEl).html('&nbsp; &nbsp;<i class="fa fa-spinner fa-spin"></i> Loading...</span>')):(this.status="ready",$(this.loadingEl).html(""))},updateHistogramParams:function(){this.region.length()>this.minHistogramRegionSize?(this.histogram=!0,this.histogramLogarithm=!0,this.histogramMax=500,this.interval=Math.ceil(10/this.pixelBase),$(this.histogramEl).html('&nbsp;<i class="fa fa-signal"></i>')):(this.histogram=void 0,this.histogramLogarithm=void 0,this.histogramMax=void 0,this.interval=void 0,$(this.histogramEl).html(""))},clean:function(){this._clean()},_clean:function(){this.chunksDisplayed={},this.renderedArea={}},initializeDom:function(a){this._initializeDom(a)},_initializeDom:function(a){var b=this,c=$('<div id="'+this.id+'-div"></div>')[0];c.classList.add("ocb-gv-track");var d="";d+='   <div class="ocb-gv-track-title">',d+='   <div class="ocb-gv-track-title-el">',d+='       <span class="ocb-gv-track-title-text">'+this.title+"</span>",d+='       <span class="ocb-gv-track-title-histogram"></span>',d+='       <span class="ocb-gv-track-title-toggle"><i class="fa fa-minus"></i></span>',d+='       <span class="ocb-gv-track-title-down"><i class="fa fa-chevron-down"></i></span>',d+='       <span class="ocb-gv-track-title-up"><i class="fa fa-chevron-up"></i></span>',1==this.closable&&(d+='       <span class="ocb-gv-track-title-close"><i class="fa fa-times"></i></span>'),""!==this.externalLink&&(d+='       <span class="ocb-gv-track-title-external-link"><i class="fa fa-external-link"></i></span>'),d+='       <span class="ocb-gv-track-title-loading"></span>',d+="   </div>",d+="   </div>";var e=$(d)[0];"undefined"==typeof this.title&&$(e).addClass("hidden");var f=e.querySelector(".ocb-gv-track-title");this.titleEl=e.querySelector(".ocb-gv-track-title-el"),this.titleText=e.querySelector(".ocb-gv-track-title-text"),this.histogramEl=e.querySelector(".ocb-gv-track-title-histogram"),this.toggleEl=e.querySelector(".ocb-gv-track-title-toggle"),this.iToggleEl=this.toggleEl.querySelector("i"),this.loadingEl=e.querySelector(".ocb-gv-track-title-loading"),this.closeEl=e.querySelector(".ocb-gv-track-title-close"),this.upEl=e.querySelector(".ocb-gv-track-title-up"),this.downEl=e.querySelector(".ocb-gv-track-title-down"),this.externalLinkEl=e.querySelector(".ocb-gv-track-title-external-link");var g=$('<div id="'+this.id+'-svgdiv"></div>')[0];$(g).css({position:"relative","box-sizing":"boder-box","z-index":3,height:this.height,"overflow-y":this.resizable?"auto":"hidden","overflow-x":"hidden"});var h=$('<div id="'+this.id+'-resizediv" class="ocb-track-resize"></div>')[0];$(a).addClass("unselectable"),$(a).append(c),$(c).append(e),$(c).append(g),$(c).append(h),$(e).css({padding:"4px"}).on("dblclick",function(a){a.stopPropagation()}),$(this.toggleEl).click(function(a){b.toggleContent()}),$(this.closeEl).click(function(a){b.close()}),$(this.upEl).click(function(a){b.up()}),$(this.downEl).click(function(a){b.down()}),$(this.externalLinkEl).click(function(a){window.open(b.externalLink)}),this.resizable&&($(h).mousedown(function(a){$("html").addClass("unselectable"),a.stopPropagation();var c=a.clientY;$("html").bind("mousemove.genomeViewer",function(a){var d=a.clientY-c,e=$(g).outerHeight(),f=e+d;f>0&&(b.height=f,$(g).css({height:b.height})),c=a.clientY})}),$("html").bind("mouseup.genomeViewer",function(a){$("html").removeClass("unselectable"),$("html").off("mousemove.genomeViewer")}),$(g).closest(".trackListPanels").mouseup(function(a){b.updateHeight()})),this.div=c,this.contentDiv=g,this.titlediv=f,this.resizeDiv=h,this.rendered=!0,this.status="ready"},_drawHistogramLegend:function(){var a=this.histogramRenderer.histogramHeight,b=this.histogramRenderer.multiplier;this.histogramGroup=SVG.addChild(this.svgGroup,"g",{"class":"histogramGroup",visibility:"hidden"});var c=SVG.addChild(this.histogramGroup,"text",{x:21,y:a+4,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="0-";var c=SVG.addChild(this.histogramGroup,"text",{x:14,y:a+4-Math.log(10)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="10-";var c=SVG.addChild(this.histogramGroup,"text",{x:7,y:a+4-Math.log(100)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="100-";var c=SVG.addChild(this.histogramGroup,"text",{x:0,y:a+4-Math.log(1e3)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="1000-"},draw:function(){},getFeaturesToRenderByChunk:function(a,b){for(var c,d,e,f,g=function(b){return Math.floor(b/a.chunkSize)},h=function(b,c){return b+":"+c+"_"+a.dataType+"_"+a.chunkSize},i=a.items,j=[],j=[],k=0,l=i.length;k<l;k++)if(1!=this.chunksDisplayed[i[k].chunkKey]){for(var m=0,n=i[k].value.length;m<n;m++){c=i[k].value[m],d=!1,e=g(c.start),f=g(c.end);for(var o=e;o<=f;o++){var p=h(c.chromosome,o);if(1==this.chunksDisplayed[p]){d=!0;break}}d||j.push(c)}this.chunksDisplayed[i[k].chunkKey]=!0}return j}},AlignmentTrack.prototype=new Track({}),AlignmentTrack.prototype.clean=function(){for(this._clean();this.svgCanvasFeatures.firstChild;)this.svgCanvasFeatures.removeChild(this.svgCanvasFeatures.firstChild)},AlignmentTrack.prototype.updateHeight=function(){if(this.histogram)return this.contentDiv.style.height=this.histogramRenderer.histogramHeight+5+"px",void this.main.setAttribute("height",this.histogramRenderer.histogramHeight);var a=this.svgCanvasFeatures.getBoundingClientRect().height;if(this.main.setAttribute("height",a),this.resizable)if(0==this.autoHeight)this.contentDiv.style.height=this.height+10+"px";else if(1==this.autoHeight){var b=this.pixelPosition,c=this.width,d=0;for(var e in this.renderedArea)this.renderedArea[e].contains({start:b,end:b+c})&&(d=e);var f=parseInt(d)+30;this.contentDiv.style.height=f+10+"px",this.main.setAttribute("height",f)}},AlignmentTrack.prototype.setWidth=function(a){this._setWidth(a),this.main.setAttribute("width",this.width)},AlignmentTrack.prototype.initializeDom=function(a){this._initializeDom(a),this.main=SVG.addChild(this.contentDiv,"svg",{"class":"trackSvg",x:0,y:0,width:this.width}),this.svgCanvasFeatures=SVG.addChild(this.main,"svg",{"class":"features",x:-this.pixelPosition,width:this.svgCanvasWidth}),this.updateHeight()},AlignmentTrack.prototype.render=function(a){this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset},AlignmentTrack.prototype.getDataHandler=function(a){var b;"histogram"==a.dataType?(this.renderer=this.histogramRenderer,b=a.items):(this.renderer=this.defaultRenderer,b=this._removeDisplayedChunks(a)),this.renderer.render(b,{cacheItems:a.items,svgCanvasFeatures:this.svgCanvasFeatures,featureTypes:this.featureTypes,renderedArea:this.renderedArea,pixelBase:this.pixelBase,position:this.region.center(),regionSize:this.region.length(),maxLabelRegionSize:this.maxLabelRegionSize,width:this.width,pixelPosition:this.pixelPosition,region:this.region,trackListPanel:this.trackListPanel}),this.updateHeight()},AlignmentTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateHistogramParams(),this.clean(),this.dataType="features",this.histogram&&(this.dataType="histogram"),("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(this.setLoading(!0),this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(b){a.getDataHandler(b),a.setLoading(!1)}})),a.updateHeight()},AlignmentTrack.prototype.move=function(a){var b=this;this.dataType="features",this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(a){b.getDataHandler(a)}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),a<0&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(a){b.getDataHandler(a)}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},AlignmentTrack.prototype._removeDisplayedChunks=function(a){for(var b,c,d,e,f=function(b){return Math.floor(b/a.chunkSize)},g=function(b,c){return b+":"+c+"_"+a.dataType+"_"+a.chunkSize},h=a.items,i=[],j=[],k=0,l=h.length;k<l;k++)if(1!=this.chunksDisplayed[h[k].chunkKey]){j=[];var m=h[k].value.alignments;null==m&&(m=h[k].value);for(var n=0,o=m.length;n<o;n++){b=m[n],c=!1,d=f(b.start),e=f(b.end);for(var p=d;p<=e;p++){var q=g(b.chromosome,p);if(1==this.chunksDisplayed[q]){c=!0;break}}c||j.push(b)}this.chunksDisplayed[h[k].chunkKey]=!0,h[k].value.alignments=j,i.push(h[k])}return a.items=i,a},FeatureTrack.prototype=new Track({}),FeatureTrack.prototype.clean=function(){for(this._clean();this.svgCanvasFeatures.firstChild;)this.svgCanvasFeatures.removeChild(this.svgCanvasFeatures.firstChild)},FeatureTrack.prototype.updateHeight=function(){if(this.histogram)return this.contentDiv.style.height=this.histogramRenderer.histogramHeight+5+"px",
void this.main.setAttribute("height",this.histogramRenderer.histogramHeight);var a=this.svgCanvasFeatures.getBoundingClientRect().height;if(this.main.setAttribute("height",a),this.resizable)if(0==this.autoHeight)this.contentDiv.style.height=this.height+10+"px";else if(1==this.autoHeight){var b=this.pixelPosition,c=this.width,d=0;for(var e in this.renderedArea)this.renderedArea[e].contains({start:b,end:b+c})&&(d=e);var f=parseInt(d)+30;this.contentDiv.style.height=f+10+"px",this.main.setAttribute("height",f)}},FeatureTrack.prototype.setWidth=function(a){this._setWidth(a),this.main.setAttribute("width",this.width)},FeatureTrack.prototype.initializeDom=function(a){this._initializeDom(a),this.main=SVG.addChild(this.contentDiv,"svg",{"class":"trackSvg",x:0,y:0,width:this.width}),this.svgCanvasFeatures=SVG.addChild(this.main,"svg",{"class":"features",x:-this.pixelPosition,width:this.svgCanvasWidth}),this.updateHeight()},FeatureTrack.prototype.render=function(a){this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset},FeatureTrack.prototype.getDataHandler=function(a){var b;"histogram"==a.dataType?(this.renderer=this.histogramRenderer,b=a.items):(this.renderer=this.defaultRenderer,b=this.getFeaturesToRenderByChunk(a)),this.renderer.render(b,{cacheItems:a.items,svgCanvasFeatures:this.svgCanvasFeatures,featureTypes:this.featureTypes,renderedArea:this.renderedArea,pixelBase:this.pixelBase,position:this.region.center(),regionSize:this.region.length(),maxLabelRegionSize:this.maxLabelRegionSize,width:this.width,pixelPosition:this.pixelPosition,resource:this.resource,species:this.species,featureType:this.featureType}),this.updateHeight()},FeatureTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateHistogramParams(),this.clean(),this.dataType="features",this.histogram&&(this.dataType="histogram"),("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(this.setLoading(!0),this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(b){a.getDataHandler(b),a.setLoading(!1)}})),this.updateHeight()},FeatureTrack.prototype.move=function(a){var b=this;this.dataType="features",this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(a){b.getDataHandler(a)}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),a<0&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(a){b.getDataHandler(a)}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset))),1==this.autoHeight&&this.updateHeight()},GeneTrack.prototype=new Track({}),GeneTrack.prototype.clean=function(){for(;this.svgCanvasFeatures.firstChild;)this.svgCanvasFeatures.removeChild(this.svgCanvasFeatures.firstChild);this._clean()},GeneTrack.prototype.updateHeight=function(){if(this.histogram)return this.contentDiv.style.height=this.histogramRenderer.histogramHeight+5+"px",void this.main.setAttribute("height",this.histogramRenderer.histogramHeight);var a=this.svgCanvasFeatures.getBoundingClientRect().height;if(this.main.setAttribute("height",a),this.resizable)if(0==this.autoHeight)this.contentDiv.style.height=this.height+10+"px";else if(1==this.autoHeight){var b=this.pixelPosition,c=this.width,d=0;for(var e in this.renderedArea)this.renderedArea[e].contains({start:b,end:b+c})&&(d=e);var f=parseInt(d)+30;this.contentDiv.style.height=f+10+"px",this.main.setAttribute("height",f)}},GeneTrack.prototype.setWidth=function(a){this._setWidth(a),this.main.setAttribute("width",this.width)},GeneTrack.prototype.initializeDom=function(a){this._initializeDom(a),this.main=SVG.addChild(this.contentDiv,"svg",{"class":"trackSvg",x:0,y:0,width:this.width}),this.svgCanvasFeatures=SVG.addChild(this.main,"svg",{"class":"features",x:-this.pixelPosition,width:this.svgCanvasWidth}),this.updateHeight()},GeneTrack.prototype.render=function(a){this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset},GeneTrack.prototype.getDataHandler=function(a){var b;"histogram"==a.dataType?(this.renderer=this.histogramRenderer,b=a.items):(this.renderer=this.defaultRenderer,b=this.getFeaturesToRenderByChunk(a)),this.renderer.render(b,{cacheItems:a.items,svgCanvasFeatures:this.svgCanvasFeatures,renderedArea:this.renderedArea,pixelBase:this.pixelBase,position:this.region.center(),regionSize:this.region.length(),maxLabelRegionSize:this.maxLabelRegionSize,width:this.width,pixelPosition:this.pixelPosition}),this.updateHeight()},GeneTrack.prototype.updateTranscriptParams=function(){this.region.length()<this.minTranscriptRegionSize?this.exclude=this.dataAdapter.params.exclude:this.exclude="transcripts,chunkIds"},GeneTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateTranscriptParams(),this.updateHistogramParams(),this.clean();var b="features";if(this.histogram&&(b="histogram"),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize){this.setLoading(!0);this.dataAdapter.getData({dataType:b,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(b){a.getDataHandler(b),a.setLoading(!1)}})}this.updateHeight()},GeneTrack.prototype.move=function(a){var b=this;this.dataType="features",_.isUndefined(this.exclude)||(dataType="features"+this.exclude),this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(a){b.getDataHandler(a)}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),a<0&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(a){b.getDataHandler(a)}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset))),1==this.autoHeight&&this.updateHeight()},Renderer.prototype={render:function(a){},getFeatureX:function(a,b){var c=b.width/2,d=b.pixelPosition+c-(b.position-a)*b.pixelBase;return d},getDefaultConfig:function(a){return FEATURE_TYPES[a]},getLabelWidth:function(a,b){var c=SVG.create("text",{"font-weight":400,"class":this.fontClass});c.textContent=a,$(b.svgCanvasFeatures).append(c);var d=$(c).width();return $(c).remove(),d}},AlignmentRenderer.prototype=new Renderer({}),AlignmentRenderer.prototype.render=function(a,b){var c=this,d=b.trackListPanel.getSequenceTrack().dataAdapter;_.isUndefined(a.params)&&(a.params={});var e=!1;null!=a.params.view_as_pairs&&(e=!0),console.log("viewAsPairs "+e);var f=0,g=0,h="orangered";null!=a.params.insert_size_interval&&(f=a.params.insert_size_interval.split(",")[0],g=a.params.insert_size_interval.split(",")[1]),console.log("insertSizeMin "+f),console.log("insertSizeMin "+g),$(b.svgCanvasFeatures).contextmenu(function(a){console.log("click derecho")}),console.time("BamRender "+a.params.resource);var i=a.items,j=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"bamCoverage",cursor:"pointer"}),k=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"bamReads",cursor:"pointer"}),l=function(a){for(var d,e=a.coverage.all,f=a.coverage.a,g=a.coverage.c,h=a.coverage.g,i=a.coverage.t,k=parseInt(a.start),l=parseInt(a.end),m=(l-k+1)*b.pixelBase,n=b.width/2,o=b.pixelBase/2-.5,p=parseInt(a.start),q="",r="",s="",t="",u=200,v=50,w=0;w<e.length;w++)d=b.pixelPosition+n-(b.position-p)*b.pixelBase,xx=b.pixelPosition+n-(b.position-p)*b.pixelBase+b.pixelBase,q+=d+","+f[w]/u*v+" ",q+=xx+","+f[w]/u*v+" ",r+=d+","+(g[w]+f[w])/u*v+" ",r+=xx+","+(g[w]+f[w])/u*v+" ",s+=d+","+(h[w]+g[w]+f[w])/u*v+" ",s+=xx+","+(h[w]+g[w]+f[w])/u*v+" ",t+=d+","+(i[w]+h[w]+g[w]+f[w])/u*v+" ",t+=xx+","+(i[w]+h[w]+g[w]+f[w])/u*v+" ",p++;var x=r.split(" ").reverse().join(" ").trim(),y=s.split(" ").reverse().join(" ").trim(),z=t.split(" ").reverse().join(" ").trim(),A=b.pixelPosition+n-(b.position-parseInt(a.start))*b.pixelBase+o,B=b.pixelPosition+n-(b.position-parseInt(a.end))*b.pixelBase+o,C=(SVG.addChild(j,"polyline",{points:A+",0 "+q+B+",0",fill:"green"}),SVG.addChild(j,"polyline",{points:q+" "+x,fill:"blue"}),SVG.addChild(j,"polyline",{points:r+" "+y,fill:"gold"}),SVG.addChild(j,"polyline",{points:s+" "+z,fill:"red"}),SVG.addChild(j,"rect",{x:b.pixelPosition+n-(b.position-k)*b.pixelBase,y:0,width:m,height:v,opacity:"0.5",fill:"lightgray",cursor:"pointer"}));$(C).qtip({content:" ",position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),b.trackListPanel.on("mousePosition:change",function(b){var c=b.mousePos-parseInt(a.start),d='depth: <span class="ssel">'+e[c]+'</span><br><span style="color:green">A</span>: <span class="ssel">'+a.coverage.a[c]+'</span><br><span style="color:blue">C</span>: <span class="ssel">'+a.coverage.c[c]+'</span><br><span style="color:darkgoldenrod">G</span>: <span class="ssel">'+a.coverage.g[c]+'</span><br><span style="color:red">T</span>: <span class="ssel">'+a.coverage.t[c]+"</span><br>";$(C).qtip("option","content.text",d)})},m=function(a){var e=a.unclippedStart,h=a.unclippedEnd;0==a.end&&(h=e+a.length-1);var i=h-e+1,j=a.differences,l=_.isFunction(c.color)?c.color(a,b.region.chromosome):c.color,m=(_.isFunction(c.strokeColor)?c.strokeColor(a,b.region.chromosome):c.strokeColor,_.isFunction(c.label)?c.label(a):c.label,_.isFunction(c.height)?c.height(a):c.height),n=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,o=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,p=_.isFunction(c.strand)?c.strand(a):c.strand,q=_.isFunction(c.mateUnmappedFlag)?c.mateUnmappedFlag(a):c.mateUnmappedFlag,r=_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId;0==f||0==g||q||(Math.abs(a.inferredInsertSize)>g&&(l="maroon"),Math.abs(a.inferredInsertSize)<f&&(l="navy"));var s=i*b.pixelBase,t=c.getFeatureX(e,b);maxWidth=s,console.log(i+" in px: "+s);for(var u=16,v=70;;){null==b.renderedArea[v]&&(b.renderedArea[v]=new FeatureBinarySearchTree);var w=b.renderedArea[v].add({start:t,end:t+maxWidth-1});if(w){var x=SVG.addChild(k,"g",{feature_id:a.name}),y={Reverse:t+","+(v+m/2)+" "+(t+5)+","+v+" "+(t+s)+","+v+" "+(t+s)+","+(v+m)+" "+(t+5)+","+(v+m),Forward:t-1+","+v+" "+(t+s-5)+","+v+" "+(t+s)+","+(v+m/2)+" "+(t+s-5)+","+(v+m)+" "+(t-1)+","+(v+m)};SVG.addChild(x,"polygon",{points:y[p],stroke:l,"stroke-width":1,fill:l,cursor:"pointer"});if($(x).qtip({content:{text:o,title:n},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:300,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"mouseenter",hide:"mousedown mouseup mouseleave"}),x.addEventListener("click",function(b){console.log(a),c.trigger("feature:click",{query:a[r],feature:a,featureType:a.featureType,clickEvent:b})}),null!=j&&b.regionSize<400){var z=new Region({chromosome:b.region.chromosome,start:e,end:h});d.getData({region:z,done:function(a){var c=AlignmentRenderer._getReferenceString(a.items,z);x.appendChild(AlignmentRenderer.drawBamDifferences(c,j,b.pixelBase,t,v+m))}})}break}v+=u}},n=function(a,d){var e=a.unclippedStart,i=a.unclippedEnd,j=d.unclippedStart,l=d.unclippedEnd,m=a.diff,n=d.diff,o=c.types[a.featureType],p=c.types[d.featureType],q=o.getColor(a,c.region.chromosome),r=p.getColor(d,c.region.chromosome),s=o.getStrand(a),t=p.getStrand(d);0!=f&&0!=g&&(Math.abs(a.inferredInsertSize)>g&&(q="maroon",r="maroon"),Math.abs(a.inferredInsertSize)<f&&(q="navy",r="navy"));var u=e,v=l;j<=e&&(u=j),i>=l&&(v=i);for(var w=(v-u+1)*c.pixelBase,x=c.pixelPosition+middle-(c.position-u)*c.pixelBase,y=(i-e+1)*c.pixelBase,z=c.pixelPosition+middle-(c.position-e)*c.pixelBase,A=(l-j+1)*c.pixelBase,B=c.pixelPosition+middle-(c.position-j)*c.pixelBase,C=12,D=70;;){null==b.renderedArea[D]&&(b.renderedArea[D]=new FeatureBinarySearchTree);var E=b.renderedArea[D].add({start:x,end:x+w-1});if(E){var F=[],G=[],H={Reverse:z+","+(D+o.height/2)+" "+(z+5)+","+D+" "+(z+y-5)+","+D+" "+(z+y-5)+","+(D+o.height)+" "+(z+5)+","+(D+o.height),Forward:z+","+D+" "+(z+y-5)+","+D+" "+(z+y)+","+(D+o.height/2)+" "+(z+y-5)+","+(D+o.height)+" "+z+","+(D+o.height)},I=SVG.addChild(k,"polygon",{points:H[s],stroke:o.getStrokeColor(a),"stroke-width":1,fill:q,cursor:"pointer"});F.push(I);var J={Reverse:B+","+(D+p.height/2)+" "+(B+5)+","+D+" "+(B+A-5)+","+D+" "+(B+A-5)+","+(D+p.height)+" "+(B+5)+","+(D+p.height),Forward:B+","+D+" "+(B+A-5)+","+D+" "+(B+A)+","+(D+p.height/2)+" "+(B+A-5)+","+(D+p.height)+" "+B+","+(D+p.height)},K=SVG.addChild(k,"polygon",{points:J[t],stroke:p.getStrokeColor(d),"stroke-width":1,fill:r,cursor:"pointer"});G.push(K);SVG.addChild(k,"line",{x1:z+y,y1:D+o.height/2,x2:B,y2:D+o.height/2,"stroke-width":"1",stroke:"gray",cursor:"pointer"});if(b.regionSize<400){if(null!=m){var L=SVG.addChild(k,"path",{d:Utils.genBamVariants(m,c.pixelBase,z,D),fill:h});F.push(L)}if(null!=n){var M=SVG.addChild(k,"path",{d:Utils.genBamVariants(n,c.pixelBase,B,D),fill:h});G.push(M)}}$(F).qtip({content:{text:o.getTipText(a),title:o.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:280,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"}),$(F).click(function(b){console.log(a),c.showInfoWidget({query:a[o.infoWidgetId],feature:a,featureType:a.featureType,adapter:c.trackData.adapter})}),$(G).qtip({content:{text:p.getTipText(d),title:p.getTipTitle(d)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:280,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"}),$(G).click(function(a){console.log(d),c.showInfoWidget({query:d[p.infoWidgetId],feature:d,featureType:d.featureType,adapter:c.trackData.adapter})});break}D+=C}},o=function(a){l(a.value);for(var b=a.value.alignments,c=0,d=b.length;c<d;c++){var f=b[c];if(e){var g=b[c+1];null!=g&&(f.name==g.name?(n(f,g),c++):m(f))}else m(f)}};if(i.length>0)for(var p=0,q=i.length;p<q;p++)o(i[p]);console.timeEnd("BamRender "+a.params.resource)},AlignmentRenderer.genBamVariants=function(a,b,c,d){for(var e=b/6,f="",g=0;g<a.length;g++){var h=a[g];switch(h.op){case"S":for(var i=c+b*h.pos,j=0;j<h.length;j++){var k=h.seq[j];switch(k){case"A":f+="M"+(2.5*e+i)+","+d+"l-"+2.5*e+","+6*e+"l"+e+",0l"+.875*e+",-"+2*e+"l"+2.25*e+",0l"+.875*e+","+2*e+"l"+e+",0l-"+2.5*e+",-"+6*e+"l-"+.5*e+",0l0,"+e+"l"+.75*e+","+2*e+"l-"+1.5*e+",0l"+.75*e+",-"+2*e+"l0,-"+e+" ";break;case"T":f+="M"+(.5*e+i)+","+d+"l0,"+e+"l"+2*e+",0l0,"+5*e+"l"+e+",0l0,-"+5*e+"l"+2*e+",0l0,-"+e+" ";break;case"C":f+="M"+(5*e+i)+","+(0*e+d)+"l-"+2*e+",0l-"+1.5*e+","+.5*e+"l-"+.5*e+","+1.5*e+"l0,"+2*e+"l"+.5*e+","+1.5*e+"l"+1.5*e+","+.5*e+"l"+2*e+",0l0,-"+e+"l-"+2*e+",0l-"+.75*e+",-"+.25*e+"l-"+.25*e+",-"+.75*e+"l0,-"+2*e+"l"+.25*e+",-"+.75*e+"l"+.75*e+",-"+.25*e+"l"+2*e+",0 ";break;case"G":f+="M"+(5*e+i)+","+(0*e+d)+"l-"+2*e+",0l-"+1.5*e+","+.5*e+"l-"+.5*e+","+1.5*e+"l0,"+2*e+"l"+.5*e+","+1.5*e+"l"+1.5*e+","+.5*e+"l"+2*e+",0l0,-"+3*e+"l-"+e+",0l0,"+2*e+"l-"+e+",0l-"+.75*e+",-"+.25*e+"l-"+.25*e+",-"+.75*e+"l0,-"+2*e+"l"+.25*e+",-"+.75*e+"l"+.75*e+",-"+.25*e+"l"+2*e+",0 ";break;case"N":f+="M"+(.5*e+i)+","+(0*e+d)+"l0,"+6*e+"l"+e+",0l0,-"+4.5*e+"l"+3*e+","+4.5*e+"l"+e+",0l0,-"+6*e+"l-"+e+",0l0,"+4.5*e+"l-"+3*e+",-"+4.5*e+" ";break;case"d":f+="M"+(0*e+i)+","+(2.5*e+d)+"l"+6*e+",0l0,"+e+"l-"+6*e+",0l0,-"+e+" ";break;default:f+="M0,0"}i+=b}}}return f},AlignmentRenderer.drawBamDifferences=function(a,b,c,d,e){for(var f=SVG.create("text",{x:d,y:e-2,"class":"ocb-font-ubuntumono ocb-font-size-15"}),g=0;g<b.length;g++){var h=b[g];switch(h.op){case"I":var i=d+c*h.pos-c/2,j=SVG.addChild(f,"tspan",{x:i,"font-weight":"bold",textLength:c});j.textContent="·",$(j).qtip({content:{text:h.seq,title:"Insertion"},position:{target:"mouse",adjust:{x:25,y:15}},style:{classes:this.toolTipfontClass+" qtip-dark qtip-shadow"}});break;case"D":for(var i=d+c*h.pos,k=0;k<h.length;k++){var j=SVG.addChild(f,"tspan",{x:i,"font-weight":"bold",textLength:c});j.textContent="—",i+=c}break;case"N":for(var i=d+c*h.pos,k=0;k<h.length;k++){var j=SVG.addChild(f,"tspan",{x:i,fill:"#888",textLength:c});j.textContent="—",i+=c}break;case"S":for(var i=d+c*h.pos,k=0;k<h.length;k++){var l=h.seq[k],j=SVG.addChild(f,"tspan",{x:i,fill:"#aaa",textLength:c});j.textContent=l,i+=c}break;case"H":for(var i=d+c*h.pos,k=0;k<h.length;k++){var j=SVG.addChild(f,"tspan",{x:i,fill:"#aaa",textLength:c});j.textContent="H",i+=c}break;case"X":case"M":for(var i=d+c*h.pos,k=0;k<h.length;k++){var l=h.seq[k],m=h.pos+k;if(l!=a.charAt(m)){var j=SVG.addChild(f,"tspan",{x:i,fill:SEQUENCE_COLORS[l],textLength:c});j.textContent=l}i+=c}}}return f},AlignmentRenderer._getReferenceString=function(a,b){for(var c,d=[],e=0;e<a.length;e++){c=a[e];for(var f=0;f<c.value.length;f++)d.push(c.value[f])}d.sort(function(a,b){return a.start-b.start});for(var g=[],h=d[0].start,e=(d[d.length-1].end,0);e<d.length;e++)g.push(d[e].sequence);var i=g.join(""),j=b.start-h,k=j+b.length(),l=i.substring(j,k);return l},BamRenderer.prototype=new Renderer({}),BamRenderer.prototype.render=function(a,b){var c=this,d=b.trackListPanel.getSequenceTrack().dataAdapter,e="orangered",f=b.cacheItems,g=!1,h=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"bamCoverage",cursor:"pointer"}),i=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"bamReads",cursor:"pointer"}),j=function(a){for(var d=a.region.start,e=a.region.end,f=new Region(a.region).length(),g=a.value,i=Array.apply(null,Array(f)).map(Number.prototype.valueOf,0),j=Array.apply(null,Array(f)).map(Number.prototype.valueOf,0),k=Array.apply(null,Array(f)).map(Number.prototype.valueOf,0),l=Array.apply(null,Array(f)).map(Number.prototype.valueOf,0),m=Array.apply(null,Array(f)).map(Number.prototype.valueOf,0),n=0;n<g.length;n++){var o=g[n];BamRenderer._processRead(o);for(var p=0;p<o.differences.length;p++){var q=o.differences[p];if("S"!=q.op&&"H"!=q.op&&"I"!=q.op&&null!=q.seq)for(var r=0;r<q.seq.length;r++){var s=q.seq[r],t=o.start+q.pos+r;if(t>=d&&t<=e)switch(s){case"A":i[t-d]++;break;case"C":j[t-d]++;break;case"G":k[t-d]++;break;case"T":l[t-d]++}}}}for(var u,v=(f*b.pixelBase,b.width/2),w=b.pixelBase/2-.5,x=parseInt(d),y="",z="",A="",B="",C=300,D=50,n=0;n<m.length;n++)u=b.pixelPosition+v-(b.position-x)*b.pixelBase,xx=b.pixelPosition+v-(b.position-x)*b.pixelBase+b.pixelBase,y+=u+","+i[n]/C*D+" ",y+=xx+","+i[n]/C*D+" ",z+=u+","+(j[n]+i[n])/C*D+" ",z+=xx+","+(j[n]+i[n])/C*D+" ",A+=u+","+(k[n]+j[n]+i[n])/C*D+" ",A+=xx+","+(k[n]+j[n]+i[n])/C*D+" ",B+=u+","+(l[n]+k[n]+j[n]+i[n])/C*D+" ",B+=xx+","+(l[n]+k[n]+j[n]+i[n])/C*D+" ",x++;var E=z.split(" ").reverse().join(" ").trim(),F=A.split(" ").reverse().join(" ").trim(),G=B.split(" ").reverse().join(" ").trim(),H=b.pixelPosition+v-(b.position-parseInt(d))*b.pixelBase+w,I=b.pixelPosition+v-(b.position-parseInt(e))*b.pixelBase+w;SVG.addChild(h,"polyline",{points:H+",0 "+y+I+",0",fill:"green"}),SVG.addChild(h,"polyline",{points:y+" "+E,fill:"blue"}),SVG.addChild(h,"polyline",{points:z+" "+F,fill:"gold"}),SVG.addChild(h,"polyline",{points:A+" "+G,fill:"red"});$(h).qtip({content:" ",position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),b.trackListPanel.on("mousePosition:change",function(a){var b=a.mousePos-parseInt(d),c='depth: <span class="ssel">'+m[b]+'</span><br><span style="color:green">A</span>: <span class="ssel">'+i[b]+'</span><br><span style="color:blue">C</span>: <span class="ssel">'+j[b]+'</span><br><span style="color:darkgoldenrod">G</span>: <span class="ssel">'+k[b]+'</span><br><span style="color:red">T</span>: <span class="ssel">'+l[b]+"</span><br>";$(h).qtip("option","content.text",c)})},k=function(a){var e=a.start,f=a.end,g=f-e+1,j=_.isFunction(c.color)?c.color(a,b.region.chromosome):c.color,k=(_.isFunction(c.strokeColor)?c.strokeColor(a,b.region.chromosome):c.strokeColor,_.isFunction(c.label)?c.label(a):c.label,_.isFunction(c.height)?c.height(a):c.height),l=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,m=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,n=_.isFunction(c.strand)?c.strand(a):c.strand,o=(_.isFunction(c.mateUnmappedFlag)?c.mateUnmappedFlag(a):c.mateUnmappedFlag,_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId),p=g*b.pixelBase,q=c.getFeatureX(e,b);maxWidth=p;for(var r=16,s=h.getBoundingClientRect().height+10;;){null==b.renderedArea[s]&&(b.renderedArea[s]=new FeatureBinarySearchTree);var t=b.renderedArea[s].add({start:q,end:q+maxWidth-1});if(t){var u=SVG.addChild(i,"g",{feature_id:a.QNAME}),v={Reverse:q+","+(s+k/2)+" "+(q+5)+","+s+" "+(q+p)+","+s+" "+(q+p)+","+(s+k)+" "+(q+5)+","+(s+k),Forward:q-1+","+s+" "+(q+p-5)+","+s+" "+(q+p)+","+(s+k/2)+" "+(q+p-5)+","+(s+k)+" "+(q-1)+","+(s+k)};SVG.addChild(u,"polygon",{points:v[n],stroke:j,"stroke-width":1,fill:j,cursor:"pointer"});if($(u).qtip({content:{text:m,title:l},position:{target:"mouse",viewport:$(window),adjust:{x:25,y:15}},style:{classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"mouseenter",hide:"mousedown mouseup mouseleave"}),u.addEventListener("click",function(b){console.log(a),c.trigger("feature:click",{query:a[o],feature:a,featureType:a.featureType,clickEvent:b})}),null!=a.differences&&b.regionSize<400){var w=new Region({chromosome:b.region.chromosome,start:e,end:f});d.getData({region:w,done:function(c){var d=BamRenderer._getReferenceString(c.items,w);u.appendChild(BamRenderer.drawBamDifferences(d,a.differences,b.pixelBase,q,s+k))}})}break}s+=r}},l=function(a,d){var f=a.unclippedStart,g=a.unclippedEnd,h=d.unclippedStart,j=d.unclippedEnd,k=a.diff,l=d.diff,m=c.types[a.featureType],n=c.types[d.featureType],o=m.getColor(a,c.region.chromosome),p=n.getColor(d,c.region.chromosome),q=m.getStrand(a),r=n.getStrand(d);0!=insertSizeMin&&0!=insertSizeMax&&(Math.abs(a.inferredInsertSize)>insertSizeMax&&(o="maroon",p="maroon"),Math.abs(a.inferredInsertSize)<insertSizeMin&&(o="navy",p="navy"));var s=f,t=j;h<=f&&(s=h),g>=j&&(t=g);for(var u=(t-s+1)*c.pixelBase,v=c.pixelPosition+middle-(c.position-s)*c.pixelBase,w=(g-f+1)*c.pixelBase,x=c.pixelPosition+middle-(c.position-f)*c.pixelBase,y=(j-h+1)*c.pixelBase,z=c.pixelPosition+middle-(c.position-h)*c.pixelBase,A=12,B=70;;){null==b.renderedArea[B]&&(b.renderedArea[B]=new FeatureBinarySearchTree);var C=b.renderedArea[B].add({start:v,end:v+u-1});if(C){var D=[],E=[],F={Reverse:x+","+(B+m.height/2)+" "+(x+5)+","+B+" "+(x+w-5)+","+B+" "+(x+w-5)+","+(B+m.height)+" "+(x+5)+","+(B+m.height),Forward:x+","+B+" "+(x+w-5)+","+B+" "+(x+w)+","+(B+m.height/2)+" "+(x+w-5)+","+(B+m.height)+" "+x+","+(B+m.height)},G=SVG.addChild(i,"polygon",{points:F[q],stroke:m.getStrokeColor(a),"stroke-width":1,fill:o,cursor:"pointer"});D.push(G);var H={Reverse:z+","+(B+n.height/2)+" "+(z+5)+","+B+" "+(z+y-5)+","+B+" "+(z+y-5)+","+(B+n.height)+" "+(z+5)+","+(B+n.height),Forward:z+","+B+" "+(z+y-5)+","+B+" "+(z+y)+","+(B+n.height/2)+" "+(z+y-5)+","+(B+n.height)+" "+z+","+(B+n.height)},I=SVG.addChild(i,"polygon",{points:H[r],stroke:n.getStrokeColor(d),"stroke-width":1,fill:p,cursor:"pointer"});E.push(I);SVG.addChild(i,"line",{x1:x+w,y1:B+m.height/2,x2:z,y2:B+m.height/2,"stroke-width":"1",stroke:"gray",cursor:"pointer"});if(b.regionSize<400){if(null!=k){var J=SVG.addChild(i,"path",{d:Utils.genBamVariants(k,c.pixelBase,x,B),fill:e});D.push(J)}if(null!=l){var K=SVG.addChild(i,"path",{d:Utils.genBamVariants(l,c.pixelBase,z,B),fill:e});E.push(K)}}$(D).qtip({content:{text:m.getTipText(a),title:m.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"}),$(D).click(function(b){console.log(a),c.showInfoWidget({query:a[m.infoWidgetId],feature:a,featureType:a.featureType,adapter:c.trackData.adapter})}),$(E).qtip({content:{text:n.getTipText(d),title:n.getTipTitle(d)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"}),$(E).click(function(a){console.log(d),c.showInfoWidget({query:d[n.infoWidgetId],feature:d,featureType:d.featureType,adapter:c.trackData.adapter})});break}B+=A}},m=function(a){j(a);for(var b=a.value,c=0,d=b.length;c<d;c++){var e=b[c];if(g){var f=b[c+1];null!=f&&(e.QNAME==f.QNAME?(l(e,f),c++):k(e))}else k(e)}};if(f.length>0)for(var n=0,o=f.length;n<o;n++){var p=f[n];m(p)}},BamRenderer._processRead=function(a){var b=parseInt(a.POS),c=b,d=b,e=a.CIGAR.match(/[0-9]+[MIDNSHPX=]/g),f=[];if(null!=e)for(var g=0,h=0,i=0;i<e.length;i++){var j,k,l=e[i],m=l.match(/[MIDNSHPX=]/)[0],n=parseInt(l.replace(m,""));switch(m){case"H":break;case"D":case"N":k="",j=h,h+=n,d+=n;break;case"S":k=a.SEQ.substr(g,n),g+=n,j=i==e.length-1?h:h-n;break;case"I":k=a.SEQ.substr(g,n),g+=n,j=h,d+=n;break;case"M":case"=":case"X":k=a.SEQ.substr(g,n),j=h,h+=n,g+=n,d+=n}f.push({op:m,pos:j,seq:k,length:n})}a.chromosome=a.RNAME,a.start=c,a.end=d-1,a.differences=f},BamRenderer.drawBamDifferences=function(a,b,c,d,e){for(var f=SVG.create("text",{x:d,y:e-2,"class":"ocb-font-ubuntumono ocb-font-size-15"}),g=0;g<b.length;g++){var h=b[g];switch(h.op){case"I":var i=d+c*h.pos-c/2,j=SVG.addChild(f,"tspan",{x:i,"font-weight":"bold",textLength:c});j.textContent="· ",$(j).qtip({content:{text:h.seq,title:"Insertion"},position:{target:"mouse",viewport:$(window),adjust:{x:25,y:15}},style:{classes:this.toolTipfontClass+" qtip-dark qtip-shadow"}});break;case"D":for(var i=d+c*h.pos,k=0;k<h.length;k++){var j=SVG.addChild(f,"tspan",{x:i,"font-weight":"bold",textLength:c});j.textContent="—",i+=c}break;case"N":for(var i=d+c*h.pos,k=0;k<h.length;k++){var j=SVG.addChild(f,"tspan",{x:i,fill:"#888",textLength:c});j.textContent="—",i+=c}break;case"S":break;var i,k,l,j;case"H":break;var i,k,j;case"X":case"=":case"M":for(var i=d+c*h.pos,k=0;k<h.length;k++){var l=h.seq[k],m=h.pos+k;if(l!=a.charAt(m)){var j=SVG.addChild(f,"tspan",{x:i,fill:SEQUENCE_COLORS[l],textLength:c});j.textContent=l}i+=c}}}return f},BamRenderer._getReferenceString=function(a,b){for(var c,d=[],e=0;e<a.length;e++){c=a[e];for(var f=0;f<c.value.length;f++)d.push(c.value[f])}d.sort(function(a,b){return a.start-b.start});for(var g=[],h=d[0].start,e=(d[d.length-1].end,0);e<d.length;e++)g.push(d[e].sequence);var i=g.join(""),j=b.start-h,k=j+b.length(),l=i.substring(j,k);return l},BamRenderer.genBamVariants=function(a,b,c,d){for(var e=b/6,f="",g=0;g<a.length;g++){var h=a[g];switch(h.op){case"S":for(var i=c+b*h.pos,j=0;j<h.length;j++){var k=h.seq[j];switch(k){case"A":f+="M"+(2.5*e+i)+","+d+"l-"+2.5*e+","+6*e+"l"+e+",0l"+.875*e+",-"+2*e+"l"+2.25*e+",0l"+.875*e+","+2*e+"l"+e+",0l-"+2.5*e+",-"+6*e+"l-"+.5*e+",0l0,"+e+"l"+.75*e+","+2*e+"l-"+1.5*e+",0l"+.75*e+",-"+2*e+"l0,-"+e+" ";break;case"T":f+="M"+(.5*e+i)+","+d+"l0,"+e+"l"+2*e+",0l0,"+5*e+"l"+e+",0l0,-"+5*e+"l"+2*e+",0l0,-"+e+" ";break;case"C":f+="M"+(5*e+i)+","+(0*e+d)+"l-"+2*e+",0l-"+1.5*e+","+.5*e+"l-"+.5*e+","+1.5*e+"l0,"+2*e+"l"+.5*e+","+1.5*e+"l"+1.5*e+","+.5*e+"l"+2*e+",0l0,-"+e+"l-"+2*e+",0l-"+.75*e+",-"+.25*e+"l-"+.25*e+",-"+.75*e+"l0,-"+2*e+"l"+.25*e+",-"+.75*e+"l"+.75*e+",-"+.25*e+"l"+2*e+",0 ";break;case"G":f+="M"+(5*e+i)+","+(0*e+d)+"l-"+2*e+",0l-"+1.5*e+","+.5*e+"l-"+.5*e+","+1.5*e+"l0,"+2*e+"l"+.5*e+","+1.5*e+"l"+1.5*e+","+.5*e+"l"+2*e+",0l0,-"+3*e+"l-"+e+",0l0,"+2*e+"l-"+e+",0l-"+.75*e+",-"+.25*e+"l-"+.25*e+",-"+.75*e+"l0,-"+2*e+"l"+.25*e+",-"+.75*e+"l"+.75*e+",-"+.25*e+"l"+2*e+",0 ";break;case"N":f+="M"+(.5*e+i)+","+(0*e+d)+"l0,"+6*e+"l"+e+",0l0,-"+4.5*e+"l"+3*e+","+4.5*e+"l"+e+",0l0,-"+6*e+"l-"+e+",0l0,"+4.5*e+"l-"+3*e+",-"+4.5*e+" ";break;case"d":f+="M"+(0*e+i)+","+(2.5*e+d)+"l"+6*e+",0l0,"+e+"l-"+6*e+",0l0,-"+e+" ";break;default:f+="M0,0"}i+=b}}}return f},ConservedRenderer.prototype=new Renderer({}),ConservedRenderer.prototype.render=function(a,b){for(var c=0;c<a.length;c++)this._paintChunk(a[c],b)},ConservedRenderer.prototype._paintChunk=function(a,b){for(var c=b.width/2,d=15,e=75,f="",g=b.pixelBase,h=b.pixelPosition+c-(b.position-parseInt(a.start))*b.pixelBase,i=0,j=a.values.length;i<j;i++){var k=a.values[i],l=k*d,m=a.start+i,h=b.pixelPosition+c-(b.position-m)*b.pixelBase;f+=h+",0 ",f+=h+","+(e-l)+" ",f+=h+g+","+(e-l)+" ",f+=h+g+",0 "}SVG.addChild(b.svgCanvasFeatures,"polyline",{points:f,stroke:"#000000","stroke-width":.2,fill:"salmon",cursor:"pointer"})},FeatureClusterRenderer.prototype=new Renderer({}),FeatureClusterRenderer.prototype.render=function(a,b){for(var c=this,d=(b.width/2,function(d){d.start=parseInt(d.start),d.end=parseInt(d.end);var f=d.end-d.start;f*=b.pixelBase;var g=c.getFeatureX(d.start,b);null==d.features_count&&(0!=d.absolute?d.features_count=Math.log(a[e].absolute):d.features_count=0);var h=d.features_count*c.multiplier,i=SVG.addChild(b.svgCanvasFeatures,"rect",{x:g+1,y:0,width:f-1,height:h,stroke:"smokewhite","stroke-width":1,fill:"#9493b1",cursor:"pointer"}),j=CellBaseManager.url({species:b.species,category:"genomic",subCategory:"region",query:new Region(d).toString(),resource:b.resource,params:{include:"chromosome,start,end,id",limit:20},async:!1});$(i).qtip({content:{text:"Loading...",
ajax:{url:j,type:"GET",success:function(a,b){for(var c=a.response[0].result,e="",f=0;f<c.length;f++){var g=c[f],h=new Region(g);e+='<span class="emph">'+g.id+'</span> <span class="info">'+h.toString()+"</span><br>"}var i=Math.round(Math.exp(d.features_count));i<=20?(this.set("content.title","Count: "+c.length),this.set("content.text",e)):(this.set("content.title","Count: "+i),this.set("content.text",e+"..."))}}},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}})}),e=0,f=a.length;e<f;e++)d(a[e].value)},FeatureRenderer.prototype=new Renderer({}),FeatureRenderer.prototype.render=function(a,b){var c=this,d=function(a,d){"featureType"in a&&_.extend(c,FEATURE_TYPES[a.featureType]),"featureClass"in a&&_.extend(c,FEATURE_TYPES[a.featureClass]),"clinical"==b.featureType&&("clinvarSet"in a?_.extend(c,FEATURE_TYPES.Clinvar):"mutationID"in a?_.extend(c,FEATURE_TYPES.Cosmic):_.extend(c,FEATURE_TYPES.GWAS));var e=_.isFunction(c.color)?c.color(a):c.color,f=_.isFunction(c.strokeColor)?c.color(a):c.strokeColor,h=_.isFunction(c.label)?c.label(a):c.label,i=_.isFunction(c.height)?c.height(a):c.height,j=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,k=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,l=_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,m=a.start,n=a.end,o=n-m+1;o=o<0?Math.abs(o):o,o=0==o?1:o;var p=o*b.pixelBase,q=6.4*h.length,r=c.getFeatureX(m,b),s=Math.max(p,2),t=0;b.maxLabelRegionSize>b.regionSize&&(t=9,s=Math.max(p,q));for(var u=0,v=t+i,w=t+i+2;;){u in b.renderedArea||(b.renderedArea[u]=new FeatureBinarySearchTree);var x=b.renderedArea[u].add({start:r,end:r+s-1});if(x){var y=SVG.addChild(d,"g",{feature_id:a.id});SVG.addChild(y,"rect",{x:r,y:u,width:p,height:i,stroke:f,"stroke-width":1,"stroke-opacity":.7,fill:e,cursor:"pointer"});if(b.maxLabelRegionSize>b.regionSize){var z=SVG.addChild(y,"text",{i:g,x:r,y:v,"font-weight":400,opacity:null,fill:"black",cursor:"pointer","class":c.fontClass});z.textContent=h}"tooltipText"in c&&$(y).qtip({content:{text:k,title:j},position:{viewport:$(window),target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),$(y).mouseover(function(b){c.trigger("feature:mouseover",{query:a[l],feature:a,featureType:a.featureType,mouseoverEvent:b})}),$(y).click(function(b){c.trigger("feature:click",{query:a[l],feature:a,featureType:a.featureType,clickEvent:b})});break}u+=w,v+=w}},e="write dom "+Utils.randomString(4);console.time(e),console.log(a.length);for(var f=SVG.create("g"),g=0,h=a.length;g<h;g++)d(a[g],f);b.svgCanvasFeatures.appendChild(f),console.timeEnd(e)},GeneRenderer.prototype=new Renderer({}),GeneRenderer.prototype.setFeatureConfig=function(a){_.extend(this,a)},GeneRenderer.prototype.render=function(a,b){for(var c=this,d=(function(a){c.setFeatureConfig(FEATURE_TYPES.gene);var d=_.isFunction(c.color)?c.color(a):c.color,e=_.isFunction(c.label)?c.label(a):c.label,f=_.isFunction(c.height)?c.height(a):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,j=a.start,k=a.end,l=k-j+1,m=l*b.pixelBase,n=6.4*e.length,o=c.getFeatureX(j,b),p=Math.max(m,2),q=0;b.maxLabelRegionSize>b.regionSize&&(q=9,p=Math.max(m,n));for(var r=0,s=q+f+1,t=q+f+5;;){r in b.renderedArea||(b.renderedArea[r]=new FeatureBinarySearchTree);var u,v=r,w=!0;if(_.isEmpty(a.transcripts))u=b.renderedArea[r].add({start:o,end:o+p-1});else{for(var x=0,y=a.transcripts.length+1;x<y;x++){if(v in b.renderedArea||(b.renderedArea[v]=new FeatureBinarySearchTree),b.renderedArea[v].contains({start:o,end:o+p-1})){w=!1;break}v+=t}1==w&&(u=b.renderedArea[r].add({start:o,end:o+p-1}))}if(u){var z=SVG.addChild(b.svgCanvasFeatures,"g",{feature_id:a.id});SVG.addChild(z,"rect",{x:o,y:r,width:m,height:f,stroke:"#3B0B0B","stroke-width":.5,fill:d,cursor:"pointer"});if(b.maxLabelRegionSize>b.regionSize){var A=SVG.addChild(z,"text",{i:x,x:o,y:s,fill:"black",cursor:"pointer","class":c.fontClass});A.textContent=e}$(z).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),z.addEventListener("click",function(b){c.trigger("feature:click",{query:a[i],feature:a,featureType:"gene",clickEvent:b})});var v=r+t,B=s+t;if(!_.isEmpty(a.transcripts))for(var x=0,y=a.transcripts.length;x<y;x++){v in b.renderedArea||(b.renderedArea[v]=new FeatureBinarySearchTree);var C=a.transcripts[x],D=c.getFeatureX(C.start,b),E=(C.end-C.start+1)*b.pixelBase;c.setFeatureConfig(FEATURE_TYPES.transcript);var F=_.isFunction(c.color)?c.color(C):c.color,e=_.isFunction(c.label)?c.label(C):c.label,f=_.isFunction(c.height)?c.height(C):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(C):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(C):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(C):c.infoWidgetId,n=6.4*e.length,p=Math.max(m,m-(a.end-C.start)*b.pixelBase+n);b.renderedArea[v].add({start:o,end:o+p-1});var G=SVG.addChild(b.svgCanvasFeatures,"g",{"data-widget-id":C[i],"data-transcript-idx":x}),A=(SVG.addChild(G,"rect",{x:D,y:v+1,width:E,height:f,fill:"gray",cursor:"pointer",feature_id:C.id}),SVG.addChild(G,"text",{x:D,y:B,fill:"black",cursor:"pointer","class":c.fontClass}));A.textContent=e,$(G).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),G.addEventListener("click",function(b){var d=this.getAttribute("data-widget-id"),e=this.getAttribute("data-transcript-idx");c.trigger("feature:click",{query:d,feature:a.transcripts[e],featureType:"transcript",clickEvent:event})});for(var H=0,I=a.transcripts[x].exons.length;H<I;H++){var J=a.transcripts[x].exons[H],K=parseInt(J.start),L=parseInt(J.end),M=b.width/2,N=b.pixelPosition+M-(b.position-K)*b.pixelBase,O=(L-K+1)*b.pixelBase;c.setFeatureConfig(FEATURE_TYPES.exon);var d=_.isFunction(c.color)?c.color(J):c.color,e=_.isFunction(c.label)?c.label(J):c.label,f=_.isFunction(c.height)?c.height(J):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(J):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(J,C):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(J):c.infoWidgetId,P=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"ocb-coding","data-id":J.id});$(P).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),P.addEventListener("click",function(a){});var Q=(SVG.addChild(P,"rect",{i:x,x:N,y:v-1,width:O,height:f,stroke:"gray","stroke-width":1,fill:"white",cursor:"pointer"}),J.genomicCodingEnd-J.genomicCodingStart),R=b.pixelPosition+M-(b.position-J.genomicCodingStart)*b.pixelBase,S=b.pixelPosition+M-(b.position-J.genomicCodingEnd)*b.pixelBase,T=(Q+1)*b.pixelBase;if(Q>0){SVG.addChild(P,"rect",{i:x,x:R,y:v-1,width:T,height:f,stroke:F,"stroke-width":1,fill:F,cursor:"pointer"});if(b.pixelBase>9.5&&null!=C.proteinSequence&&null!=J.phase){if("+"==J.strand)var U=C.proteinSequence.substring(Math.floor(J.cdsStart/3),Math.floor(J.cdsEnd/3)),V=R-(3-J.phase)%3*b.pixelBase,W=1;else if("-"==J.strand)var U=C.proteinSequence.substring(Math.floor(J.cdsStart/3),Math.ceil(J.cdsEnd/3)),V=S-2*b.pixelBase-J.phase*b.pixelBase,W=-1;for(var X=0;X<U.length;X++){var Y=(SVG.addChild(P,"rect",{x:V+W*b.pixelBase*3*X,y:v-1,width:3*b.pixelBase,height:f,stroke:"#3B0B0B","stroke-width":.5,fill:CODON_CONFIG[U.charAt(X)].color,"class":"ocb-codon"}),SVG.addChild(P,"text",{x:V+W*b.pixelBase*X*3+b.pixelBase/3,y:v-3,width:3*b.pixelBase,"class":"ocb-font-ubuntumono ocb-font-size-16 ocb-codon"}));Y.textContent=CODON_CONFIG[U.charAt(X)].text}}}}v+=t,B+=t}break}r+=t,s+=t}}),e=0,f=a.length;e<f;e++)d(a[e])},HistogramRenderer.prototype=new Renderer({}),HistogramRenderer.prototype._checkFeatureValue=function(a){null==a.features_count&&(0!=a.absolute&&a.absolute>0?a.features_count=Math.max(.2,Math.log(a.absolute)):a.features_count=0)},HistogramRenderer.prototype.updateScale=function(a){null!=a&&(null!=a.height&&(this.histogramHeight=.95*a.height),null!=a.histogramMaxFreqValue&&(this.maxValue=a.histogramMaxFreqValue)),this.multiplier=this.histogramHeight/this.maxValue},HistogramRenderer.prototype.render=function(a,b){a.sort(function(a,b){return a.value.start-b.value.start});var c=b.width/2,d="";if(this.updateScale(b),a.length>0){var e=a[0].value,f=(e.end-e.start+1)*b.pixelBase,g=b.pixelPosition+c-(b.position-parseInt(e.start))*b.pixelBase;this._checkFeatureValue(e);var h=e.features_count*this.multiplier;d=(g-f/2).toFixed(1)+","+this.histogramHeight.toFixed(1)+" ",d+=(g-f/2).toFixed(1)+","+(this.histogramHeight-h).toFixed(1)+" "}for(var i=0,j=a.length;i<j;i++){var k=a[i].value;k.start=parseInt(k.start),k.end=parseInt(k.end);var f=(k.end-k.start+1)*b.pixelBase,g=b.pixelPosition+c-(b.position-k.start)*b.pixelBase;this._checkFeatureValue(k);var h=k.features_count*this.multiplier;d+=(g+f/2).toFixed(1)+","+(this.histogramHeight-h).toFixed(1)+" "}if(a.length>0){var l=a[a.length-1].value,f=(l.end-l.start+1)*b.pixelBase,g=b.pixelPosition+c-(b.position-parseInt(l.start))*b.pixelBase;this._checkFeatureValue(l);var h=l.features_count*this.multiplier;d+=(g+f).toFixed(1)+","+(this.histogramHeight-h).toFixed(1)+" ",d+=(g+f).toFixed(1)+","+this.histogramHeight.toFixed(1)+" "}""!==d&&SVG.addChild(b.svgCanvasFeatures,"polyline",{points:d,fill:this.histogramColor,cursor:"pointer"})},SequenceRenderer.prototype=new Renderer({}),SequenceRenderer.prototype.render=function(a,b){for(var c=0;c<a.length;c++)this._paintSequenceChunk(a[c],b)},SequenceRenderer.prototype._paintSequenceChunk=function(a,b){var c=new Region(a).toString();console.time("Sequence render "+c);for(var d=b.width/2,e=a.start,f=a.start,g=a.sequence,h=0;h<g.length;h++){var i=b.pixelPosition+d-(b.position-e)*b.pixelBase,j=SVG.addChild(b.svgCanvasFeatures,"text",{x:i+1,y:12,fill:SEQUENCE_COLORS[g.charAt(h)],"data-pos":e,"class":this.fontClass});e++,j.textContent=g.charAt(h),$(j).qtip({content:g.charAt(h)+" "+(f+h).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:this.toolTipfontClass+" qtip-light qtip-shadow"},show:{delay:300},hide:{delay:300}})}console.timeEnd("Sequence render "+c)},VariantRenderer.prototype=new Renderer({}),VariantRenderer.prototype.init=function(a,b){$(a).contextmenu(function(a){console.log("right click"),a.preventDefault()})},VariantRenderer.prototype.render=function(a,b){for(var c=0,d=a.length;c<d;c++)for(var e=0;e<a[c].length;e++){var f=a[c][e];this.draw(f,b)}},VariantRenderer.prototype.draw=function(a,b){var c=this,d=(_.isFunction(c.color)?c.color(a):c.color,_.isFunction(c.label)?c.label(a):c.label),e=(_.isFunction(c.height)?c.height(a):c.height,_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle),f=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,g=(_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,a.start),h=a.end,i=h-g+1;i=i<0?Math.abs(i):i,i=0==i?1:i;var j=i*b.pixelBase,k=c.getLabelWidth(d,b),l=c.getFeatureX(g,b),m=Math.max(j,2),n=0;b.regionSize<b.maxLabelRegionSize&&(n=9,m=Math.max(j,k));var o="",p="",q="",r="",s=l,t=l+j,u=1,v=6,w=10,x=0;for(var y in a.files)for(var z in a.files[y].samplesData){b.renderedArea[u]=new FeatureBinarySearchTree,b.renderedArea[u].add({start:s,end:t});var A=a.files[y].samplesData[z].GT;switch(A){case"0|0":case"0/0":o+="M"+s+","+u+" L"+t+","+u+" ",o+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case".|.":case"./.":p+="M"+s+","+u+" L"+t+","+u+" ",p+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case"1|1":case"1/1":q+="M"+s+","+u+" L"+t+","+u+" ",q+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case"0|1":case"0/1":case"1|0":case"1/0":r+="M"+s+","+u+" L"+t+","+u+" ",r+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z "}x++,u+=w}var B=SVG.addChild(b.svgCanvasFeatures,"g",{feature_id:a.id});SVG.addChild(B,"rect",{x:s,y:1,width:j,height:u,fill:"transparent",cursor:"pointer"});if(""!=o){SVG.addChild(B,"path",{d:o,fill:"blue",cursor:"pointer"})}if(""!=p){SVG.addChild(B,"path",{d:p,fill:"black",cursor:"pointer"})}if(""!=q){SVG.addChild(B,"path",{d:q,fill:"red",cursor:"pointer"})}if(""!=r){SVG.addChild(B,"path",{d:r,fill:"orange",cursor:"pointer"})}var C=0;$(B).qtip({content:{text:f+"<br>"+x+" samples",title:e},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),$(B).mousemove(function(b){var c=parseInt(b.offsetY/w);if(c!=C){console.log(c),x=0;var d="",e=!1;for(var g in a.files)for(var h in a.files[g].samplesData)c==x&&(e=!0,d=h),x++;$(B).qtip("option","content.text",f+"<br>"+d)}C=c})},VcfMultisampleRenderer.prototype=new Renderer({}),VcfMultisampleRenderer.prototype.render=function(a,b){for(var c=0,d=a.length;c<d;c++)this._drawFeature(a[c],b)},VcfMultisampleRenderer.prototype._drawFeature=function(a,b){var c=this,d=_.isFunction(c.color)?c.color(a):c.color,e=_.isFunction(c.label)?c.label(a):c.label,f=_.isFunction(c.height)?c.height(a):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,j=a.start,k=a.end,l=k-j+1;l=l<0?Math.abs(l):l,l=0==l?1:l;var m=l*b.pixelBase,n=6.4*e.length,o=c.getFeatureX(j,b),p=Math.max(m,2),q=0;b.maxLabelRegionSize>b.regionSize&&(q=9,p=Math.max(m,n));for(var r=0,s=q+f,t=q+f+2;;){r in b.renderedArea||(b.renderedArea[r]=new FeatureBinarySearchTree);var u=b.renderedArea[r].add({start:o,end:o+p-1});if(u){var v=SVG.addChild(b.svgCanvasFeatures,"g",{feature_id:a.id});SVG.addChild(v,"rect",{x:o,y:r,width:m,height:f,stroke:"#3B0B0B","stroke-width":1,"stroke-opacity":.7,fill:d,cursor:"pointer"});if(b.maxLabelRegionSize>b.regionSize){var w=SVG.addChild(v,"text",{x:o,y:s,"font-weight":400,opacity:null,fill:"black",cursor:"pointer","class":c.fontClass});w.textContent=e}"tooltipText"in c&&$(v).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),$(v).mouseover(function(b){c.trigger("feature:mouseover",{query:a[i],feature:a,featureType:a.featureType,mouseoverEvent:b})}),$(v).click(function(b){c.trigger("feature:click",{query:a[i],feature:a,featureType:a.featureType,clickEvent:b})});break}r+=t,s+=t}},VcfMultisampleRenderer.prototype._drawFeatureMultiSample=function(a,b){var c=this,d=(_.isFunction(c.color)?c.color(a):c.color,_.isFunction(c.label)?c.label(a):c.label),e=(_.isFunction(c.height)?c.height(a):c.height,_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle),f=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,g=(_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,a.start),h=a.end,i=h-g+1;i=i<0?Math.abs(i):i,i=0==i?1:i;var j=i*b.pixelBase,k=c.getLabelWidth(d,b),l=c.getFeatureX(g,b),m=Math.max(j,2),n=0;b.regionSize<b.maxLabelRegionSize&&(n=9,m=Math.max(j,k));for(var o="",p="",q="",r="",s=l,t=l+j,u=1,v=6,w=10,x=0,y=a.samples.length;x<y;x++){b.renderedArea[u]=new FeatureBinarySearchTree,b.renderedArea[u].add({start:s,end:t});var z=a.samples[x].split(":")[0];switch(z){case"0|0":case"0/0":o+="M"+s+","+u+" L"+t+","+u+" ",o+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case".|.":case"./.":p+="M"+s+","+u+" L"+t+","+u+" ",p+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case"1|1":case"1/1":q+="M"+s+","+u+" L"+t+","+u+" ",q+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case"0|1":case"0/1":case"1|0":case"1/0":r+="M"+s+","+u+" L"+t+","+u+" ",r+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z "}u+=w}var A=SVG.addChild(b.svgCanvasFeatures,"g",{feature_id:a.id});SVG.addChild(A,"rect",{x:s,y:1,width:j,height:u,fill:"transparent",cursor:"pointer"});if(""!=o){SVG.addChild(A,"path",{d:o,fill:"blue",cursor:"pointer"})}if(""!=p){SVG.addChild(A,"path",{d:p,fill:"black",cursor:"pointer"})}if(""!=q){SVG.addChild(A,"path",{d:q,fill:"red",cursor:"pointer"})}if(""!=r){SVG.addChild(A,"path",{d:r,fill:"orange",cursor:"pointer"})}var B=0;$(A).qtip({content:{text:f+"<br>"+a.samples[B],title:e},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:{delay:300},hide:{delay:300}}),$(A).mousemove(function(b){var c=parseInt(b.offsetY/w);c!=B&&(console.log(c),$(A).qtip("option","content.text",f+"<br>"+a.samples[c])),B=c})},GenomeViewer.prototype={render:function(){console.log("Initializing Genome Viewer"),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.div.setAttribute("class","ocb-gv ocb-box-vertical"),this.navigationbarDiv=document.createElement("div"),this.navigationbarDiv.setAttribute("class","ocb-gv-navigation"),this.div.appendChild(this.navigationbarDiv),this.centerPanelDiv=document.createElement("div"),this.centerPanelDiv.setAttribute("class","ocb-gv-center"),this.div.appendChild(this.centerPanelDiv),this.statusbarDiv=document.createElement("div"),this.statusbarDiv.setAttribute("class","ocb-gv-status"),this.div.appendChild(this.statusbarDiv),this.rightSidebarDiv=document.createElement("div"),this.rightSidebarDiv.setAttribute("class","ocb-gv-right-side"),this.centerPanelDiv.appendChild(this.rightSidebarDiv),this.leftSidebarDiv=document.createElement("div"),this.leftSidebarDiv.setAttribute("class","ocb-gv-left-side"),this.centerPanelDiv.appendChild(this.leftSidebarDiv),this.karyotypeDiv=document.createElement("div"),this.karyotypeDiv.setAttribute("class","ocb-gv-karyotype"),this.centerPanelDiv.appendChild(this.karyotypeDiv),this.chromosomeDiv=document.createElement("div"),this.chromosomeDiv.setAttribute("class","ocb-gv-chromosome"),this.centerPanelDiv.appendChild(this.chromosomeDiv),this.trackListPanelsDiv=document.createElement("div"),this.trackListPanelsDiv.setAttribute("class","ocb-gv-tracklist-target"),this.centerPanelDiv.appendChild(this.trackListPanelsDiv),this.regionDiv=document.createElement("div"),this.regionDiv.setAttribute("class","ocb-gv-overview"),this.trackListPanelsDiv.appendChild(this.regionDiv),this.tracksDiv=document.createElement("div"),this.tracksDiv.setAttribute("class","ocb-gv-detailed"),this.trackListPanelsDiv.appendChild(this.tracksDiv),this._init(),this.rendered=!0},_init:function(){var a=this;this._checkAndSetMinimumRegion(this.region,this.getSVGCanvasWidth()),this.zoom=this._calculateZoomByRegion(this.region),this.drawNavigationBar&&(this.navigationBar=this._createNavigationBar(this.navigationbarDiv)),this.drawKaryotypePanel&&(this.karyotypePanel=this._drawKaryotypePanel(this.karyotypeDiv)),this.drawChromosomePanel&&(this.chromosomePanel=this._drawChromosomePanel(this.chromosomeDiv)),this.drawOverviewTrackListPanel&&(this.overviewTrackListPanel=this._createOverviewTrackListPanel(this.regionDiv)),this.trackListPanel=this._createTrackListPanel(this.tracksDiv),this.drawStatusBar&&(this.statusBar=this._createStatusBar(this.statusbarDiv)),this.on("region:change region:move",function(b){b.sender!=a&&a.region.load(b.region)}),this.on("width:change",function(b){b.sender!=a&&(a.width=b.width,$(a.div).width(b.width),$(a.targetDiv).width(b.width))}),$("html").bind("keydown.genomeViewer",function(b){switch(b.keyCode){case 40:case 109:b.shiftKey&&a.increaseZoom(-10);break;case 38:case 107:b.shiftKey&&a.increaseZoom(10)}})},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?void this.targetDiv.appendChild(this.div):void console.log("target not found")},destroy:function(){$(this.div).remove(),this.off(),this.rendered=!1,$("html").unbind(".genomeViewer"),$("body").unbind(".genomeViewer"),delete this},getChromosomes:function(){var a,b=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.name]=d}return b};return"undefined"!=typeof this.chromosomeList?a=b(this.chromosomeList):CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",resource:"all",async:!1,success:function(c){a=b(c.response[0].result[0].chromosomes);for(var d=0;d<a.length;d++){a[d]}},error:function(a){console.log("Could not get chromosome list")}}),a},_createNavigationBar:function(a){var b=this;$.isFunction(this.quickSearchResultFn)||(this.quickSearchResultFn=function(a){var c=[],d=Utils.getSpeciesCode(this.species.scientificName);return CellBaseManager.get({host:b.cellBaseHost,version:b.cellBaseVersion,species:d,category:"feature",subCategory:"id",query:a,resource:"starts_with",params:{limit:10},async:!1,success:function(a,b,d){c=a.response[0].result}}),c});var c=function(a){b._regionChangeHandler({region:new Region(a)})},d=new NavigationBar({target:a,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,availableSpecies:this.availableSpecies,species:this.species,region:this.region,width:this.width,svgCanvasWidthOffset:this.trackPanelScrollWidth+this.sidePanelWidth,zoom:this.zoom,quickSearchResultFn:this.quickSearchResultFn,quickSearchDisplayKey:this.quickSearchDisplayKey,componentsConfig:this.navigationBarConfig.componentsConfig,karyotypePanelConfig:this.karyotypePanelConfig,chromosomePanelConfig:this.chromosomePanelConfig,regionPanelConfig:this.regionPanelConfig,handlers:{"region:change":function(a){b._regionChangeHandler(a)},"region:move":function(a){b._regionMoveHandler(a)},"zoom:change":function(a){b._zoomChangeHandler(a)},"species:change":function(a){b._speciesChangeHandler(a)},"karyotype-button:change":function(a){a.selected?b.karyotypePanel.show():b.karyotypePanel.hide()},"chromosome-button:change":function(a){a.selected?b.chromosomePanel.show():b.chromosomePanel.hide()},"region-button:change":function(a){a.selected?b.overviewTrackListPanel.show():b.overviewTrackListPanel.hide()},"fullscreen:click":function(a){b.fullscreen?($(b.div).css({width:"auto"}),Utils.cancelFullscreen(),b.fullscreen=!1):($(b.div).css({width:screen.width}),Utils.launchFullScreen(b.div),b.fullscreen=!0)},"restoreDefaultRegion:click":function(a){a.region=b.defaultRegion,b._regionChangeHandler(a)},"autoHeight-button:change":function(a){b.toggleAutoHeight(a.selected)},"quickSearch:select":function(a){c(a.item),b.trigger("quickSearch:select",a)},"quickSearch:go":function(a){c(a.item)}}});return this.on("region:change",function(a){b.navigationBar.setRegion(a.region,b.zoom)}),this.on("region:move",function(a){a.sender!=d&&b.navigationBar.moveRegion(a.region)}),this.on("width:change",function(a){b.navigationBar.setWidth(a.width)}),d.draw(),d},_drawKaryotypePanel:function(a){var b=this,c=new KaryotypePanel({target:a,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,width:this.width-this.sidePanelWidth,height:125,species:this.species,title:"Karyotype",collapsed:this.karyotypePanelConfig.collapsed,collapsible:this.karyotypePanelConfig.collapsible,hidden:this.karyotypePanelConfig.hidden,region:this.region,autoRender:!0,handlers:{"region:change":function(a){b._regionChangeHandler(a)}}});return this.on("region:change region:move",function(a){c.setRegion(a.region)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),c.draw(),c},_drawChromosomePanel:function(a){var b=this,c=new ChromosomePanel({target:a,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,autoRender:!0,width:this.width-this.sidePanelWidth,height:65,species:this.species,title:"Chromosome",collapsed:this.chromosomePanelConfig.collapsed,collapsible:this.chromosomePanelConfig.collapsible,hidden:this.chromosomePanelConfig.hidden,region:this.region,handlers:{"region:change":function(a){b._regionChangeHandler(a)}}});return this.on("region:change region:move",function(a){c.setRegion(a.region)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),c.draw(),c},_createOverviewTrackListPanel:function(a){var b=this,c=new TrackListPanel({cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,target:a,autoRender:!0,width:this.width-this.sidePanelWidth,zoomMultiplier:this.overviewZoomMultiplier,title:"Region overview",showRegionOverviewBox:!0,collapsible:this.regionPanelConfig.collapsible,region:this.region,species:this.species,handlers:{"region:change":function(a){a.sender=void 0,b._regionChangeHandler(a)},"region:move":function(a){b._regionMoveHandler(a)}}});return this.on("region:change",function(a){a.sender!=c&&c.setRegion(a.region)}),this.on("region:move",function(a){a.sender!=c&&c.moveRegion(a)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),c.draw(),c},_createTrackListPanel:function(a){var b=this,c=new TrackListPanel({target:a,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,autoRender:!0,width:this.width-this.sidePanelWidth,title:this.trackListTitle,region:this.region,species:this.species,hidden:this.regionPanelConfig.hidden,handlers:{"region:change":function(a){a.sender=void 0,b._regionChangeHandler(a)},"region:move":function(a){b._regionMoveHandler(a)}}});return this.on("region:change",function(a){a.sender!=c&&c.setRegion(a.region)}),this.on("region:move",function(a){a.sender!=c&&c.moveRegion(a)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),this.on("feature:highlight",function(a){c.highlight(a)}),c.draw(),c},_createStatusBar:function(a){var b=new StatusBar({target:a,autoRender:!0,region:this.region,width:this.width,version:this.version});return this.on("region:change",function(a){b.setRegion(a)}),this.trackListPanel.on("mousePosition:change",function(a){b.setMousePosition(a)}),b.draw(),b},_checkAndSetNewChromosomeRegion:function(a){var b=this.chromosomes[a.chromosome];a.chromosome!==this.region.chromosome&&(a.start>b.size||a.end>b.size)&&(a.start=Math.round(b.size/2),a.end=Math.round(b.size/2))},_checkAndSetMinimumRegion:function(a,b){var c=Math.floor(b/10);if(a.length()<c){var d=a.center(),e=Math.ceil(c/2-1);a.start=Math.floor(d-e),a.end=Math.floor(d+e)}},_calculateRegionByZoom:function(a){var b=10,c=this.chromosomes[this.region.chromosome],d=this.getSVGCanvasWidth()/b,e=Math.pow(c.size/d,.01),f=d*Math.pow(e,100-a),g=this.region.center(),h=Math.ceil(f/2-1),i=Math.floor(g-h),j=Math.floor(g+h);return{start:i,end:j}},_calculateZoomByRegion:function(a){var b=10,c=this.chromosomes[a.chromosome],d=this.getSVGCanvasWidth()/b,e=Math.pow(c.size/d,.01),f=a.length(),g=Math.log(f/d)/Math.log(e);return 100-Math.round(g)},_checkChangingRegion:function(){return!("undefined"!=typeof this.overviewTrackListPanel&&!this.overviewTrackListPanel.checkTracksReady())&&!("undefined"!=typeof this.trackListPanel&&!this.trackListPanel.checkTracksReady())},_regionChangeHandler:function(a){return this._checkChangingRegion()?(this._checkAndSetNewChromosomeRegion(a.region),this._checkAndSetMinimumRegion(a.region,this.getSVGCanvasWidth()),this.zoom=this._calculateZoomByRegion(a.region),this.trigger("region:change",a),!0):(a.sender&&a.sender.updateRegionControls&&a.sender.updateRegionControls(),console.log("****************************"),console.log("**************************** region change already in progress"),console.log("****************************"),!1)},_regionMoveHandler:function(a){this.trigger("region:move",a)},_zoomChangeHandler:function(a){a.zoom=Math.min(100,a.zoom),a.zoom=Math.max(0,a.zoom),this.zoom=a.zoom,this.region.load(this._calculateRegionByZoom(a.zoom)),this.setRegion(this.region)},_speciesChangeHandler:function(a){this.trigger("species:change",a),this._updateSpecies(a.species);var b;CellBaseManager.get({host:this.cellBaseHost,async:!1,category:"feature",subCategory:"gene",resource:"first",species:a.species,params:{include:"chromosome,start,end"},success:function(a){b=a.response[0].result[0]}});var c=new Region(b);this.setRegion(c)},_updateSpecies:function(a){this.species=a,this.chromosomes=this.getChromosomes(),this.species.chromosomes=this.chromosomes,this.overviewTrackListPanel&&this.overviewTrackListPanel.setSpecies(a),this.trackListPanel&&this.trackListPanel.setSpecies(a),this.chromosomePanel&&this.chromosomePanel.setSpecies(a),this.karyotypePanel&&this.karyotypePanel.setSpecies(a),this.navigationBar&&this.navigationBar.setSpecies(a)},_getSpeciesByTaxonomy:function(a){for(var b=null,c=0;c<this.availableSpecies.items.length;c++)for(var d=0;d<this.availableSpecies.items[c].items.length;d++){var e=this.availableSpecies.items[c].items[d],f=Utils.getSpeciesCode(e.scientificName);if(f===a){b=e;break}}return b},setSpeciesByTaxonomy:function(a){var b=this._getSpeciesByTaxonomy(a);null!=b?this._speciesChangeHandler({species:b}):console.log("Species taxonomy not found on availableSpecies.")},setRegion:function(a,b){if(null!=b){var c=this._getSpeciesByTaxonomy(b);this._updateSpecies(c)}return this._regionChangeHandler({region:new Region(a)})},moveRegion:function(a){this.region.start+=a,this.region.end+=a,this.trigger("region:move",{region:this.region,disp:-a,sender:this})},setWidth:function(a){var b=new Region(this.region),c=a*this.region.length()/this.width,d=this.region.center(),e=Math.ceil(c/2-1);b.start=Math.floor(d-e),b.end=Math.floor(d+e),this.width=a,this.overviewTrackListPanel&&this.overviewTrackListPanel.setWidth(a),this.trackListPanel&&this.trackListPanel.setWidth(a),this.chromosomePanel&&this.chromosomePanel.setWidth(a),this.karyotypePanel&&this.karyotypePanel.setWidth(a),this.navigationBar&&this.navigationBar.setWidth(a);this._regionChangeHandler({region:b})},setZoom:function(a){a=Math.min(100,a),a=Math.max(0,a),this.zoom=a,this.region.load(this._calculateRegionByZoom(a)),this.setRegion(this.region)},increaseZoom:function(a){var b=this.zoom+a;this.setZoom(b)},setCellBaseHost:function(a){a!=this.cellBaseHost&&(this.cellBaseHost=a,this.navigationBar.setCellBaseHost(this.cellBaseHost),this.chromosomePanel.setCellBaseHost(this.cellBaseHost),this.karyotypePanel.setCellBaseHost(this.cellBaseHost),this.trackListPanel.setCellBaseHost(this.cellBaseHost),this.overviewTrackListPanel.setCellBaseHost(this.cellBaseHost),this._updateSpecies(this.species),this.setRegion(new Region(this.region)))},getSVGCanvasWidth:function(){return this.width-this.trackPanelScrollWidth-this.sidePanelWidth},mark:function(a){var b=a.attrName||"feature_id",c=a["class"]||"ocb-feature-mark";if("attrValues"in a){a.attrValues=$.isArray(a.attrValues)?a.attrValues:[a.attrValues];for(var d in a.attrValues)$("rect["+b+"~="+a.attrValues[d]+"]").attr("class",c)}},unmark:function(a){var b=a.attrName||"feature_id";if("attrValues"in a){a.attrValues=$.isArray(a.attrValues)?a.attrValues:[a.attrValues];for(var c in a.attrValues)$("rect["+b+"~="+a.attrValues[c]+"]").attr("class","")}},highlight:function(a){this.trigger("feature:highlight",a)},getRightSidePanelId:function(){return $(this.rightSidebarDiv).attr("id")},getLeftSidePanelId:function(){return $(this.leftSidebarDiv).attr("id")},getNavigationPanelId:function(){return $(this.navigationbarDiv).attr("id")},getStatusPanelId:function(){return $(this.statusbarDiv).attr("id")},setNavigationBar:function(a){this.navigationBar=a;var b={availableSpecies:this.availableSpecies,species:this.species,region:this.region,width:this.width,svgCanvasWidthOffset:this.trackPanelScrollWidth+this.sidePanelWidth};_.extend(this.navigationBar,b),a.render(this.getNavigationPanelId())},toggleAutoHeight:function(a){this.trackListPanel.toggleAutoHeight(a),this.overviewTrackListPanel.toggleAutoHeight(a)},updateHeight:function(){this.trackListPanel.updateHeight(),this.overviewTrackListPanel.updateHeight()},setSpeciesVisible:function(a){this.navigationBar.setSpeciesVisible(a)},setChromosomesVisible:function(a){this.navigationBar.setChromosomeMenuVisible(a)},setKaryotypePanelVisible:function(a){this.karyotypePanel.setVisible(a),
this.navigationBar.setVisible({karyotype:a})},setChromosomePanelVisible:function(a){this.chromosomePanel.setVisible(a),this.navigationBar.setVisible({chromosome:a})},setRegionOverviewPanelVisible:function(a){this.overviewTrackListPanel.setVisible(a),this.navigationBar.setVisible({region:a})},setRegionTextBoxVisible:function(a){this.navigationBar.setRegionTextBoxVisible(a)},setSearchVisible:function(a){this.navigationBar.setSearchVisible(a)},setFullScreenVisible:function(a){this.navigationBar.setFullScreenButtonVisible(a)},addOverviewTrack:function(a){this.overviewTrackListPanel.addTrack(a)},addTrack:function(a){this.trackListPanel.addTrack(a)},getTrackById:function(a){return this.trackListPanel.getTrackById(a)},removeTrack:function(a){return this.trackListPanel.removeTrack(a)},restoreTrack:function(a,b){return this.trackListPanel.restoreTrack(a,b)},setTrackIndex:function(a,b){return this.trackListPanel.setTrackIndex(a,b)},scrollToTrack:function(a){return this.trackListPanel.scrollToTrack(a)},showTrack:function(a){this.trackListPanel.showTrack(a)},hideTrack:function(a){this.trackListPanel.hideTrack(a)},containsTrack:function(a){return this.trackListPanel.containsTrack(a)},containsTrackById:function(a){return null!=this.getTrackById(a)},deleteTracksCache:function(){this.overviewTrackListPanel.deleteTracksCache(),this.trackListPanel.deleteTracksCache()},checkRenderedTrack:function(a){console.log("DEPRECATED METHOD"),console.log(this.checkRenderedTrack),this.trackExists(a)}};