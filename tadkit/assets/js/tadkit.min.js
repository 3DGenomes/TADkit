!function(){"use strict";angular.module("TADkit",["ui.router","ngMaterial","uuid4","d3js","threejs"])}(),function(){"use strict";function e(e,t){t.theme("default").primaryPalette("green").accentPalette("lime",{"default":"500"}).warnPalette("red").backgroundPalette("grey"),t.theme("darkKit").dark()}angular.module("TADkit").config(e),e.$inject=["$locationProvider","$mdThemingProvider"]}(),function(){"use strict";function e(e){e.$on("$stateChangeError",function(e,t,r,n,o,a){console.log("Resolve Error: ",a)})}angular.module("TADkit").run(e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e,t){t.otherwise("/project/loader/"),e.state("main",{controller:"MainController","abstract":!0,url:"",templateUrl:"assets/templates/main.html",resolve:{initialData:["initMain",function(e){return e()}]}}).state("project",{parent:"main",url:"/project",views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"sidebar-left@main":{templateUrl:"assets/templates/sidebar.project.html",controller:"SidebarProjectController"},"content@main":{templateUrl:"assets/templates/project-content.html",controller:"ProjectContentController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("loader",{parent:"project",url:"/loader/:loadDataset",views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"content@main":{templateUrl:"assets/templates/project-loader.html",controller:"ProjectLoaderController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("dataset",{parent:"project",url:"/dataset",views:{"content@main":{templateUrl:"assets/templates/project-dataset.html",controller:"ProjectDatasetController"}}}).state("overlay",{parent:"project",url:"/overlay",views:{"content@main":{templateUrl:"assets/templates/project-overlay.html",controller:"ProjectOverlayController"}}}).state("storyboard",{parent:"project",url:"/storyboard",views:{"content@main":{templateUrl:"assets/templates/project-storyboard.html",controller:"ProjectStoryboardController"}}}).state("browser",{parent:"project",url:"/browser",views:{"sidebar-left@main":{templateUrl:"assets/templates/sidebar.browser.html",controller:"SidebarBrowserController"},"content@main":{templateUrl:"assets/templates/storyboard.html",controller:"StoryboardController"}}}).state("overlay-import",{parent:"browser",url:"/overlay/import",views:{"modal@main":{templateUrl:"assets/templates/overlay-import.html",controller:"OverlayImportController"}}}).state("404",{url:"/404",templateUrl:"assets/templates/404.tpl.html",controller:"AppController"})}angular.module("TADkit").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e){return{restrict:"EA",link:function(t,r,n){var o="<data-tk-component-"+t.component.object.type+' id="{{component.object.id}}-'+t.$index+'" type="component.object.type" title="{{component.object.title}}" state="component.object.state" settings="settings" view="component.view" currentparticle="currentParticle"currentposition="currentPosition"currentmodel="current.model" currentoverlay="current.overlay" data="component.data" proximities="component.proximities" overlay="component.overlay"toggleoverlay="toggleOverlay(index)" style="margin: {{component.object.state.margin}}; background-color: {{component.view.settings.background}}" class="component '+t.component.object.type+'"></data-tk-component-'+t.component.object.type+">";r.replaceWith(e(o)(t))}}}angular.module("TADkit").directive("tkComponent",e),e.$inject=["$compile"]}(),function(){"use strict";function e(e){e.species=e.current.dataset.object.species,e.region=e.current.dataset.object.region}angular.module("TADkit").controller("PanelInfoboxController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(){return{restrict:"C",templateUrl:"assets/templates/panel-infobox.html",link:function(e,t,r){}}}angular.module("TADkit").directive("tkComponentPanelInfobox",e)}(),function(){"use strict";function e(e,t){e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState},e.toggle=function(e){e=!e},e.width=parseInt(e.state.width),e.height=parseInt(e.state.height),e.atPosition=function(t){return e.$parent.settings.current.segmentUpper>=t.start&&e.$parent.settings.current.segmentLower<=t.end?!0:!1},e.formatRegionName=function(e){return"Chromosome"==e?e:"chr"+e},e.featureTitle=function(e){return e.external_name?e.external_name:e.id},e.getDetails=function(e,r){t.show(t.alert().title("Details").content(e.description).ariaLabel("Item details").ok("Close").targetEvent(r))}}angular.module("TADkit").controller("PanelInspectorController",e),e.$inject=["$scope","$mdDialog"]}(),function(){"use strict";function e(){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"="},templateUrl:"assets/templates/panel-inspector.html",link:function(e,t,r){}}}angular.module("TADkit").directive("tkComponentPanelInspector",e)}(),function(){"use strict";function e(e,n){return function(o,a,i){var s={visible:!0,genomeLength:816394,particles:0,particleSegments:5,curveSegments:1,radius:15,radiusSegments:16,endcap:!1,pathClosed:!1};i=i||{},angular.extend(this,angular.copy(s),i);for(var l=t(o),c=l.vertices.length-1;c>=0;c--){var g=new THREE.Color(a[20*c]);l.colors.unshift(g)}for(var u=n.cubic(l.vertices,this.pathClosed),d=new THREE.Geometry,p=0;p<u.vertices.length;p++){d.vertices.push(new THREE.Vector3(u.vertices[p].x,u.vertices[p].y,u.vertices[p].z||0));var b=u.colors[p];d.colors.push(b)}d.name="controlsGeom",0===this.particles&&(this.particles=l.vertices.length);var h=this.particles*this.particleSegments;this.pathSegments=h;for(var f=e.cubicBezier(u.vertices,h,this.pathClosed),m=f.createPointsGeometry(h),v=m.vertices.length-1;v>=0;v--){var y=new THREE.Color(a[v]);m.colors.unshift(y)}m.name="cubicGeom";var w=f.getLength(),k=15,x=11*this.genomeLength/1080;this.radius=w*k/x;for(var C=new THREE.Object3D,E=new THREE.Geometry,T=0;h>T;T++){this.endcap=0===T||T===h-1?!1:!0;var S=a[T],j=new THREE.MeshLambertMaterial({color:S,emissive:S,vertexColors:THREE.VertexColors,opacity:1,transparent:!1,wireframe:!1}),$=r(m.vertices[T],m.vertices[T+1],this);E.merge($);var A=new THREE.Mesh($,j);A.name="segment-"+(T+1),C.add(A)}return E.computeBoundingSphere(),C.boundingSphere=E.boundingSphere,C.name="Chromatin Fiber",C}}function t(e){for(var t,r=0,n=new THREE.Geometry,o=e.length;o>r;)t=new THREE.Vector3,t.x=e[r++],t.y=e[r++],t.z=e[r++],n.vertices.push(t);return n.name="Chromatin Geometry",n}function r(e,t,r){var n,o=(new THREE.Vector3).subVectors(t,e),a=new THREE.Matrix4;a.lookAt(e,t,(new THREE.Object3D).up);var i=new THREE.Matrix4;return i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),a.multiply(i),a.setPosition(e.add(t).multiplyScalar(.5)),n=new THREE.CylinderGeometry(r.radius,r.radius,o.length(),r.radiusSegments,r.curveSegments,r.endcap),n.applyMatrix(a),n}angular.module("TADkit").factory("Chromatin",e),e.$inject=["Paths","PathControls"]}(),function(){"use strict";function e(e,t,r,n,o){return{restrict:"EA",scope:{state:"=",type:"=",title:"@",settings:"=",view:"=",id:"@",cluster:"=",overlay:"="},templateUrl:"assets/templates/scene-cluster-icon.html",link:function(a,i,s){r.load(["TrackballControls","OrbitControls"]).then(function(r){var s,l,c,g,u,d,p,b,h,f,m,v=t.getRenderer();a.init=function(){s=i[0].children[0].children[0];var t=i[0].id.substring(20,i[0].id.length);console.log(t),console.log(a.cluster.number),l=parseInt(a.state.width),c=parseInt(a.state.height),v.setSize(l,c),1==a.cluster.number&&s.appendChild(v.domElement),e["scene"+a.cluster.number]=new r.Scene,g=new r.PerspectiveCamera(a.view.viewpoint.fov,l/c,a.view.viewpoint.near,a.view.viewpoint.far),g.position.fromArray(a.view.viewpoint.camera),g.name="Scene Camera",b=new r.TrackballControls(g,v.domElement),b.enableZoom=!1,b.enableRotate=!1,b.enablePan=!1,h=new r.OrbitControls(g,v.domElement),h.autoRotate=a.view.controls.autoRotate,h.autoRotateSpeed=a.view.controls.autoRotateSpeed,h.enableZoom=!1,h.enableRotate=!1,h.enablePan=!1,h.enableKeys=!1,f=new n(a.cluster.data[a.cluster.centroidIndex],a.view.settings.particles),f.visible=a.view.settings.particles.visible,e["scene"+a.cluster.number].add(f),m=new o(a.cluster.data,a.cluster.centroidIndex,a.overlay,a.view.settings.cluster),m.visible=a.view.settings.cluster.visible,m.name=m.name+" "+a.id.match(/\d+/)[0],e["scene"+a.cluster.number].add(m),u=new r.Vector3,d=new r.Vector3(0,0,0),p=m.boundingSphere.radius*a.view.viewpoint.scale,a.lookAtTarget(u,d,p)},a.lookAtTarget=function(e,t,n){e=e||new r.Vector3(5e4,5e4,5e4);var o=new r.Vector3(0,0,0);t=t||o,n=n||500,g.position.set(e.x,e.y,e.z),g.lookAt(o),g.translateZ(n),g.lookAt(t),g.updateMatrixWorld(),b.target.copy(e)},a.animate=function(){requestAnimationFrame(a.animate),h.update(),b.update(),a.render()},a.render=function(){1==a.cluster.number&&v.clear(),v.render(e["scene"+a.cluster.number],g)},a.init(),a.animate()})}}}angular.module("TADkit").directive("tkComponentSceneCluster",e),e.$inject=["$window","THREEService","THREEPlugins","Particles","Cluster"]}(),function(){"use strict";function e(e){return function(r,n,o,a){var i={visible:!0};a=a||{},angular.extend(this,angular.copy(i),a);for(var s=new THREE.BufferGeometry,l=e.colorsFromHex(o),c=new THREE.Object3D,g=0;g<r.length;g++){var u=r[g];s.addAttribute("position",new THREE.BufferAttribute(u,3));var d=t(u);d.colors=l;var p=(o[g],new THREE.LineBasicMaterial({color:new THREE.Color(this.color),opacity:this.modelOpacity,transparent:this.transparent,linewidth:this.linewidth,fog:this.fog})),b=new THREE.LineBasicMaterial({opacity:this.centroidOpacity,transparent:this.transparent,linewidth:this.linewidth,vertexColors:THREE.VertexColors,fog:this.fog});g==n&&(p=b);var h=new THREE.Line(d,p);h.name="model-"+g,c.add(h)}return s.computeBoundingBox(),c.boundingBox=s.boundingBox,c.BufferGeometry=s,c.name="Cluster Ensemble",c}}function t(e){for(var t,r=0,n=new THREE.Geometry,o=e.length;o>r;)t=new THREE.Vector3,t.x=e[r++],t.y=e[r++],t.z=e[r++],n.vertices.push(t);return n}angular.module("TADkit").factory("Cluster",e),e.$inject=["Color"]}(),function(){"use strict";function e(e,t,r,n){return{restrict:"EA",scope:{state:"=",type:"=",title:"@",settings:"=",view:"=",id:"@",clusters:"=",overlay:"=",mousemove:"&"},templateUrl:"assets/templates/scene-cluster-icon.html",link:function(o,a,i){t.load(["TrackballControls","OrbitControls"]).then(function(t){var i,s,l,c,g,u,d,p,b=e.getRenderer(),h=[];o.init=function(){i=a[0].children[0].children[0],s=800,l=400,b.setSize(s,l),i.appendChild(b.domElement),c=new t.PerspectiveCamera(o.view.viewpoint.fov,l/l,o.view.viewpoint.near,o.view.viewpoint.far),c.position.fromArray(o.view.viewpoint.camera),c.name="Scene Camera",p=new t.TrackballControls(c,b.domElement);var e=new t.Box3,f=new t.Sphere;angular.forEach(o.clusters,function(a,i){h[i]=new t.Scene;var s,l;s=new r(a.data[a.centroidIndex],o.view.settings.particles),s.visible=o.view.settings.particles.visible,h[i].add(s),l=new n(a.data,a.centroidIndex,o.overlay,o.view.settings.cluster),l.visible=o.view.settings.cluster.visible,l.name=l.name+" "+i,h[i].add(l),e.union(l.boundingBox),e.getBoundingSphere(f)}),g=f.center,u=f.center,d=f.radius*o.view.viewpoint.scale,o.lookAtTarget(g,u,d)},o.lookAtTarget=function(e,r,n){e=e||new t.Vector3(5e4,5e4,5e4);var o=new t.Vector3(0,0,0);r=r||o,n=n||500,c.position.set(e.x,e.y,e.z),c.lookAt(o),c.translateZ(n),c.lookAt(r),c.updateMatrixWorld(),p.target.copy(e),p.update()};var f,m=0;o.animate=function(){m>=0&&1>m?(f=requestAnimationFrame(o.animate),p.update(),o.render(),m++):cancelAnimationFrame(f)},o.render=function(){var e=[{left:0,bottom:0,width:.5,height:1,background:(new t.Color).setRGB(1,1,1)},{left:.5,bottom:0,width:.5,height:1,background:(new t.Color).setRGB(1,1,1)}],r=60;angular.forEach(o.clusters,function(t,n){0===n&&b.clear();var o=e[n],a=h[n];p.update();var i=Math.floor(s*o.left+r),g=Math.floor(l*o.bottom+r),u=Math.floor(s*o.width-2*r),d=Math.floor(l*o.height-2*r);b.setViewport(i,g,u,d),b.setScissor(i,g,u,d),b.enableScissorTest(!0),b.setClearColor(o.background),b.render(a,c,null,!0)})},o.init(),o.animate()})}}}angular.module("TADkit").directive("tkComponentSceneClusters",e),e.$inject=["THREEService","THREEPlugins","Particles","Cluster"]}(),function(){"use strict";function e(e,t,r){return{restrict:"EA",link:function(n,o,a){r.load(["TrackballControls","OrbitControls"]).then(function(r){var a,i,s,l,c,g,u,d,p=t.getRenderer();n.init=function(){a=o[0],i=a.clientWidth,p.setSize(i,i),a.appendChild(p.domElement),l=new r.Scene,s=new r.PerspectiveCamera(50,1,150,650),s.position.z=500,l.add(s),c=new r.TorusKnotGeometry(100,30,100,16),g=new r.MeshDepthMaterial({wireframe:!0}),u=new r.Mesh(c,g),u.name="Floating TAD",l.add(u)},e.$on("$stateChangeStart",function(){cancelAnimationFrame(d)}),n.animate=function(){d=requestAnimationFrame(n.animate),n.render()},n.render=function(){u.rotation.x+=.006,u.rotation.y+=.006,p.render(l,s,null,!0)},n.init(),n.animate()})}}}angular.module("TADkit").directive("tkComponentSceneFloatingtad",e),e.$inject=["$rootScope","THREEService","THREEPlugins"]}(),function(){"use strict";function e(e,r,n){return function(e,r,n){var o={color:"#ff0000",size:200,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0,visible:!1};n=n||{},angular.extend(this,angular.copy(o),n);var a={},i={uniforms:a,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,vertexColors:THREE.VertexColors,transparent:!0},s=new THREE.ShaderMaterial(i),l=e.length/3,c=.5*(l*l-l),g=t(e,c),u=r.RGB,d=r.alpha,p=new THREE.BufferGeometry;p.addAttribute("position",new THREE.BufferAttribute(g,3)),p.addAttribute("color",new THREE.BufferAttribute(u,3)),p.addAttribute("alpha",new THREE.BufferAttribute(d,1)),p.computeBoundingSphere();var b=null;if(this.map){var h=new THREE.TextureLoader;h.load(this.map,function(e){b=e},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.log("An error happened")})}var f=(new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:b,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),new THREE.LineSegments(p,s));return f.name="Network Graph",f}}function t(e,t){for(var r=new Float32Array(6*t),n=0,o=0;o<e.length;o+=3)for(var a=o,i=o+3;i<e.length;i+=3){var s=i;r[n]=e[a],n++,r[n]=e[a+1],n++,r[n]=e[a+2],n++,r[n]=e[s],n++,r[n]=e[s+1],n++,r[n]=e[s+2],n++}return r.name="Network Vertex Pairs",r}angular.module("TADkit").factory("Network",e),e.$inject=["Color","Particles","Networks"]}(),function(){"use strict";function e(){return function(e,r,n){var o={particles:0,visible:!0,color:"#ff0000",size:200,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0};n=n||{},angular.extend(this,angular.copy(o),n);var a=t(e);a.computeBoundingSphere();for(var i=[],s=0;s<a.vertices.length;s++)i[s]=new THREE.Color("rgb(255,255,255)");a.colors=i;var l=null;if(this.map){var c=new THREE.TextureLoader;c.load(this.map,function(e){l=e},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.log("An error happened")})}var g=new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:l,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),u=new THREE.Points(a,g);return u.name="Particles Cloud",u}}function t(e){for(var t,r=0,n=new THREE.Geometry,o=e.length;o>r;)t=new THREE.Vector3,t.x=e[r++],t.y=e[r++],t.z=e[r++],n.vertices.push(t);return n.name="Particles Geometry",n}angular.module("TADkit").factory("Particles",e)}(),function(){"use strict";function e(e){e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState},e.toggle=function(e){e=!e,console.log(e)}}angular.module("TADkit").controller("SceneController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,r,n,o,a){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",state:"=",currentmodel:"=",proximities:"=",currentoverlay:"="},templateUrl:"assets/templates/scene.html",link:function(i,s,l){r.load(["TrackballControls","OrbitControls"]).then(function(r){var l,c,g,u,d,p,b,h,f,m,v,y,w,k,x,C,E,T,S,j,$=t.getRenderer(),A=new r.Color,R=new r.Color,H=new r.Color("rgb(0,0,0)");i.init=function(){l=s[0].children[0].children[3],c=parseInt(i.state.width),g=parseInt(i.state.height);var e=i.view.settings.background;$.setSize(c,g),l.appendChild($.domElement),f=new r.Scene,m=new r.PerspectiveCamera(i.view.viewpoint.fov,c/g,i.view.viewpoint.near,i.view.viewpoint.far),m.position.fromArray(i.view.viewpoint.camera),m.name="Scene Camera",f.add(m),E=new r.TrackballControls(m,$.domElement),C=new r.OrbitControls(m,$.domElement),C.autoRotate=i.view.controls.autoRotate,C.autoRotateSpeed=i.view.controls.autoRotateSpeed,C.enableZoom=!1,C.enableRotate=!1,C.enablePan=!1,C.enableKeys=!1;var t=new r.AxisHelper(i.view.settings.axis.size);t.visible=i.view.settings.axis.visible,t.name="Axis",f.add(t);var u=i.view.settings.lighting.ambient;k=new r.AmbientLight(u),k.name="Scene Ambient Light",T=new n(i.currentmodel.data,i.currentoverlay.colors.particles,i.view.settings.particles),T.visible=i.view.settings.particles.visible,f.add(T),S=new o(i.currentmodel.data,i.currentoverlay.colors.chromatin,i.view.settings.chromatin),S.visible=i.view.settings.chromatin.visible,f.add(S),i.view.settings.chromatin.radius=S.boundingSphere.radius,j=new a(i.data,i.overlay.colors.network,i.view.settings.network),j.visible=i.view.settings.network.visible,f.add(j),v=S.boundingSphere.center,y=S.boundingSphere.center,w=S.boundingSphere.radius*i.view.viewpoint.scale,i.lookAtTAD(v,y,w);var d=i.view.settings.lighting.color,p=i.view.settings.lighting.intensity;x=new r.PointLight(d,p),x.name="Scene Light",m.add(x);var b=.5*w;x.position.set(b,b,-1*b);var h=100,I=(new r.PointLightHelper(x,h),w*i.view.viewpoint.fogNear),D=w*i.view.viewpoint.fogFar;i.view.viewpoint.fog&&(f.fog=new r.Fog(e,I,D)),i.$watch("view.controls.autoRotate",function(e,t){e!==t&&(C.autoRotate=i.view.controls.autoRotate)}),i.$watch("view.settings.axis.visible",function(e,r){e!==r&&(t.visible=!t.visible)}),i.$watch("view.settings.particles.visible",function(e,t){e!==t&&(T.visible=!T.visible)}),i.$watch("view.settings.chromatin.visible",function(e,t){e!==t&&(S.visible=!S.visible)}),i.$watch("view.settings.network.visible",function(e,t){e!==t&&(j.visible=!j.visible)});var B=f.getObjectByName("Particles Cloud"),P=f.getObjectByName("Chromatin Fiber"),O=f.getObjectByName("Network Graph");i.$watch("currentoverlay.colors.chromatin",function(e,t){if(e!==t)for(var n=P.children.length,o=0;n>o;o++){var a=new r.Color(e[o]);P.children[o].material.color=a,P.children[o].material.ambient=a,P.children[o].material.emissive=a}}),i.$watch("currentoverlay.colors.network",function(e,t){e!==t&&(O.geometry.addAttribute("color",new r.BufferAttribute(e.RGB,3)),O.geometry.addAttribute("alpha",new r.BufferAttribute(e.alpha,1)))}),i.$watch("settings.current.particle",function(e,t){e!==t&&(A&&(B.geometry.colors[t-1]=A),A=B.geometry.colors[e-1],B.geometry.colors[e-1]=H,B.geometry.colorsNeedUpdate=!0)}),i.$watch("settings.current.segment",function(e,t){if(e!==t){var r=P.getObjectByName("segment-"+t);R&&(r.material.color=R,r.material.ambient=R,r.material.emissive=R);var n=P.getObjectByName("segment-"+e);R=n.material.color,n.material.color=H,n.material.ambient=H,n.material.emissive=H}})},i.onWindowResize=function(){i.resizeCanvas()},e.$on("$stateChangeStart",function(){cancelAnimationFrame(h)}),i.resizeCanvas=function(){u=.66*l.parentNode.clientWidth,d=.66*u,p=u/2,b=d/2,m.aspect=u/d,m.updateProjectionMatrix(),$.setSize(u,d)},i.lookAtTAD=function(e,t,n){e=e||new r.Vector3(5e4,5e4,5e4);var o=new r.Vector3(0,0,0);t=t||o,n=n||500,m.position.set(e.x,e.y,e.z),m.lookAt(o),m.translateZ(n),m.lookAt(t),m.updateMatrixWorld(),E.target.copy(e)},i.animate=function(){h=requestAnimationFrame(i.animate),E.update(),i.render()},i.render=function(){$.render(f,m,null,!0)},i.init(),i.animate()})}}}angular.module("TADkit").directive("tkComponentScene",e),e.$inject=["$rootScope","THREEService","THREEPlugins","Particles","Chromatin","Network"]}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){e.load().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var o,a,i,s,l,c,g,u,d,p,b,h,f,m=r.data,v=r.view.viewpoint.chromStart,y=r.view.viewpoint.chromEnd,w=r.settings.current.particlesCount,k=parseInt(r.view.settings.margin),x={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},C=parseInt(r.view.settings.heightInner),E=(r.view.settings.color,r.overlay.palette[0]),T=r.overlay.palette[1],S=n[0].parentNode,j=n[0].children[0].children[3],$=e.select(j).append("svg");r.$watch(function(){var e=S.clientWidth,t=S.clientHeight;return e+t},function(){r.render(m)}),r.$watch("data.dimension",function(e,t){e!==t&&(m=r.data,r.render(m))}),r.$watch("settings.current.position",function(e,t){e!==t&&r.update()}),r.getColor=function(e){for(var t=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=t.length-1;n>=0;n--)e==t[n].code&&(r=t[n].color);return r},r.getOpacity=function(e){var t,r=e/5;return t=r*r},r.getStrokeWidth=function(e){var t=10,r=e/5;return t*=r},r.render=function(t){if($.selectAll("*").remove(),t){var n=S.clientWidth-2*k-x.left-x.right,m=C-x.top-x.bottom,j=1*n/w,A=j;o=e.scale.linear().range([0,n]).domain([v,y]).clamp(!0),a=e.scale.linear().domain([-5,5]).range([0,m]),i=e.svg.axis().scale(a).orient("left").ticks(6).outerTickSize(1);var R=2;s=e.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),l=$.attr("width",n+x.left+x.right).attr("height",m+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(s),l.append("g").attr("class","y axis").append("line").attr("y1",a(0)).attr("y2",a(0)).attr("x1",0).attr("x2",n),l.select(".background").attr("y",m/2).attr("height",m),c=l.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",m).style("fill","white"),g=l.append("g").attr("class","focus"),u=g.append("g").attr("class","container").attr("clip-path","url(#clip)"),b=u.append("g").attr("class","harmonics"),h=u.append("g").attr("class","lowerbounds"),d=g.append("g").attr("class","axis y").call(i),p=l.append("g").attr("class","labels"),b.selectAll("rect").data(t.harmonics).enter().append("rect").attr("x",function(e){return e[1]*A}).attr("y",function(e){return a(e[3])}).attr("width",A).attr("height",function(e){return a(e[3])}).style("fill",E).style("stroke",E).style("stroke-width",0).append("svg:title").text(function(e,t){return t+":"+e}),h.selectAll("rect").data(t.lowerBounds).enter().append("rect").attr("x",function(e){return e[1]*A}).attr("y",function(e){return a(Math.max(0,-1*e[3]))}).attr("width",A).attr("height",function(e){return a(e[3])}).style("fill",T).style("stroke",T).style("stroke-width",0).append("svg:title").text(function(e,t){return t+":"+e}),f=l.append("rect").attr("id","highlight").attr("x",function(e){return o(r.settings.current.position)}).attr("y",0).attr("width",R).attr("height",C).attr("class","highlight-follow")}},r.update=function(e){$.select("#highlight").attr("x",function(e){return o(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var a=s.extent()[0];e.event.sourceEvent&&(a=parseInt(o.invert(e.mouse(n)[0])),s.extent([a,a])),f.attr("x",o(a)),r.settings.current.position=a,r.settings.current.particle=t.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(m)})}}}angular.module("TADkit").directive("tkComponentTrackBarchart",e),e.$inject=["d3Service","Settings"]}(),function(){"use strict";function e(e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(t,r,n){e.load().then(function(e){var n,o,a,i,s,l,c,g=t.data,u=t.view.settings.step,d=t.view.viewpoint.chromStart,p=t.view.viewpoint.chromEnd,b=p-d,h=parseInt(t.view.settings.margin),f={top:parseInt(t.view.settings.padding.top),right:parseInt(t.view.settings.padding.right),bottom:parseInt(t.view.settings.padding.bottom),left:parseInt(t.view.settings.padding.left)},m=parseInt(t.view.settings.heightInner),v=.5*m,y=.5*(m-v),w=(t.view.settings.color,r[0].parentNode),k=r[0].children[0].children[3],x=e.select(k).append("svg");t.$watch(function(){var e=w.clientWidth,t=w.clientHeight;return e+t},function(){t.render(g)}),t.$watch("settings.current.position",function(e){t.update()},!0);e.behavior.zoom().on("zoom",function(){t.update()});t.render=function(r){if(x.selectAll("*").remove(),r){var g=w.clientWidth-2*h-f.left-f.right,k=m-f.top-f.bottom;n=u*g/b,c=e.scale.linear().range([0,g]).clamp(!0),c.domain([d,p]),i=e.svg.axis().scale(c).orient("top").ticks(0).outerTickSize(0);var C=2;o=x.attr("width",g+f.left+f.right).attr("height",k+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),a=o.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",g).attr("height",k).style("fill","white"),s=o.append("g").attr("class","focus"),l=s.append("g").attr("class","container").attr("clip-path","url(#clip)");o.append("g").attr("class","labels"),l.selectAll("rect").data(r).enter().append("rect").attr("x",function(e,t){return Math.floor(c(e.start))}).attr("y",y).attr("width",function(e){return Math.ceil(c(e.end)-c(e.start))}).attr("height",v).attr("class",function(e){return 1==e.read?t.title:void 0}).append("svg:title").text(function(e,t){return e.start+":"+e.end+"("+e.read+")"}),o.append("rect").attr("id","highlight").attr("x",function(e){return c(t.settings.current.position-.5*u)}).attr("y",0).attr("width",C).attr("height",m).attr("class","highlight-follow")}},t.update=function(){x.select("#highlight").attr("x",function(e){return c(t.settings.current.position-.5*u)})}})}}}angular.module("TADkit").directive("tkComponentBedgraph",e),e.$inject=["d3Service"]}(),function(){"use strict";function e(e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(t,r,n){e.load().then(function(e){var n=t.data,o=32e8;t.settings.current.position||(t.settings.current.position=o/2);var a=t.view.viewpoint.chromStart,i=t.view.viewpoint.chromEnd,s=i-a,l=1e3,c=o/s,g=.05*c;c-=2*g;var u,d,p,b,h,f,m=.5*s,v=.5*o,y=parseInt(t.view.settings.margin),w={top:parseInt(t.view.settings.padding.top),right:parseInt(t.view.settings.padding.right),bottom:parseInt(t.view.settings.padding.bottom),left:parseInt(t.view.settings.padding.left)},k=parseInt(t.view.settings.heightInner),x=10,C=r[0].parentNode,E=r[0].children[0].children[3],T=e.select(E).append("svg");t.$watch(function(){var e=C.clientWidth,t=C.clientHeight;return e+t},function(){t.render(n)}),t.$watch("data",function(e,r){e!==r&&t.render(e)}),t.$watch("settings.current.position",function(e,r){e!==r&&t.update()});e.behavior.zoom().on("zoom",function(){t.update()});t.render=function(r){if(T.selectAll("*").remove(),r){var n=C.clientWidth-2*y-w.left-w.right,o=k-w.top-w.bottom;f=e.scale.linear().range([0,n]).clamp(!0),f.domain([a,i]),p=e.svg.axis().scale(f).orient("top").ticks(0).outerTickSize(0);var s=2;f(v)-f(m);u=T.attr("width",n+w.left+w.right).attr("height",o+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")"),d=u.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",o).style("fill","white"),b=u.append("g").attr("class","focus"),h=b.append("g").attr("class","container").attr("clip-path","url(#clip)");var c=(b.append("g").attr("class","x axis").attr("transform","translate(0,"+x+")").call(p),u.append("g").attr("class","labels"));c.append("text").attr("x",-18).attr("y",8).style("text-anchor","right").style("font-size","10px").text("<<"),c.append("text").attr("x",-18).attr("y",18).style("text-anchor","right").style("font-size","10px").text(">>");h.selectAll("rect").data(r).enter().append("rect").attr("x",function(e){return Math.floor(f(e.start))}).attr("y",function(e){return t.view.settings.sense&&e.strand<1?x:0}).attr("width",function(e){return Math.ceil(f(e.end)-f(e.start))}).attr("height",function(e){return t.view.settings.sense?x:2*x}).attr("class",function(e){var t=e.biotypeStyle;return t+=e.strand<1?" forward-strand":" reverse-strand"}).append("svg:title").text(function(e){return e.external_name}),u.append("rect").attr("id","highlight").attr("x",function(e){return f(t.settings.current.position-.5*l)}).attr("y",0).attr("width",s).attr("height",k).attr("class","highlight-follow")}},t.update=function(){T.select("g.x.axis").call(p),h.selectAll("rect").attr("x",function(e){return Math.floor(f(e.start))}).attr("y",function(e){return t.view.settings.sense&&e.strand<1?x:0}).attr("width",function(e){return Math.ceil(f(e.end)-f(e.start))}).attr("height",function(e){return t.view.settings.sense?x:2*x}),T.select("#highlight").attr("x",function(e){return f(t.settings.current.position-.5*l)})}})}}}angular.module("TADkit").directive("tkComponentTrackGenes",e),e.$inject=["d3Service"]}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){e.load().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var o,a,i,s,l,c,g,u,d,p,b=r.data.distances,h=r.view.viewpoint.chromStart,f=r.view.viewpoint.chromEnd,m=r.settings.current.particlesCount,v="clip"+r.title,y="url(#"+v+")",w=parseInt(r.view.settings.margin),k={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},x=parseInt(r.view.settings.heightInner),C=.5*x,E=.5*(x-C),T=r.view.settings.color,S=n[0].parentNode,j=n[0].children[0].children[3],$=e.select(j).append("svg");r.$watch(function(){var e=S.clientWidth,t=S.clientHeight;return e+t},function(){r.render(b)}),r.$watch("data.dimension",function(e,t){e!==t&&(b=r.data.distances,r.render(b))}),r.$watch("settings.current.position",function(e,t){e!==t&&r.update()}),r.render=function(t){if($.selectAll("*").remove(),t){var n=S.clientWidth-2*w-k.left-k.right,b=x-k.top-k.bottom,j=1*n/m;o=e.scale.linear().range([0,n]).clamp(!0),o.domain([h,f]),a=e.svg.axis().scale(o).orient("top").ticks(0).outerTickSize(0);var A=2;i=e.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),s=$.attr("width",n+k.left+k.right).attr("height",b+k.top+k.bottom).append("g").attr("transform","translate("+k.left+","+k.top+")").call(i),s.select(".background").attr("y",b/2).attr("height",b),l=s.append("defs").append("clipPath").attr("id",v).append("rect").attr("width",n).attr("height",b).style("fill","white"),c=s.append("g").attr("class","focus"),g=c.append("g").attr("class","container").attr("clip-path",y),u=s.append("g").attr("class","labels"),d=g.selectAll("rect").data(t).enter().append("rect").attr("x",function(e,t){return t*j}).attr("y",E).attr("width",j).attr("height",C).style("fill",T).style("fill-opacity",function(e){
return e*e}).style("stroke",T).style("stroke-width",0).append("svg:title").text(function(e,t){return t+":"+e}),p=s.append("rect").attr("id","highlight").attr("x",function(e){return o(r.settings.current.position)}).attr("y",0).attr("width",A).attr("height",x).attr("class","highlight-follow"),p.call(i.extent([r.settings.current.position,0])).call(i.event)}},r.update=function(){$.select("#highlight").attr("x",function(e){return o(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var a=i.extent()[0];e.event.sourceEvent&&(a=parseInt(o.invert(e.mouse(n)[0])),i.extent([a,a])),p.attr("x",o(a)),r.settings.current.position=a,r.settings.current.particle=t.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(b)})}}}angular.module("TADkit").directive("tkComponentTrackProximities",e),e.$inject=["d3Service","Settings"]}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){e.load().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var o,a,i,s,l,c,g,u,d,p,b,h=r.data,f=r.view.viewpoint.chromStart,m=r.view.viewpoint.chromEnd,v=r.settings.current.particlesCount,y="clip"+r.title,w="url(#"+y+")",k=parseInt(r.view.settings.margin),x={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},C=2,E=parseInt(r.view.settings.heightInner),T=r.view.settings.nodeSize,S=x.top+.5*T,j=(r.view.settings.color,r.overlay.palette[0]),$=r.overlay.palette[1],A=n[0].parentNode,R=n[0].children[0].children[3],H=e.select(R).append("svg");r.$watch(function(){var e=A.clientWidth,t=A.clientHeight;return e+t},function(){r.render(r.data)}),r.$watch("data.dimension",function(e,t){e!==t&&(h=r.data,r.render(h))}),r.$watch("settings.current.position",function(e,t){e!==t&&r.update()}),r.getColor=function(e){for(var t=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=t.length-1;n>=0;n--)e==t[n].code&&(r=t[n].color);return r},r.getOpacity=function(e){var t,r=e/C;return t=r*r},r.getStrokeWidth=function(e){var t=5,r=e/5;return t*=r},r.render=function(t){if(H.selectAll("*").remove(),t){var n=A.clientWidth-2*k-x.left-x.right,h=E-x.top-x.bottom,C=1*n/v;o=e.scale.linear().range([0,n]).clamp(!0),o.domain([f,m]),a=e.svg.axis().scale(o).orient("top").ticks(0).outerTickSize(0),i=e.svg.axis().scale(o).orient("bottom").ticks(0).outerTickSize(0);var R=2;s=e.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),l=H.attr("width",n+x.left+x.right).attr("height",h+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(s),l.select(".background").attr("y",h/2).attr("height",h),c=l.append("defs"),c.append("clipPath").attr("id",y).append("rect").attr("width",n).attr("height",h).style("fill","white"),g=l.append("g").attr("class","focus"),d=g.append("g").attr("class","harmonics").attr("clip-path",w),p=g.append("g").attr("class","lowerbounds").attr("clip-path",w),u=l.append("g").attr("class","labels"),d.append("rect").attr("x",t.dimension*C-C).attr("y",S-.5*T).attr("width",C).attr("height",T).style("fill",j).append("svg:title").text(t.dimension),d.selectAll("line").data(t.harmonics).enter().append("line").attr("x1",function(e){return e[0]*C-.5*C}).attr("y1",S).attr("x2",function(e){return e[1]*C-.5*C}).attr("y2",h-T).attr("marker-end","url(#harmonics-marker)").style("stroke",j).style("opacity",1).style("stroke-width",function(e){return r.getStrokeWidth(e[3])}).append("svg:title").text(function(e){return e[1]+":"+e[3]}),d.selectAll("circle").data(t.harmonics).enter().append("circle").attr("cx",function(e){return e[1]*C-.5*C}).attr("cy",h-T).attr("r",.5*T).style("opacity",function(e){return r.getOpacity(e[3])}).style("fill",j).append("svg:title").text(function(e){return e[0]+" : "+e[1]}),p.append("rect").attr("x",t.dimension*C-C).attr("y",h-1.5*T).attr("width",C).attr("height",T).style("fill",$).append("svg:title").text(t.dimension),p.selectAll("line").data(t.lowerBounds).enter().append("line").attr("x1",function(e){return e[0]*C-.5*C}).attr("y2",S).attr("x2",function(e){return e[1]*C-.5*C}).attr("y1",h-T).attr("marker-end","url(#lowerbounds-marker)").style("stroke",$).style("opacity",function(e){return r.getOpacity(e[3])}).style("stroke-width",function(e){return r.getStrokeWidth(e[3])}).append("svg:title").text(function(e){return e[1]+":"+e[3]}),p.selectAll("circle").data(t.lowerBounds).enter().append("circle").attr("cx",function(e){return e[1]*C-.5*C}).attr("cy",S).attr("r",.5*T).style("opacity",function(e){return r.getOpacity(e[3])}).style("fill",$).append("svg:title").text(function(e){return e[0]+" : "+e[1]}),b=l.append("rect").attr("id","highlight").attr("x",o(r.settings.current.position)).attr("y",0).attr("width",R).attr("height",E).attr("class","highlight-follow")}},r.update=function(e){H.select("#highlight").attr("x",function(e){return o(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var a=s.extent()[0];e.event.sourceEvent&&(a=parseInt(o.invert(e.mouse(n)[0])),s.extent([a,a])),b.attr("x",o(a)),r.settings.current.position=a,r.settings.current.particle=t.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(h)})}}}angular.module("TADkit").directive("tkComponentTrackRestraints",e),e.$inject=["d3Service","Settings"]}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){e.load().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var o,a,i,s,l,c,g,u,d,p,b=(r.data,r.view.viewpoint.chromStart),h=r.view.viewpoint.chromEnd,f=(r.view.settings.cursorWidth,parseInt(r.view.settings.margin)),m={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},v=parseInt(r.view.settings.heightInner),y=n[0].parentNode,w=n[0].children[0].children[3],k=e.select(w).append("svg");r.$watch(function(){var e=y.clientWidth,t=y.clientHeight;return e+t},function(){r.render()}),r.$watch("settings.current.position",function(e,t){e!==t&&r.update()}),r.render=function(){k.selectAll("*").remove();var t=y.clientWidth-2*f-m.left-m.right,n=v-m.bottom-m.top;a=e.scale.linear().range([0,t]).clamp(!0),a.domain([b,h]),g=e.svg.axis().scale(a).orient("bottom").ticks(4),i=e.svg.axis().orient("left"),s=e.svg.axis().orient("right"),l=.5*n,c=v,u=e.svg.brush().x(a).extent([0,0]).on("brush",r.brushed),o=k.attr("width",t+m.left+m.right).attr("height",n+m.top+m.bottom).append("g").attr("transform","translate("+m.left+", 0)");var w=o.append("g").attr("class","labels");w.append("text").attr("x",-16).attr("y",26).style("text-anchor","right").style("font-size","10px").text("3'"),w.append("text").attr("x",t+8).attr("y",26).style("text-anchor","left").style("font-size","10px").text("5'");o.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(g).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");o.append("g").attr("class","slider").call(u),o.select(".background").attr("y",n/2).attr("height",n),d=o.append("circle").attr("id","handle").attr("class","handle").attr("cx",a(r.settings.current.position)).attr("cy",n).attr("r",.6*l),p=o.append("text").attr("id","position").attr("x",a(r.settings.current.position)-.5*l).attr("y",n-10).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text(r.settings.current.particle),o.call(u.extent([r.settings.current.position,0])).call(u.event)},r.update=function(e){k.select("#handle").attr("cx",a(r.settings.current.position)),k.select("#position").attr("x",a(r.settings.current.position)-.5*l).text(r.settings.current.particle)},r.brushed=function(){var n=this;r.safeApply(function(){var o=u.extent()[0];e.event.sourceEvent&&(o=parseInt(a.invert(e.mouse(n)[0])),u.extent([o,o])),d.attr("cx",a(o)),r.settings.current.position=o,r.settings.current.particle=t.getParticle(),r.settings.current.segment=t.getSegment(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})}})}}}angular.module("TADkit").directive("tkComponentTrackSlider",e),e.$inject=["d3Service","Settings"]}(),function(){"use strict";function e(e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(t,r,n){e.load().then(function(e){var n,o,a,i,s,l,c,g=t.data,u=t.view.settings.step,d=t.view.viewpoint.chromStart,p=t.view.viewpoint.chromEnd,b=p-d,h=parseInt(t.view.settings.margin),f={top:parseInt(t.view.settings.padding.top),right:parseInt(t.view.settings.padding.right),bottom:parseInt(t.view.settings.padding.bottom),left:parseInt(t.view.settings.padding.left)},m=parseInt(t.view.settings.heightInner),v=.5*m,y=.5*(m-v),w=t.view.settings.color,k=r[0].parentNode,x=r[0].children[0].children[3],C=e.select(x).append("svg");t.$watch(function(){var e=k.clientWidth,t=k.clientHeight;return e+t},function(){t.render(g)}),t.$watch("settings.current.position",function(e){t.update()},!0);e.behavior.zoom().on("zoom",function(){t.update()});t.render=function(r){if(C.selectAll("*").remove(),r){var g=k.clientWidth-2*h-f.left-f.right,x=m-f.top-f.bottom;n=u*g/b,c=e.scale.linear().range([0,g]).clamp(!0),c.domain([d,p]),i=e.svg.axis().scale(c).orient("top").ticks(0).outerTickSize(0);var E=2;o=C.attr("width",g+f.left+f.right).attr("height",x+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),a=o.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",g).attr("height",x).style("fill","white"),s=o.append("g").attr("class","focus"),l=s.append("g").attr("class","container").attr("clip-path","url(#clip)");o.append("g").attr("class","labels"),l.selectAll("rect").data(r).enter().append("rect").attr("x",function(e,t){return(t+1)*n}).attr("y",y).attr("width",n).attr("height",v).style("fill",w).style("fill-opacity",function(e){return e}).style("stroke",w).style("stroke-width",0).append("svg:title").text(function(e,t){return t+":"+e}),o.append("rect").attr("id","highlight").attr("x",function(e){return c(t.settings.current.position-.5*u)}).attr("y",0).attr("width",E).attr("height",m).attr("class","highlight-follow")}},t.update=function(){C.select("#highlight").attr("x",function(e){return c(t.settings.current.position-.5*u)})}})}}}angular.module("TADkit").directive("tkComponentWiggle0",e),e.$inject=["d3Service"]}(),function(){"use strict";function e(e){e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState}}angular.module("TADkit").controller("TrackController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e){}angular.module("TADkit").controller("HomeController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,r,n,o,a,i,s,l){r.settings||(r.settings=n.get()),r.settings.app.isProject=e.is("project"),r.$on("$stateChangeSuccess",function(){r.settings.app.isProject=e.is("project")}),r.users||(r.users=o.get(),"undefined"!=typeof r.users.loaded[0].projects&&0===r.users.loaded[0].projects.length&&(r.users.loaded[0].projects=a.get(),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].datasets&&0===r.users.loaded[0].projects.loaded[0].datasets.length&&(r.users.loaded[0].projects.loaded[0].datasets=i.get()),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].overlays&&0===r.users.loaded[0].projects.loaded[0].overlays.length&&(r.users.loaded[0].projects.loaded[0].overlays=s.get()),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].storyboards&&0===r.users.loaded[0].projects.loaded[0].storyboards.length&&(r.users.loaded[0].projects.loaded[0].storyboards=l.get()))),r.current={},r.current.user=o.getUser(),r.current.project=a.getProject(),r.current.dataset=i.getDataset(),r.current.model=i.getModel(),r.current.overlay=s.getOverlay(),r.current.storyboard=l.getStoryboard()}angular.module("TADkit").controller("MainController",e),e.$inject=["$state","$stateParams","$scope","Settings","Users","Projects","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function e(t,r,n,o,a,i,s,l,c){r.fileTitle="No file loaded",r.$on("$viewContentLoaded",function(){function a(e,t,r){console.log("showing dialog")}var i=angular.element(document.body),s="assets/templates/"+t.current.name+".html";n.show({parent:i,templateUrl:s,controller:e,locals:{overlays:r.$parent.overlays},onComplete:a}).then(function(e){o.show(o.simple().content("Overlays ("+e+") added"))},function(){o.show(o.simple().content("cancelled")),t.go("browser")})}),r.parseFile=function(e){r.fileData=i.parse(e).data,r.selectedRows=[];for(var t=r.fileData.length;--t>=0;)r.selectedRows[t]=!0;r.selectedCols=[];for(var n=r.fileData[0].length;--n>=0;)r.selectedCols[n]=!0;console.log("File Opened...")},r.importData=function(e){r.importedOverlays=i["import"](e,r.selectedRows,r.selectedCols),n.hide(r.importedOverlays.length),t.go("browser")},r.hide=function(){n.hide(r.overlaysAcquired)},r.cancel=function(){n.cancel()}}angular.module("TADkit").controller("OverlayImportController",e),e.$inject=["$state","$scope","$mdDialog","$mdToast","Settings","CustomTracks","Components","Storyboards","uuid4"]}(),function(){"use strict";function e(e){return{restrict:"A",scope:{tkOverlayImport:"&",filetitle:"="},link:function(e,t,r){t.on("change",function(t){var r=new FileReader;r.onload=function(t){e.$apply(function(){e.tkOverlayImport({$fileContent:t.target.result})})},r.readAsText((t.srcElement||t.target).files[0]),e.filetitle=(t.srcElement||t.target).files[0].name})}}}angular.module("TADkit").directive("tkOverlayImport",e),e.$inject=["$parse"]}(),function(){"use strict";function e(e){}angular.module("TADkit").controller("ProjectContentController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,r,n,o,a){t.clusterComponent=o.getComponentById("datasets-scene-icon");var i=n.getOverlayById("gradient"),s=t.current.model.data.length/t.current.dataset.object.components,l=a.gradientHCL(i,s);t.clusterComponent.overlay=l;for(var c=new THREE.BufferGeometry,g=t.current.dataset.models.length-1;g>=0;g--)c.addAttribute("position",new THREE.BufferAttribute(t.current.dataset.models[p],3));c.computeBoundingSphere(),t.clusterComponent.view.viewpoint.translate=c.boundingSphere.radius,t.clusters=[];for(var u=t.current.dataset.clusters,d=t.current.dataset.models,p=u.length-1;p>=0;p--){var b={};b.number=p+1,b.list=u[p],b.centroidIndex=b.list.indexOf(r.getCentroid(b.number)),b.data=[];for(var h=b.list.length-1;h>=0;h--){for(var f,m=d.length-1;m>=0;m--){var v=d[m];parseInt(v.ref)==b.list[h]&&(f=v.data)}f?b.data.unshift(f):console.log("Listed model not found!")}t.clusters.unshift(b)}t.selectCluster=function(n){t.clusterArray=r.setCluster(n+1),t.centroidRef=r.getCentroid(),console.log("Current Cluster: "+(n+1)+"(Centroid Model: "+t.centroidRef+")"),e.go("browser")}}angular.module("TADkit").controller("ProjectDatasetController",e),e.$inject=["$state","$scope","Datasets","Overlays","Components","Segments"]}(),function(){"use strict";function e(e,t){return{restrict:"A",link:function(e,r,n){var o=n.dropzone,a=t(o),i=function(e){e.preventDefault(),r.addClass("dragOver")},s=function(e){e.preventDefault(),r.removeClass("dragOver")},l=function(t){var r=new FileReader;r.onload=function(t){e.$apply(function(){a(e,{$fileContent:t.target.result}),e.addDataset(t.target.result)})},r.readAsText(t),console.log("File loaded...")};r.bind("dragover",i).bind("dragleave",s).bind("drop",function(e){s(e),l(e.dataTransfer.files[0])}),e.$watch(o,function(){r.attr("src",a(e))})}}}angular.module("TADkit").directive("tkProjectDropzone",e),e.$inject=["$state","$parse"]}(),function(){"use strict";function e(e,t,r,n,o,a,i){n.updateCurrent=function(){n.current.dataset=o.getDataset(),n.current.model=o.getModel(),n.current.overlay=a.getOverlay(),n.current.storyboard=i.getStoryboard(),console.log("Current dataset, model, overlay and storyboard updated.")},n.loadDatasetFromParam=function(){var a=o.load(r.loadDataset);return e.all([a]).then(function(e){n.updateCurrent(),console.log("Dataset loaded: "+r.loadDataset),t.go("browser")})},r.loadDataset&&n.loadDatasetFromParam(),n.addDataset=function(r){var a=o.add(r);return e.all([a]).then(function(e){n.updateCurrent(),console.log("Dataset added."),t.go("dataset")})}}angular.module("TADkit").controller("ProjectLoaderController",e),e.$inject=["$q","$state","$stateParams","$scope","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function e(e,t){return{restrict:"A",scope:!1,link:function(e,r,n){var o=t(n.tkProjectLoader);r.on("change",function(t){var r=new FileReader;r.onload=function(t){console.log("Data Loaded"),e.$apply(function(){o(e,{$fileContent:t.target.result})})},r.readAsText((t.srcElement||t.target).files[0])})}}}angular.module("TADkit").directive("tkProjectLoader",e),e.$inject=["$state","$parse"]}(),function(){"use strict";function e(e){}angular.module("TADkit").controller("ProjectOverlayController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e){}angular.module("TADkit").controller("ProjectStoryboardController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t){e.toggleSetting=function(r){e.settings=t.toggle(r)}}angular.module("TADkit").controller("SidebarBrowserController",e),e.$inject=["$scope","Settings"]}(),function(){"use strict";function e(e,t,r,n){e.setCurrentDataset=function(e){t.set(e)},e.setCurrentOverlay=function(e){r.set(e)},e.setCurrentStoryboard=function(e){n.set(e)}}angular.module("TADkit").controller("SidebarProjectController",e),e.$inject=["$scope","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function e(e){}angular.module("TADkit").controller("SidebarUserController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,r,n,o,a,i,s){angular.element(e).on("resize",function(){t.$apply()}),t.settings.views.scale=1,n.setViewpoint(t.settings.current.chromStart,t.settings.current.chromEnd,t.settings.views.scale),o.setViewpoint(t.settings.current.chromStart,t.settings.current.chromEnd,t.settings.views.scale),t.allProximities=i.get(),t.currentProximities=i.at(t.settings.current.particle),t.currentRestraints=s.at(t.settings.current.particle),angular.forEach(t.current.storyboard.components,function(e,r){var n;"scene"==e.object.type?(e.data=t.current.model.data,e.proximities=t.allProximities,e.overlay=t.current.overlay,e.overlay.state={},e.overlay.object.state.index=a.getCurrentIndex()):"track-genes"==e.object.type||"panel-inspector"==e.object.type?(n=a.getOverlayById("genes"),e.data=n.data,e.overlay=n):"track-proximities"==e.object.type?(e.data=t.currentProximities,n=a.getOverlayById("proximities"),e.overlay=n):"track-restraints"==e.object.type&&(e.data=t.currentRestraints,n=a.getOverlayById("restraints"),e.overlay=n)}),t.$watch("settings.current.particle",function(e,r){e!==r&&(t.currentProximities=i.at(e),t.currentRestraints=s.at(e),"matrix"==t.current.overlay.object.type&&(a.at(e),t.current.overlay=a.getOverlay()))}),t.overlayOrig=t.current.overlay,t.toggleOverlay=function(e){t.overlaid=a.getOverlay(e).object.state.overlaid,t.overlaid?(a.setOverlaid(t.overlayOrig.object.state.index),a.set(t.overlayOrig.object.state.index),t.current.overlay=a.getOverlay()):(a.setOverlaid(e),a.set(e),t.current.overlay=a.getOverlay())},t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState},t.toggle=function(e){e=!e,console.log(e)},t.testfn=function(){console.log("test worked")}}angular.module("TADkit").controller("StoryboardController",e),e.$inject=["$window","$scope","Settings","Storyboards","Components","Overlays","Proximities","Restraints"]}(),function(){"use strict";function e(e,t,r){t.$state=e,e.includes("main.project")&&(t.projectTitle=t.users[0].projects[0].object.title),t.toggleLeft=function(){r("left").toggle()},t.toggleRight=function(){r("right").toggle()}}angular.module("TADkit").controller("TopbarController",e),e.$inject=["$state","$scope","$mdSidenav"]}(),function(){"use strict";function e(){var e={};return e.re_={x11rgb:/^\s*rgb:([a-f0-9]{1,4})\/([a-f0-9]{1,4})\/([a-f0-9]{1,4})\s*$/i},e.colorNames={transparent:"rgb(0, 0, 0)",rust:"rgb(243, 137, 92)",stripes:"rgb(255, 54, 54)",dark_blue:"rgb(0, 0, 139)",contigblue1:"rgb(0, 0, 139)",contigblue2:"rgb(173, 216, 230)","border:grey70":"rgb(179, 179, 179)",aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",antiquewhite1:"rgb(255, 239, 219)",antiquewhite2:"rgb(238, 223, 204)",antiquewhite3:"rgb(205, 192, 176)",antiquewhite4:"rgb(139, 131, 120)",aquamarine:"rgb(127, 255, 212)",aquamarine1:"rgb(127, 255, 212)",aquamarine2:"rgb(118, 238, 198)",aquamarine3:"rgb(102, 205, 170)",aquamarine4:"rgb(69, 139, 116)",azure:"rgb(240, 255, 255)",azure1:"rgb(240, 255, 255)",azure2:"rgb(224, 238, 238)",azure3:"rgb(193, 205, 205)",azure4:"rgb(131, 139, 139)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",bisque1:"rgb(255, 228, 196)",bisque2:"rgb(238, 213, 183)",bisque3:"rgb(205, 183, 158)",bisque4:"rgb(139, 125, 107)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blue1:"rgb(0, 0, 255)",blue2:"rgb(0, 0, 238)",blue3:"rgb(0, 0, 205)",blue4:"rgb(0, 0, 139)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",brown1:"rgb(255, 64, 64)",brown2:"rgb(238, 59, 59)",brown3:"rgb(205, 51, 51)",brown4:"rgb(139, 35, 35)",burlywood:"rgb(222, 184, 135)",burlywood1:"rgb(255, 211, 155)",burlywood2:"rgb(238, 197, 145)",burlywood3:"rgb(205, 170, 125)",burlywood4:"rgb(139, 115, 85)",cadetblue:"rgb(95, 158, 160)",cadetblue1:"rgb(152, 245, 255)",cadetblue2:"rgb(142, 229, 238)",cadetblue3:"rgb(122, 197, 205)",cadetblue4:"rgb(83, 134, 139)",chartreuse:"rgb(127, 255, 0)",chartreuse1:"rgb(127, 255, 0)",chartreuse2:"rgb(118, 238, 0)",chartreuse3:"rgb(102, 205, 0)",chartreuse4:"rgb(69, 139, 0)",chocolate:"rgb(210, 105, 30)",chocolate1:"rgb(255, 127, 36)",chocolate2:"rgb(238, 118, 33)",chocolate3:"rgb(205, 102, 29)",chocolate4:"rgb(139, 69, 19)",coral:"rgb(255, 127, 80)",coral1:"rgb(255, 114, 86)",coral2:"rgb(238, 106, 80)",coral3:"rgb(205, 91, 69)",coral4:"rgb(139, 62, 47)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",cornsilk1:"rgb(255, 248, 220)",cornsilk2:"rgb(238, 232, 205)",cornsilk3:"rgb(205, 200, 177)",cornsilk4:"rgb(139, 136, 120)",cyan:"rgb(0, 255, 255)",cyan1:"rgb(0, 255, 255)",cyan2:"rgb(0, 238, 238)",cyan3:"rgb(0, 205, 205)",cyan4:"rgb(0, 139, 139)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgoldenrod1:"rgb(255, 185, 15)",darkgoldenrod2:"rgb(238, 173, 14)",darkgoldenrod3:"rgb(205, 149, 12)",darkgoldenrod4:"rgb(139, 101, 8)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkolivegreen1:"rgb(202, 255, 112)",darkolivegreen2:"rgb(188, 238, 104)",darkolivegreen3:"rgb(162, 205, 90)",darkolivegreen4:"rgb(110, 139, 61)",darkorange:"rgb(255, 140, 0)",darkorange1:"rgb(255, 127, 0)",darkorange2:"rgb(238, 118, 0)",darkorange3:"rgb(205, 102, 0)",darkorange4:"rgb(139, 69, 0)",darkorchid:"rgb(153, 50, 204)",darkorchid1:"rgb(191, 62, 255)",darkorchid2:"rgb(178, 58, 238)",darkorchid3:"rgb(154, 50, 205)",darkorchid4:"rgb(104, 34, 139)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkseagreen1:"rgb(193, 255, 193)",darkseagreen2:"rgb(180, 238, 180)",darkseagreen3:"rgb(155, 205, 155)",darkseagreen4:"rgb(105, 139, 105)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategray1:"rgb(151, 255, 255)",darkslategray2:"rgb(141, 238, 238)",darkslategray3:"rgb(121, 205, 205)",darkslategray4:"rgb(82, 139, 139)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",debianred:"rgb(215, 7, 81)",deeppink:"rgb(255, 20, 147)",deeppink1:"rgb(255, 20, 147)",deeppink2:"rgb(238, 18, 137)",deeppink3:"rgb(205, 16, 118)",deeppink4:"rgb(139, 10, 80)",deepskyblue:"rgb(0, 191, 255)",deepskyblue1:"rgb(0, 191, 255)",deepskyblue2:"rgb(0, 178, 238)",deepskyblue3:"rgb(0, 154, 205)",deepskyblue4:"rgb(0, 104, 139)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",dodgerblue1:"rgb(30, 144, 255)",dodgerblue2:"rgb(28, 134, 238)",dodgerblue3:"rgb(24, 116, 205)",dodgerblue4:"rgb(16, 78, 139)",firebrick:"rgb(178, 34, 34)",firebrick1:"rgb(255, 48, 48)",firebrick2:"rgb(238, 44, 44)",firebrick3:"rgb(205, 38, 38)",firebrick4:"rgb(139, 26, 26)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",gold1:"rgb(255, 215, 0)",gold2:"rgb(238, 201, 0)",gold3:"rgb(205, 173, 0)",gold4:"rgb(139, 117, 0)",goldenrod:"rgb(218, 165, 32)",goldenrod1:"rgb(255, 193, 37)",goldenrod2:"rgb(238, 180, 34)",goldenrod3:"rgb(205, 155, 29)",goldenrod4:"rgb(139, 105, 20)",gray:"rgb(190, 190, 190)",gray0:"rgb(0, 0, 0)",gray1:"rgb(3, 3, 3)",gray10:"rgb(26, 26, 26)",gray100:"rgb(255, 255, 255)",gray11:"rgb(28, 28, 28)",gray12:"rgb(31, 31, 31)",gray13:"rgb(33, 33, 33)",gray14:"rgb(36, 36, 36)",gray15:"rgb(38, 38, 38)",gray16:"rgb(41, 41, 41)",gray17:"rgb(43, 43, 43)",gray18:"rgb(46, 46, 46)",gray19:"rgb(48, 48, 48)",gray2:"rgb(5, 5, 5)",gray20:"rgb(51, 51, 51)",gray21:"rgb(54, 54, 54)",gray22:"rgb(56, 56, 56)",gray23:"rgb(59, 59, 59)",gray24:"rgb(61, 61, 61)",gray25:"rgb(64, 64, 64)",gray26:"rgb(66, 66, 66)",gray27:"rgb(69, 69, 69)",gray28:"rgb(71, 71, 71)",gray29:"rgb(74, 74, 74)",gray3:"rgb(8, 8, 8)",gray30:"rgb(77, 77, 77)",gray31:"rgb(79, 79, 79)",gray32:"rgb(82, 82, 82)",gray33:"rgb(84, 84, 84)",gray34:"rgb(87, 87, 87)",gray35:"rgb(89, 89, 89)",gray36:"rgb(92, 92, 92)",gray37:"rgb(94, 94, 94)",gray38:"rgb(97, 97, 97)",gray39:"rgb(99, 99, 99)",gray4:"rgb(10, 10, 10)",gray40:"rgb(102, 102, 102)",gray41:"rgb(105, 105, 105)",gray42:"rgb(107, 107, 107)",gray43:"rgb(110, 110, 110)",gray44:"rgb(112, 112, 112)",gray45:"rgb(115, 115, 115)",gray46:"rgb(117, 117, 117)",gray47:"rgb(120, 120, 120)",gray48:"rgb(122, 122, 122)",gray49:"rgb(125, 125, 125)",gray5:"rgb(13, 13, 13)",gray50:"rgb(127, 127, 127)",gray51:"rgb(130, 130, 130)",gray52:"rgb(133, 133, 133)",gray53:"rgb(135, 135, 135)",gray54:"rgb(138, 138, 138)",gray55:"rgb(140, 140, 140)",gray56:"rgb(143, 143, 143)",gray57:"rgb(145, 145, 145)",gray58:"rgb(148, 148, 148)",gray59:"rgb(150, 150, 150)",gray6:"rgb(15, 15, 15)",gray60:"rgb(153, 153, 153)",gray61:"rgb(156, 156, 156)",gray62:"rgb(158, 158, 158)",gray63:"rgb(161, 161, 161)",gray64:"rgb(163, 163, 163)",gray65:"rgb(166, 166, 166)",gray66:"rgb(168, 168, 168)",gray67:"rgb(171, 171, 171)",gray68:"rgb(173, 173, 173)",gray69:"rgb(176, 176, 176)",gray7:"rgb(18, 18, 18)",gray70:"rgb(179, 179, 179)",gray71:"rgb(181, 181, 181)",gray72:"rgb(184, 184, 184)",gray73:"rgb(186, 186, 186)",gray74:"rgb(189, 189, 189)",gray75:"rgb(191, 191, 191)",gray76:"rgb(194, 194, 194)",gray77:"rgb(196, 196, 196)",gray78:"rgb(199, 199, 199)",gray79:"rgb(201, 201, 201)",gray8:"rgb(20, 20, 20)",gray80:"rgb(204, 204, 204)",gray81:"rgb(207, 207, 207)",gray82:"rgb(209, 209, 209)",gray83:"rgb(212, 212, 212)",gray84:"rgb(214, 214, 214)",gray85:"rgb(217, 217, 217)",gray86:"rgb(219, 219, 219)",gray87:"rgb(222, 222, 222)",gray88:"rgb(224, 224, 224)",gray89:"rgb(227, 227, 227)",gray9:"rgb(23, 23, 23)",gray90:"rgb(229, 229, 229)",gray91:"rgb(232, 232, 232)",gray92:"rgb(235, 235, 235)",gray93:"rgb(237, 237, 237)",gray94:"rgb(240, 240, 240)",gray95:"rgb(242, 242, 242)",gray96:"rgb(245, 245, 245)",gray97:"rgb(247, 247, 247)",gray98:"rgb(250, 250, 250)",gray99:"rgb(252, 252, 252)",green:"rgb(0, 255, 0)",green1:"rgb(0, 255, 0)",green2:"rgb(0, 238, 0)",green3:"rgb(0, 205, 0)",green4:"rgb(0, 139, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(190, 190, 190)",grey0:"rgb(0, 0, 0)",grey1:"rgb(3, 3, 3)",grey10:"rgb(26, 26, 26)",grey100:"rgb(255, 255, 255)",grey11:"rgb(28, 28, 28)",grey12:"rgb(31, 31, 31)",grey13:"rgb(33, 33, 33)",grey14:"rgb(36, 36, 36)",grey15:"rgb(38, 38, 38)",grey16:"rgb(41, 41, 41)",grey17:"rgb(43, 43, 43)",grey18:"rgb(46, 46, 46)",grey19:"rgb(48, 48, 48)",grey2:"rgb(5, 5, 5)",grey20:"rgb(51, 51, 51)",grey21:"rgb(54, 54, 54)",grey22:"rgb(56, 56, 56)",grey23:"rgb(59, 59, 59)",grey24:"rgb(61, 61, 61)",grey25:"rgb(64, 64, 64)",grey26:"rgb(66, 66, 66)",grey27:"rgb(69, 69, 69)",grey28:"rgb(71, 71, 71)",grey29:"rgb(74, 74, 74)",grey3:"rgb(8, 8, 8)",grey30:"rgb(77, 77, 77)",grey31:"rgb(79, 79, 79)",grey32:"rgb(82, 82, 82)",grey33:"rgb(84, 84, 84)",grey34:"rgb(87, 87, 87)",grey35:"rgb(89, 89, 89)",grey36:"rgb(92, 92, 92)",grey37:"rgb(94, 94, 94)",grey38:"rgb(97, 97, 97)",grey39:"rgb(99, 99, 99)",grey4:"rgb(10, 10, 10)",grey40:"rgb(102, 102, 102)",grey41:"rgb(105, 105, 105)",grey42:"rgb(107, 107, 107)",grey43:"rgb(110, 110, 110)",grey44:"rgb(112, 112, 112)",grey45:"rgb(115, 115, 115)",grey46:"rgb(117, 117, 117)",grey47:"rgb(120, 120, 120)",grey48:"rgb(122, 122, 122)",grey49:"rgb(125, 125, 125)",grey5:"rgb(13, 13, 13)",grey50:"rgb(127, 127, 127)",grey51:"rgb(130, 130, 130)",grey52:"rgb(133, 133, 133)",grey53:"rgb(135, 135, 135)",grey54:"rgb(138, 138, 138)",grey55:"rgb(140, 140, 140)",grey56:"rgb(143, 143, 143)",grey57:"rgb(145, 145, 145)",grey58:"rgb(148, 148, 148)",grey59:"rgb(150, 150, 150)",grey6:"rgb(15, 15, 15)",grey60:"rgb(153, 153, 153)",grey61:"rgb(156, 156, 156)",grey62:"rgb(158, 158, 158)",grey63:"rgb(161, 161, 161)",grey64:"rgb(163, 163, 163)",grey65:"rgb(166, 166, 166)",grey66:"rgb(168, 168, 168)",grey67:"rgb(171, 171, 171)",grey68:"rgb(173, 173, 173)",grey69:"rgb(176, 176, 176)",grey7:"rgb(18, 18, 18)",grey70:"rgb(179, 179, 179)",grey71:"rgb(181, 181, 181)",grey72:"rgb(184, 184, 184)",grey73:"rgb(186, 186, 186)",grey74:"rgb(189, 189, 189)",grey75:"rgb(191, 191, 191)",grey76:"rgb(194, 194, 194)",grey77:"rgb(196, 196, 196)",grey78:"rgb(199, 199, 199)",grey79:"rgb(201, 201, 201)",grey8:"rgb(20, 20, 20)",grey80:"rgb(204, 204, 204)",grey81:"rgb(207, 207, 207)",grey82:"rgb(209, 209, 209)",grey83:"rgb(212, 212, 212)",grey84:"rgb(214, 214, 214)",grey85:"rgb(217, 217, 217)",grey86:"rgb(219, 219, 219)",grey87:"rgb(222, 222, 222)",grey88:"rgb(224, 224, 224)",grey89:"rgb(227, 227, 227)",grey9:"rgb(23, 23, 23)",grey90:"rgb(229, 229, 229)",grey91:"rgb(232, 232, 232)",grey92:"rgb(235, 235, 235)",grey93:"rgb(237, 237, 237)",grey94:"rgb(240, 240, 240)",grey95:"rgb(242, 242, 242)",grey96:"rgb(245, 245, 245)",grey97:"rgb(247, 247, 247)",grey98:"rgb(250, 250, 250)",grey99:"rgb(252, 252, 252)",honeydew:"rgb(240, 255, 240)",honeydew1:"rgb(240, 255, 240)",honeydew2:"rgb(224, 238, 224)",honeydew3:"rgb(193, 205, 193)",honeydew4:"rgb(131, 139, 131)",hotpink:"rgb(255, 105, 180)",hotpink1:"rgb(255, 110, 180)",hotpink2:"rgb(238, 106, 167)",hotpink3:"rgb(205, 96, 144)",hotpink4:"rgb(139, 58, 98)",indianred:"rgb(205, 92, 92)",indianred1:"rgb(255, 106, 106)",indianred2:"rgb(238, 99, 99)",indianred3:"rgb(205, 85, 85)",indianred4:"rgb(139, 58, 58)",ivory:"rgb(255, 255, 240)",ivory1:"rgb(255, 255, 240)",ivory2:"rgb(238, 238, 224)",ivory3:"rgb(205, 205, 193)",
ivory4:"rgb(139, 139, 131)",khaki:"rgb(240, 230, 140)",khaki1:"rgb(255, 246, 143)",khaki2:"rgb(238, 230, 133)",khaki3:"rgb(205, 198, 115)",khaki4:"rgb(139, 134, 78)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lavenderblush1:"rgb(255, 240, 245)",lavenderblush2:"rgb(238, 224, 229)",lavenderblush3:"rgb(205, 193, 197)",lavenderblush4:"rgb(139, 131, 134)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lemonchiffon1:"rgb(255, 250, 205)",lemonchiffon2:"rgb(238, 233, 191)",lemonchiffon3:"rgb(205, 201, 165)",lemonchiffon4:"rgb(139, 137, 112)",lightblue:"rgb(173, 216, 230)",lightblue1:"rgb(191, 239, 255)",lightblue2:"rgb(178, 223, 238)",lightblue3:"rgb(154, 192, 205)",lightblue4:"rgb(104, 131, 139)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightcyan1:"rgb(224, 255, 255)",lightcyan2:"rgb(209, 238, 238)",lightcyan3:"rgb(180, 205, 205)",lightcyan4:"rgb(122, 139, 139)",lightgoldenrod:"rgb(238, 221, 130)",lightgoldenrod1:"rgb(255, 236, 139)",lightgoldenrod2:"rgb(238, 220, 130)",lightgoldenrod3:"rgb(205, 190, 112)",lightgoldenrod4:"rgb(139, 129, 76)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightpink1:"rgb(255, 174, 185)",lightpink2:"rgb(238, 162, 173)",lightpink3:"rgb(205, 140, 149)",lightpink4:"rgb(139, 95, 101)",lightsalmon:"rgb(255, 160, 122)",lightsalmon1:"rgb(255, 160, 122)",lightsalmon2:"rgb(238, 149, 114)",lightsalmon3:"rgb(205, 129, 98)",lightsalmon4:"rgb(139, 87, 66)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightskyblue1:"rgb(176, 226, 255)",lightskyblue2:"rgb(164, 211, 238)",lightskyblue3:"rgb(141, 182, 205)",lightskyblue4:"rgb(96, 123, 139)",lightslateblue:"rgb(132, 112, 255)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightsteelblue1:"rgb(202, 225, 255)",lightsteelblue2:"rgb(188, 210, 238)",lightsteelblue3:"rgb(162, 181, 205)",lightsteelblue4:"rgb(110, 123, 139)",lightyellow:"rgb(255, 255, 224)",lightyellow1:"rgb(255, 255, 224)",lightyellow2:"rgb(238, 238, 209)",lightyellow3:"rgb(205, 205, 180)",lightyellow4:"rgb(139, 139, 122)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",magenta1:"rgb(255, 0, 255)",magenta2:"rgb(238, 0, 238)",magenta3:"rgb(205, 0, 205)",magenta4:"rgb(139, 0, 139)",maroon:"rgb(176, 48, 96)",maroon1:"rgb(255, 52, 179)",maroon2:"rgb(238, 48, 167)",maroon3:"rgb(205, 41, 144)",maroon4:"rgb(139, 28, 98)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumorchid1:"rgb(224, 102, 255)",mediumorchid2:"rgb(209, 95, 238)",mediumorchid3:"rgb(180, 82, 205)",mediumorchid4:"rgb(122, 55, 139)",mediumpurple:"rgb(147, 112, 219)",mediumpurple1:"rgb(171, 130, 255)",mediumpurple2:"rgb(159, 121, 238)",mediumpurple3:"rgb(137, 104, 205)",mediumpurple4:"rgb(93, 71, 139)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",mistyrose1:"rgb(255, 228, 225)",mistyrose2:"rgb(238, 213, 210)",mistyrose3:"rgb(205, 183, 181)",mistyrose4:"rgb(139, 125, 123)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navajowhite1:"rgb(255, 222, 173)",navajowhite2:"rgb(238, 207, 161)",navajowhite3:"rgb(205, 179, 139)",navajowhite4:"rgb(139, 121, 94)",navy:"rgb(0, 0, 128)",navyblue:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olivedrab:"rgb(107, 142, 35)",olivedrab1:"rgb(192, 255, 62)",olivedrab2:"rgb(179, 238, 58)",olivedrab3:"rgb(154, 205, 50)",olivedrab4:"rgb(105, 139, 34)",orange:"rgb(255, 165, 0)",orange1:"rgb(255, 165, 0)",orange2:"rgb(238, 154, 0)",orange3:"rgb(205, 133, 0)",orange4:"rgb(139, 90, 0)",orangered:"rgb(255, 69, 0)",orangered1:"rgb(255, 69, 0)",orangered2:"rgb(238, 64, 0)",orangered3:"rgb(205, 55, 0)",orangered4:"rgb(139, 37, 0)",orchid:"rgb(218, 112, 214)",orchid1:"rgb(255, 131, 250)",orchid2:"rgb(238, 122, 233)",orchid3:"rgb(205, 105, 201)",orchid4:"rgb(139, 71, 137)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",palegreen1:"rgb(154, 255, 154)",palegreen2:"rgb(144, 238, 144)",palegreen3:"rgb(124, 205, 124)",palegreen4:"rgb(84, 139, 84)",paleturquoise:"rgb(175, 238, 238)",paleturquoise1:"rgb(187, 255, 255)",paleturquoise2:"rgb(174, 238, 238)",paleturquoise3:"rgb(150, 205, 205)",paleturquoise4:"rgb(102, 139, 139)",palevioletred:"rgb(219, 112, 147)",palevioletred1:"rgb(255, 130, 171)",palevioletred2:"rgb(238, 121, 159)",palevioletred3:"rgb(205, 104, 137)",palevioletred4:"rgb(139, 71, 93)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peachpuff1:"rgb(255, 218, 185)",peachpuff2:"rgb(238, 203, 173)",peachpuff3:"rgb(205, 175, 149)",peachpuff4:"rgb(139, 119, 101)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",pink1:"rgb(255, 181, 197)",pink2:"rgb(238, 169, 184)",pink3:"rgb(205, 145, 158)",pink4:"rgb(139, 99, 108)",plum:"rgb(221, 160, 221)",plum1:"rgb(255, 187, 255)",plum2:"rgb(238, 174, 238)",plum3:"rgb(205, 150, 205)",plum4:"rgb(139, 102, 139)",powderblue:"rgb(176, 224, 230)",purple:"rgb(160, 32, 240)",purple1:"rgb(155, 48, 255)",purple2:"rgb(145, 44, 238)",purple3:"rgb(125, 38, 205)",purple4:"rgb(85, 26, 139)",red:"rgb(255, 0, 0)",red1:"rgb(255, 0, 0)",red2:"rgb(238, 0, 0)",red3:"rgb(205, 0, 0)",red4:"rgb(139, 0, 0)",rosybrown:"rgb(188, 143, 143)",rosybrown1:"rgb(255, 193, 193)",rosybrown2:"rgb(238, 180, 180)",rosybrown3:"rgb(205, 155, 155)",rosybrown4:"rgb(139, 105, 105)",royalblue:"rgb(65, 105, 225)",royalblue1:"rgb(72, 118, 255)",royalblue2:"rgb(67, 110, 238)",royalblue3:"rgb(58, 95, 205)",royalblue4:"rgb(39, 64, 139)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",salmon1:"rgb(255, 140, 105)",salmon2:"rgb(238, 130, 98)",salmon3:"rgb(205, 112, 84)",salmon4:"rgb(139, 76, 57)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seagreen1:"rgb(84, 255, 159)",seagreen2:"rgb(78, 238, 148)",seagreen3:"rgb(67, 205, 128)",seagreen4:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",seashell1:"rgb(255, 245, 238)",seashell2:"rgb(238, 229, 222)",seashell3:"rgb(205, 197, 191)",seashell4:"rgb(139, 134, 130)",sienna:"rgb(160, 82, 45)",sienna1:"rgb(255, 130, 71)",sienna2:"rgb(238, 121, 66)",sienna3:"rgb(205, 104, 57)",sienna4:"rgb(139, 71, 38)",skyblue:"rgb(135, 206, 235)",skyblue1:"rgb(135, 206, 255)",skyblue2:"rgb(126, 192, 238)",skyblue3:"rgb(108, 166, 205)",skyblue4:"rgb(74, 112, 139)",slateblue:"rgb(106, 90, 205)",slateblue1:"rgb(131, 111, 255)",slateblue2:"rgb(122, 103, 238)",slateblue3:"rgb(105, 89, 205)",slateblue4:"rgb(71, 60, 139)",slategray:"rgb(112, 128, 144)",slategray1:"rgb(198, 226, 255)",slategray2:"rgb(185, 211, 238)",slategray3:"rgb(159, 182, 205)",slategray4:"rgb(108, 123, 139)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",snow1:"rgb(255, 250, 250)",snow2:"rgb(238, 233, 233)",snow3:"rgb(205, 201, 201)",snow4:"rgb(139, 137, 137)",springgreen:"rgb(0, 255, 127)",springgreen1:"rgb(0, 255, 127)",springgreen2:"rgb(0, 238, 118)",springgreen3:"rgb(0, 205, 102)",springgreen4:"rgb(0, 139, 69)",steelblue:"rgb(70, 130, 180)",steelblue1:"rgb(99, 184, 255)",steelblue2:"rgb(92, 172, 238)",steelblue3:"rgb(79, 148, 205)",steelblue4:"rgb(54, 100, 139)",tan:"rgb(210, 180, 140)",tan1:"rgb(255, 165, 79)",tan2:"rgb(238, 154, 73)",tan3:"rgb(205, 133, 63)",tan4:"rgb(139, 90, 43)",thistle:"rgb(216, 191, 216)",thistle1:"rgb(255, 225, 255)",thistle2:"rgb(238, 210, 238)",thistle3:"rgb(205, 181, 205)",thistle4:"rgb(139, 123, 139)",tomato:"rgb(255, 99, 71)",tomato1:"rgb(255, 99, 71)",tomato2:"rgb(238, 92, 66)",tomato3:"rgb(205, 79, 57)",tomato4:"rgb(139, 54, 38)",turquoise:"rgb(64, 224, 208)",turquoise1:"rgb(0, 245, 255)",turquoise2:"rgb(0, 229, 238)",turquoise3:"rgb(0, 197, 205)",turquoise4:"rgb(0, 134, 139)",violet:"rgb(238, 130, 238)",violetred:"rgb(208, 32, 144)",violetred1:"rgb(255, 62, 150)",violetred2:"rgb(238, 58, 140)",violetred3:"rgb(205, 50, 120)",violetred4:"rgb(139, 34, 82)",wheat:"rgb(245, 222, 179)",wheat1:"rgb(255, 231, 186)",wheat2:"rgb(238, 216, 174)",wheat3:"rgb(205, 186, 150)",wheat4:"rgb(139, 126, 102)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellow1:"rgb(255, 255, 0)",yellow2:"rgb(238, 238, 0)",yellow3:"rgb(205, 205, 0)",yellow4:"rgb(139, 139, 0)",yellowgreen:"rgb(154, 205, 50)"},{nameToRGB:function(t){return t in e.colorNames?e.colorNames[t]:(t=t.toLowerCase(),t in e.colorNames?e.colorNames[t]:(t=t.replace(/\s+/g,""),t in e.colorNames?e.colorNames[t]:null))},testIfHex:function(e){var t=/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(e);return t},rgbToHex:function(e){var t=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),r=parseInt(t[2]),n=parseInt(t[3]),o=parseInt(t[4]);return"#"+((1<<24)+(r<<16)+(n<<8)+o).toString(16).slice(1)},hslToHex:function(e){var t=function(e,t,n){var o,a,i;if(e%=360,0>e&&(e+=360),e=~~e/360,0>t?t=0:t>100&&(t=100),t=~~t/100,0>n?n=0:n>100&&(n=100),n=~~n/100,0===t)o=a=i=n;else{var s=.5>n?n*(1+t):n+t-n*t,l=2*n-s;o=r(l,s,e+1/3),a=r(l,s,e),i=r(l,s,e-1/3)}return[~~(255*o),~~(255*a),~~(255*i)]},r=function(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+(t-e)*(2/3-r)*6:e};return{process:function(){return e.replace(/hsl\((-?\d+),(-?\d+)%?,(-?\d+)%?\)/g,function(e,r,n,o){var a=t(r,n,o),i=a[0].toString(16),s=a[1].toString(16),l=a[2].toString(16);return"#"+((1==i.length?"0":"")+i)+((1==s.length?"0":"")+s)+((1==l.length?"0":"")+l)})}}},nameToHex:function(t){var r,n=this.testIfHex(t);return n?"#"+t:t in e.colorNames?r=this.rgbToHex(e.colorNames[t]):(t=t.toLowerCase(),t in e.colorNames?r=this.rgbToHex(e.colorNames[t]):(t=t.replace(/\s+/g,""),t in e.colorNames?r=this.rgbToHex(e.colorNames[t]):null))},x11ToCSS:function(t){function r(e){return 1==e.length?parseInt(e+e,16):2==e.length?parseInt(e,16):(3==e.length&&(e+=e.substr(2)),Math.round(parseInt(e,16)/257))}var n=t.match(e.re_.x11rgb);return n?(n.splice(0,1),e.arrayToRGBA(n.map(r))):this.nameToRGB(t)},stripHash:function(e){return"#"==e.charAt(0)?e.substring(1,7):e},hexToR:function(e){var t=this;return parseInt(t.stripHash(e).substring(0,2),16)},hexToG:function(e){var t=this;return parseInt(t.stripHash(e).substring(2,4),16)},hexToB:function(e){var t=this;return parseInt(t.stripHash(e).substring(4,6),16)},hexToRGB:function(e){var t=this,r=[];return r.push(t.hexToR(e)),r.push(t.hexToG(e)),r.push(t.hexToB(e)),r}}}angular.module("TADkit").service("ColorConvert",e)}(),function(){"use strict";function e(e){return{RGBObjectFromHex:function(t){var r=e.hexToR(t),n=e.hexToG(t),o=e.hexToB(t),a={r:r,g:n,b:o};return a},colorsFromIni:function(t){var r={section:/^\s*\[\s*([^\]]*)\s*\]\s*$/,param:/^\s*([\w\.\-\_]+)\s*=\s*([\w\.\-\_]+)/,comment:/^\s*#.*$/},n={},o=t.split(/\r\n|\r|\n/),a=null;return o.forEach(function(t){if(!r.comment.test(t)&&""!==t){var o;if(r.param.test(t))if(o=t.match(r.param),a){var i=e.nameToHex(o[2]);n[a][o[1]]=i}else n[o[1]]=o[2];else r.section.test(t)?(o=t.match(r.section),n[o[1]]={},a=o[1]):0===t.length&&a&&(a=null)}}),n},colorsFromTriplets:function(e){for(var t,r,n=0,o=[],a=e.length;a>n;)t=e[n],r=new THREE.Color(t[0],t[1],t[2]),o.push(r),n++;return o},colorsFromArray:function(e){for(var t=[],r=e.length-1;r>=0;r-=1){var n=e[r]/255;r-=1;var o=e[r]/255;r-=1;var a=e[r]/255,i=new THREE.Color(a,o,n);t.unshift(i)}return t},colorsFromHex:function(e){for(var t=[],r=e.length-1;r>=0;r--){var n=new THREE.Color(e[r]);t.unshift(n)}return t},vertexColorsFromColors:function(e){for(var t=new Float32Array(6*e.length),r=e.length-1;r>=0;r--){var n=6*r,o=e[r];t[n]=o.r,t[n+1]=o.g,t[n+2]=o.b,t[n+3]=o.r,t[n+4]=o.g,t[n+5]=o.b}return t},getRandomColors:function(e){for(var t=[],r=0;e>r;r++){var n="#"+Math.floor(16777215*Math.random()).toString(16);t.push(n)}return t},getRandomRGB:function(e){for(var t=[],r=0;e>r;r++){var n="#"+Math.floor(16777215*Math.random()).toString(16),o=new THREE.Color(n);t.push(o)}return t},getGradientColor:function(e,t,r){e=e.replace(/^\s*#|\s*$/g,""),t=t.replace(/^\s*#|\s*$/g,""),3==e.length&&(e=e.replace(/(.)/g,"$1$1")),3==t.length&&(t=t.replace(/(.)/g,"$1$1"));var n=parseInt(e.substr(0,2),16),o=parseInt(e.substr(2,2),16),a=parseInt(e.substr(4,2),16),i=parseInt(t.substr(0,2),16),s=parseInt(t.substr(2,2),16),l=parseInt(t.substr(4,2),16),c=i-n,g=s-o,u=l-a;return c=(c*r+n).toString(16).split(".")[0],g=(g*r+o).toString(16).split(".")[0],u=(u*r+a).toString(16).split(".")[0],1==c.length&&(c="0"+c),1==g.length&&(g="0"+g),1==u.length&&(u="0"+u),"#"+c+g+u}}}angular.module("TADkit").factory("Color",e),e.$inject=["ColorConvert"]}(),function(){"use strict";function e(e,t,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),o="assets/defaults/tk-defaults-components.json";return n.loaded.length>0?r.resolve(n):t.get(o).success(function(e){n.loaded=e,console.log("Components ("+e.length+") loaded from "+o),r.resolve(n)}),r.promise},add:function(e){e=e||["","","","","","","",[]];var t={metadata:{version:1,type:"component",generator:"TADkit"},object:{uuid:r.generate(),id:e[0],title:e[1],type:e[2],state:{width:e[3],height:e[4],margin:e[5],padding:e[6],position:e[7]}},view:e[8]};return n.loaded.push(t),n.current=n.loaded.length-1,n},remove:function(e){e=e||n.current.index;var t=n.loaded.indexOf(e);return n.loaded.splice(t,1),n},set:function(e){(void 0!==e||e!==!1)&&(n.current.index=e);var t=n.loaded[n.current.index];return t},setViewpoint:function(e,t,r){e=e||0,t=t||4999999;var o=n.loaded;return angular.forEach(o,function(n,o){var a=r||1;if(n.view.viewpoint.chromStart=e,n.view.viewpoint.chromEnd=t,"scene"===n.object.type||"scene-icon"===n.object.type){var i=n.view.viewpoint.fov/2,s=.6;a=Math.tan(i).toFixed(2)*s}n.view.viewpoint.scale=a}),n},get:function(){return n},getComponent:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e];return t},getComponentById:function(e){var t,r;if(void 0!==e||e!==!1)for(var o=n.loaded.length-1;o>=0;o--)n.loaded[o].object.id===e&&(t=n.loaded[o],r=o);return r||(t=n.loaded[n.current.index],console.log("Component '"+e+"' not found: returning current.")),t},getComponentByType:function(e){var t,r,o;if(void 0!==e||e!==!1)for(var a=n.loaded.length-1;a>=0;a--)n.loaded[a].object.type===e&&(t=n.loaded[a],o=a),"default"===n.loaded[a].object.type&&(r=n.loaded[a]);return o||(t=r,console.log("Component type '"+e+"' not found: returning default.")),t}}}angular.module("TADkit").factory("Components",e),e.$inject=["$q","$http","uuid4"]}(),function(){"use strict";function e(e,t,r,n,o){return{load:function(r,n,o){r=r||"tk-example-dataset",n=n||"tsv","undefined"==typeof o&&(o=!0);var a=this,i=e.defer(),s="defaults";"tk-example-dataset"!=r&&(s="examples");var l="assets/"+s+"/"+r+"."+n;return t.get(l).success(function(e){var t=a["import"](e,[],[],o);console.log("Overlays ("+t.length+") imported from "+l),i.resolve(t)}).error(function(e){console.log("No associated data tracks found.")}),i.promise},"import":function(e,t,r){var a=this;t=t||[],r=r||[];var i,s=n.whatIsIt(e);i="String"==s?a.parse(e).data:e;var l;l=t.length>0&&r.length>0?a.filter(i,t,r):i;var c=a.aquire(l);return o.add(c),c},parse:function(e){Papa.DefaultDelimiter=" ";var t=Papa.parse(e,{dynamicTyping:!0,skipEmptyLines:!0,fastMode:!0});return t},filter:function(e,t,r){for(var n=[],o=t.length,a=r.length,i=0;o>i;i++){var s=[];if(t[i]){for(var l=0;a>l;l++)r[l]&&s.push(e[i][l]);n.push(s)}}return n},aquire:function(e){var t,n,o,a=["#227c4f","#e71818","#8ece0d","#6666ff","#424242"],i=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],s=[],l=0,c=1,g=0,u=1,d=e[l].length,p=e[c][u]-e[c][g]+1,b=e[c+1][u]-e[c+1][g]+1;p==b?(t="wiggle_0",n="fixed",o="fixed"):(t="bedgraph",n="variable",o="variable");var h=!1;if(7==d){for(var f=0,m=2;d>m;m++){var v=e[l][m].toLowerCase();("hp1"==v||"brm"==v||"mrg15"==v||"pc"==v||"h1"==v)&&f++}5==f&&(h=!0)}for(var y=d-1;y>=2;y--){var w;w=h?a[y-2]:i[y],s.unshift({metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:r.generate(),id:e[l][y],title:e[l][y],source:"Research output",url:"local",description:"center_label",type:t,format:n,components:2,name:e[l][y],visibility:"full",color:w,altColor:"#cccccc",priority:"100",stepType:o,chrom:"",start:e[c][g],step:p,state:{index:0,overlaid:!1}},palette:[w,"#cccccc"],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}});for(var k=e.length-1;k>=1;k--)"variable"==n?s[0].data.unshift({start:e[k][g],end:e[k][u],read:e[k][y]}):s[0].data.unshift(e[k][y])}return s}}}angular.module("TADkit").factory("CustomTracks",e),e.$inject=["$q","$http","uuid4","Resources","Overlays"]}(),function(){"use strict";function e(e,t,r,n,o,a,i,s,l){var c={loaded:[],current:{index:0,cluster:1,centroid:1}};return{load:function(r,n){r=r||"tk-example-dataset",n=n||!1;var o=this;n&&o.clear();var a="defaults";"tk-example-dataset"!=r&&(a="examples");var i=e.defer(),s="assets/"+a+"/"+r+".json";return t.get(s).success(function(e){e.object.filename=r,o.add(e),i.resolve(c)}),i.promise},add:function(e){var t=this,r=t.validate(e);return c.loaded.push(r),c.current.index=c.loaded.length-1,t.setSpeciesUrl(),t.setRegion(),t.init(r),console.log("Dataset "+r.object.species+" "+r.object.region+" loaded from file."),c},validate:function(e){var t={},r=o.whatIsIt(e);t="String"===r?JSON.parse(e):e;var n=!0;return n?t:void 0},init:function(e){var t=this,r=t.getModel().data;n.set(e),a.set(r),i.set(r,e.restraints),s.update(a.get().distances,e.restraints);var o="tsv",c=!0;l.load(e.object.filename,o,c),console.log("Settings, Proximities, Restraints & Overlays initialized.")},clear:function(){for(;c.loaded.length>0;)c.loaded.shift()},remove:function(e){(void 0===e||e===!1)&&(e=c.current.index);var t=c.loaded.indexOf(e);return c.loaded.splice(t,1),c},setSpeciesUrl:function(e){(void 0===e||e===!1)&&(e=c.current.index);var t=c.loaded[e].object.species,r=t.replace(/[^a-z0-9]/gi,"_").toLowerCase();return c.loaded[e].object.speciesUrl=r,r},setRegion:function(e){(void 0===e||e===!1)&&(e=c.current.index);var t=0;c.loaded[e].object.chromosomeIndex&&(t=c.loaded[e].object.chromosomeIndex);var r=c.loaded[e].object.chrom[t],n=c.loaded[e].object.chromStart[t],o=c.loaded[e].object.chromEnd[t],a=r+":"+n+"-"+o;return c.loaded[e].object.region=a,a},set:function(e){(void 0!==e||e!==!1)&&(c.current.index=e),this.setCluster(c.current.cluster);var t=c.loaded[c.current.index];return t},setCluster:function(e){e=e||1,c.current.cluster=e;var t=this.getCentroid(c.current.cluster);this.setCentroid(t);var r=this.getCluster();return r},setCentroid:function(e){e=e||this.getCentroid(),c.current.centroid=e;var t=this.setModel(c.current.centroid);return t},setModel:function(e){e=e||this.getCentroid();var t=this.getModel(e-1);return c.loaded[c.current.index].data=t,t},get:function(){return c},getDataset:function(e){(void 0===e||e===!1)&&(e=c.current.index);var t=c.loaded[e];return t},getCluster:function(e){e=e||c.current.cluster;var t=c.loaded[c.current.index].clusters[e-1];return t},getCentroid:function(e){e=e||c.current.cluster;var t=c.loaded[c.current.index].centroids[e-1];return t},getModel:function(e){e=e||this.getCentroid();for(var t,r=c.loaded[c.current.index].models,n=r.length-1;n>=0;n--)r[n].ref==e&&(t=r[n]);return t}}}angular.module("TADkit").factory("Datasets",e),e.$inject=["$q","$http","uuid4","Settings","Resources","Proximities","Restraints","Overlays","CustomTracks"]}(),function(){"use strict";function e(e,t,r,n){var o={root:"http://rest.ensemblgenomes.org/",ping:0,assembly:{},featureColors:{},biotypes:{}};return{ping:function(){console.log("Pinging Ensembl RESTful genomic data server...");var r=e.defer(),n=o.root+"info/ping?content-type=application/json";return t.get(n).success(function(e){o.ping=e.ping,console.log("Ensembl RESTful is contactable.")}),r.promise},load:function(n){var o,a=e.defer(),i=r.get(),s=i.current.species,l=i.current.speciesUrl,c=i.current.chrom,g=i.current.chromStart,u=i.current.chromEnd,d=this,p=r.getOnline();return o=p?n.object.url[0]+l+n.object.url[2]+c+n.object.url[4]+g+n.object.url[6]+u+n.object.url[8]:"assets/offline/"+l+"-genes.json",t.get(o).success(function(e){var t=d.setBiotypeStyle(e);n.data=t;var r=c+":"+g+"-"+u,o=p?"Ensembl":"local storage";console.log("Genes for "+s+" "+r+" retreived from "+o+"."),a.resolve(n)}),a.promise},loadBiotypeColors:function(){var r,a=e.defer(),i=!1;return r=i?"https://cdn.rawgit.com/Ensembl/ensembl-webcode/release/75/conf/ini-files/COLOUR.ini":"assets/offline/ensembl-webcode-COLOUR.ini",t.get(r).success(function(e){var t=n.colorsFromIni(e);o.featureColors=t,o.biotypes=t.gene,console.log("Ensembl webcode biotype colors retrieved Ensembl."),a.resolve(t)}),a.promise},setBiotypeStyle:function(e){return angular.forEach(e,function(e,t){var r=e.biotype.toLowerCase();e.biotypeStyle=r}),e},setLengthBP:function(e){var t=0,r=e;for(var n in r)if(r.hasOwnProperty(n))for(var o=0,a=r.length;a>o;o++)t+=r[o].length;return t},get:function(){return o}}}angular.module("TADkit").factory("Ensembl",e),e.$inject=["$q","$http","Settings","Color"]}(),function(){"use strict";function e(e,t,r,n,o,a,i,s,l){return function(){console.log("Loading TADkit...");var c=function(o){var a=t.load(),i=r.load(),s=n.loadBiotypeColors();return e.all([a,i,s]).then(function(e){return e})},g=function(t){var r=o.load(),n=a.load(),c=i.load(),g=s.load(),u=l.load();return e.all([r,n,c,g,u]).then(function(e){return e})};return c().then(g)}}angular.module("TADkit").service("initMain",e),e.$inject=["$q","Settings","Components","Ensembl","Users","Projects","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function e(e){return{lineSegmentsRGB:function(e,t){for(var r=this,n=e.data.length,o=new Float32Array(6*t),a=0;n>a;a++){var i=e.data[a][0],s=e.data[a][1],l=6*r.getMatrixIndex(i,s,t),c={r:.5,g:.5,b:.5};if("restraints"==e.object.id){var g={H:"#4CAF50",L:"#0000ff",U:"#ff00ff",C:"#00ff00"};c=r.getFeatureRGB(e.data[a][2],g)}o[l]=c.r,l++,o[l]=c.g,l++,o[l]=c.b,l++,o[l]=c.r,l++,o[l]=c.g,l++,o[l]=c.b}return o.name="Network lineSegments RGB",o},lineSegmentsAlpha:function(e,t){for(var r=this,n=new Float32Array(2*t),o=0,a=n.length-1;a>=0;a--)n[a]=o;if(e.data)for(var i=e.data.length,s=0;i>s;s++){var l=e.data[s][0],c=e.data[s][1],g=r.getMatrixIndex(l,c,t),u=e.data[s][3]*e.data[s][3]/5;n[g]=u,g++,n[g]=u}return n.name="Network lineSegments Alphas",n},getMatrixIndex:function(e,t,r){for(var n=0,o=e-1,a=0;o>=a;a++)n+=r-(r-a);return n+=t-e-1},getFeatureRGB:function(t,r){r=r||{0:"#000000"};var n;return angular.forEach(r,function(r,o){t==o&&(n=e.RGBObjectFromHex(r))}),n}}}angular.module("TADkit").factory("Networks",e),e.$inject=["Color"]}(),function(){"use strict";function e(e,t,r,n,o,a,i,s){var l={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),n="assets/defaults/tk-defaults-overlays.json";return l.loaded.length>0?r.resolve(l):t.get(n).success(function(e){l.loaded=e,console.log("Overlays ("+e.length+") loaded from "+n),r.resolve(l)}),r.promise},add:function(e){var t=this,r=[],n=l.loaded.length-1;return angular.forEach(e,function(e,t){var a=!1;a||(n++,e.object.state.index=n,e.object.state.overlaid=!1,r.push(e),o.addComponent(e))}),l.loaded=l.loaded.concat(r),t.segment(),r},clear:function(){for(;l.loaded.length>0;)l.loaded.shift()},defaults:function(){for(;l.loaded.length>4;)l.loaded.pop(),o.defaultComponents()},remove:function(e){(void 0===e||e===!1)&&(e=l.current.index);var t=l.loaded.indexOf(e);return l.loaded.splice(t,1),l},set:function(e){(void 0!==e||e!==!1)&&(l.current.index=e);var t=l.loaded[l.current.index];return t},setOverlaid:function(e){return e=e||"",angular.forEach(l.loaded,function(t){t.object.state.index===e?t.object.state.overlaid=!0:t.object.state.overlaid=!1}),e},update:function(t,r){var n=this,i=[],s=[];return angular.forEach(l.loaded,function(e,n){if("ensembl"==e.object.type){var o=a.load(e);i.push(o),s.push(e)}"proximities"==e.object.id&&(e.data=t),"restraints"==e.object.id&&(e.data=r)}),e.all(i).then(function(e){for(var t=0;t<s.length;t++)o.update(s[t]);return n.segment(),e})},segment:function(){var e=this,t=n.get();return angular.forEach(l.loaded,function(r,n){var o=!0;if(o){var l=r.object.type,c=r.object.format;if("gradient"==l&&"hex"==c)r.colors.particles=i.gradientHCL(r,t.current.particlesCount),r.colors.chromatin=i.gradientHCL(r,t.current.segmentsCount),r.colors.network.RGB=s.lineSegmentsRGB(r,t.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,t.current.edgesCount);else if("wiggle_0"==l&&"fixed"==c)r.colors.particles=i.bicolor(r,t.current.particlesCount),r.colors.chromatin=i.bicolor(r,t.current.segmentsCount),r.colors.network.RGB=s.lineSegmentsRGB(r,t.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,t.current.edgesCount);else if("wiggle_0"==l&&"variable"==c);else if("bedgraph"==l)r.colors.particles=i.bicolorVariable(r,t.current.chromStart,t.current.particlesCount,1),r.colors.chromatin=i.bicolorVariable(r,t.current.chromStart,t.current.segmentsCount,t.current.segmentLength),r.colors.network.RGB=s.lineSegmentsRGB(r,t.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,t.current.edgesCount);else if("matrix"==l)r.colors.particlesMatrix=i.matrix(r,1),r.colors.chromatinMatrix=i.matrix(r,t.current.particleSegments),r.colors.networkMatrix=r.colors.particlesMatrix,e.at(1,t.current.particlesCount,t.current.particleSegments);else if("misc"==l&&"variable"==c)r.colors.particles=[],r.colors.chromatin=[],r.colors.network.RGB=s.lineSegmentsRGB(r,t.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,t.current.edgesCount);else if("ensembl"==l&&"json"==c){var g=a.get().biotypes,u=1;r.colors.particles=i.features(r,t.current.chromStart,t.current.particlesCount,u,g),r.colors.chromatin=i.features(r,t.current.chromStart,t.current.segmentsCount,t.current.segmentLength,g),r.colors.network.RGB=s.lineSegmentsRGB(r,t.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,t.current.edgesCount)}}else console.log("Overlay '"+r.object.title+"' already segmented as color array matching current dataset length")}),l},at:function(e){var t=n.get();return angular.forEach(l.loaded,function(r,n){var o=r.object.type;if("matrix"==o){var a=(e-1)*t.current.particlesCount,i=e*t.current.particlesCount,s=a*t.current.particleSegments,l=i*t.current.particleSegments;r.colors.particles=r.colors.particlesMatrix.slice(a,i),r.colors.chromatin=r.colors.chromatinMatrix.slice(s,l),r.colors.network=r.colors.networkMatrix.slice(a,i)}}),l},get:function(){return l},getOverlay:function(e){(void 0===e||e===!1)&&(e=l.current.index);var t=l.loaded[e];return t},getOverlayById:function(e){var t,r;if(void 0!==e||e!==!1)for(var n=l.loaded.length-1;n>=0;n--)l.loaded[n].object.id===e&&(t=l.loaded[n],t.object.state.index=n,r=!0);return r||(t=l.loaded[l.current.index],t.object.state.index=l.current.index,console.log('Overlay "'+e+'" not found: returning current.')),t},getCurrentIndex:function(){return l.current.index}}}angular.module("TADkit").factory("Overlays",e),e.$inject=["$q","$http","uuid4","Settings","Storyboards","Ensembl","Segments","Networks"]}(),function(){"use strict";function e(){return{simple:function(e){for(var t="EnsemblBacteria",r=e.length,n=[],o=0;r-1>o;o++){var a=e[o],i=e[o+1],s=new THREE.Vector3(0,0,0);s.addVectors(a,i).divideScalar(2);var l=new THREE.Vector3(0,0,0);if(l.copy(s).sub(a),0===o&&"EnsemblBacteria"!=t){var c;c=new THREE.Vector3(0,0,0),c.copy(a).sub(l),n.push(c)}if(n.push(s),o==r-2&&"EnsemblBacteria"!=t){var g;g=new THREE.Vector3(0,0,0),g.copy(i).add(l),n.push(g)}}return n},cubic:function(e,t){t=t||!1;var r=1,n=e.length,o={};o.vertices=[],o.colors=[];for(var a=new THREE.Vector3(0,0,0),i=0;n>i;i++){var s=e[i],l=new THREE.Vector3(0,0,0);i==n-1?t?l=e[0]:l.copy(s).addVectors(s,e[i-1]):l=e[i+1];var c=new THREE.Vector3(0,0,0);c.addVectors(s,l).divideScalar(2);var g=new THREE.Vector3(0,0,0);if(g.copy(c).sub(s),0===i)if(t){var u=new THREE.Vector3(0,0,0);u.addVectors(e[n-1],e[0]).divideScalar(2),a.copy(u).sub(e[n-1])}else a.copy(g);var d=new THREE.Vector3(0,0,0);d.copy(s).sub(g);var p=new THREE.Vector3(0,0,0);p.copy(s).add(a);var b=new THREE.Vector3(0,0,0);b.subVectors(p,d).divideScalar(r),d.copy(s).sub(b),p.copy(s).add(b),o.vertices.push(d),o.colors.push(new THREE.Color(13421772)),o.vertices.push(s),o.colors.push(new THREE.Color(0)),o.vertices.push(p),o.colors.push(new THREE.Color(13421772)),a=g}var h=new THREE.Vector3(0,0,0),f=new THREE.Vector3(0,0,0),m=new THREE.Vector3(0,0,0),v=new THREE.Vector3(0,0,0),y=o.vertices.length,w=o.vertices[y-2],k=o.vertices[y-1],x=o.vertices[0],C=o.vertices[1];if(t){var E=new THREE.CubicBezierCurve3(w,k,x,C),T=E.getPointAt(.5),S=E.getTangent(.5).multiplyScalar(1);h.copy(T).sub(S),f.copy(T),m.copy(T).add(S),v.copy(T)}else h.copy(x),f.copy(x),m.copy(k),v.copy(k);return o.vertices.unshift(h),o.colors.unshift(new THREE.Color(16776960)),o.vertices.unshift(f),o.colors.unshift(new THREE.Color(16711680)),o.vertices.push(m),o.colors.push(new THREE.Color(65535)),o.vertices.push(v),o.colors.push(new THREE.Color(255)),o}}}angular.module("TADkit").factory("PathControls",e)}(),function(){"use strict";function e(){return{splineNearFit:function(e,t){var r,n="EnsemblBacteria";return r="EnsemblBacteria"==n?new THREE.ClosedSplineCurve3(e):new THREE.SplineCurve3(e)},spline:function(e,t){var r="NotEnsemblBacteria",n=new THREE.CurvePath,o=e.length;if("EnsemblBacteria"==r)n=new THREE.ClosedSplineCurve3(e);else for(var a=1;o-2>a;a+=3){var i=e[a],s=e[a+1],l=e[a+2],c=e[a+3],g=new THREE.Vector3(0,0,0);g.addVectors(l,s).divideScalar(2);var u=new THREE.SplineCurve3([i,g,c]);n.add(u)}return n},quadraticBezier:function(e,t){var r="NotEnsemblBacteria",n=new THREE.CurvePath,o=e.length;if("EnsemblBacteria"==r)n=new THREE.ClosedSplineCurve3(e);else for(var a=1;o-2>a;a+=3){var i=e[a],s=e[a+1],l=e[a+2],c=e[a+3],g=new THREE.Vector3(0,0,0);g.addVectors(l,s).divideScalar(2);var u=new THREE.QuadraticBezierCurve3(i,g,c);n.add(u)}return n},cubicBezier:function(e,t,r){r=r||!1;for(var n=new THREE.CurvePath,o=e.length,a=0;o-1>a;a+=3){var i=e[a],s=e[a+1],l=e[a+2],c=e[a+3],g=new THREE.CubicBezierCurve3(i,s,l,c);n.add(g)}return n}}}angular.module("TADkit").factory("Paths",e)}(),function(){"use strict";function e(e,t,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),o="assets/defaults/tk-defaults-projects.json";return n.loaded.length>0?r.resolve(n):t.get(o).success(function(e){n.loaded=e,console.log("Projects ("+e.length+") loaded from "+o),r.resolve(n)}),r.promise},add:function(e){var t={metadata:{version:1,type:"project",generator:"TADkit"},object:{uuid:r.generate(),id:e[0],title:e[1],description:e[2],group:e[3],state:e[4]},datasets:e[5],overlays:e[6],storyboards:e[7]};return n.loaded.push(t),n.current=n.loaded.length-1,n},remove:function(e){(void 0===e||e===!1)&&(e=users.current.index);var t=n.loaded.indexOf(e);return n.loaded.splice(t,1),n},set:function(e){(void 0!==e||e!==!1)&&(n.current.index=e);var t=n.loaded[n.current.index];return t},get:function(){return n},getProject:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e];return t},getState:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e].object.state;return t}}}angular.module("TADkit").factory("Projects",e),e.$inject=["$q","$http","uuid4"]}(),function(){"use strict";function e(e,t){var r={dimension:0,positions:[],distances:[]},n={dimension:0,positions:[],distances:[]};return{set:function(e,t){var n={minDistance:150,maxDistance:400,limitConnections:!0,maxConnections:200};t=t||{},angular.extend(this,angular.copy(n),t),this.maxDistance=this.getMaxDistance(e);var o=0,a=0;r.dimension=e.length/3;for(var i=r.dimension*r.dimension,s=2*i,l=new Float32Array(3*s),c=new Float32Array(i),g=r.dimension-1,u=g;u>=0;u--)for(var d=g;d>=0;d--){
var p=e[3*u]-e[3*d],b=e[3*u+1]-e[3*d+1],h=e[3*u+2]-e[3*d+2],f=Math.sqrt(p*p+b*b+h*h);l[o++]=e[3*u],l[o++]=e[3*u+1],l[o++]=e[3*u+2],l[o++]=e[3*d],l[o++]=e[3*d+1],l[o++]=e[3*d+2];var m=1-f/this.maxDistance;c[a++]=m}return r.positions=l,r.distances=c,r},getMaxDistance:function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e,3)),t.computeBoundingSphere();var r=Math.ceil(2*t.boundingSphere.radius);return r},at:function(e){n.dimension=e;var t=(e-1)*r.dimension,o=e*r.dimension;return n.positions=r.positions.subarray(2*t*3,2*o*3),n.distances=r.distances.subarray(t,o),n},get:function(){return r},getCurrent:function(){return n}}}angular.module("TADkit").factory("Proximities",e),e.$inject=["$q","THREEService"]}(),function(){"use strict";function e(){return{whatIsIt:function(e){var t="test".constructor,r=[].constructor,n={}.constructor;return null===e?"null":void 0===e?"undefined":e.constructor===t?"String":e.constructor===r?"Array":e.constructor===n?"Object":"don't know"}}}angular.module("TADkit").factory("Resources",e)}(),function(){"use strict";function e(){var e={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]},t={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]};return{set:function(t,r,n){var o={setting:!0};n=n||{},angular.extend(this,angular.copy(o),n),e.dimension=t.length/3;for(var a=0;a<r.length;a++)"H"==r[a][2]&&e.harmonics.push(r[a]),"L"==r[a][2]&&e.lowerBounds.push(r[a]),"U"==r[a][2]&&e.upperBounds.push(r[a]),"C"==r[a][2]&&e.neighbours.push(r[a]);return e},at:function(r){return t.dimension=r,t.harmonics=[],t.lowerBounds=[],t.upperBounds=[],t.neighbours=[],angular.forEach(e,function(e,n){if("dimension"!=n)for(var o=e.length-1;o>=0;o--)if(e[o][0]==r&&t[n].push(e[o]),e[o][1]==r){var a=[];a.push(e[o][1]),a.push(e[o][0]),a.push(e[o][2]),a.push(e[o][3]),t[n].push(a)}}),t},get:function(){return e},getCurrent:function(){return t}}}angular.module("TADkit").factory("Restraints",e)}(),function(){"use strict";function e(e,t,r){return{gradientHCL:function(e,t){for(var r=[],n=e.palette[0],o=e.palette[1],a=t-1;a>=0;a--){var i=a/t,s=d3.interpolateHcl(n,o)(i);r.push(s)}return r},gradientComponentRGB:function(e,t){var r,n,o,a,i,s,l,c,g,u,d=[],p="0x"+e.palette[0].substring(1),b="0x"+e.palette[1].substring(1);r=p>>16,n=p>>8&255,o=255&p,a=b>>16,i=b>>8&255,s=255&b;for(var h=t-1;h>=0;h--)l=h/t,c=+(l*r+(1-l)*a).toFixed(2),g=+(l*n+(1-l)*i).toFixed(2),u=+(l*o+(1-l)*s).toFixed(2),d.push(c,g,u);return d},bicolor:function(e,t){for(var r=e.palette[0],n=e.palette[1],o=[],a=0;t>a;a++){var i;i=1===e.data[a]?r:n,o.push(i)}return o},matrix:function(e,t){for(var r=e.palette[0],n=e.palette[1],o=[],a=e.data.length-1;a>=0;a--)for(var i=e.data[a],s=1-i*i,l=d3.interpolateHsl(r,n)(s),c=0;t>c;c++)o.push(l);return o},bicolorVariable:function(e,t,r,n){for(var o=e.palette[0],a=e.palette[1],i=e.data,s=[],l=0;r>l;l++){for(var c=a,g=t+n*l,u=g+n,d=i.length,p=0;d>p;p++){var b=i[p].start,h=i[p].end;Math.max(g,b)<=Math.min(u,h)&&(c=1===i[p].read?o:a)}s.push(c)}return s},featureGraph:function(e,t){var n=this.gradientHCL(e,t),o=r.THREEColorsFromHex(n),a=r.vertexColorsFromTHREEColors(o);return a},features:function(e,t,r,n,o){for(var a=e.data,i=[],s=0;r>s;s++){for(var l=[],c=t+n*s,g=c+n,u=a.length,d="cccccc",p="#"+d,b=0;u>b;b++){var h=a[b].start,f=a[b].end,m=[];if(Math.max(c,h)<=Math.min(g,f)){m.push(s);var v="biotype",y="protein_coding";l.length>0&&l[0]==y?l[0]=a[b][v].toLowerCase():l.push(a[b][v].toLowerCase())}a[b].inSegments=m}for(var w=0;w<l.length;w++){var k=l[0];k in o?(d=o[k].match(/[a-f0-9]{6}/gi),p="#"+d):(d="110100",p="#"+d)}i.push(p)}return i}}}angular.module("TADkit").factory("Segments",e),e.$inject=["$q","d3Service","Color"]}(),function(){"use strict";function e(e,t){var r={};return{load:function(){var n=e.defer(),o="assets/defaults/tk-defaults-settings.json";return Object.getOwnPropertyNames(r).length>0?n.resolve(r):t.get(o).success(function(e){r=e,console.log("Settings loaded from "+o),n.resolve(r)}),n.promise},set:function(e){var t=this,n=0;e.object.chromosomeIndex&&(n=e.object.chromosomeIndex),r.current.chrom=e.object.chrom[n],r.current.chromStart=e.object.chromStart[n],r.current.chromEnd=e.object.chromEnd[n],r.current.species=e.object.species,r.current.speciesUrl=e.object.speciesUrl,r.current.particleSegments=20,r.current.particlesCount=e.models[0].data.length/e.object.components,r.current.edgesCount=.5*(r.current.particlesCount*r.current.particlesCount-r.current.particlesCount),r.current.segmentsCount=r.current.particlesCount*r.current.particleSegments,r.current.segmentLength=e.object.resolution/r.current.particleSegments,r.current.position=r.current.chromStart+parseInt(.5*(r.current.chromEnd-r.current.chromStart)),r.current.particle=t.getParticle(),r.current.segment=t.getSegment(r.current.position),r.current.segmentLower=r.current.position-.5*r.current.segment,r.current.segmentUpper=r.current.position+.5*r.current.segment},add:function(e){return r},remove:function(e){return r},getState:function(e){var t=r[settingID].state;return t},get:function(){return r},getOnline:function(){var e=!1;return r.app&&(e=r.app.online),e},getSegment:function(e){e=e||r.current.position;var t=this,n=t.getRange(r.current.chromStart,e),o=t.getRange(r.current.chromStart,r.current.chromEnd),a=Math.ceil(n*r.current.segmentsCount/o);return a},getParticle:function(e){e=e||r.current.position;var t=this,n=t.getRange(r.current.chromStart,e),o=t.getRange(r.current.chromStart,r.current.chromEnd),a=Math.ceil(n*r.current.particlesCount/o);return a},getRange:function(e,t){for(var r=0,n=e;t>=n;n++)r++;return r},toggle:function(e){return angular.forEach(r,function(t,r){e==t.id&&(t.state=!t.state)}),r}}}angular.module("TADkit").factory("Settings",e),e.$inject=["$q","$http"]}(),function(){"use strict";function e(e,t,r,n,o){var a={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),n="assets/defaults/tk-defaults-storyboards.json";return a.loaded.length>0?(console.log("if"),console.log("Storyboards already loaded."),r.resolve(a)):t.get(n).success(function(e){a.loaded=e,console.log("Storyboards ("+e.length+") loaded from "+n),r.resolve(a)}),r.promise},add:function(e){e=e||[""];var t={metadata:{version:1,type:"storyboard",generator:"TADkit"},object:{uuid:r.generate(),id:e[0],title:e[1],email:e[2],group:e[3],permissions:e[4]},data:e[5]};return a.loaded.push(t),a.current=a.loaded.length-1,a},addComponent:function(e,t,a){var i=this;t=t||"default",a=a||[];var s=n.get(),l=o.getComponentByType(e.object.type),c=angular.copy(l);c.object.uuid=r.generate(),c.object.id=e.object.id,c.object.title=e.object.id,c.object.dataset=e.object.id,c.view.settings.step=e.object.step,c.view.settings.color=e.object.color,c.view.viewpoint.chromStart=s.current.chromStart,c.view.viewpoint.chromEnd=s.current.chromEnd,c.view.viewpoint.scale=s.views.scale,c.view.viewtype=e.object.type+"-"+e.object.stepType,c.data=e.data,c.overlay=e;var g=i.getStoryboardById(t);return g.components.push(c),c},defaultComponents:function(e){var t=this;e=e||"current";var r;for(r="current"==e?t.getStoryboard():t.getStoryboardById(e);r.components.length>6;)console.log("popping"),a.loaded[a.current.index].components.pop();return a},remove:function(e){(void 0===e||e===!1)&&(e=a.current.index);var t=a.loaded.indexOf(e);return a.loaded.splice(t,1),a},removeComponentById:function(e){console.log("component");var t=this;if(void 0!==e||e!==!1){var r=t.getComponentById(e),n=t.getStoryboard();n.components.splice(r.index,1),console.log(r)}return a},set:function(e){(void 0!==e||e!==!1)&&(a.current.index=e);var t=a.loaded[a.current.index];return t},setViewpoint:function(e,t,r){e=e||0,t=t||4999999;var n=a.loaded[a.current.index].components;return angular.forEach(n,function(n,o){var a=r||1;if(n.view.viewpoint.chromStart=e,n.view.viewpoint.chromEnd=t,"scene"===n.object.type||"scene-icon"===n.object.type){var i=n.view.viewpoint.fov/2,s=.6;a=Math.tan(i).toFixed(2)*s}n.view.viewpoint.scale=a}),a},update:function(e){var t=this,r=t.getStoryboard().components;angular.forEach(r,function(t,r){("track-genes"==t.object.type||"panel-inspector"==t.object.type)&&(t.data=e.data,t.overlay=e)})},get:function(){return a},getStoryboard:function(e){(void 0===e||e===!1)&&(e=a.current.index);var t=a.loaded[e];return t},getStoryboardById:function(e){var t,r;if(void 0!==e||e!==!1)for(var n=a.loaded.length-1;n>=0;n--)a.loaded[n].object.id===e&&(t=a.loaded[n],t.index=n,r=!0);return r||(t=a.loaded[a.current.index],t.index=a.current.index,console.log("Storyboard '"+e+"' not found: returning current.")),t},getComponentById:function(e){var t,r,n=this,o=n.getStoryboard().components;if(void 0!==e||e!==!1)for(var a=o.length-1;a>=0;a--)console.log(o[a].object.title),o[a].object.title===e&&(t=o[a],t.index=a,r=!0,console.log("Component '"+e+"' found!"));return r||(t=o[0],console.log("Component '"+e+"' not found: returning first.")),t}}}angular.module("TADkit").factory("Storyboards",e),e.$inject=["$q","$http","uuid4","Settings","Components"]}(),function(){"use strict";function e(e,t,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),o="assets/defaults/tk-defaults-users.json";return n.loaded.length>0?r.resolve(n):t.get(o).success(function(e){n.loaded=e,console.log("Users ("+e.length+") loaded from "+o),r.resolve(n)}),r.promise},add:function(e){e=e||["id","Name Surname","email@company.com","Group","edit",["default"]];var t={metadata:{version:1,type:"user",generator:"TADkit"},object:{uuid:r.generate(),id:e[0],title:e[1],email:e[2],group:e[3],permissions:e[4]},projects:e[5]};return n.loaded.push(t),n.current=n.loaded.length-1,n},remove:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded.indexOf(e);return n.loaded.splice(t,1),n},set:function(e){(void 0!==e||e!==!1)&&(n.current.index=e);var t=n.loaded[n.current.index];return t},get:function(){return n},getUser:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e];return t},getPermissions:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e].permissions;return t}}}angular.module("TADkit").factory("Users",e),e.$inject=["$q","$http","uuid4"]}();