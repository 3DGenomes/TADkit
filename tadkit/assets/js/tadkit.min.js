!function(){"use strict";angular.module("TADkit",["ui.router","ngMaterial","uuid4","d3js","threejs","generic","bioinformatics","modeling","visualization"])}(),function(){"use strict";angular.module("TADkit").constant("NAME","TADkit").constant("VERSION","0.1.0").constant("ENV","production").constant("VERBOSE",!1).constant("ONLINE",!1)}(),function(){"use strict";function t(t,e,r,n){e.debugEnabled("development"===t),n.theme("default").primaryPalette("green").accentPalette("lime",{"default":"500"}).warnPalette("red").backgroundPalette("grey"),n.theme("darkKit").dark()}angular.module("TADkit").config(t),t.$inject=["ENV","$logProvider","$locationProvider","$mdThemingProvider"]}(),function(){"use strict";function t(t,e){e.$on("$stateChangeError",function(e,r,n,o,i,a){t.error("Resolve Error: ",a)})}angular.module("TADkit").run(t),t.$inject=["$log","$rootScope"]}(),function(){"use strict";function t(t,e){e.otherwise("/project/loader/"),t.state("main",{controller:"MainController","abstract":!0,url:"",templateUrl:"assets/templates/main.html",resolve:{initialData:["App",function(t){return new t}]}}).state("project",{parent:"main",url:"/project",data:{cssClassnames:"main"},views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"sidebar-left@main":{templateUrl:"assets/templates/sidebar.project.html",controller:"SidebarProjectController"},"content@main":{templateUrl:"assets/templates/project-content.html",controller:"ProjectContentController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("loader",{parent:"project",url:"/loader/:loadDataset",data:{cssClassnames:"loader"},views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"content@main":{templateUrl:"assets/templates/project-loader.html",controller:"ProjectLoaderController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("dataset",{parent:"project",url:"/dataset",data:{cssClassnames:"dataset"},views:{"content@main":{templateUrl:"assets/templates/project-dataset.html",controller:"ProjectDatasetController"}}}).state("overlay",{parent:"project",url:"/overlay",data:{cssClassnames:"overlay"},views:{"content@main":{templateUrl:"assets/templates/project-overlay.html",controller:"ProjectOverlayController"}}}).state("storyboard",{parent:"project",url:"/storyboard",data:{cssClassnames:"storyboard"},views:{"content@main":{templateUrl:"assets/templates/project-storyboard.html",controller:"ProjectStoryboardController"}}}).state("browser",{parent:"project",url:"/browser",views:{"sidebar-left@main":{templateUrl:"assets/templates/sidebar.browser.html",controller:"SidebarBrowserController"},"content@main":{templateUrl:"assets/templates/storyboard.html",controller:"StoryboardController"}}}).state("overlay-import",{parent:"browser",url:"/overlay/import",views:{"modal@main":{templateUrl:"assets/templates/overlay-import.html",controller:"OverlayImportController"}}}).state("404",{url:"/404",templateUrl:"assets/templates/404.tpl.html",controller:"AppController"})}angular.module("TADkit").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,r,n,o,i,a,s){function c(){t.debug("Dependencies loading...");var s=r.load(),c=o.load(),l=i.load(),u=a.load();return e.all([s,c,l,u]).then(function(e){return t.debug("Dependencies loaded OK!"),n.load(e[2].textures),e})}function l(){var t=s.defaults();return e.all([t]).then(function(t){return t})}return function(){return t.log("TADkit loading..."),c().then(l).then(function(){t.log("TADkit loaded OK!")})}}angular.module("TADkit").factory("App",t),t.$inject=["$log","$q","THREEService","THREETextures","d3Service","Settings","Components","Init"]}(),function(){"use strict";function t(t,e,r,n){var o={loaded:[],current:{index:0}};return{load:function(){var n=e.defer(),i="assets/defaults/tk-defaults-components.json";return o.loaded.length>0?n.resolve(o):r.get(i).success(function(e){o.loaded=e,t.debug("Components ("+e.length+") loaded from "+i),n.resolve(o)}),n.promise},add:function(t){t=t||["","","","","","",[]];var e={metadata:{version:1,type:"component",generator:"TADkit"},object:{uuid:n.generate(),id:t[0],title:t[1],type:t[2],state:{width:t[3],height:t[4],margin:t[5],position:t[6]}},view:t[7]};return o.loaded.push(e),o.current=o.loaded.length-1,o},remove:function(t){t=t||o.current.index;var e=o.loaded.indexOf(t);return o.loaded.splice(e,1),o},set:function(t){(void 0!==t||t!==!1)&&(o.current.index=t);var e=o.loaded[o.current.index];return e},init:function(e){return t.info("Component initialized!"),component},setViewpoint:function(t,e,r){t=t||0,e=e||4999999;var n=o.loaded;return angular.forEach(n,function(n,o){var i=r||1;if(n.view.viewpoint.chromStart=t,n.view.viewpoint.chromEnd=e,"scene"===n.object.type||"scene-clusters"===n.object.type){var a=n.view.viewpoint.fov/2;i=Math.tan(a).toFixed(2)}n.view.viewpoint.scale=i}),o},get:function(){return o},getComponent:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t];return e},getComponentById:function(e){var r,n;if(void 0===e&&e===!1)return t.warn("No valid component ID supplied.");for(var i=o.loaded.length-1;i>=0;i--)o.loaded[i].object.id===e&&(r=o.loaded[i],n=i,t.debug("Component '"+e+"' found!"));return n||(r=o.loaded[o.current.index],t.warn("Component '"+e+"' not found: returning current.")),r},getComponentByType:function(e){var r,n,i,a=this;if(void 0!==e||e!==!1)for(var s=o.loaded.length-1;s>=0;s--)o.loaded[s].object.type===e&&(r=o.loaded[s],i=s,t.debug("Component type '"+e+"' found!")),"default"===o.loaded[s].object.type&&(n=o.loaded[s]);return i||(r=n,t.warn("Component type '"+e+"' not found: returning default.")),a.init(r),r}}}angular.module("TADkit").factory("Components",t),t.$inject=["$log","$q","$http","uuid4"]}(),function(){"use strict";function t(t,e,r,n,o,i){var a={loaded:[],current:{index:0,cluster:1,centroid:1}},s={loaded:[],current:{ref:0}};return{load:function(t,e){t=t||"tk-example-dataset",e=e||!1;var o=this;e&&o.clear();var i="defaults";"tk-example-dataset"!=t&&(i="examples");var s=r.defer(),c="assets/"+i+"/"+t+".json";return n.get(c).success(function(e){e.object.filename=t,o.add(e),s.resolve(a)}),s.promise},add:function(t){var r=this,n=r.validate(t);return a.loaded.push(n),a.current.index=a.loaded.length-1,r.setSpeciesUrl(),r.setRegion(),r.groupClusters(),e.info("Dataset "+n.object.species+" "+n.object.region+" loaded from file."),a},validate:function(t){var e={},r=i.whatIsIt(t);e="String"===r?JSON.parse(t):t;var n=!0;return n?e:void 0},clear:function(){for(;a.loaded.length>0;)a.loaded.shift();return e.info("Datasets Object cleared!")},remove:function(t){(void 0===t||t===!1)&&(t=a.current.index);var r=a.loaded.indexOf(t),n=r.title;return a.loaded.splice(r,1),e.info("Dataset "+n+"at index "+t+" removed!"),a},setSpeciesUrl:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=a.loaded[t].object.species,r=e.replace(/[^a-z0-9]/gi,"_").toLowerCase();return a.loaded[t].object.speciesUrl=r,r},setRegion:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=0;a.loaded[t].object.chromosomeIndex&&(e=a.loaded[t].object.chromosomeIndex);var r=a.loaded[t].object.chrom[e],n=a.loaded[t].object.chromStart[e],o=a.loaded[t].object.chromEnd[e],i=r+":"+n+"-"+o;return a.loaded[t].object.region=i,i},set:function(t){var e=this;(void 0!==t||t!==!1)&&(a.current.index=t),e.setCluster(a.current.cluster);var r=a.loaded[a.current.index];return r},setCluster:function(t){var e=this;t=t||1,s.current.index=t-1;var r=e.getCentroidRef(a.current.cluster);e.setCentroid(r);var n=e.getCluster();return n},setCentroid:function(t){var e=this;t=t||e.getCentroidRef(),a.current.centroid=t;var r=e.setModel(a.current.centroid);return r},setModel:function(t){var e=this;t=t||e.getCentroidRef();var r=e.getModel(t-1);return a.loaded[a.current.index].data=r,r},get:function(){return a},getDataset:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=a.loaded[t];return e},getClusterGroups:function(){var t=a.loaded[a.current.index].clusters;return t},groupClusters:function(){for(var r=this,n=r.getClusterGroups(),o=r.getModels(),i=n.length-1;i>=0;i--){var a={};a.ref=i+1,a.centroid=r.getCentroidRef(a.ref),a.list=n[i],a.centroidIndex=a.list.indexOf(a.centroid),a.data=[];for(var c=a.list.length-1;c>=0;c--){for(var l,u=o.length-1;u>=0;u--){var d=o[u];parseInt(d.ref)==a.list[c]&&(l=d.data,t&&e.debug("Model "+d.ref+" in Cluster "+a.ref))}l?a.data.unshift(l):e.error("Listed model not found!")}s.loaded.unshift(a)}return s.current.ref=1,s},getGroupedClusters:function(){return s.loaded},getCluster:function(t){t=t||s.current.ref;var e=s.loaded[t-1];return e},getClusterModels:function(t){t=t||s.current.ref;var e=s.loaded[t-1];return e},getCentroidRef:function(t){t=t||s.current.ref;var e=a.loaded[a.current.index].centroids[t-1];return e},getModels:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=a.loaded[t].models;return e},getModel:function(t){var e=this;t=t||e.getCentroidRef();for(var r,n=a.loaded[a.current.index].models,o=n.length-1;o>=0;o--)n[o].ref==t&&(r=n[o]);return r},getModelData:function(t){var e=this,r=e.getModel(t);return r.data}}}angular.module("TADkit").factory("Datasets",t),t.$inject=["VERBOSE","$log","$q","$http","uuid4","Utils"]}(),function(){"use strict";function t(t,e,r,n,o,i,a,s,c,l,u){function d(){t.debug("Default user initializing...");var e=r.getUser();"undefined"!=typeof e.projects&&0===e.projects.length&&(e.projects=n.get(),"undefined"!=typeof e.projects.loaded[0].datasets&&0===e.projects.loaded[0].datasets.length&&(e.projects.loaded[0].datasets=o.get()),"undefined"!=typeof e.projects.loaded[0].overlays&&0===e.projects.loaded[0].overlays.length&&(e.projects.loaded[0].overlays=i.get()),"undefined"!=typeof e.projects.loaded[0].storyboards&&0===e.projects.loaded[0].storyboards.length&&(e.projects.loaded[0].storyboards=a.get())),t.debug("Default user initialized.")}function p(){t.debug("Default dataset initializing...");var r=o.getDataset(),n=o.getModelData();s.set(r);var a=c.set(n).distances,u=n.length/3,d=l.set(r.restraints,u),p=i.update(a,d),g=i.loadFromFile(r.object.filename);return e.all([p,g]).then(function(){t.debug("Default dataset initialized.")})}return{defaults:function(){t.debug("Defaults initializing...");var s=r.load(),c=n.load(),l=o.load(),g=i.load(),f=a.load(),v=u.load();return e.all([s,c,l,g,f,v]).then(d).then(p).then(function(){t.debug("Defaults initialized.")})}}}angular.module("TADkit").factory("Init",t),t.$inject=["$log","$q","Users","Projects","Datasets","Overlays","Storyboards","Settings","Proximities","Restraints","ColorsEnsembl"]}(),function(){"use strict";function t(t,e,r,n,o){return{load:function(n,o,i){n=n||"tk-example-dataset",o=o||"tsv","undefined"==typeof i&&(i=!0);var a=this,s=e.defer(),c="defaults";"tk-example-dataset"!=n&&(c="examples");var l="assets/"+c+"/"+n+"."+o;return r.get(l).success(function(e){var r=a["import"](e,[],[],i);t.debug("Overlays ("+r.length+") imported from "+l),s.resolve(r)}).error(function(e){t.error("No associated data tracks found.")}),s.promise},"import":function(t,e,r){var n=this;e=e||[],r=r||[];var i,a=o.whatIsIt(t);i="String"==a?n.parse(t).data:t;var s;s=e.length>0&&r.length>0?n.filter(i,e,r):i;var c=n.aquire(s);return c},parse:function(t){Papa.DefaultDelimiter=" ";var e=Papa.parse(t,{dynamicTyping:!0,skipEmptyLines:!0,fastMode:!0});return e},filter:function(t,e,r){for(var n=[],o=e.length,i=r.length,a=0;o>a;a++){var s=[];if(e[a]){for(var c=0;i>c;c++)r[c]&&s.push(t[a][c]);n.push(s)}}return n},aquire:function(t){var e,r,o,i=["#227c4f","#e71818","#8ece0d","#6666ff","#424242"],a=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],s=[],c=0,l=1,u=0,d=1,p=t[c].length,g=t[l][d]-t[l][u]+1,f=t[l+1][d]-t[l+1][u]+1;g==f?(e="wiggle_0",r="fixed",o="fixed"):(e="bedgraph",r="variable",o="variable");var v=!1;if(7==p){for(var h=0,m=2;p>m;m++){var w=t[c][m].toLowerCase();("hp1"==w||"brm"==w||"mrg15"==w||"pc"==w||"h1"==w)&&h++}5==h&&(v=!0)}for(var y=p-1;y>=2;y--){var b;b=v?i[y-2]:a[y],s.unshift({metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:n.generate(),id:t[c][y],title:t[c][y],source:"Research output",url:"local",description:"center_label",type:e,format:r,components:2,name:t[c][y],visibility:"full",color:b,altColor:"#cccccc",priority:"100",stepType:o,chrom:"",start:t[l][u],step:g,state:{index:0,overlaid:!1}},palette:[b,"#cccccc"],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}});for(var x=t.length-1;x>=1;x--)"variable"==r?s[0].data.unshift({start:t[x][u],end:t[x][d],read:t[x][y]}):s[0].data.unshift(t[x][y])}return s}}}angular.module("TADkit").factory("OverlaysImport",t),t.$inject=["$log","$q","$http","uuid4","Utils"]}(),function(){"use strict";function t(t,e,r,n,o,a,s,c,l,u,d){var p={loaded:[],current:{index:0}};return{load:function(){var n=e.defer(),o="assets/defaults/tk-defaults-overlays.json";return p.loaded.length>0?n.resolve(p):r.get(o).success(function(e){p.loaded=e,t.debug("Overlays ("+e.length+") loaded from "+o),n.resolve(p)}),n.promise},loadFromFile:function(t,e,r){t=t||"none",e=e||"tsv",r=r||!0,"none"!=t&&o.load(t,e,r)},fetch:function(t){var e=o.parse(t).data;return e},"import":function(t,e,r){var n=this,i=o["import"](t,e,r);return n.add(i),i},add:function(e){var r=this,n=[],o=p.loaded.length-1;return angular.forEach(e,function(e,r){var a=!1;t.debug(p.loaded[i].object.uuid),t.debug(e.object.uuid),a||(o++,e.object.state.index=o,e.object.state.overlaid=!1,n.push(e),s.addComponent(e))}),p.loaded=p.loaded.concat(n),r.segment(),n},clear:function(){for(;p.loaded.length>0;)p.loaded.shift()},defaults:function(){for(;p.loaded.length>4;)p.loaded.pop(),s.defaultComponents()},remove:function(t){(void 0===t||t===!1)&&(t=p.current.index);var e=p.loaded.indexOf(t);return p.loaded.splice(e,1),p},set:function(t){(void 0!==t||t!==!1)&&(p.current.index=t);var e=p.loaded[p.current.index];return e},setOverlaid:function(t){return t=t||"",angular.forEach(p.loaded,function(e){e.object.state.index===t?e.object.state.overlaid=!0:e.object.state.overlaid=!1}),t},update:function(t,r){var n=this,o=[],i=[];return angular.forEach(p.loaded,function(t,e){if("ensembl"==t.object.type){var r=a.getAddress(),n=c.load(t,r);o.push(n),i.push(t)}}),e.all(o).then(function(t){for(var e=0;e<i.length;e++){var r=i[e];s.update(r)}return n.segment(),t})},segment:function(){var e=this,r=a.get();return angular.forEach(p.loaded,function(n,o){var i=!0;if(i){var a=n.object.type,s=n.object.format;if("gradient"==a&&"hex"==s)n.colors.particles=u.gradientHCL(n,r.current.particlesCount),n.colors.chromatin=u.gradientHCL(n,r.current.segmentsCount),n.colors.network.RGB=d.lineSegmentsRGB(n,r.current.edgesCount),n.colors.network.alpha=d.lineSegmentsAlpha(n,r.current.edgesCount);else if("wiggle_0"==a&&"fixed"==s)n.colors.particles=u.bicolor(n,r.current.particlesCount),n.colors.chromatin=u.bicolor(n,r.current.segmentsCount),n.colors.network.RGB=d.lineSegmentsRGB(n,r.current.edgesCount),n.colors.network.alpha=d.lineSegmentsAlpha(n,r.current.edgesCount);else if("wiggle_0"==a&&"variable"==s);else if("bedgraph"==a)n.colors.particles=u.bicolorVariable(n,r.current.chromStart,r.current.particlesCount,1),n.colors.chromatin=u.bicolorVariable(n,r.current.chromStart,r.current.segmentsCount,r.current.segmentLength),n.colors.network.RGB=d.lineSegmentsRGB(n,r.current.edgesCount),n.colors.network.alpha=d.lineSegmentsAlpha(n,r.current.edgesCount);else if("matrix"==a)n.colors.particlesMatrix=u.matrix(n,1),n.colors.chromatinMatrix=u.matrix(n,r.current.particleSegments),n.colors.networkMatrix=n.colors.particlesMatrix,e.at(1,r.current.particlesCount,r.current.particleSegments);else if("misc"==a&&"variable"==s)n.colors.particles=[],n.colors.chromatin=[],n.colors.network.RGB=d.lineSegmentsRGB(n,r.current.edgesCount),n.colors.network.alpha=d.lineSegmentsAlpha(n,r.current.edgesCount);else if("ensembl"==a&&"json"==s){var c=l.get("gene"),p=1;n.colors.particles=u.features(n,r.current.chromStart,r.current.particlesCount,p,c),n.colors.chromatin=u.features(n,r.current.chromStart,r.current.segmentsCount,r.current.segmentLength,c),n.colors.network.RGB=d.lineSegmentsRGB(n,r.current.edgesCount),n.colors.network.alpha=d.lineSegmentsAlpha(n,r.current.edgesCount)}}else t.warn("Overlay '"+n.object.title+"' already segmented as color array matching current dataset length")}),p},at:function(t){var e=a.get();return angular.forEach(p.loaded,function(r,n){var o=r.object.type;if("matrix"==o){var i=(t-1)*e.current.particlesCount,a=t*e.current.particlesCount,s=i*e.current.particleSegments,c=a*e.current.particleSegments;r.colors.particles=r.colors.particlesMatrix.slice(i,a),r.colors.chromatin=r.colors.chromatinMatrix.slice(s,c),r.colors.network=r.colors.networkMatrix.slice(i,a)}}),p},get:function(){return p},getOverlay:function(t){(void 0===t||t===!1)&&(t=p.current.index);var e=p.loaded[t];return e},getOverlayById:function(e){var r,n;if(void 0!==e||e!==!1)for(var o=p.loaded.length-1;o>=0;o--)p.loaded[o].object.id===e&&(r=p.loaded[o],r.object.state.index=o,n=!0,t.debug('Overlay "'+e+'" found!'));return n||(r=p.loaded[p.current.index],r.object.state.index=p.current.index,t.debug('Overlay "'+e+'" not found: returning current.')),t.debug(r),r},getCurrentIndex:function(){return p.current.index}}}angular.module("TADkit").factory("Overlays",t),t.$inject=["$log","$q","$http","uuid4","OverlaysImport","Settings","Storyboards","FeaturesEnsembl","ColorsEnsembl","Segments","Networks"]}(),function(){"use strict";function t(t,e,r,n){var o={loaded:[],current:{index:0}};return{load:function(){var n=e.defer(),i="assets/defaults/tk-defaults-projects.json";return o.loaded.length>0?n.resolve(o):r.get(i).success(function(e){o.loaded=e,t.debug("Projects ("+e.length+") loaded from "+i),n.resolve(o)}),n.promise},add:function(t){var e={metadata:{version:1,type:"project",generator:"TADkit"},object:{uuid:n.generate(),id:t[0],title:t[1],description:t[2],group:t[3],state:t[4]},datasets:t[5],overlays:t[6],storyboards:t[7]};return o.loaded.push(e),o.current=o.loaded.length-1,o},remove:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded.indexOf(t);return o.loaded.splice(e,1),o},set:function(t){(void 0!==t||t!==!1)&&(o.current.index=t);var e=o.loaded[o.current.index];return e},get:function(){return o},getProject:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t];return e},getState:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t].object.state;return e}}}angular.module("TADkit").factory("Projects",t),t.$inject=["$log","$q","$http","uuid4"]}(),function(){"use strict";function t(t,e,r,n){var o={};return{load:function(){var t=r.defer(),i="assets/defaults/tk-defaults-settings.json";return Object.getOwnPropertyNames(o).length>0?t.resolve(o):n.get(i).success(function(r){o=r,e.debug("Settings loaded from "+i),t.resolve(o)}),t.promise},set:function(t){var e=this,r=0;t.object.chromosomeIndex&&(r=t.object.chromosomeIndex),o.current.chrom=t.object.chrom[r],o.current.chromStart=t.object.chromStart[r],o.current.chromEnd=t.object.chromEnd[r],o.current.species=t.object.species,o.current.speciesUrl=t.object.speciesUrl,o.current.particleSegments=20,o.current.particlesCount=t.models[0].data.length/t.object.components,o.current.edgesCount=.5*(o.current.particlesCount*o.current.particlesCount-o.current.particlesCount),o.current.segmentsCount=o.current.particlesCount*o.current.particleSegments,o.current.segmentLength=t.object.resolution/o.current.particleSegments,o.current.position=o.current.chromStart+parseInt(.5*(o.current.chromEnd-o.current.chromStart)),o.current.particle=e.getParticle(),o.current.segment=e.getSegment(o.current.position),o.current.segmentLower=o.current.position-.5*o.current.segment,o.current.segmentUpper=o.current.position+.5*o.current.segment},setOnline:function(e){return e=e||t,o.app.online=e,o.online},add:function(t){return o},remove:function(t){return o},getState:function(t){var e=o[settingID].state;return e},get:function(){return o},getOnline:function(){var e=!1;return e=o.app?o.app.online:t},getAddress:function(){var t={};return t.species=o.current.species,t.speciesUrl=o.current.speciesUrl,t.chrom=o.current.chrom,t.chromStart=o.current.chromStart,t.chromEnd=o.current.chromEnd,t},getSegment:function(t){t=t||o.current.position;var e=this,r=e.getRange(o.current.chromStart,t),n=e.getRange(o.current.chromStart,o.current.chromEnd),i=Math.ceil(r*o.current.segmentsCount/n);return i},getParticle:function(t){t=t||o.current.position;var e=this,r=e.getRange(o.current.chromStart,t),n=e.getRange(o.current.chromStart,o.current.chromEnd),i=Math.ceil(r*o.current.particlesCount/n);return i},getRange:function(t,e){for(var r=0,n=t;e>=n;n++)r++;return r},toggle:function(t){return angular.forEach(o,function(e,r){t==e.id&&(e.state=!e.state)}),o}}}angular.module("TADkit").factory("Settings",t),t.$inject=["ONLINE","$log","$q","$http"]}(),function(){"use strict";function t(t,e,r,n,o,i){var a={loaded:[],current:{index:0}};return{load:function(){var n=e.defer(),o="assets/defaults/tk-defaults-storyboards.json";return a.loaded.length>0?(t.warn("Storyboards already loaded."),n.resolve(a)):r.get(o).success(function(e){a.loaded=e,t.debug("Storyboards ("+e.length+") loaded from "+o),n.resolve(a)}),n.promise},add:function(t){t=t||[""];var e={metadata:{version:1,type:"storyboard",generator:"TADkit"},object:{uuid:n.generate(),id:t[0],title:t[1],email:t[2],group:t[3],permissions:t[4]},data:t[5]};return a.loaded.push(e),a.current=a.loaded.length-1,a},addComponent:function(t,e,r){var a=this;e=e||"default",r=r||[];var s=o.get(),c=i.getComponentByType(t.object.type),l=angular.copy(c);l.object.uuid=n.generate(),l.object.id=t.object.id,l.object.title=t.object.id,l.object.dataset=t.object.id,l.view.settings.step=t.object.step,l.view.settings.color=t.object.color,l.view.viewpoint.chromStart=s.current.chromStart,l.view.viewpoint.chromEnd=s.current.chromEnd,l.view.viewpoint.scale=s.views.scale,l.view.viewtype=t.object.type+"-"+t.object.stepType,l.data=t.data,l.overlay=t;var u=a.getStoryboardById(e);return u.components.push(l),l},defaultComponents:function(e){var r=this;e=e||"current";var n;for(n="current"==e?r.getStoryboard():r.getStoryboardById(e);n.components.length>6;)t.warn("Popping to default components..."),a.loaded[a.current.index].components.pop();return a},remove:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=a.loaded.indexOf(t);return a.loaded.splice(e,1),a},removeComponentById:function(t){var e=this;if(void 0!==t||t!==!1){var r=e.getComponentById(t),n=e.getStoryboard();n.components.splice(r.index,1)}return a},set:function(t){(void 0!==t||t!==!1)&&(a.current.index=t);var e=a.loaded[a.current.index];return e},setViewpoint:function(e,r,n){e=e||0,r=r||4999999;var o=a.loaded[a.current.index].components;return t.debug(o),angular.forEach(o,function(t,o){var i=n||1;if(t.view.viewpoint.chromStart=e,t.view.viewpoint.chromEnd=r,"scene"===t.object.type||"scene-clusters"===t.object.type){var a=t.view.viewpoint.fov/2,s=.6;i=Math.tan(a).toFixed(2)*s}t.view.viewpoint.scale=i}),a},update:function(t){var e=this,r=e.getStoryboard().components;angular.forEach(r,function(e,r){("track-genes"==e.object.type||"panel-inspector"==e.object.type)&&(e.data=t.data,e.overlay=t)})},get:function(){return a},getStoryboard:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=a.loaded[t];return e},getStoryboardById:function(e){var r,n;if(void 0!==e||e!==!1)for(var o=a.loaded.length-1;o>=0;o--)a.loaded[o].object.id===e&&(r=a.loaded[o],r.index=o,n=!0,t.debug('Overlay "'+e+'" found!'));return n||(r=a.loaded[a.current.index],r.index=a.current.index,t.warn("Storyboard '"+e+"' not found: returning current.")),r},getComponents:function(){var t=this,e=t.getStoryboard().components;return e},getComponentById:function(e){var r,n,o=this,i=o.getStoryboard().components;if(void 0!==e||e!==!1)for(var a=i.length-1;a>=0;a--)t.debug(i[a].object.title),i[a].object.title===e&&(r=i[a],r.index=a,n=!0,t.debug("Component '"+e+"' found"));return n||(r=i[0],t.warn("Component '"+e+"' not found: returning first.")),t.debug(r),r}}}angular.module("TADkit").factory("Storyboards",t),t.$inject=["$log","$q","$http","uuid4","Settings","Components"]}(),function(){"use strict";function t(t,e,r,n){var o={loaded:[],current:{index:0}};return{load:function(){var n=e.defer(),i="assets/defaults/tk-defaults-users.json";return o.loaded.length>0?n.resolve(o):r.get(i).success(function(e){o.loaded=e,t.debug("Users ("+e.length+") loaded from "+i),n.resolve(o)}),n.promise},add:function(t){t=t||["id","Name Surname","email@company.com","Group","edit",["default"]];var e={metadata:{version:1,type:"user",generator:"TADkit"},object:{uuid:n.generate(),id:t[0],title:t[1],email:t[2],group:t[3],permissions:t[4]},projects:t[5]};return o.loaded.push(e),o.current=o.loaded.length-1,o},remove:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded.indexOf(t);return o.loaded.splice(e,1),o},set:function(t){(void 0!==t||t!==!1)&&(o.current.index=t);var e=o.loaded[o.current.index];return e},get:function(){return o},getUser:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t];return e},getPermissions:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t].permissions;return e}}}angular.module("TADkit").factory("Users",t),t.$inject=["$log","$q","$http","uuid4"]}(),function(){"use strict";function t(t,e,r){return{restrict:"EA",link:function(n,o,i){t&&e.debug(n);var a="<data-tk-component-"+n.component.object.type+' id="{{component.object.id}}-'+n.$index+'" type="component.object.type" title="{{component.object.title}}" state="component.object.state" settings="settings" view="component.view" currentparticle="currentParticle"currentposition="currentPosition"currentmodel="current.model" currentoverlay="current.overlay" data="component.data" proximities="component.proximities" overlay="component.overlay"toggleoverlay="toggleOverlay(index)" style="margin: {{component.object.state.margin}}; background-color: {{component.view.settings.background}}" class="component '+n.component.object.type+'"></data-tk-component-'+n.component.object.type+">";o.replaceWith(r(a)(n))}}}angular.module("TADkit").directive("tkComponent",t),t.$inject=["VERBOSE","$log","$compile"]}(),function(){"use strict";function t(t){t.species=t.current.dataset.object.species,t.region=t.current.dataset.object.region}angular.module("TADkit").controller("PanelInfoboxController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(){return{restrict:"C",templateUrl:"assets/templates/panel-infobox.html",link:function(t,e,r){}}}angular.module("TADkit").directive("tkComponentPanelInfobox",t)}(),function(){"use strict";function t(t,e){t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState},t.toggle=function(t){t=!t},t.width=parseInt(t.state.width),t.height=parseInt(t.state.height),t.atPosition=function(e){return t.$parent.settings.current.segmentUpper>=e.start&&t.$parent.settings.current.segmentLower<=e.end?!0:!1},t.formatRegionName=function(t){return"Chromosome"==t?t:"chr"+t},t.featureTitle=function(t){return t.external_name?t.external_name:t.id},t.getDetails=function(t,r){e.show(e.alert().title("Details").content(t.description).ariaLabel("Item details").ok("Close").targetEvent(r))}}angular.module("TADkit").controller("PanelInspectorController",t),t.$inject=["$scope","$mdDialog"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"="},templateUrl:"assets/templates/panel-inspector.html",link:function(r,n,o){t&&e.debug(r.data)}}}angular.module("TADkit").directive("tkComponentPanelInspector",t),t.$inject=["VERBOSE","$log"]}(),function(){"use strict";function t(t,n,o,i){return function(a,s,c){t&&n.debug(s);var l={visible:!0,genomeLength:816394,particles:0,particleSegments:5,curveSegments:1,radius:15,radiusSegments:16,endcap:!1,pathClosed:!1};c=c||{},angular.extend(this,angular.copy(l),c);for(var u=e(a),d=u.vertices.length-1;d>=0;d--){var p=new THREE.Color(s[20*d]);u.colors.unshift(p)}for(var g=i.cubic(u.vertices,this.pathClosed),f=new THREE.Geometry,v=0;v<g.vertices.length;v++){f.vertices.push(new THREE.Vector3(g.vertices[v].x,g.vertices[v].y,g.vertices[v].z||0));var h=g.colors[v];f.colors.push(h)}f.name="controlsGeom",0===this.particles&&(this.particles=u.vertices.length);var m=this.particles*this.particleSegments;this.pathSegments=m;for(var w=o.cubicBezier(g.vertices,m,this.pathClosed),y=w.createPointsGeometry(m),b=y.vertices.length-1;b>=0;b--){var x=new THREE.Color(s[b]);y.colors.unshift(x)}y.name="cubicGeom";var C=w.getLength(),$=15,k=11*this.genomeLength/1080;this.radius=C*$/k;for(var S=new THREE.Object3D,j=new THREE.Geometry,E=0;m>E;E++){this.endcap=0===E||E===m-1?!1:!0;var T=s[E],A=new THREE.MeshLambertMaterial({color:T,emissive:T,vertexColors:THREE.VertexColors,opacity:1,transparent:!1,wireframe:!1}),D=r(y.vertices[E],y.vertices[E+1],this);j.merge(D);var R=new THREE.Mesh(D,A);R.name="segment-"+(E+1),S.add(R)}return j.computeBoundingSphere(),S.boundingSphere=j.boundingSphere,S.name="Chromatin Fiber",S}}function e(t){for(var e,r=0,n=new THREE.Geometry,o=t.length;o>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n.name="Chromatin Geometry",n}function r(t,e,r){var n,o=(new THREE.Vector3).subVectors(e,t),i=new THREE.Matrix4;i.lookAt(t,e,(new THREE.Object3D).up);var a=new THREE.Matrix4;return a.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),i.multiply(a),i.setPosition(t.add(e).multiplyScalar(.5)),n=new THREE.CylinderGeometry(r.radius,r.radius,o.length(),r.radiusSegments,r.curveSegments,r.endcap),n.applyMatrix(i),n}angular.module("TADkit").factory("Chromatin",t),t.$inject=["VERBOSE","$log","Paths","PathControls"]}(),function(){"use strict";function t(t,r){return function(n,o,i,a,s){n&&t.debug(a);var c={visible:!0};s=s||{},angular.extend(this,angular.copy(c),s);for(var l=new THREE.BufferGeometry,u=r.THREEColorsFromHex(a),d=new THREE.Object3D,p=0;p<o.length;p++){var g=o[p];l.addAttribute("position",new THREE.BufferAttribute(g,3));var f=e(g);f.colors=u;var v=(a[p],new THREE.LineBasicMaterial({color:new THREE.Color(this.color),opacity:this.modelOpacity,transparent:this.transparent,linewidth:this.linewidth,fog:this.fog})),h=new THREE.LineBasicMaterial({opacity:this.centroidOpacity,transparent:this.transparent,linewidth:this.linewidth,vertexColors:THREE.VertexColors,fog:this.fog});p==i&&(v=h);var m=new THREE.Line(f,v);m.name="model-"+p,d.add(m)}return l.computeBoundingBox(),d.boundingBox=l.boundingBox,d.BufferGeometry=l,d.name="Cluster Ensemble",d}}function e(t){for(var e,r=0,n=new THREE.Geometry,o=t.length;o>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n}angular.module("TADkit").factory("Cluster",t),t.$inject=["$log","Color"]}(),function(){"use strict";function t(t,e,r,n,o,i){return{restrict:"EA",scope:{title:"@",view:"=",clusters:"=",overlay:"=",mousemove:"&"},templateUrl:"assets/templates/scene-clusters.html",link:function(a,s,c){t&&e.debug(a),n.load(["TrackballControls","OrbitControls"]).then(function(t){var n,c,l,u,d,p,g,f,v,h,m,w,y,b,x=r.getRenderer(),C=[];a.init=function(){n=s[0].children[0].children[3].children[0],c=s.parent().parent()[0];var e=parseInt(window.getComputedStyle(c,null).getPropertyValue("padding"));l=c.clientWidth-2*e,u=c.clientHeight-2*e,x.setSize(l,u),n.appendChild(x.domElement);var r=a.view.settings.rowHeight,$=r.split(":"),k=parseInt($[0],10)/parseInt($[1],10);m=parseInt(a.view.settings.gutter),h=a.view.settings.cols;var S=(h-1)/h,j=1/h,E=m*S;w=l*j-E,y=w,b=y*k,d=new t.PerspectiveCamera(a.view.viewpoint.fov,k,a.view.viewpoint.near,a.view.viewpoint.far),d.position.fromArray(a.view.viewpoint.camera),d.name="Scene Camera",
v=new t.TrackballControls(d,x.domElement),angular.forEach(a.clusters,function(e,r){C[r]=new t.Scene;var n,s;n=new o(e.data[e.centroidIndex],a.overlay,a.view.settings.particles),n.visible=a.view.settings.particles.visible,C[r].add(n),s=new i(e.data,e.centroidIndex,a.overlay,a.view.settings.cluster),s.visible=a.view.settings.cluster.visible,s.name=s.name+" "+r,C[r].add(s)}),p=a.view.viewpoint.camera,g=a.view.viewpoint.target,f=a.view.viewpoint.translate,a.lookAtTarget(p,g,f)},a.lookAtTarget=function(e,r,n){e=e||new t.Vector3(5e4,5e4,5e4);var o=new t.Vector3(0,0,0);r=r||o,n=n||500,d.position.set(e.x,e.y,e.z),d.lookAt(o),d.translateZ(n),d.lookAt(r),d.updateMatrixWorld(),v.target.copy(e),v.update()};var $,k=0;a.animate=function(){k>=0&&1>k?($=requestAnimationFrame(a.animate),v.update(),a.render(),k++,e.debug("AnimationFrame requested")):(cancelAnimationFrame($),e.debug("AnimationFrame canceled"))},a.render=function(){var t=1,r=1;angular.forEach(a.clusters,function(e,n){0===n&&x.clear();var o=C[n];v.update();var i=(w+m)*(t-1),a=u-w*r;x.setViewport(i,a,y,b),x.setScissor(i,a,y,b),x.enableScissorTest(!0),x.setClearColor("#ffffff"),x.render(o,d,null,!0),t===h?(t=1,r++):t++}),e.debug(d)},angular.element(document).ready(function(){a.init(),a.animate()})})}}}angular.module("TADkit").directive("tkComponentSceneClusters",t),t.$inject=["VERBOSE","$log","THREEService","THREEPlugins","Particles","Cluster"]}(),function(){"use strict";function t(t,e,r){return{restrict:"EA",link:function(n,o,i){r.load(["TrackballControls","OrbitControls"]).then(function(r){var i,a,s,c,l,u,d,p,g=e.getRenderer();n.init=function(){i=o[0],a=i.clientWidth,g.setSize(a,a),i.appendChild(g.domElement),c=new r.Scene,s=new r.PerspectiveCamera(50,1,150,650),s.position.z=500,c.add(s),l=new r.TorusKnotGeometry(100,30,100,16),u=new r.MeshDepthMaterial({wireframe:!0}),d=new r.Mesh(l,u),d.name="Floating TAD",c.add(d)},t.$on("$stateChangeStart",function(){cancelAnimationFrame(p)}),n.animate=function(){p=requestAnimationFrame(n.animate),n.render()},n.render=function(){d.rotation.x+=.006,d.rotation.y+=.006,g.render(c,s,null,!0)},n.init(),n.animate()})}}}angular.module("TADkit").directive("tkComponentSceneFloatingtad",t),t.$inject=["$rootScope","THREEService","THREEPlugins"]}(),function(){"use strict";function t(t,r,n,o,i){return function(n,o,i){t&&r.debug(n),t&&r.debug(o);var a={color:"#ff0000",size:200,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0,visible:!1};i=i||{},angular.extend(this,angular.copy(a),i);var s={},c={uniforms:s,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,vertexColors:THREE.VertexColors,transparent:!0},l=new THREE.ShaderMaterial(c),u=n.length/3,d=.5*(u*u-u),p=e(n,d),g=o.RGB,f=o.alpha,v=new THREE.BufferGeometry;v.addAttribute("position",new THREE.BufferAttribute(p,3)),v.addAttribute("color",new THREE.BufferAttribute(g,3)),v.addAttribute("alpha",new THREE.BufferAttribute(f,1)),v.computeBoundingSphere();var h=null;if(this.map){var m=new THREE.TextureLoader;m.load(this.map,function(t){h=t},function(t){r.info(t.loaded/t.total*100+"% loaded")},function(t){r.error("An error happened")})}var w=(new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:h,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),new THREE.LineSegments(v,l));return w.name="Network Graph",t&&r.debug(w),w}}function e(t,e,r){for(var n=new Float32Array(6*r),o=0,i=0;i<e.length;i+=3)for(var a=i,s=i+3;s<e.length;s+=3){var c=s;t.debug(o),t.debug(e[a]+","+e[a+1]+","+e[a+2]),t.debug(e[c]+","+e[c+1]+","+e[c+2]),n[o]=e[a],o++,n[o]=e[a+1],o++,n[o]=e[a+2],o++,n[o]=e[c],o++,n[o]=e[c+1],o++,n[o]=e[c+2],o++}return n.name="Network Vertex Pairs",n}angular.module("TADkit").factory("Network",t),t.$inject=["VERBOSE","$log","Color","Particles","Networks"]}(),function(){"use strict";function t(t){return function(r,n,o){var i={particles:0,visible:!0,color:"#fff000",size:200,opacity:.8,map:"particle",depthtest:!0,alphatest:.5,transparent:!0};o=o||{},angular.extend(this,angular.copy(i),o);var a=e(r);a.computeBoundingSphere();for(var s=[],c=0;c<a.vertices.length;c++)s[c]=new THREE.Color("rgb(255,255,255)");a.colors=s;var l=t.get(this.map),u=new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:l,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),d=new THREE.Points(a,u);return d.name="Particles",d}}function e(t){for(var e,r=0,n=new THREE.Geometry,o=t.length;o>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n.name="Particles Geometry",n}angular.module("TADkit").factory("Particles",t),t.$inject=["THREETextures"]}(),function(){"use strict";function t(t,e,r,n){r.optionsState=!1,r.toggleOptions=function(){r.optionsState=!r.optionsState},r.toggle=function(e){e=!e,t.debug(e)},r.selectCluster=function(r){n.setCluster(r+1);var o=n.getCentroidRef();t.info("Current Cluster: "+(r+1)+" (Centroid Model: "+o+")"),e.go("browser")}}angular.module("TADkit").controller("SceneController",t),t.$inject=["$log","$state","$scope","Datasets"]}(),function(){"use strict";function t(t,e,r,n,o,i,a){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",state:"=",currentmodel:"=",proximities:"=",currentoverlay:"="},templateUrl:"assets/templates/scene.html",link:function(t,s,c){n.load(["TrackballControls","OrbitControls"]).then(function(n){var c,l,u,d,p,g,f,v,h,m,w,y,b,x,C,$,k,S,j,E,T=r.getRenderer(),A=new n.Color,D=new n.Color,R=new n.Color("rgb(0,0,0)");t.init=function(){c=s[0].children[0].children[3],l=parseInt(t.state.width),u=parseInt(t.state.height);var e=t.view.settings.background;T.setSize(l,u),c.appendChild(T.domElement),h=new n.Scene,m=new n.PerspectiveCamera(t.view.viewpoint.fov,l/u,t.view.viewpoint.near,t.view.viewpoint.far),m.position.fromArray(t.view.viewpoint.camera),m.name="Scene Camera",h.add(m),k=new n.TrackballControls(m,T.domElement),$=new n.OrbitControls(m,T.domElement),$.autoRotate=t.view.controls.autoRotate,$.autoRotateSpeed=t.view.controls.autoRotateSpeed,$.enableZoom=!1,$.enableRotate=!1,$.enablePan=!1,$.enableKeys=!1;var r=new n.AxisHelper(t.view.settings.axis.size);r.visible=t.view.settings.axis.visible,r.name="Axis",h.add(r);var d=t.view.settings.lighting.ambient;x=new n.AmbientLight(d),x.name="Scene Ambient Light",S=new o(t.currentmodel.data,t.currentoverlay.colors.particles,t.view.settings.particles),S.visible=t.view.settings.particles.visible,h.add(S),j=new i(t.currentmodel.data,t.currentoverlay.colors.chromatin,t.view.settings.chromatin),j.visible=t.view.settings.chromatin.visible,h.add(j),t.view.settings.chromatin.radius=j.boundingSphere.radius,E=new a(t.data,t.overlay.colors.network,t.view.settings.network),E.visible=t.view.settings.network.visible,h.add(E),w=j.boundingSphere.center,y=j.boundingSphere.center,b=j.boundingSphere.radius*t.view.viewpoint.scale,t.lookAtTAD(w,y,b);var p=t.view.settings.lighting.color,g=t.view.settings.lighting.intensity;C=new n.PointLight(p,g),C.name="Scene Light",m.add(C);var f=.5*b;C.position.set(f,f,-1*f);var v=100,I=(new n.PointLightHelper(C,v),b*t.view.viewpoint.fogNear),O=b*t.view.viewpoint.fogFar;t.view.viewpoint.fog&&(h.fog=new n.Fog(e,I,O)),t.$watch("view.controls.autoRotate",function(e,r){e!==r&&($.autoRotate=t.view.controls.autoRotate)}),t.$watch("view.settings.axis.visible",function(t,e){t!==e&&(r.visible=!r.visible)}),t.$watch("view.settings.particles.visible",function(t,e){t!==e&&(S.visible=!S.visible)}),t.$watch("view.settings.chromatin.visible",function(t,e){t!==e&&(j.visible=!j.visible)}),t.$watch("view.settings.network.visible",function(t,e){t!==e&&(E.visible=!E.visible)});var P=h.getObjectByName("Particles Cloud"),B=h.getObjectByName("Chromatin Fiber"),H=h.getObjectByName("Network Graph");t.$watch("currentoverlay.colors.chromatin",function(t,e){if(t!==e)for(var r=B.children.length,o=0;r>o;o++){var i=new n.Color(t[o]);B.children[o].material.color=i,B.children[o].material.ambient=i,B.children[o].material.emissive=i}}),t.$watch("currentoverlay.colors.network",function(t,e){t!==e&&(H.geometry.addAttribute("color",new n.BufferAttribute(t.RGB,3)),H.geometry.addAttribute("alpha",new n.BufferAttribute(t.alpha,1)))}),t.$watch("settings.current.particle",function(t,e){t!==e&&(A&&(P.geometry.colors[e-1]=A),A=P.geometry.colors[t-1],P.geometry.colors[t-1]=R,P.geometry.colorsNeedUpdate=!0)}),t.$watch("settings.current.segment",function(t,e){if(t!==e){var r=B.getObjectByName("segment-"+e);D&&(r.material.color=D,r.material.ambient=D,r.material.emissive=D);var n=B.getObjectByName("segment-"+t);D=n.material.color,n.material.color=R,n.material.ambient=R,n.material.emissive=R}})},t.onWindowResize=function(){t.resizeCanvas()},e.$on("$stateChangeStart",function(){cancelAnimationFrame(v)}),t.resizeCanvas=function(){d=.66*c.parentNode.clientWidth,p=.66*d,g=d/2,f=p/2,m.aspect=d/p,m.updateProjectionMatrix(),T.setSize(d,p)},t.lookAtTAD=function(t,e,r){t=t||new n.Vector3(5e4,5e4,5e4);var o=new n.Vector3(0,0,0);e=e||o,r=r||500,m.position.set(t.x,t.y,t.z),m.lookAt(o),m.translateZ(r),m.lookAt(e),m.updateMatrixWorld(),k.target.copy(t)},t.animate=function(){v=requestAnimationFrame(t.animate),k.update(),t.render()},t.render=function(){T.render(h,m,null,!0)},t.init(),t.animate()})}}}angular.module("TADkit").directive("tkComponentScene",t),t.$inject=["$log","$rootScope","THREEService","THREEPlugins","Particles","Chromatin","Network"]}(),function(){"use strict";function t(t,e,r,n){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(o,i,a){t&&e.debug(o),r.load().then(function(t){o.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var e,r,a,s,c,l,u,d,p,g,f,v,h,m=o.data,w=o.view.viewpoint.chromStart,y=o.view.viewpoint.chromEnd,b=o.settings.current.particlesCount,x=parseInt(o.view.settings.margin),C={top:parseInt(o.view.settings.padding.top),right:parseInt(o.view.settings.padding.right),bottom:parseInt(o.view.settings.padding.bottom),left:parseInt(o.view.settings.padding.left)},$=parseInt(o.view.settings.heightInner),k=(o.view.settings.color,o.overlay.palette[0]),S=o.overlay.palette[1],j=i[0].parentNode,E=i[0].children[0].children[3],T=t.select(E).append("svg");o.$watch(function(){var t=j.clientWidth,e=j.clientHeight;return t+e},function(){o.render(m)}),o.$watch("data.dimension",function(t,e){t!==e&&(m=o.data,o.render(m))}),o.$watch("settings.current.position",function(t,e){t!==e&&o.update()}),o.getColor=function(t){for(var e=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=e.length-1;n>=0;n--)t==e[n].code&&(r=e[n].color);return r},o.getOpacity=function(t){var e,r=t/5;return e=r*r},o.getStrokeWidth=function(t){var e=10,r=t/5;return e*=r},o.render=function(n){if(T.selectAll("*").remove(),n){var i=j.clientWidth-2*x-C.left-C.right,m=$-C.top-C.bottom,E=1*i/b,A=E;e=t.scale.linear().range([0,i]).domain([w,y]).clamp(!0),r=t.scale.linear().domain([-5,5]).range([0,m]),a=t.svg.axis().scale(r).orient("left").ticks(6).outerTickSize(1);var D=2;s=t.svg.brush().x(e).extent([0,0]).on("brush",o.brushed),c=T.attr("width",i+C.left+C.right).attr("height",m+C.top+C.bottom).append("g").attr("transform","translate("+C.left+","+C.top+")").call(s),c.append("g").attr("class","y axis").append("line").attr("y1",r(0)).attr("y2",r(0)).attr("x1",0).attr("x2",i),c.select(".background").attr("y",m/2).attr("height",m),l=c.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",i).attr("height",m).style("fill","white"),u=c.append("g").attr("class","focus"),d=u.append("g").attr("class","container").attr("clip-path","url(#clip)"),f=d.append("g").attr("class","harmonics"),v=d.append("g").attr("class","lowerbounds"),p=u.append("g").attr("class","axis y").call(a),g=c.append("g").attr("class","labels"),f.selectAll("rect").data(n.harmonics).enter().append("rect").attr("x",function(t){return t[1]*A}).attr("y",function(t){return r(t[3])}).attr("width",A).attr("height",function(t){return r(t[3])}).style("fill",k).style("stroke",k).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),v.selectAll("rect").data(n.lowerBounds).enter().append("rect").attr("x",function(t){return t[1]*A}).attr("y",function(t){return r(Math.max(0,-1*t[3]))}).attr("width",A).attr("height",function(t){return r(t[3])}).style("fill",S).style("stroke",S).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),h=c.append("rect").attr("id","highlight").attr("x",function(t){return e(o.settings.current.position)}).attr("y",0).attr("width",D).attr("height",$).attr("class","highlight-follow")}},o.update=function(t){T.select("#highlight").attr("x",function(t){return e(o.settings.current.position)})},o.brushed=function(){var r=this;o.safeApply(function(){var i=s.extent()[0];t.event.sourceEvent&&(i=parseInt(e.invert(t.mouse(r)[0])),s.extent([i,i])),h.attr("x",e(i)),o.settings.current.position=i,o.settings.current.particle=n.getParticle(),o.settings.current.segmentLower=o.settings.current.position-5*o.settings.current.segment,o.settings.current.segmentUpper=o.settings.current.position+5*o.settings.current.segment})},o.render(m)})}}}angular.module("TADkit").directive("tkComponentTrackBarchart",t),t.$inject=["VERBOSE","$log","d3Service","Settings"]}(),function(){"use strict";function t(t,e,r){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(n,o,i){r.load().then(function(r){t&&e.debug(n);var i,a,s,c,l,u,d,p=n.data,g=n.view.settings.step,f=n.view.viewpoint.chromStart,v=n.view.viewpoint.chromEnd,h=v-f,m=parseInt(n.view.settings.margin),w={top:parseInt(n.view.settings.padding.top),right:parseInt(n.view.settings.padding.right),bottom:parseInt(n.view.settings.padding.bottom),left:parseInt(n.view.settings.padding.left)},y=parseInt(n.view.settings.heightInner),b=.5*y,x=.5*(y-b),C=(n.view.settings.color,o[0].parentNode),$=o[0].children[0].children[3],k=r.select($).append("svg");n.$watch(function(){var t=C.clientWidth,e=C.clientHeight;return t+e},function(){n.render(p)}),n.$watch("settings.current.position",function(t){n.update()},!0);r.behavior.zoom().on("zoom",function(){n.update()});n.render=function(t){if(k.selectAll("*").remove(),t){var e=C.clientWidth-2*m-w.left-w.right,o=y-w.top-w.bottom;i=g*e/h,d=r.scale.linear().range([0,e]).clamp(!0),d.domain([f,v]),c=r.svg.axis().scale(d).orient("top").ticks(0).outerTickSize(0);var p=2;a=k.attr("width",e+w.left+w.right).attr("height",o+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")"),s=a.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",o).style("fill","white"),l=a.append("g").attr("class","focus"),u=l.append("g").attr("class","container").attr("clip-path","url(#clip)");a.append("g").attr("class","labels"),u.selectAll("rect").data(t).enter().append("rect").attr("x",function(t,e){return Math.floor(d(t.start))}).attr("y",x).attr("width",function(t){return Math.ceil(d(t.end)-d(t.start))}).attr("height",b).attr("class",function(t){return 1==t.read?n.title:void 0}).append("svg:title").text(function(t,e){return t.start+":"+t.end+"("+t.read+")"}),a.append("rect").attr("id","highlight").attr("x",function(t){return d(n.settings.current.position-.5*g)}).attr("y",0).attr("width",p).attr("height",y).attr("class","highlight-follow")}},n.update=function(){k.select("#highlight").attr("x",function(t){return d(n.settings.current.position-.5*g)})}})}}}angular.module("TADkit").directive("tkComponentBedgraph",t),t.$inject=["VERBOSE","$log","d3Service"]}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(e,r,n){t.load().then(function(t){var n=e.data,o=32e8;e.settings.current.position||(e.settings.current.position=o/2);var i=e.view.viewpoint.chromStart,a=e.view.viewpoint.chromEnd,s=a-i,c=1e3,l=o/s,u=.05*l;l-=2*u;var d,p,g,f,v,h,m=.5*s,w=.5*o,y=parseInt(e.view.settings.margin),b={top:parseInt(e.view.settings.padding.top),right:parseInt(e.view.settings.padding.right),bottom:parseInt(e.view.settings.padding.bottom),left:parseInt(e.view.settings.padding.left)},x=parseInt(e.view.settings.heightInner),C=10,$=r[0].parentNode,k=r[0].children[0].children[3],S=t.select(k).append("svg");e.$watch(function(){var t=$.clientWidth,e=$.clientHeight;return t+e},function(){e.render(n)}),e.$watch("data",function(t,r){t!==r&&e.render(t)}),e.$watch("settings.current.position",function(t,r){t!==r&&e.update()});t.behavior.zoom().on("zoom",function(){e.update()});e.render=function(r){if(S.selectAll("*").remove(),r){var n=$.clientWidth-2*y-b.left-b.right,o=x-b.top-b.bottom;h=t.scale.linear().range([0,n]).clamp(!0),h.domain([i,a]),g=t.svg.axis().scale(h).orient("top").ticks(0).outerTickSize(0);var s=2;h(w)-h(m);d=S.attr("width",n+b.left+b.right).attr("height",o+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),p=d.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",o).style("fill","white"),f=d.append("g").attr("class","focus"),v=f.append("g").attr("class","container").attr("clip-path","url(#clip)");var l=(f.append("g").attr("class","x axis").attr("transform","translate(0,"+C+")").call(g),d.append("g").attr("class","labels"));l.append("text").attr("x",-18).attr("y",8).style("text-anchor","right").style("font-size","10px").text("<<"),l.append("text").attr("x",-18).attr("y",18).style("text-anchor","right").style("font-size","10px").text(">>");v.selectAll("rect").data(r).enter().append("rect").attr("x",function(t){return Math.floor(h(t.start))}).attr("y",function(t){return e.view.settings.sense&&t.strand<1?C:0}).attr("width",function(t){return Math.ceil(h(t.end)-h(t.start))}).attr("height",function(t){return e.view.settings.sense?C:2*C}).attr("class",function(t){var e=t.biotypeStyle;return e+=t.strand<1?" forward-strand":" reverse-strand"}).append("svg:title").text(function(t){return t.external_name}),d.append("rect").attr("id","highlight").attr("x",function(t){return h(e.settings.current.position-.5*c)}).attr("y",0).attr("width",s).attr("height",x).attr("class","highlight-follow")}},e.update=function(){S.select("g.x.axis").call(g),v.selectAll("rect").attr("x",function(t){return Math.floor(h(t.start))}).attr("y",function(t){return e.view.settings.sense&&t.strand<1?C:0}).attr("width",function(t){return Math.ceil(h(t.end)-h(t.start))}).attr("height",function(t){return e.view.settings.sense?C:2*C}),S.select("#highlight").attr("x",function(t){return h(e.settings.current.position-.5*c)})}})}}}angular.module("TADkit").directive("tkComponentTrackGenes",t),t.$inject=["d3Service"]}(),function(){"use strict";function t(t,e,r,n){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(o,i,a){t&&e.debug(o),r.load().then(function(t){o.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var e,r,a,s,c,l,u,d,p,g,f=o.data.distances,v=o.view.viewpoint.chromStart,h=o.view.viewpoint.chromEnd,m=o.settings.current.particlesCount,w="clip"+o.title,y="url(#"+w+")",b=parseInt(o.view.settings.margin),x={top:parseInt(o.view.settings.padding.top),right:parseInt(o.view.settings.padding.right),bottom:parseInt(o.view.settings.padding.bottom),left:parseInt(o.view.settings.padding.left)},C=parseInt(o.view.settings.heightInner),$=.5*C,k=.5*(C-$),S=o.view.settings.color,j=i[0].parentNode,E=i[0].children[0].children[3],T=t.select(E).append("svg");o.$watch(function(){var t=j.clientWidth,e=j.clientHeight;return t+e},function(){o.render(f)}),o.$watch("data.dimension",function(t,e){t!==e&&(f=o.data.distances,o.render(f))}),o.$watch("settings.current.position",function(t,e){t!==e&&o.update()}),o.render=function(n){if(T.selectAll("*").remove(),n){var i=j.clientWidth-2*b-x.left-x.right,f=C-x.top-x.bottom,E=1*i/m;e=t.scale.linear().range([0,i]).clamp(!0),e.domain([v,h]),r=t.svg.axis().scale(e).orient("top").ticks(0).outerTickSize(0);var A=2;a=t.svg.brush().x(e).extent([0,0]).on("brush",o.brushed),s=T.attr("width",i+x.left+x.right).attr("height",f+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(a),s.select(".background").attr("y",f/2).attr("height",f),c=s.append("defs").append("clipPath").attr("id",w).append("rect").attr("width",i).attr("height",f).style("fill","white"),l=s.append("g").attr("class","focus"),u=l.append("g").attr("class","container").attr("clip-path",y),d=s.append("g").attr("class","labels"),p=u.selectAll("rect").data(n).enter().append("rect").attr("x",function(t,e){return e*E}).attr("y",k).attr("width",E).attr("height",$).style("fill",S).style("fill-opacity",function(t){return t*t}).style("stroke",S).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),g=s.append("rect").attr("id","highlight").attr("x",function(t){return e(o.settings.current.position)}).attr("y",0).attr("width",A).attr("height",C).attr("class","highlight-follow"),g.call(a.extent([o.settings.current.position,0])).call(a.event)}},o.update=function(){T.select("#highlight").attr("x",function(t){return e(o.settings.current.position)})},o.brushed=function(){var r=this;o.safeApply(function(){var i=a.extent()[0];t.event.sourceEvent&&(i=parseInt(e.invert(t.mouse(r)[0])),a.extent([i,i])),g.attr("x",e(i)),o.settings.current.position=i,o.settings.current.particle=n.getParticle(),o.settings.current.segmentLower=o.settings.current.position-5*o.settings.current.segment,o.settings.current.segmentUpper=o.settings.current.position+5*o.settings.current.segment})},o.render(f)})}}}angular.module("TADkit").directive("tkComponentTrackProximities",t),t.$inject=["VERBOSE","$log","d3Service","Settings"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){t.load().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var o,i,a,s,c,l,u,d,p,g,f,v=r.data,h=r.view.viewpoint.chromStart,m=r.view.viewpoint.chromEnd,w=r.settings.current.particlesCount,y="clip"+r.title,b="url(#"+y+")",x=parseInt(r.view.settings.margin),C={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},$=2,k=parseInt(r.view.settings.heightInner),S=r.view.settings.nodeSize,j=C.top+.5*S,E=(r.view.settings.color,r.overlay.palette[0]),T=r.overlay.palette[1],A=n[0].parentNode,D=n[0].children[0].children[3],R=t.select(D).append("svg");r.$watch(function(){var t=A.clientWidth,e=A.clientHeight;return t+e},function(){r.render(r.data)}),r.$watch("data.dimension",function(t,e){t!==e&&(v=r.data,r.render(v))}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.getColor=function(t){for(var e=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=e.length-1;n>=0;n--)t==e[n].code&&(r=e[n].color);return r},r.getOpacity=function(t){var e,r=t/$;return e=r*r},r.getStrokeWidth=function(t){var e=5,r=t/5;return e*=r},r.render=function(e){if(R.selectAll("*").remove(),e){var n=A.clientWidth-2*x-C.left-C.right,v=k-C.top-C.bottom,$=1*n/w;o=t.scale.linear().range([0,n]).clamp(!0),o.domain([h,m]),i=t.svg.axis().scale(o).orient("top").ticks(0).outerTickSize(0),a=t.svg.axis().scale(o).orient("bottom").ticks(0).outerTickSize(0);var D=2;s=t.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),c=R.attr("width",n+C.left+C.right).attr("height",v+C.top+C.bottom).append("g").attr("transform","translate("+C.left+","+C.top+")").call(s),c.select(".background").attr("y",v/2).attr("height",v),l=c.append("defs"),l.append("clipPath").attr("id",y).append("rect").attr("width",n).attr("height",v).style("fill","white"),u=c.append("g").attr("class","focus"),p=u.append("g").attr("class","harmonics").attr("clip-path",b),g=u.append("g").attr("class","lowerbounds").attr("clip-path",b),d=c.append("g").attr("class","labels"),p.append("rect").attr("x",e.dimension*$-$).attr("y",j-.5*S).attr("width",$).attr("height",S).style("fill",E).append("svg:title").text(e.dimension),p.selectAll("line").data(e.harmonics).enter().append("line").attr("x1",function(t){return t[0]*$-.5*$}).attr("y1",j).attr("x2",function(t){return t[1]*$-.5*$}).attr("y2",v-S).attr("marker-end","url(#harmonics-marker)").style("stroke",E).style("opacity",1).style("stroke-width",function(t){return r.getStrokeWidth(t[3])}).append("svg:title").text(function(t){return t[1]+":"+t[3]}),p.selectAll("circle").data(e.harmonics).enter().append("circle").attr("cx",function(t){return t[1]*$-.5*$}).attr("cy",v-S).attr("r",.5*S).style("opacity",function(t){return r.getOpacity(t[3])}).style("fill",E).append("svg:title").text(function(t){return t[0]+" : "+t[1]}),g.append("rect").attr("x",e.dimension*$-$).attr("y",v-1.5*S).attr("width",$).attr("height",S).style("fill",T).append("svg:title").text(e.dimension),g.selectAll("line").data(e.lowerBounds).enter().append("line").attr("x1",function(t){return t[0]*$-.5*$}).attr("y2",j).attr("x2",function(t){return t[1]*$-.5*$}).attr("y1",v-S).attr("marker-end","url(#lowerbounds-marker)").style("stroke",T).style("opacity",function(t){return r.getOpacity(t[3])}).style("stroke-width",function(t){return r.getStrokeWidth(t[3])}).append("svg:title").text(function(t){return t[1]+":"+t[3]}),g.selectAll("circle").data(e.lowerBounds).enter().append("circle").attr("cx",function(t){return t[1]*$-.5*$}).attr("cy",j).attr("r",.5*S).style("opacity",function(t){return r.getOpacity(t[3])}).style("fill",T).append("svg:title").text(function(t){return t[0]+" : "+t[1]}),f=c.append("rect").attr("id","highlight").attr("x",o(r.settings.current.position)).attr("y",0).attr("width",D).attr("height",k).attr("class","highlight-follow")}},r.update=function(t){R.select("#highlight").attr("x",function(t){return o(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var i=s.extent()[0];t.event.sourceEvent&&(i=parseInt(o.invert(t.mouse(n)[0])),s.extent([i,i])),f.attr("x",o(i)),r.settings.current.position=i,r.settings.current.particle=e.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(v)})}}}angular.module("TADkit").directive("tkComponentTrackRestraints",t),t.$inject=["d3Service","Settings"]}(),function(){"use strict";function t(t,e,r,n){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(o,i,a){t&&e.debug(o),r.load().then(function(t){o.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var r=(o.data,o.view.viewpoint.chromStart),a=o.view.viewpoint.chromEnd,s=(o.view.settings.cursorWidth,parseInt(o.view.settings.margin)),c={top:parseInt(o.view.settings.padding.top),right:parseInt(o.view.settings.padding.right),bottom:parseInt(o.view.settings.padding.bottom),left:parseInt(o.view.settings.padding.left)},l=parseInt(o.view.settings.heightInner),u=i[0].parentNode;e.debug(u.clientWidth);var d=i[0].children[0].children[3];e.debug(d.clientWidth);var p,g,f,v,h,m,w,y,b,x,C=t.select(d).append("svg");o.$watch(function(){var t=u.clientWidth,e=u.clientHeight;return t+e},function(){o.render()}),o.$watch("settings.current.position",function(t,e){t!==e&&o.update()}),o.render=function(){C.selectAll("*").remove();var e=u.clientWidth-2*s-c.left-c.right,n=l-c.bottom-c.top;g=t.scale.linear().range([0,e]).clamp(!0),g.domain([r,a]),w=t.svg.axis().scale(g).orient("bottom").ticks(4),f=t.svg.axis().orient("left"),v=t.svg.axis().orient("right"),h=.5*n,m=l,y=t.svg.brush().x(g).extent([0,0]).on("brush",o.brushed),p=C.attr("width",e+c.left+c.right).attr("height",n+c.top+c.bottom).append("g").attr("transform","translate("+c.left+", 0)");var i=p.append("g").attr("class","labels");i.append("text").attr("x",-16).attr("y",26).style("text-anchor","right").style("font-size","10px").text("3'"),i.append("text").attr("x",e+8).attr("y",26).style("text-anchor","left").style("font-size","10px").text("5'");p.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(w).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");p.append("g").attr("class","slider").call(y),p.select(".background").attr("y",n/2).attr("height",n),b=p.append("circle").attr("id","handle").attr("class","handle").attr("cx",g(o.settings.current.position)).attr("cy",n).attr("r",.6*h),x=p.append("text").attr("id","position").attr("x",g(o.settings.current.position)-.5*h).attr("y",n-10).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text(o.settings.current.particle),p.call(y.extent([o.settings.current.position,0])).call(y.event)},o.update=function(t){C.select("#handle").attr("cx",g(o.settings.current.position)),C.select("#position").attr("x",g(o.settings.current.position)-.5*h).text(o.settings.current.particle)},o.brushed=function(){var e=this;o.safeApply(function(){var r=y.extent()[0];t.event.sourceEvent&&(r=parseInt(g.invert(t.mouse(e)[0])),y.extent([r,r])),b.attr("cx",g(r)),o.settings.current.position=r,o.settings.current.particle=n.getParticle(),o.settings.current.segment=n.getSegment(),o.settings.current.segmentLower=o.settings.current.position-5*o.settings.current.segment,o.settings.current.segmentUpper=o.settings.current.position+5*o.settings.current.segment})}})}}}angular.module("TADkit").directive("tkComponentTrackSlider",t),t.$inject=["VERBOSE","$log","d3Service","Settings"]}(),function(){"use strict";function t(t,e,r){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(n,o,i){r.load().then(function(r){t&&e.debug(n);var i,a,s,c,l,u,d,p=n.data,g=n.view.settings.step,f=n.view.viewpoint.chromStart,v=n.view.viewpoint.chromEnd,h=v-f,m=parseInt(n.view.settings.margin),w={top:parseInt(n.view.settings.padding.top),right:parseInt(n.view.settings.padding.right),bottom:parseInt(n.view.settings.padding.bottom),left:parseInt(n.view.settings.padding.left)},y=parseInt(n.view.settings.heightInner),b=.5*y,x=.5*(y-b),C=n.view.settings.color,$=o[0].parentNode,k=o[0].children[0].children[3],S=r.select(k).append("svg");n.$watch(function(){var t=$.clientWidth,e=$.clientHeight;return t+e},function(){n.render(p)}),n.$watch("settings.current.position",function(t){n.update()},!0);r.behavior.zoom().on("zoom",function(){n.update()});n.render=function(t){if(S.selectAll("*").remove(),t){var e=$.clientWidth-2*m-w.left-w.right,o=y-w.top-w.bottom;i=g*e/h,d=r.scale.linear().range([0,e]).clamp(!0),d.domain([f,v]),c=r.svg.axis().scale(d).orient("top").ticks(0).outerTickSize(0);var p=2;a=S.attr("width",e+w.left+w.right).attr("height",o+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")"),s=a.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",o).style("fill","white"),
l=a.append("g").attr("class","focus"),u=l.append("g").attr("class","container").attr("clip-path","url(#clip)");a.append("g").attr("class","labels"),u.selectAll("rect").data(t).enter().append("rect").attr("x",function(t,e){return(e+1)*i}).attr("y",x).attr("width",i).attr("height",b).style("fill",C).style("fill-opacity",function(t){return t}).style("stroke",C).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),a.append("rect").attr("id","highlight").attr("x",function(t){return d(n.settings.current.position-.5*g)}).attr("y",0).attr("width",p).attr("height",y).attr("class","highlight-follow")}},n.update=function(){S.select("#highlight").attr("x",function(t){return d(n.settings.current.position-.5*g)})}})}}}angular.module("TADkit").directive("tkComponentWiggle0",t),t.$inject=["VERBOSE","$log","d3Service"]}(),function(){"use strict";function t(t,e){e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState}}angular.module("TADkit").controller("TrackController",t),t.$inject=["$log","$scope"]}(),function(){"use strict";function t(e,r,n,o,i,a){n.fileTitle="No file loaded",n.$on("$viewContentLoaded",function(){function a(t,r,n){e.debug(t),e.debug("Showing dialog")}var s=angular.element(document.body),c="assets/templates/"+r.current.name+".html";o.show({parent:s,templateUrl:c,controller:t,locals:{overlays:n.$parent.overlays},onComplete:a}).then(function(t){i.show(i.simple().content("Overlays ("+t+") added"))},function(){i.show(i.simple().content("cancelled")),r.go("browser")})}),n.fetchData=function(t){n.fileData=a.fetch(t),n.selectedRows=[];for(var r=n.fileData.length;--r>=0;)n.selectedRows[r]=!0;n.selectedCols=[];for(var o=n.fileData[0].length;--o>=0;)n.selectedCols[o]=!0;e.info("Data fetched - pending selection...")},n.importData=function(t){var i=a["import"](t,n.selectedRows,n.selectedCols);e.info("Importing selected data..."),o.hide(i.length),r.go("browser")},n.hide=function(){o.hide(n.overlaysAcquired)},n.cancel=function(){o.cancel()}}angular.module("TADkit").controller("OverlayImportController",t),t.$inject=["$log","$state","$scope","$mdDialog","$mdToast","Overlays"]}(),function(){"use strict";function t(t,e){return{restrict:"A",scope:{tkOverlayImport:"&",filetitle:"="},link:function(e,r,n){r.on("change",function(r){var n=new FileReader;n.onload=function(r){e.$apply(function(){t.debug("Fetching Import results...."),e.tkOverlayImport({$fileContent:r.target.result})})},n.readAsText((r.srcElement||r.target).files[0]),e.filetitle=(r.srcElement||r.target).files[0].name})}}}angular.module("TADkit").directive("tkOverlayImport",t),t.$inject=["$log","$parse"]}(),function(){"use strict";function t(t,e,r){e.toggleSetting=function(t){e.settings=r.toggle(t)}}angular.module("TADkit").controller("SidebarBrowserController",t),t.$inject=["$log","$scope","Settings"]}(),function(){"use strict";function t(t,e,r,n,o,i,a,s,c){angular.element(e).on("resize",function(){r.$apply()}),r.settings.views.scale=1,o.setViewpoint(r.settings.current.chromStart,r.settings.current.chromEnd,r.settings.views.scale),i.setViewpoint(r.settings.current.chromStart,r.settings.current.chromEnd,r.settings.views.scale),r.allProximities=s.get(),r.currentProximities=s.get(r.settings.current.particle),r.currentRestraints=c.get(r.settings.current.particle),r.components=o.getComponents(),angular.forEach(r.components,function(t,e){var n;"scene"==t.object.type?(t.data=r.current.model.data,t.proximities=r.allProximities,t.overlay=r.current.overlay,t.overlay.state={},t.overlay.object.state.index=a.getCurrentIndex()):"track-genes"==t.object.type||"panel-inspector"==t.object.type?(n=a.getOverlayById("genes"),t.data=n.data,t.overlay=n):"track-proximities"==t.object.type?(t.data=r.currentProximities,n=a.getOverlayById("proximities"),t.overlay=n):"track-restraints"==t.object.type&&(t.data=r.currentRestraints,n=a.getOverlayById("restraints"),t.overlay=n)}),r.$watch("settings.current.particle",function(e,n){e!==n&&(r.currentProximities=s.get(e),r.currentRestraints=c.get(e),"matrix"==r.current.overlay.object.type&&(a.at(e),r.current.overlay=a.getOverlay()),t.debug(r.currentProximities))}),r.overlayOrig=r.current.overlay,r.toggleOverlay=function(e){r.overlaid=a.getOverlay(e).object.state.overlaid,r.overlaid?(a.setOverlaid(r.overlayOrig.object.state.index),a.set(r.overlayOrig.object.state.index),r.current.overlay=a.getOverlay()):(a.setOverlaid(e),a.set(e),r.current.overlay=a.getOverlay(),t.debug(r.current.overlay))},r.optionsState=!1,r.toggleOptions=function(){r.optionsState=!r.optionsState},r.toggle=function(e){e=!e,t.debug(e)},r.testfn=function(){t.debug("test worked")}}angular.module("TADkit").controller("StoryboardController",t),t.$inject=["$log","$window","$scope","Settings","Storyboards","Components","Overlays","Proximities","Restraints"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("HomeController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("ProjectContentController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,r,n,o,i,a){t.debug(r),r.clusterComponent=i.getComponentById("dataset-clusters");var s=o.getOverlayById("gradient"),c=r.current.model.data.length/r.current.dataset.object.components,l=a.gradientHCL(s,c);r.clusterComponent.overlay=l;for(var u=new THREE.BufferGeometry,d=r.current.dataset.models.length-1;d>=0;d--)u.addAttribute("position",new THREE.BufferAttribute(r.current.dataset.models[d].data,3));u.computeBoundingSphere(),t.debug(u.boundingSphere.center),t.debug(u.boundingSphere.radius),r.clusterComponent.view.viewpoint.camera=u.boundingSphere.center,r.clusterComponent.view.viewpoint.target=u.boundingSphere.center,r.clusterComponent.view.viewpoint.translate=u.boundingSphere.radius*u.boundingSphere.scale,r.clusters=n.getGroupedClusters(),t.debug(r.clusters)}angular.module("TADkit").controller("ProjectDatasetController",t),t.$inject=["$log","$state","$scope","Datasets","Overlays","Components","Segments"]}(),function(){"use strict";function t(t,e,r){return{restrict:"A",link:function(e,n,o){var i=o.dropzone,a=r(i),s=function(t){t.preventDefault(),n.addClass("dragOver")},c=function(t){t.preventDefault(),n.removeClass("dragOver")},l=function(r){var n=new FileReader;n.onload=function(t){e.$apply(function(){a(e,{$fileContent:t.target.result}),e.addDataset(t.target.result)})},n.readAsText(r),t.info("File loaded...")};n.bind("dragover",s).bind("dragleave",c).bind("drop",function(t){c(t),l(t.dataTransfer.files[0])}),e.$watch(i,function(){n.attr("src",a(e))})}}}angular.module("TADkit").directive("tkProjectDropzone",t),t.$inject=["$log","$state","$parse"]}(),function(){"use strict";function t(t,e,r,n,o,i,a,s){o.updateCurrent=function(){o.current.dataset=i.getDataset(),o.current.model=i.getModel(),o.current.overlay=a.getOverlay(),t.info("Current dataset, model, overlay and storyboard updated.")},o.loadDatasetFromParam=function(){var a=i.load(n.loadDataset);return e.all([a]).then(function(e){o.updateCurrent(),t.info("Dataset loaded: "+n.loadDataset),r.go("browser")})},n.loadDataset&&o.loadDatasetFromParam(),o.addDataset=function(n){var a=i.add(n);return e.all([a]).then(function(e){o.updateCurrent(),t.info("Dataset added."),r.go("dataset")})}}angular.module("TADkit").controller("ProjectLoaderController",t),t.$inject=["$log","$q","$state","$stateParams","$scope","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function t(t,e,r){return{restrict:"A",scope:!1,link:function(e,n,o){var i=r(o.tkProjectLoader);n.on("change",function(r){var n=new FileReader;n.onload=function(r){t.info("Data loaded OK!"),e.$apply(function(){i(e,{$fileContent:r.target.result})})},n.readAsText((r.srcElement||r.target).files[0])})}}}angular.module("TADkit").directive("tkProjectLoader",t),t.$inject=["$log","$state","$parse"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("ProjectOverlayController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("ProjectStoryboardController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,r,n){t.setCurrentDataset=function(t){e.set(t)},t.setCurrentOverlay=function(t){r.set(t)},t.setCurrentStoryboard=function(t){n.set(t)}}angular.module("TADkit").controller("SidebarProjectController",t),t.$inject=["$scope","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function t(t,e,r,n,o,i,a,s,c){r.settings||(r.settings=n.get()),r.settings.app.isProject=t.is("project"),r.$on("$stateChangeSuccess",function(){r.settings.app.isProject=t.is("project")}),r.current={},r.current.dataset=a.getDataset(),r.current.model=a.getModel(),r.current.overlay=s.getOverlay()}angular.module("TADkit").controller("MainController",t),t.$inject=["$state","$stateParams","$scope","Settings","Users","Projects","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("SidebarUserController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,r){e.$state=t,e.toggleLeft=function(){r("left").toggle()},e.toggleRight=function(){r("right").toggle()}}angular.module("TADkit").controller("TopbarController",t),t.$inject=["$state","$scope","$mdSidenav"]}();