!function(){"use strict";angular.module("TADkit",["ui.router","ngMaterial","uuid4","d3","angularAwesomeSlider","angularResizable","ui.grid","ui.grid.resizeColumns"])}(),function(){"use strict";function t(t,e){var r=e.extendPalette("cyan",{500:"#006080"});e.definePalette("VreMap",r),e.theme("default").primaryPalette("VreMap").accentPalette("blue").warnPalette("red").backgroundPalette("grey"),e.theme("darkKit").dark()}angular.module("TADkit").config(t)}(),function(){"use strict";function t(t){t.$on("$stateChangeError",function(t,e,r,n,a,o){console.log("Resolve Error: ",o)})}angular.module("TADkit").run(t)}(),function(){"use strict";function t(t,e){e.otherwise("/project/loader"),t.state("main",{controller:"MainController","abstract":!0,url:"",templateUrl:"assets/templates/main.html",resolve:{initialData:function(t){return t()}}}).state("project",{parent:"main",url:"/project?conf",views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"sidebar-left@main":{templateUrl:"assets/templates/sidebar.project.html",controller:"SidebarProjectController"},"content@main":{templateUrl:"assets/templates/project-content.html",controller:"ProjectContentController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}},resolve:{loadfromparam:["$q","$http","$stateParams","Users","Datasets",function(t,e,r,n,a){if(r.conf){var o=t.defer();return e.get(r.conf).success(function(e){{var i;r.conf}"undefined"!=typeof e.dataset?(e.tracks&&n.setTracks(e.tracks),i=e.dataset):"undefined"!=typeof e.models&&(i=e);var s=a.load(i);return t.all([s]).then(function(){console.log("Dataset loaded: "+e.dataset),o.resolve(e.dataset)})}),o.promise}}]}}).state("loader",{parent:"project",url:"/loader",views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"content@main":{templateUrl:"assets/templates/project-loader.html",controller:"ProjectLoaderController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("dataset",{parent:"project",url:"/dataset",views:{"content@main":{templateUrl:"assets/templates/project-dataset.html",controller:"ProjectDatasetController"}}}).state("overlay",{parent:"project",url:"/overlay",views:{"content@main":{templateUrl:"assets/templates/project-overlay.html",controller:"ProjectOverlayController"}}}).state("storyboard",{parent:"project",url:"/storyboard",views:{"content@main":{templateUrl:"assets/templates/project-storyboard.html",controller:"ProjectStoryboardController"}}}).state("browser",{parent:"project",url:"/browser",views:{"sidebar-left@main":{templateUrl:"assets/templates/sidebar.browser.html",controller:"SidebarBrowserController"},"content@main":{templateUrl:"assets/templates/storyboard.html",controller:"StoryboardController"}}}).state("overlay-import",{parent:"browser",url:"/overlay/import",views:{"modal@main":{templateUrl:"assets/templates/overlay-import.html",controller:"OverlayImportController"}}}).state("data-import",{parent:"browser",url:"/data/import",views:{"modal@main":{templateUrl:"assets/templates/data-import.html",controller:"DataImportController"}}}).state("data-mining",{parent:"browser",url:"/data/mining/:func",views:{"modal@main":{templateUrl:"assets/templates/data-mining.html",controller:"DataMiningController"}}}).state("404",{url:"/404",templateUrl:"assets/templates/404.tpl.html",controller:"AppController"})}angular.module("TADkit").config(t)}(),function(){"use strict";function t(t){return{restrict:"EA",link:function(e,r){var n="<data-tk-component-"+e.component.object.type+' id="{{component.object.id}}-'+e.$index+'" type="component.object.type" title="{{component.object.title}}" state="component.object.state" settings="settings" view="component.view" currentparticle="currentParticle"currentposition="currentPosition"currentmodel="current.model" currentoverlay="current.overlay" data="component.data" proximities="component.proximities" overlay="component.overlay"toggleoverlay="toggleOverlay(index)" style="margin: {{component.object.state.margin}}; background-color: {{component.view.settings.background}}" class="component '+e.component.object.type+'"></data-tk-component-'+e.component.object.type+">";r.replaceWith(t(n)(e))}}}angular.module("TADkit").directive("tkComponent",t)}(),function(){"use strict";function t(t,e,r,n){if(t.slideoptions={},t.slidevalue="10;0.001",!angular.isUndefined(t.data)){var a=r.getComponentById("Chromatin"),o=0,i=0;"undefined"!=typeof a&&(t.settings.views.scene_width=o=parseInt(a.object.state.width),t.settings.views.scene_height=i=parseInt(a.object.state.height)),t.width=t.state.width=e.innerWidth-o-50-2*parseInt(t.state.margin),t.canvas_width=2*t.width,t.height=t.state.height=parseInt(t.state.height)-2*parseInt(t.state.margin),t.canvas_height=t.canvas_width;var s=angular.element(e);if(t.$watch(function(){return e.innerWidth},function(e){t.width=t.state.width=e-o-50-2*parseInt(t.state.margin),t.canvas_width=2*t.width},!0),t.$watch("settings.views.scene_width",function(r,n){r!==n&&(t.width=t.state.width=e.innerWidth-r-50-2*parseInt(t.state.margin),t.canvas_width=2*t.width,t.state.offsetx=parseInt(t.state.offsetx)-(n-r),t.update_width())}),t.$watch("settings.views.scene_height",function(e,r){e!==r&&(t.height=t.state.height=parseInt(e)-2*parseInt(t.state.margin)+1,t.update_height())}),0===t.data.n){var c=n.loadHic();c&&c.then(function(e){return 0===e.n?(t.no_hic_data=!0,t.slidevalue="10;0.001",t.slideoptions={},void 0):(t.no_hic_data=!1,t.update_data(e),void 0)})}s.bind("resize",function(){t.$apply()}),t.slidevalue="10;0.001",t.slideoptions={vertical:!0,from:10,to:.001,step:.01,round:2,skin:"blue",css:{before:{"background-color":"red"},after:{"background-color":"red"}},modelLabels:function(e){if(10==e)return"";if(.001>=e)return"ln("+Math.round(100*t.data.max)/100+")";var r=Math.log(1e4)/(t.data.max-.001),n=10/Math.exp(r*t.data.max),a=t.data.max-Math.log(e/n)/r;return"ln("+Math.round(100*a)/100+")"},callback:function(e,r){r&&(t.settings.slidevalue=t.slidevalue,t.$apply())}}}}angular.module("TADkit").controller("PanelHicdataController",t)}(),function(){"use strict";function t(t,e,r,n,a,o){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"=",currentoverlay:"="},templateUrl:"assets/templates/panel-hicdata.html",link:function(r){function n(){this.reset()}if(!angular.isUndefined(r.data)){r.rendered=!1,r.imageObject=new Image,r.show_tads=0!==r.data.tads.length;var a,i,s,c,l,g,d,u=.8,h={},p=!1,m=!1,f=(r.slidevalue,[]);r.highlighted_tad=-1;var v;n.prototype.reset=function(){this.m=[1,0,0,1,0,0]},n.prototype.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],r=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],a=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],i=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=r,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=i},n.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,r=-this.m[1]*t,n=-this.m[2]*t,a=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),i=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=r,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=i},n.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=this.m[0]*e+this.m[2]*r,a=this.m[1]*e+this.m[3]*r,o=this.m[0]*-r+this.m[2]*e,i=this.m[1]*-r+this.m[3]*e;this.m[0]=n,this.m[1]=a,this.m[2]=o,this.m[3]=i},n.prototype.translate=function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},n.prototype.scale=function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},n.prototype.transformPoint=function(t,e){var r=t,n=e;return t=r*this.m[0]+n*this.m[2]+this.m[4],e=r*this.m[1]+n*this.m[3]+this.m[5],[t,e]};var b=new n,y=new n;r.render=function(e,n){if(0!==r.data.n&&(v=angular.element(document.querySelector("#hic_canvas"))[0],v.getContext)){console.log("Drawing hic matrix");var u=v.getContext("2d");u.imageSmoothingEnabled=!1,u.mozImageSmoothingEnabled=!1,u.imageSmoothingEnabled=!1,u.clearRect(0,0,v.width,v.height);var b,w,k=0,x=0,E=0;0!==r.data.max&&(E=Math.log(r.data.max)),0!==r.data.min&&(x=Math.log(r.data.min));for(var C=parseInt(r.state.width),T=parseInt(r.state.height),S=0;S<r.data.value.length&&(w=Math.floor(r.data.pos[S]%r.data.n),k=Math.floor(r.data.pos[S]/r.data.n),!(w>=parseInt(v.width)&&k>=parseInt(v.height)));S++)w<parseInt(v.width)&&k<parseInt(v.height)&&(b=0!==r.data.value[S]?r.data.value[S]<=e&&r.data.value[S]>=n?Math.floor((Math.log(r.data.value[S])-x)/(E-x)*255):0:0,u.fillStyle="rgba(255,0,0,"+b/255+")",u.fillRect(w,k,1,1));if(r.imageObject.src=v.toDataURL(),r.rendered)return;t.d3().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)},a=t.svg.brush();var e=angular.element(document.querySelector("#hic_data_container"));i||(i=t.select(e[0]).append("svg")),i.selectAll("*").remove(),s=i.attr("width",C-2*parseInt(r.state.margin)).attr("height",T-2*parseInt(r.state.margin)).style("position","absolute").style("top",2*parseInt(r.state.margin)+"px").style("left",2*parseInt(r.state.margin)+"px").append("g").attr("id","tads_svg"),c=s.append("circle").attr("id","circ_mark").style("fill","#fff").style("stroke","#ccc").style("stroke-widt",2).attr("cx",(r.settings.current.particle-.5)*Math.sqrt(2)*r.scale+r.translatePos.x*Math.sqrt(2)).attr("cy",T-2*parseInt(r.state.margin)).attr("r",4),l=s.append("text").attr("id","circ_position").attr("x",(r.settings.current.particle-.5)*Math.sqrt(2)*r.scale+r.translatePos.x*Math.sqrt(2)-2).attr("y",T-2*parseInt(r.state.margin)-5).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text(r.settings.current.particle);var n,u,v,b,w=0,k=0;f=[];var x=0,E=99;for(S=0;S<r.data.tads.length;S++)r.data.tads[S][3]>x&&(x=r.data.tads[S][3]),r.data.tads[S][3]<E&&(E=r.data.tads[S][3]);for(S=0;S<r.data.tads.length;S++)w=(r.data.tads[S][3]-E)/(x-E)+.1,n=r.settings.current.segmentLength*r.settings.current.particleSegments,u=Math.round((r.data.tads[S][1]-r.settings.current.chromStart[r.settings.current.chromIdx])/n),k=Math.round((r.data.tads[S][2]-r.settings.current.chromStart[r.settings.current.chromIdx])/n),b=Math.round(u*Math.sqrt(2)*r.scale+r.translatePos.x*Math.sqrt(2)),v=s.append("rect").attr("id",r.data.tads[S][0]).attr("start",r.data.tads[S][1]).attr("end",r.data.tads[S][2]).attr("score",r.data.tads[S][3]).style("fill","white").style("fill-opacity",0).style("stroke","black").style("stroke-width",w).style("stroke-dasharray","3,3").attr("class","polygon_tad").attr("width",k-u+1).attr("height",k-u+1).attr("display","block").attr("x",0).attr("y",0).attr("transform","translate("+b+","+(T-2*parseInt(r.state.margin))+") scale("+r.scale+") rotate(-45 0 0)"),v.append("svg:title").text("Start:"+r.data.tads[S][1]+",End:"+r.data.tads[S][2]+",Score:"+r.data.tads[S][3]),f.push(v);g=s.append("rect").attr("id","contact_marker").style("fill","transparent").style("stroke","red").style("stroke-width",1).attr("width",1).attr("height",1).attr("display","block").attr("x",0).attr("y",0),d=s.append("text").attr("id","contact_marker_value").attr("x",0).attr("y",0).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text("0"),i.on("mousedown",function(){p=!0,h.x=t.event.clientX-r.translatePos.x}),i.on("mouseup",function(){if(!m){var e=[-1,-1],n=t.mouse(this),a=y.transformPoint(n[0],n[1]);if(a[0]<0||a[1]<0||a[0]>r.data.n||a[0]>r.data.n)g.attr("display","none"),d.attr("display","none"),r.settings.current.markers_position=e,r.$apply(r.settings.current.markers_position);else{g.attr("x",n[0]).attr("y",n[1]).attr("width",r.data.n*r.scale).attr("height",r.data.n*r.scale).attr("transform","rotate(45 "+n[0]+" "+n[1]+")").attr("display","block");var i=Math.floor(a[0])+Math.floor(a[1])*r.data.n,s=r.data.pos.indexOf(i),c=0;if(s>=0&&(c=r.data.value[s]),o.setInteractionFreq(c),d.attr("x",n[0]).attr("y",n[1]-10).text(c).attr("display","block"),r.settings.current.chromosomeIndexes.length<=2){var l,u,h=r.settings.current.segmentLength*r.settings.current.particleSegments;r.settings.current.markers_chr=[r.settings.current.chromosomeIndexes[0],r.settings.current.chromosomeIndexes[0]];for(var f=0,v=0;f<a[0];)l=(a[0]-f)*h+r.settings.current.chromStart[v],f+=Math.round(r.settings.current.chromEnd[v]/h)-Math.round(r.settings.current.chromStart[v]/h),v++;for(r.settings.current.markers_chr[0]=r.settings.current.chromosomeIndexes[v-1],f=0,v=0;f<a[1];)u=(a[1]-f)*h+r.settings.current.chromStart[v],f+=Math.round(r.settings.current.chromEnd[v]/h)-Math.round(r.settings.current.chromStart[v]/h),v++;r.settings.current.markers_chr[1]=r.settings.current.chromosomeIndexes[v-1],e=[l,u],r.settings.current.markers_position=e,r.$apply(r.settings.current.markers_position)}}}m=!1,p=!1}),i.on("mouseover",function(){p=!1}),i.on("mouseout",function(){p=!1}),i.on("mousemove",function(){if(p){r.translatePos.x=t.event.clientX-h.x,m=!0;var e=parseFloat(c.attr("cx")),n=(e-parseInt(r.state.offsetx)-r.translatePos.x)/(r.scale*Math.sqrt(2)),a=r.settings.current.segmentLength*r.settings.current.particleSegments,o=r.settings.current.hic_position+(n-r.settings.current.particle)*a;o>=r.settings.current.chromStart[r.settings.current.chromIdx]&&o<=r.settings.current.chromEnd[r.settings.current.chromIdx]&&(r.settings.current.hic_position=o,r.$apply(r.settings.current.hic_position))}})}),r.rendered=!0,r.imageObject.onload=function(){r.update(),r.update_marks()}}},r.$watch("state.width",function(t,e){t!==e&&(r.rendered=!1,r.render(r.data.max,r.data.min))}),r.$watch("settings.current.leftborder",function(t,e){if(t!==e&&r.data.n>0){var n=hic_data_container.getBoundingClientRect();r.translatePos.x=r.settings.current.leftborder-n.left;{r.settings.current.segmentLength*r.settings.current.particleSegments}r.scale=(r.settings.current.rightborder-r.settings.current.leftborder)/(Math.sqrt(2)*r.data.n),r.settings.current.hic_position=r.settings.current.position,r.update(),r.update_marks()}}),r.$watch("settings.slidevalue",function(t,e){if(t!==e&&!angular.isUndefined(t)){var n=t.split(";"),a=parseFloat(n[0]),o=parseFloat(n[1]),i=Math.log(1e4)/(r.data.max-.001),s=10/Math.exp(i*r.data.max);0!==a&&(a=Math.log(a/s)/i),0!==o&&(o=Math.log(o/s)/i),r.render(r.data.max-o,r.data.max-a)}}),r.$watch("settings.current.chromosomeIndexes",function(t,e){t===e||angular.isUndefined(t)||(r.data=o.get(),r.update_data(r.data))}),r.update=function(){r.rendered||r.render(r.data.max,r.data.min);var t=document.getElementById("hic_canvas"),e=parseInt(r.state.height);if(t.getContext){var n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),n.save(),b.reset(),b.translate(r.translatePos.x+parseInt(r.state.offsetx),e),b.rotate(-Math.PI/4),b.scale(r.scale,r.scale),y.m=b.m.slice(),y.invert();var a=b.m;n.setTransform(a[0],a[1],a[2],a[3],a[4],a[5]),n.drawImage(r.imageObject,0,0),n.restore()}},r.update_marks=function(){var t=(r.settings.current.particle-1+.5)*Math.sqrt(2)*r.scale+r.translatePos.x+parseInt(r.state.offsetx);c.attr("cx",t),l.attr("x",t).text(r.settings.current.particle),g.attr("display","none"),d.attr("display","none");var e,n,a,o=(parseInt(r.state.width),parseInt(r.state.height));if(r.show_tads)for(var i=0;i<f.length;i++)e=r.settings.current.segmentLength*r.settings.current.particleSegments,n=Math.round((r.data.tads[i][1]-r.settings.current.chromStart[r.settings.current.chromIdx])/e),a=Math.round(n*Math.sqrt(2)*r.scale+r.translatePos.x+parseInt(r.state.offsetx)),f[i].attr("transform","translate("+a+","+(o-2*parseInt(r.state.margin))+") scale("+r.scale+") rotate(-45 0 0)"),i!=r.highlighted_tad&&f[i].style("fill-opacity",.5),r.settings.current.position>=parseInt(f[i].attr("start"))&&r.settings.current.position<=parseInt(f[i].attr("end"))&&(r.highlighted_tad=i)},r.update_width=function(){r.settings.current.hic_position+=1},r.update_height=function(){r.rendered=!1,r.update(),r.update_marks()},r.$watch("highlighted_tad",function(t,e){if(t!==e){if(-1==t)return f[e].style("fill-opacity",.5),!0;f[t].style("fill-opacity",0);var n,a;e>-1&&(f[e].style("fill-opacity",.5),n=Math.round((parseInt(f[e].attr("start"))-r.settings.current.chromStart[r.settings.current.chromIdx])/r.settings.current.segmentLength),a=Math.ceil((parseInt(f[e].attr("end"))-r.settings.current.chromStart[r.settings.current.chromIdx])/r.settings.current.segmentLength)),n=Math.round((parseInt(f[t].attr("start"))-r.settings.current.chromStart[r.settings.current.chromIdx])/r.settings.current.segmentLength),a=Math.ceil((parseInt(f[t].attr("end"))-r.settings.current.chromStart[r.settings.current.chromIdx])/r.settings.current.segmentLength),r.settings.current.tad_selected=t}}),r.translatePos={x:0,y:0},r.scale=1,r.increasezoom=function(){r.scale/=u,r.update(),r.update_marks()},r.reducezoom=function(){r.scale*=u,r.update(),r.update_marks()},r.toggle=function(t){r.show_tads=t;for(var e=0;e<f.length;e++)r.show_tads?f[e].attr("display","block"):(f[e].attr("display","none"),r.highlighted_tad=-1,r.settings.current.tad_selected=-1);r.update_marks()},r.update_data=function(t){r.data=t;r.settings.current.segmentLength*r.settings.current.particleSegments;if(r.scale=(r.settings.current.rightborder-r.settings.current.leftborder)/(Math.sqrt(2)*r.data.n),"undefined"!=typeof r.settings.current.leftborder){var e=hic_data_container.getBoundingClientRect();r.translatePos.x=r.settings.current.leftborder-e.left}r.rendered=!1,r.render(t.max,t.min),r.update(),r.update_marks()},e(function(){r.update()})}}}}angular.module("TADkit").directive("tkComponentPanelHicdata",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i,s,c,l,g){function d(t,e){t.closeDialog=function(){e.hide()}}if(t.showInfo=function(t){n.show({parent:angular.element(document.body),template:'<md-dialog md-theme="default" aria-label="Information">  <md-dialog-content class="md-default-theme">'+t+'<div class="md-actions"><md-button ng-click="closeDialog();" class="md-primary md-button md-default-theme"><span class="ng-binding ng-scope">Close</span></md-button></div>  </md-dialog-content></md-dialog>',locals:{},controller:d})},(angular.isUndefined(t.settings.current.speciesUrl)||angular.isUndefined(t.view.settings.species_data[t.settings.current.speciesUrl]))&&(t.settings.current.speciesUrl=l.setSpeciesUrl(),angular.isUndefined(t.settings.current.speciesUrl)||angular.isUndefined(t.view.settings.species_data[t.settings.current.speciesUrl]))){var u='<div class="component-caption" layout="column" layout-align="left center">No species specified in the dataset</div>';return r(function(){t.showInfo(u)}),void 0}var h=o.getComponentById("Chromatin"),p=0;if("undefined"!=typeof h)p=parseInt(h.object.state.width);else{var m=o.getComponentById("Inspector"),f=0;"undefined"!=typeof m&&(f=parseInt(m.object.state.width)),p=f}t.width=t.state.width=e.innerWidth-p-50-2*parseInt(t.state.margin),t.height=t.state.height=parseInt(t.state.height)-2*parseInt(t.state.margin),t.$watch("settings.views.scene_width",function(r,n){r!==n&&(t.width=t.state.width=e.innerWidth-r-50-2*parseInt(t.state.margin),t.myIgv.repaint())});angular.element(e);t.$watch(function(){return e.innerWidth},function(e){t.width=t.state.width=e-p-50-2*parseInt(t.state.margin)},!0);var v=a.getCurrentIndex(),b=s.get(),y=t.settings.current.segmentLength*t.settings.current.particleSegments,w=t.settings.current.chromStart[t.settings.current.chromIdx]-1*y;0>w&&(w=0);var k=t.settings.current.chrom;t.view.settings.leading_chr||(k=t.settings.current.chrom.replace("chr","")),("undefined"==typeof t.settings.current.assemblyUrl||"undefined"==typeof t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl])&&(t.settings.current.assemblyUrl=Object.keys(t.view.settings.species_data[t.settings.current.speciesUrl])[0]);var x;t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].fastaURL?(x={id:t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].id,fastaURL:t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].fastaURL,cytobandURL:null},t.view.settings.showNav=!0,t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].cytobandURL?(x.cytobandURL=t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].cytobandURL,t.view.settings.showCyto=!1):t.view.settings.showCyto=!1):(x={id:t.settings.current.speciesUrl},t.view.settings.showNav=!0),t.tracks=g.getTracks(),t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].tracks&&(t.tracks=t.tracks.concat(t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].tracks)),t.igvDiv=angular.element(document.querySelector("#igvDiv"))[0],t.igvOptions={showNavigation:t.view.settings.showNav,showRuler:!0,showIdeogram:t.view.settings.showCyto,showKaryo:t.view.settings.showCyto,flanking:1e5,reference:x,locus:k+":"+w+"-"+t.settings.current.chromEnd[t.settings.current.chromIdx],tracks:t.tracks.slice()},t.updatePosition=function(e,n,a){for(var o=0,i=(t.settings.current.segmentLength*t.settings.current.particleSegments,0);i<t.settings.current.chromosomeIndexes.length;i++)o+=t.settings.current.chromEnd[i]-t.settings.current.chromStart[i];o+=t.settings.current.chromStart[0],e>=t.settings.current.chromStart[t.settings.current.chromIdx]&&o>=e&&(t.settings.current.position=e),e<t.settings.current.chromStart[t.settings.current.chromIdx]&&(t.settings.current.position=t.settings.current.chromStart[t.settings.current.chromIdx]),e>o&&(t.settings.current.position=o),(t.settings.current.leftborder!=n||t.settings.current.rightborder!=a)&&(t.settings.current.leftborder=n,t.settings.current.rightborder=a),t.hideTadkitMarkers(),t.updateTadkitTAD(),r(function(){t.$apply()})},t.applyOverlay=function(e,r){for(var n=a.get(),o=0;o<n.loaded.length;o++)if(n.loaded[o].object.title===e)return t.toggleOverlay(n.loaded[o].object.state.index),!0;var s,c,l,g,d={metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:i.generate(),id:n.loaded.length,title:e,source:"igvJs track",url:"local",description:"igvJs track overlay",type:"igvJs",format:"variable",components:2,name:e,state:{index:0,overlaid:!1}},palette:[],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}},u=0,h=0;for(c=0;c<t.settings.current.segmentsCount;c++)d.colors.chromatin[c]="gray";var p,m,f,v=[],b=!1,y=[];if(angular.forEach(r,function(t){"undefined"==typeof t.color?("undefined"!=typeof t.score&&v.push(t.score),"undefined"!=typeof t.value&&v.push(t.value),b=!0):v.push(t.color)}),b){var w="#0000ff",k="#ffffff",x=0,E=0;for(h=0;E<v.length;){for(s=0,p=0,f=0,x=r[E].start;1>s&&E<v.length;)m=r[E],s=(m.end-x)/t.settings.current.segmentLength,p+=parseFloat(v[E]),f++,E++;y.push(p)}for(l=Math.max.apply(Math,y),g=Math.min.apply(Math,y),E=0,h=0;E<v.length;){for(s=0,p=0,x=r[E].start;1>s&&E<v.length;)m=r[E],s=(m.end-x)/t.settings.current.segmentLength,p+=parseFloat(v[E]),E++;for(v[h]=d3.interpolateHcl(k,w)((p-g)/(l-g)),u=Math.round((x-t.settings.current.chromStart[t.settings.current.chromIdx])/t.settings.current.segmentLength),c=u;c<u+Math.round(s)&&c<t.settings.current.segmentsCount;c++)d.colors.chromatin[c]=v[h];h++}}else angular.forEach(r,function(e){for(u=Math.round((e.start-t.settings.current.chromStart[t.settings.current.chromIdx])/t.settings.current.segmentLength),s=Math.round((e.end-e.start)/t.settings.current.segmentLength),c=u;u+s>c&&c<t.settings.current.segmentsCount;c++)d.colors.chromatin[c]=v[h];h++});var C=a.addDirect(d),T=n.loaded[C];T.colors.particles=[],T.colors.network.RGB=[],T.colors.network.alpha=[],t.toggleOverlay(C)},t.toggleOverlay=function(e){t.overlaid=a.getOverlay(e).object.state.overlaid,t.overlaid?(a.setOverlaid(v),a.set(v),t.currentoverlay=a.getOverlay()):(a.setOverlaid(e),a.set(e),t.currentoverlay=a.getOverlay()),t.toggleColor(t.currentoverlay)},t.removeOverlay=function(e){var r=a.get();angular.forEach(r.loaded,function(r){r.object.title===e&&t.toggleOverlay(r.object.state.index)})},t.myIgv=igv.createBrowser(t.igvDiv,t.igvOptions);var E=angular.element(document.querySelector(".igv-search-container"))[0];$(E).hide(),t.myIgv.centerGuide.$centerGuideToggle.click();var C=angular.element('<div id="tad-highlight-tadkit" style="width=\'0px;\';display=none;"></div>'),T=angular.element(t.myIgv.trackContainerDiv);T.append(C);var S=angular.element('<div id="trackbar-tadkit-left-mark" style="display=none"></div>');T.append(S);var I=angular.element('<div id="trackbar-tadkit-right-mark" style="display=none"></div>');T.append(I),t.updateTadkitTAD=function(){if("undefined"!=typeof t.settings.current.tad_selected&&-1!=t.settings.current.tad_selected){var e=_.first(t.myIgv.genomicStateList),r=e.referenceFrame;if("undefined"!=typeof r){var n=t.data.tad_data.tads[t.settings.current.tad_selected][1],a=t.data.tad_data.tads[t.settings.current.tad_selected][2],o=Math.round((n-r.start)/r.bpPerPixel);C.css("left",Math.floor(o+50)+"px");var i=Math.round((a-r.start)/r.bpPerPixel);C.css("width",Math.floor(i-o)+"px"),C.css("display","block")}}else C.css("width","0px"),C.css("display","none")},t.myIgv.zoomHandlers={"in":{click:function(){t.myIgv.zoomIn()}},out:{click:function(){t.myIgv.zoomOut()}}},t.synchronizeViewports=function(){var e,r,n,a,o,i,s;i=t.settings.current.segmentLength*t.settings.current.particleSegments,r=t.myIgv.genomicStateList[0],a=igv.browser.viewportContainerWidth()/r.locusCount,n=r.referenceFrame.bpPerPixel*a+r.referenceFrame.start,n-=t.settings.current.chromEnd[0]-t.settings.current.chromStart[0],e=t.myIgv.genomicStateList[1],o=e.referenceFrame,o.bpPerPixel=r.referenceFrame.bpPerPixel,s=t.settings.current.chromStart[1]-1*i+n,s=Math.max(0,s),o.start=s;for(var c=0;c<t.myIgv.trackViews.length;c++)t.myIgv.trackViews[c].update()},t.$watch("settings.current.hic_position",function(e,r){angular.equals(e,r)||e==t.settings.current.position||t.myIgv.goto(t.settings.current.chrom,e)}),t.$watch("settings.current.chromosomeIndexes",function(e,r){if(e!==r){var n=[],a=t.settings.current.segmentLength*t.settings.current.particleSegments,o=t.settings.current.particlesCount*a;n.push(t.settings.current.chromosomeIndexes[0]),t.view.settings.leading_chr||(n[0]=n[0].replace("chr","")),2!=t.settings.current.chromosomeIndexes.length?n[0]+=":"+t.settings.current.chromStart[0]+"-"+(t.settings.current.chromStart[0]+o):(o=t.settings.current.chromEnd[0]-t.settings.current.chromStart[0],n[0]+=":"+t.settings.current.chromStart[0]+"-"+(t.settings.current.chromStart[0]+o),n.push(t.settings.current.chromosomeIndexes[1]),t.view.settings.leading_chr||(n[1]=n[1].replace("chr","")),n[1]+=":"+t.settings.current.chromStart[1]+"-"+(t.settings.current.chromStart[1]+o)),t.myIgv.parseSearchInput(n.join(" "));var i,c,l=[],g=[];for(i=document.getElementsByClassName("igv-viewport-content-ruler-div"),c=0;c<i.length;c++)l.push(i[c].innerHTML),g.push(angular.element(i[c]).parent()),i[c].style.display="none";for(c=0;c<l.length;c++){angular.element(i[c]).remove();var d=angular.element("<div class='igv-viewport-content-ruler-div'>"+l[c]+"</div>");angular.element(g[c]).append(d)}for(i=document.getElementsByClassName("igv-viewport-fa-close"),c=0;c<i.length;c++)i[c].style.display="none";s.clear(),t.updateFeaturesList()}}),t.$watch("settings.current.markers_position",function(e,r){e!==r&&(angular.isUndefined(t.settings.current.markers_position)||-1===e[0]||-1===e[1]?t.hideTadkitMarkers():(2===t.settings.current.chromosomeIndexes.length&&t.synchronizeViewports(),t.updateTadkitMarkers(e,t.settings.current.markers_chr)))}),t.$watch("myIgv.trackViews.length",function(e,r){e!==r&&t.updateFeaturesList()}),t.hideTadkitMarkers=function(){I.css("display","none"),S.css("display","none"),t.settings.current.markers_position=void 0},t.updateTadkitMarkers=function(e,r){t.updateFeaturesList();var n=_.first(t.myIgv.genomicStateList),a=n.referenceFrame,o=igv.browser.viewportContainerWidth()/n.locusCount,i=(t.settings.current.segmentLength*t.settings.current.particleSegments,0);2==t.settings.current.chromosomeIndexes.length&&r[1]!=t.settings.current.chromosomeIndexes[0]&&(i=a.bpPerPixel*Math.floor(t.myIgv.viewportContainerWidth()/n.locusCount));var s=(e[1]+i-a.start)/a.bpPerPixel;if(S.css("display","block"),S.css("left",Math.floor(s+50)+"px"),S.css("position","absolute"),i=0,2==t.settings.current.chromosomeIndexes.length&&r[0]!=t.settings.current.chromosomeIndexes[0]){var c=t.myIgv.genomicStateList[1],l=c.referenceFrame;i=a.bpPerPixel*o+a.start,i-=l.start-t.settings.current.chromStart[1],i=Math.max(0,i)}var g=(e[0]+i-a.start)/a.bpPerPixel;I.css("display","block"),I.css("left",Math.floor(g+50)+"px"),I.css("position","absolute")},t.getFeatures=function(e,r){t.myIgv.trackViews.forEach(function(n){if(n.track.name==e){var a=0;n.browser.genomicStateList.forEach(function(e){var o=e.referenceFrame;n.track.getFeatures(o.chrName,t.settings.current.chromStart[a],t.settings.current.chromEnd[a],o.bpPerPixel).then(function(t){t&&(Array.prototype.unique=function(){for(var t=this.concat(),e=0;e<t.length;++e)for(var r=e+1;r<t.length;++r)t[e]===t[r]&&t.splice(r--,1);return t},b[r].feature=b[r].feature.concat(t).unique())}).catch(function(t){t instanceof igv.AbortLoad?console.log("Aborted ---"):igv.presentAlert(t)}),a++})}})},t.updateFeaturesList=function(){t.myIgv.trackViews.forEach(function(e){if("ruler"!=e.track.id&&"sequence"!=e.track.id){for(var r=!1,n=0;n<b.length;n++)b[n].track_name==e.track.name&&(r=!0);if(!r){var a={track_name:e.track.name,pos:[],feature:[]};b.push(a),t.getFeatures(e.track.name,b.length-1)}}})},t.locuschange=function(){t.updateFeaturesList();for(var e=_.first(t.myIgv.genomicStateList),r=e.referenceFrame,n=Math.floor(t.myIgv.viewportContainerWidth()/e.locusCount),a=r.start+r.bpPerPixel*(n/2),o=a-r.start,i=t.settings.current.segmentLength*t.settings.current.particleSegments,s=0,c=0;c<t.settings.current.chromosomeIndexes.length;c++)s+=t.settings.current.chromEnd[c]-t.settings.current.chromStart[c];s+=t.settings.current.chromStart[0],t.settings.current.chromStart[t.settings.current.chromIdx]>a&&(r.start=t.settings.current.chromStart[t.settings.current.chromIdx]-o<=0?t.settings.current.chromStart[t.settings.current.chromIdx]-o:t.settings.current.chromStart[t.settings.current.chromIdx]-o);var l=t.myIgv.genome.getChromosome(r.chrName);l.bpLength=s+(s-r.start)-i;var g=(t.settings.current.chromStart[t.settings.current.chromIdx]-r.start)/r.bpPerPixel,d=(s-r.start)/r.bpPerPixel;t.updatePosition(a,g+50,d+50)},igv.Browser.prototype.updateLocusSearchWithGenomicState=function(e){var r,n,a,o,i,s,c=this;0===e.locusIndex?"all"===e.locusSearchString.toLowerCase()?this.$searchInput.val(e.locusSearchString):(r=e.referenceFrame,this.$searchInput&&(i=r.start+r.bpPerPixel*(c.viewportContainerWidth()/e.locusCount),this.genome&&(s=this.genome.getChromosome(r.chrName),s&&(i=Math.min(i,s.bpLength))),n=igv.numberFormatter(Math.floor(r.start+1)),a=igv.numberFormatter(Math.floor(i)),o=r.chrName+":"+n+"-"+a,this.$searchInput.val(o)),this.fireEvent("locuschange",[r,o]),t.locuschange(r,o)):this.$searchInput.val("")},t.tracksOverlaid={},igv.trackMenuItemList=function(e,r){var n,a=[];a.push(igv.trackMenuItem(e,r,"Set track name",function(){return"Track Name"},r.track.name,function(){function t(t){var e=/(?=.*[a-zA-Z].*)([a-zA-Z0-9 ]+)/,r=e.exec(t);return null!==r?r[0]:"untitled"}var e=t(igv.dialog.$dialogInput.val());void 0!==e&&(igv.setTrackLabel(r.track,e),r.update())},void 0)),a.push(igv.trackMenuItem(e,r,"Set track height",function(){return"Track Height"},r.trackDiv.clientHeight,function(){var t=parseFloat(igv.dialog.$dialogInput.val(),10);void 0!==t&&(void 0!==r.track.minHeight&&r.track.minHeight>t&&(r.track.minHeight=t),void 0!==r.track.maxHeight&&r.track.maxHeight<t&&(r.track.minHeight=t),r.setTrackHeight(t),r.track.autoHeight=!1)
},void 0)),"undefined"==typeof t.tracksOverlaid[r.track.id]&&(t.tracksOverlaid[r.track.id]=!1);var o,i;o='<div class="igv-track-menu-item igv-track-menu-border-top">',o+=!1===t.tracksOverlaid[r.track.id]?'<i class="fa fa-check fa-check-shim fa-check-hidden"></i>Apply to 3D</div>':'<i class="fa fa-check fa-check-shim"></i>Apply to 3D</div>';var s=function(){if(t.tracksOverlaid[r.track.id])t.removeOverlay(r.track.id),t.tracksOverlaid[r.track.id]=!1;else{var n=_.first(r.browser.genomicStateList),a=n.referenceFrame;r.track.getFeatures(a.chrName,t.settings.current.chromStart[t.settings.current.chromIdx],t.settings.current.chromEnd[t.settings.current.chromIdx],a.bpPerPixel).then(function(e){e&&t.applyOverlay(r.track.id,e)}).catch(function(t){t instanceof igv.AbortLoad?console.log("Aborted ---"):igv.presentAlert(t)}),t.tracksOverlaid[r.track.id]=!0}e.hide()};return i=$(o),i.click(s),a=a.concat({object:i,init:void 0}),n=[],r.track.menuItemList&&(n=a.concat(igv.trackMenuItemListHelper(r.track.menuItemList(e)))),r.track.removable!==!1&&n.push(igv.trackMenuItem(e,r,"Remove track",function(){var t="Remove "+r.track.name;return'<div class="igv-dialog-label-centered">'+t+"</div>"},void 0,function(){e.hide(),r.browser.removeTrack(r.track)},!0)),n}}angular.module("TADkit").controller("PanelIgvjsControllerBeta",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i,s,c,l){if(!angular.isUndefined(t.settings.current.speciesUrl)||(t.settings.current.speciesUrl=c.setSpeciesUrl(),!angular.isUndefined(t.settings.current.speciesUrl))){var g=a.getComponentById("Chromatin"),d=0;if("undefined"!=typeof g)d=parseInt(g.object.state.width);else{var u=a.getComponentById("Inspector"),h=0;"undefined"!=typeof u&&(h=parseInt(u.object.state.width)),d=h}t.width=t.state.width=e.innerWidth-d-50-2*parseInt(t.state.margin),t.height=t.state.height=parseInt(t.state.height)-2*parseInt(t.state.margin),t.$watch("settings.views.scene_width",function(r,n){r!==n&&(t.width=t.state.width=e.innerWidth-r-50-2*parseInt(t.state.margin),t.myIgv.repaint())});{angular.element(e)}t.$watch(function(){return e.innerWidth},function(e){t.width=t.state.width=e-d-50-2*parseInt(t.state.margin)},!0);var p=n.getCurrentIndex(),m=i.get(),f=t.settings.current.chromStart;0>f&&(f=0);var v=t.settings.current.chrom;t.view.settings.leading_chr||(v=t.settings.current.chrom.replace("chr","")),("undefined"==typeof t.settings.current.assemblyUrl||"undefined"==typeof t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl])&&(t.settings.current.assemblyUrl=Object.keys(t.view.settings.species_data[t.settings.current.speciesUrl])[0]);var b;t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].fastaURL?(b={id:t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].id,fastaURL:t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].fastaURL,cytobandURL:null},t.view.settings.showNav=!0,t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].cytobandURL?(b.cytobandURL=t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].cytobandURL,t.view.settings.showCyto=!1):t.view.settings.showCyto=!1):(b={id:t.settings.current.speciesUrl},t.view.settings.showNav=!0),t.tracks=l.getTracks(),t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].tracks&&(t.tracks=t.tracks.concat(t.view.settings.species_data[t.settings.current.speciesUrl][t.settings.current.assemblyUrl].tracks)),t.igvDiv=angular.element(document.querySelector("#igvDiv"))[0],t.igvOptions={showNavigation:t.view.settings.showNav,showRuler:!0,showIdeogram:t.view.settings.showCyto,showKaryo:t.view.settings.showCyto,flanking:1e5,reference:b,locus:v+":"+f+"-"+t.settings.current.chromEnd,tracks:t.tracks.slice()},t.updatePosition=function(e,n,a){e>=t.settings.current.chromStart&&e<=t.settings.current.chromEnd&&(t.settings.current.position=e),e<t.settings.current.chromStart&&(t.settings.current.position=t.settings.current.chromStart),e>t.settings.current.chromEnd&&(t.settings.current.position=t.settings.current.chromEnd),(t.settings.current.leftborder!=n||t.settings.current.rightborder!=a)&&(t.settings.current.leftborder=n,t.settings.current.rightborder=a),t.hideTadkitMarkers(),t.updateTadkitTAD(),r(function(){t.$apply()})},t.applyOverlay=function(e,r){for(var a=n.get(),i=0;i<a.loaded.length;i++)if(a.loaded[i].object.title===e)return t.toggleOverlay(a.loaded[i].object.state.index),!0;var s,c,l,g,d={metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:o.generate(),id:a.loaded.length,title:e,source:"igvJs track",url:"local",description:"igvJs track overlay",type:"igvJs",format:"variable",components:2,name:e,state:{index:0,overlaid:!1}},palette:[],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}},u=0,h=0;for(c=0;c<t.settings.current.segmentsCount;c++)d.colors.chromatin[c]="gray";var p,m,f,v=[],b=!1,y=[];if(angular.forEach(r,function(t){"undefined"==typeof t.color?("undefined"!=typeof t.score&&v.push(t.score),"undefined"!=typeof t.value&&v.push(t.value),b=!0):v.push(t.color)}),b){var w="#0000ff",k="#ffffff",x=0,E=0;for(h=0;E<v.length;){for(s=0,p=0,f=0,x=r[E].start;1>s&&E<v.length;)m=r[E],s=(m.end-x)/t.settings.current.segmentLength,p+=parseFloat(v[E]),f++,E++;y.push(p)}for(l=Math.max.apply(Math,y),g=Math.min.apply(Math,y),E=0,h=0;E<v.length;){for(s=0,p=0,x=r[E].start;1>s&&E<v.length;)m=r[E],s=(m.end-x)/t.settings.current.segmentLength,p+=parseFloat(v[E]),E++;for(v[h]=d3.interpolateHcl(k,w)((p-g)/(l-g)),u=Math.round((x-t.settings.current.chromStart)/t.settings.current.segmentLength),c=u;c<u+Math.round(s)&&c<t.settings.current.segmentsCount;c++)d.colors.chromatin[c]=v[h];h++}}else angular.forEach(r,function(e){for(u=Math.round((e.start-t.settings.current.chromStart)/t.settings.current.segmentLength),s=Math.round((e.end-e.start)/t.settings.current.segmentLength),c=u;u+s>c&&c<t.settings.current.segmentsCount;c++)d.colors.chromatin[c]=v[h];h++});var C=n.addDirect(d),T=a.loaded[C];T.colors.particles=[],T.colors.network.RGB=[],T.colors.network.alpha=[],t.toggleOverlay(C)},t.toggleOverlay=function(e){t.overlaid=n.getOverlay(e).object.state.overlaid,t.overlaid?(n.setOverlaid(p),n.set(p),t.currentoverlay=n.getOverlay()):(n.setOverlaid(e),n.set(e),t.currentoverlay=n.getOverlay()),t.toggleColor(t.currentoverlay)},t.removeOverlay=function(e){var r=n.get();angular.forEach(r.loaded,function(r){r.object.title===e&&t.toggleOverlay(r.object.state.index)})},t.myIgv=igv.createBrowser(t.igvDiv,t.igvOptions);var y=angular.element(document.querySelector(".igv-search-container"))[0];$(y).hide(),t.myIgv.centerGuide.$centerGuideToggle.click();var w=angular.element(document.querySelector(".igv-ideogram-content-div"))[0];w.remove(),t.myIgv.karyoPanel=null;var k=angular.element('<div id="tad-highlight-tadkit" style="width=\'0px;\';display=none;"></div>'),x=angular.element(t.myIgv.trackContainerDiv);x.append(k);var E=angular.element('<div id="trackbar-tadkit-left-mark" style="display=none"></div>');x.append(E);var C=angular.element('<div id="trackbar-tadkit-right-mark" style="display=none"></div>');x.append(C),t.updateTadkitTAD=function(){if("undefined"!=typeof t.settings.current.tad_selected&&-1!=t.settings.current.tad_selected){var e;if(e=t.myIgv.referenceFrame,"undefined"!=typeof e){var r=t.data.tad_data.tads[t.settings.current.tad_selected][1],n=t.data.tad_data.tads[t.settings.current.tad_selected][2],a=Math.round((r-e.start)/e.bpPerPixel);k.css("left",Math.floor(a+50)+"px");var o=Math.round((n-e.start)/e.bpPerPixel);k.css("width",Math.floor(o-a)+"px"),k.css("display","block")}}else k.css("width","0px"),k.css("display","none")},t.myIgv.zoomHandlers={"in":{click:function(){t.myIgv.zoomIn()}},out:{click:function(){t.myIgv.zoomOut()}}},t.$watch("settings.current.hic_position",function(e,r){angular.equals(e,r)||e==t.settings.current.position||t.myIgv.goto(t.settings.current.chrom,e)}),t.$watch("settings.current.markers_position",function(e,r){e!==r&&(angular.isUndefined(t.settings.current.markers_position)||-1===e[0]||-1===e[1]?t.hideTadkitMarkers():t.updateTadkitMarkers(e))}),t.hideTadkitMarkers=function(){C.css("display","none"),E.css("display","none"),t.settings.current.markers_position=void 0},t.updateTadkitMarkers=function(e){t.updateFeaturesList();var r=t.myIgv.referenceFrame,n=(e[1]-r.start)/r.bpPerPixel;E.css("display","block"),E.css("left",Math.floor(n+50)+"px"),E.css("position","absolute");var a=(e[0]-r.start)/r.bpPerPixel;C.css("display","block"),C.css("left",Math.floor(a+50)+"px"),C.css("position","absolute")},t.getFeatures=function(e,r){t.myIgv.trackViews.forEach(function(n){if(n.track.name==e){var a=n.browser.referenceFrame;n.track.getFeatures(a.chr,t.settings.current.chromStart,t.settings.current.chromEnd,a.bpPerPixel).then(function(t){t&&(m[r].feature=m[r].feature.concat(t))}).catch(function(t){t instanceof igv.AbortLoad?console.log("Aborted ---"):igv.presentAlert(t)})}})},t.updateFeaturesList=function(){t.myIgv.trackViews.forEach(function(e){if("ruler"!=e.track.id&&"sequence"!=e.track.id){for(var r=!1,n=0;n<m.length;n++)m[n].track_name==e.track.name&&(r=!0);if(!r){var a={track_name:e.track.name,pos:[],feature:[]};m.push(a),t.getFeatures(e.track.name,m.length-1)}}})},t.myIgv.on("locuschange",function(){t.updateFeaturesList();var e=t.myIgv.referenceFrame,r=t.myIgv.trackViewportWidth(),n=e.start+e.bpPerPixel*(r/2),a=n-e.start;t.settings.current.chromStart>n&&(e.start=t.settings.current.chromStart-a<=0?t.settings.current.chromStart-a:t.settings.current.chromStart-a);var o=t.myIgv.genome.getChromosome(e.chr);o.bpLength=t.settings.current.chromEnd+(t.settings.current.chromEnd-e.start);var i=(t.settings.current.chromStart-e.start)/e.bpPerPixel,s=(t.settings.current.chromEnd-e.start)/e.bpPerPixel;t.updatePosition(n,i+50,s+50)}),t.tracksOverlaid={},igv.trackMenuItems=function(e,r){var n,a=[];a.push(igv.dialogMenuItem(e,r,"Set track name",function(){return"Track Name"},r.track.name,function(){function t(t){var e=/(?=.*[a-zA-Z].*)([a-zA-Z0-9 ]+)/,r=e.exec(t);return null!==r?r[0]:"untitled"}var e=t(igv.dialog.$dialogInput.val());void 0!==e&&(igv.setTrackLabel(r.track,e),r.update())},void 0)),a.push(igv.dialogMenuItem(e,r,"Set track height",function(){return"Track Height"},r.trackDiv.clientHeight,function(){var t=parseFloat(igv.dialog.$dialogInput.val(),10);void 0!==t&&(void 0!==r.track.minHeight&&r.track.minHeight>t&&(r.track.minHeight=t),void 0!==r.track.maxHeight&&r.track.maxHeight<t&&(r.track.minHeight=t),r.setTrackHeight(t),r.track.autoHeight=!1)},void 0)),r.track.popupMenuItems&&(n=r.track.popupMenuItems(e),n&&n.length>0&&n.forEach(function(t,e){var r;t.name?(r=0===e?'<div class="igv-track-menu-item igv-track-menu-border-top">':'<div class="igv-track-menu-item">',r=r+t.name+"</div>",a.push({object:$(r),click:t.click,init:t.init})):0===e?(t.object.addClass("igv-track-menu-border-top"),a.push(t)):a.push(t)})),"undefined"==typeof t.tracksOverlaid[r.track.id]&&(t.tracksOverlaid[r.track.id]=!1);var o,i;o='<div class="igv-track-menu-item igv-track-menu-border-top">',o+=!1===t.tracksOverlaid[r.track.id]?'<i class="fa fa-check fa-check-shim fa-check-hidden"></i>Apply to 3D</div>':'<i class="fa fa-check fa-check-shim"></i>Apply to 3D</div>';var s=function(){if(t.tracksOverlaid[r.track.id])t.removeOverlay(r.track.id),t.tracksOverlaid[r.track.id]=!1;else{var n=r.browser.referenceFrame;r.track.getFeatures(n.chr,t.settings.current.chromStart,t.settings.current.chromEnd,n.bpPerPixel).then(function(e){e&&t.applyOverlay(r.track.id,e)}).catch(function(t){t instanceof igv.AbortLoad?console.log("Aborted ---"):igv.presentAlert(t)}),t.tracksOverlaid[r.track.id]=!0}e.hide()};return i=$(o),i.click(s),a=a.concat({object:i,init:void 0}),r.track.removable!==!1&&a.push(igv.dialogMenuItem(e,r,"Remove track",function(){var t="Remove "+r.track.name;return'<div class="igv-dialog-label-centered">'+t+"</div>"},void 0,function(){e.hide(),r.browser.removeTrack(r.track)},!0)),a}}}angular.module("TADkit").controller("PanelIgvjsController",t)}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"=",overlay:"=",currentoverlay:"="},templateUrl:"assets/templates/panel-igvjs.html",link:function(e){e.$watch("settings.current.position",function(t,r){t!==r&&e.update()}),e.$watch("settings.current.tad_selected",function(t,r){(-1===t||-1===r)&&e.updateTadkitTAD()}),e.update=function(){e.settings.current.particle=t.getParticle(),e.settings.current.segment=t.getSegment();var r=e.settings.current.segmentLength*e.settings.current.particleSegments;e.settings.current.segmentLower=e.settings.current.particle*r+e.settings.current.chromStart[e.settings.current.chromIdx],e.settings.current.segmentUpper=(e.settings.current.particle+1)*r+e.settings.current.chromStart[e.settings.current.chromIdx]},e.toggleColor=function(t){e.currentoverlay=t,e.$apply(e.currentoverlay.colors.chromatin)}}}}angular.module("TADkit").directive("tkComponentPanelIgvjs",t)}(),function(){"use strict";function t(t){t.current.dataset&&(t.species=t.current.dataset.object.species,t.region=t.current.dataset.object.region)}angular.module("TADkit").controller("PanelInfoboxController",t)}(),function(){"use strict";function t(){return{restrict:"C",templateUrl:"assets/templates/panel-infobox.html",link:function(){}}}angular.module("TADkit").directive("tkComponentPanelInfobox",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i,s){function c(t,e){t.closeDialog=function(){e.hide()}}t.$watch("settings.views.scene_width",function(e,r){e!==r&&(t.width=t.state.width=e)}),t.width=parseInt(t.state.width),t.height=parseInt(t.state.height);var l;l=angular.isUndefined(t.data.object.bp_per_nm)?.01*t.data.object.resolution:t.data.object.resolution*t.data.object.bp_per_nm,t.selectedIndex=0,t.atPosition=function(e){return t.$parent.settings.current.segmentUpper>=e.start&&t.$parent.settings.current.segmentLower<=e.end&&e.chr.replace("chr","")==t.settings.current.chrom.replace("chr","")?!0:!1},t.atLeftPosition=function(e){if(!angular.isUndefined(t.settings.current.markers_position)){var n=t.data.object.resolution,a=t.settings.current.markers_position[1],o=r.getParticle(a),i=(o-1)*n+t.settings.current.chromStart[t.settings.current.chromosomeIndexes.indexOf(t.settings.current.markers_chr[1])],s=o*n+t.settings.current.chromStart[t.settings.current.chromosomeIndexes.indexOf(t.settings.current.markers_chr[1])];return s>=e.start&&i<=e.end&&e.chr.replace("chr","")==t.settings.current.markers_chr[1].replace("chr","")?!0:!1}},t.atRightPosition=function(e){if(!angular.isUndefined(t.settings.current.markers_position)){var n=t.data.object.resolution,a=t.settings.current.markers_position[0],o=r.getParticle(a),i=(o-1)*n+t.settings.current.chromStart[t.settings.current.chromosomeIndexes.indexOf(t.settings.current.markers_chr[0])],s=o*n+t.settings.current.chromStart[t.settings.current.chromosomeIndexes.indexOf(t.settings.current.markers_chr[0])];return s>=e.start&&i<=e.end&&e.chr.replace("chr","")==t.settings.current.markers_chr[0].replace("chr","")?!0:!1}},t.formatRegionName=function(t){return"Chromosome"==t?t:"chr"+t},t.featureTitle=function(t){return angular.isUndefined(t.name)?angular.isUndefined(t.id)?angular.isUndefined(t.value)?void 0:t.value:t.id:t.name},t.interactionDistance=function(){if(angular.isUndefined(t.settings.current.markers_position&&t.currentmodel.data.length>0))return-1;var e=r.getParticle(t.settings.current.markers_position[1]),n=r.getParticle(t.settings.current.markers_position[0]),a=t.currentmodel.data[3*(e-1)]-t.currentmodel.data[3*(n-1)],o=t.currentmodel.data[3*(e-1)+1]-t.currentmodel.data[3*(n-1)+1],i=t.currentmodel.data[3*(e-1)+2]-t.currentmodel.data[3*(n-1)+2],s=Math.round(Math.sqrt(a*a+o*o+i*i));return s},t.toggleSelection=function(e){var n=t.settings.current.chromosomeIndexes.slice(),a=n.indexOf(e);if(a>-1){if(n.length<2)return;n.splice(a,1)}else n.push(e);for(var o,c=[],l=[],g=[],d=t.data.object.resolution,u=0,h=0;h<t.data.object.chrom.length;h++)o=n.indexOf(t.data.object.chrom[h]),o>-1&&(g.push(t.data.object.chrom[h]),c.push(Math.round(t.data.object.chromStart[h]/d)+u),l.push(Math.round(t.data.object.chromEnd[h]/d)+u)),u+=Math.round(t.data.object.chromEnd[h]/d)-Math.round(t.data.object.chromStart[h]/d);{var p=i.getDataset();s.set(p.hic_data,c,l),i.setModel(i.getCentroid(),n)}n.indexOf(t.settings.current.chrom)<0&&(t.settings.current.chrom=n[0]),r.set(p,n,t.settings.current.chrom);var m=angular.element(document.querySelector("#igvRootDiv"))[0],f=parseInt(m.clientWidth)-100;if(t.settings.current.leftborder=50,2==n.length){var v=(50+f)/n.length;t.settings.current.rightborder=v*(t.settings.current.particlesCount/(l[0]-c[0]))}else t.settings.current.rightborder=50+f;t.settings.current.chromosomeIndexes=g},t.showInfo=function(t){e.show({parent:angular.element(document.body),template:'<md-dialog md-theme="default" aria-label="Information">  <md-dialog-content class="md-default-theme">'+t+'<div class="md-actions"><md-button ng-click="closeDialog();" class="md-primary md-button md-default-theme"><span class="ng-binding ng-scope">Close</span></md-button></div>  </md-dialog-content></md-dialog>',locals:{},controller:c})},t.getDetails=function(e){var r='<div class="component-caption" layout="column" layout-align="left center"><table>';for(var n in e)["name","id","chr","value","score","strand","start","end"].indexOf(n)>=0&&(r+="<tr><td><b>"+n+":</b></td><td>"+e[n]+"</td></tr>");r+="</table></div>",t.showInfo(r)}}angular.module("TADkit").controller("PanelInspectorController",t)}(),function(){"use strict";function t(){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",currentmodel:"=",settings:"="},templateUrl:"assets/templates/panel-inspector.html",link:function(){}}}angular.module("TADkit").directive("tkComponentPanelInspector",t)}(),function(){"use strict";function t(t,e,r,n,a){t.width=t.state.width,t.height=t.state.height;var o=r.getCurrentIndex(),i=t.settings.current.chromStart-3e4;0>i&&(i=0);var s=t.settings.current.chrom;t.view.settings.leading_chr||(s=t.settings.current.chrom.replace("chr","")),t.jbrowsedataurl=encodeURIComponent(t.view.settings.species_data[t.settings.current.speciesUrl]),t.iframe_src=t.view.settings.jbrowse_path+"index.html?data="+t.jbrowsedataurl+"&loc="+s+":"+i+".."+(t.settings.current.chromEnd+3e4)+"&tracks=Restraints&overview=0",t.updatePosition=function(e,r,n){e>=t.settings.current.chromStart&&e<=t.settings.current.chromEnd&&(t.settings.current.position=e),e<t.settings.current.chromStart&&(t.settings.current.position=t.settings.current.chromStart),e>t.settings.current.chromEnd&&(t.settings.current.position=t.settings.current.chromEnd),(t.settings.current.leftborder!=r||t.settings.current.rightborder!=n)&&(t.settings.current.leftborder=r,t.settings.current.rightborder=n),t.hideTadkitMarkers(),t.$apply()},t.$watch("settings.current.markers_position",function(e,r){e!==r&&(-1===e[0]||-1===e[1]?t.hideTadkitMarkers():t.updateTadkitMarkers(e[0],e[1]))}),t.applyOverlay=function(e,o){for(var i=r.get(),s=0;s<i.loaded.length;s++)if(i.loaded[s].object.title===e)return t.toggleOverlay(i.loaded[s].object.state.index),!0;var c,l,g,d,u={metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:n.generate(),id:i.loaded.length,title:e,source:"JBrowse track",url:"local",description:"JBrowse track overlay",type:"jbrowse",format:"variable",components:2,name:e,state:{index:0,overlaid:!1}},palette:[],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}},h=0,p=0;for(l=0;l<t.settings.current.segmentsCount;l++)u.colors.chromatin[l]="gray";var m=[],f=!1;if(angular.forEach(o,function(t){"undefined"==typeof t.get("color")?(m.push(t.get("score")),f=!0):m.push(t.get("color"))}),f){var v="#0000ff",b="#ffffff";for(g=Math.max.apply(Math,m),d=Math.min.apply(Math,m),l=0;l<m.length;l++)m[l]=d3.interpolateHcl(b,v)((m[l]-d)/(g-d))}angular.forEach(o,function(e){for(h=Math.round((e.get("start")-t.settings.current.chromStart)/t.settings.current.segmentLength),c=Math.round((e.get("end")-e.get("start"))/t.settings.current.segmentLength),l=h;h+c>l&&l<t.settings.current.segmentsCount;l++)u.colors.chromatin[l]=m[p];p++});var y=r.addDirect(u),w=i.loaded[y];w.colors.particles=[],w.colors.network.RGB=a.linePiecesRGB(w,t.settings.current.edgesCount),w.colors.network.alpha=a.linePiecesAlpha(w,t.settings.current.edgesCount),t.toggleOverlay(y)},t.toggleOverlay=function(e){t.overlaid=r.getOverlay(e).object.state.overlaid,t.overlaid?(r.setOverlaid(o),r.set(o),t.currentoverlay=r.getOverlay()):(r.setOverlaid(e),r.set(e),t.currentoverlay=r.getOverlay()),t.toggleColor(t.currentoverlay)},t.removeOverlay=function(e){var n=r.get();angular.forEach(n.loaded,function(r){r.object.title===e&&t.toggleOverlay(r.object.state.index)})}}angular.module("TADkit").controller("PanelJBrowseController",t)}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"=",overlay:"=",currentoverlay:"="},templateUrl:"assets/templates/panel-jbrowse.html",link:function(e){e.$watch("settings.current.position",function(t,r){t!==r&&e.update()}),e.$watch("settings.current.tad_selected",function(t,e){if(-1===t||-1===e){var r=angular.element(document.querySelector("#jbrowse-iframe")).scope();!angular.isUndefined(r)&&r.updateTadkitBar&&r.updateTadkitTAD()}}),e.update=function(){e.settings.current.particle=t.getParticle(),e.settings.current.segment=t.getSegment(),e.settings.current.segmentLower=e.settings.current.position-5*e.settings.current.segment,e.settings.current.segmentUpper=e.settings.current.position+5*e.settings.current.segment},e.toggleColor=function(t){e.currentoverlay=t,e.$apply(e.currentoverlay.colors.chromatin)}}}}angular.module("TADkit").directive("tkComponentPanelJbrowse",t)}(),function(){"use strict";function t(t,n,a){return function(o,i,s,c,l){var g={visible:!0,genomeLength:816394,particles:0,particleSegments:40,curveSegments:1,radius:15,radiusSegments:16,endcap:!1,pathClosed:!1,tubed:!0,resolution_scales:{2000:1,10000:1,50000:5,100000:5}};s=s||{},angular.extend(this,angular.copy(g),s);{var d=l.segmentLength*l.particleSegments,u=5;11*this.genomeLength/1080}this.radius=c*u;for(var h=e(o),p=h.vertices.length-1;p>=0;p--){var m=new THREE.Color(i[20*p]);h.colors.unshift(m)}h.computeBoundingSphere(),h.center();for(var f,v,b,y,w,k,x,E,C,T,S=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1,transparent:!1,vertexColors:THREE.FaceColors,overdraw:!0}),I=new THREE.Object3D,j=0,R=0,M=0;M<l.chromosomeIndexes.length;M++){if(v=Math.round((l.chromEnd[M]-l.chromStart[M])/d),b=n.cubic(h.vertices.slice(R,R+v),this.pathClosed),0===this.particles&&(this.particles+=h.vertices.length),y=v*this.particleSegments,w=t.cubicBezier(b.vertices,y,this.pathClosed),k=(new THREE.Geometry).setFromPoints(w.getPoints()),s.tubed){for(x=new THREE.TubeGeometry(w,y,this.radius,8,this.pathClosed),E=new THREE.Mesh(x,S),x.dynamic=!0,x.verticesNeedUpdate=!0,f=0;f<x.faces.length;f++){for(C=a.testIfHex(i[Math.floor(j/16)])||0===i[Math.floor(j/16)].indexOf("#")?new THREE.Color(i[Math.floor(j/16)]):new THREE.Color(a.nameToHex(i[Math.floor(f/16)])),T=0;16>T;T++)"undefined"!=typeof x.faces[f+T]&&x.faces[f+T].color.set(C);j++}E.geometry.__dirtyColors=!0,E.geometry.elementsNeedUpdate=!0,E.dynamic=!0,E.needsUpdate=!0,I.add(E)}else for(x=new THREE.Geometry,f=0;y>f;f++){this.endcap=0===f||f===y-1?!1:!0;var A=i[f],H=new THREE.MeshLambertMaterial({color:A,emissive:A,vertexColors:THREE.VertexColors,opacity:1,transparent:!1,wireframe:!1}),_=r(k.vertices[f],k.vertices[f+1],this);x.merge(_),THREE.GeometryUtils.center(x);var P=new THREE.Mesh(_,H);P.name="segment-"+(f+1),I.add(P)}x.computeBoundingSphere(),R+=v}return I.boundingSphere=h.boundingSphere,I.name="Chromatin Fiber",I}}function e(t){for(var e,r=0,n=new THREE.Geometry,a=t.length;a>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n.name="Chromatin Geometry",n}function r(t,e,r){var n,a=(new THREE.Vector3).subVectors(e,t),o=new THREE.Matrix4;o.lookAt(t,e,(new THREE.Object3D).up);var i=new THREE.Matrix4;return i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),o.multiply(i),o.setPosition(t.add(e).multiplyScalar(.5)),n=new THREE.CylinderGeometry(r.radius,r.radius,a.length(),r.radiusSegments,r.curveSegments,r.endcap),n.applyMatrix(o),n}angular.module("TADkit").factory("Chromatin",t)}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{state:"=",type:"=",title:"@",settings:"=",view:"=",id:"@",cluster:"=",overlay:"="},templateUrl:"assets/templates/scene-cluster-icon.html",link:function(r,n){var a,o,i,s,c,l,g,d,u,h,p,m,f;r.init=function(){i=n[0].children[0].children[0],m=parseInt(r.state.width),f=parseInt(r.state.height),a=window.WebGLRenderingContext?new THREE.WebGLRenderer({alpha:!0,antialias:!0}):new THREE.CanvasRenderer({alpha:!0});var v=r.view.settings.background,b="0x"+v.substring(1);a.setClearColor(parseInt(b)),a.setSize(m,f),a.autoClear=!1,a.setSize(m,f),i.appendChild(a.domElement),o=new THREE.Scene,s=new THREE.PerspectiveCamera(r.view.viewpoint.fov,m/f,r.view.viewpoint.near,r.view.viewpoint.far),s.position.fromArray(r.view.viewpoint.camera),s.name="Scene Camera",d=new THREE.OrbitControls(s,a.domElement),d.autoRotate=r.view.controls.autoRotate,d.autoRotateSpeed=r.view.controls.autoRotateSpeed,d.enableZoom=!1,d.enableRotate=!1,d.enablePan=!1,d.enableKeys=!1,u=new THREE.TrackballControls(s,a.domElement),u.noZoom=!0,u.noRotate=!0,u.noPan=!0,h=new t(r.cluster.data[r.cluster.centroidIndex],r.view.settings.particles),h.geometry.center(),h.visible=r.view.settings.particles.visible,p=new e(r.cluster.data,r.cluster.centroidIndex,r.overlay,r.view.settings.cluster),p.visible=r.view.settings.cluster.visible,p.name=p.name+" "+r.id.match(/\d+/)[0],o.add(p),c=new THREE.Vector3,l=new THREE.Vector3(0,0,0);var y=r.view.viewpoint.fov/2,w=.6,k=Math.tan(y).toFixed(2)*w;g=p.boundingSphere.radius*k,r.lookAtTarget(c,l,g)},r.lookAtTarget=function(t,e,r){t=t||new THREE.Vector3(5e4,5e4,5e4);var n=new THREE.Vector3(0,0,0);e=e||n,r=r||500,s.position.set(t.x,t.y,t.z),s.lookAt(n),d.target=e,s.translateY(r),s.lookAt(e),s.updateMatrixWorld(),u.target.copy(t)},r.animate=function(){requestAnimationFrame(r.animate),d.update(),u.update(),r.render()},r.render=function(){a.render(o,s)},r.init(),r.animate(),r.destroy_scene=function(){o.remove(p),o.remove(h),h.geometry.dispose(),h.material.dispose();for(var t=0;t<p.children.length;t++)p.children[t].geometry.dispose(),p.children[t].material.dispose();h=void 0,p=void 0,a&&a.forceContextLoss()},r.$on("$destroy",function(){r.destroy_scene()})}}}angular.module("TADkit").directive("tkComponentSceneCluster",t)}(),function(){"use strict";function t(t,r){return function(n,a,o,i){var s={visible:!0};i=i||{},angular.extend(this,angular.copy(s),i);var c,l,g=0,d=t.colorsFromHex(o),u=new THREE.Object3D,h=r.get(),p=h.current.segmentLength*h.current.particleSegments,m=0;for(l=0;l<n.length;l++){var f=new THREE.LineBasicMaterial({color:new THREE.Color(parseInt(this.color)),opacity:this.modelOpacity,transparent:this.transparent,linewidth:this.linewidth,fog:this.fog}),v=new THREE.LineBasicMaterial({opacity:this.centroidOpacity,transparent:this.transparent,linewidth:this.linewidth,vertexColors:THREE.VertexColors,fog:this.fog});l==a&&(f=v),m=0;for(var b=0;b<h.current.chromosomeIndexes.length;b++){c=Math.round((h.current.chromEnd[b]-h.current.chromStart[b])/p)+1;var y=n[l].slice(3*m,3*(m+c)),w=e(y);w.colors=d;var k=new THREE.Line(w,f);k.name="model-"+h.current.chromosomeIndexes[b]+"-"+l,k.geometry.computeBoundingSphere(),k.geometry.center(),k.geometry.boundingSphere.radius>g&&(g=k.geometry.boundingSphere.radius),u.add(k),m+=c}}for(l=0;l<u.children.length;l++)u.children[l].geometry.center();return u.boundingSphere=u.children[0].geometry.boundingSphere.clone(),u.boundingSphere.radius=g,u.name="Cluster Ensemble",u}}function e(t){for(var e,r=0,n=new THREE.Geometry,a=t.length;a>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n.center(),n}angular.module("TADkit").factory("Cluster",t)}(),function(){"use strict";function t(){return{restrict:"EA",link:function(t,e){function r(){o=e[0],i=o.clientWidth,c=new THREE.Scene,s=new THREE.PerspectiveCamera(50,1,150,650),s.position.z=500,c.add(s),g=new THREE.TorusKnotGeometry(100,30,100,16),d=new THREE.MeshDepthMaterial({wireframe:!0,wireframeLinewidth:1}),u=new THREE.Mesh(g,d),u.name="Floating TAD",c.add(u),l=window.WebGLRenderingContext?new THREE.WebGLRenderer({alpha:!0}):new THREE.CanvasRenderer({alpha:!0}),l.setSize(i,i),o.appendChild(l.domElement),h=new THREE.TrackballControls(s,l.domElement),h.minDistance=450,h.maxDistance=550}function n(){requestAnimationFrame(n),h.update(),a()}function a(){u.rotation.x+=.006,u.rotation.y+=.006,l.render(c,s)}var o,i,s,c,l,g,d,u,h;r(),n()}}}angular.module("TADkit").directive("tkComponentSceneFloatingtad",t)}(),function(){"use strict";function t(){return function(t,n,a){var o={color:"#ff0000",size:200,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0,visible:!1};a=a||{},angular.extend(this,angular.copy(o),a);var i={color:{type:"c",value:new THREE.Color(65280)},alpha:{type:"f",value:1}},s={uniforms:i,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,vertexColors:THREE.VertexColors,transparent:!0},c=new THREE.ShaderMaterial(s);c.linewidth=1;var l=t.length/3,g=.5*(l*l-l),d=e(t,g),u=new Float32Array(n.RGB),h=new Float32Array(n.alpha),p=new THREE.BufferGeometry;p.addAttribute("position",new THREE.BufferAttribute(d,3)),p.addAttribute("color",new THREE.BufferAttribute(u,3)),p.addAttribute("alpha",new THREE.BufferAttribute(h,1)),p.center(),p.computeBoundingSphere();var m=null;if(this.map){var f=new THREE.TextureLoader;m=f.load(this.map)}var v=new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:m,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),b=r(t);b.center(),b.computeBoundingSphere();for(var y=[],w=0;w<b.vertices.length;w++)y[w]=new THREE.Color("rgb(255,255,255)");b.colors=y;var k=new THREE.Points(b,v);k.name="Network Nodes";var x=new THREE.LineSegments(p,c);x.name="Network Edges";var E=new THREE.Object3D;return E.add(x),E.add(k),E.boundingSphere=p.boundingSphere,E.name="Network Graph",E}}function e(t,e){for(var r=new Float32Array(6*e),n=0,a=0;a<t.length;a+=3)for(var o=a,i=a+3;i<t.length;i+=3){var s=i;r[n]=t[o],n++,r[n]=t[o+1],n++,r[n]=t[o+2],n++,r[n]=t[s],n++,r[n]=t[s+1],n++,r[n]=t[s+2],n++}return r.name="Network Vertex Pairs",r}function r(t){for(var e,r=0,n=new THREE.Geometry,a=t.length;a>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n.name="Particles Geometry",n}angular.module("TADkit").factory("Network",t)}(),function(){"use strict";function t(){return function(t,r,n){var a={particles:0,visible:!0,color:"#ff0000",size:100,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0};n=n||{},angular.extend(this,angular.copy(a),n);var o=e(t);o.center(),o.computeBoundingSphere();for(var i=[],s=0;s<o.vertices.length;s++)i[s]=new THREE.Color("rgb(255,255,255)");o.colors=i;var c=null;if(this.map){var l=new THREE.TextureLoader;c=l.load(this.map)}var g=new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:c,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),d=new THREE.Points(o,g);return d.name="Particles Cloud",d}}function e(t){for(var e,r=0,n=new THREE.Geometry,a=t.length;a>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n.name="Particles Geometry",n}angular.module("TADkit").factory("Particles",t)}(),function(){"use strict";function t(){return{restrict:"EA",scope:{id:"@",type:"=",data:"=",view:"=",overlay:"=",state:"="},link:function(t,e){function r(){o=e[0],s=new THREE.Scene,i=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e4),i.position.z=500,s.add(i);
var r=200;l=new THREE.BoxGeometry(r,r,r);var n="#"+t.overlay;g=new THREE.MeshLambertMaterial({color:n,ambient:n,emissive:n,opacity:1,transparent:!1,wireframe:!1}),d=new THREE.Mesh(l,g),d.name="testmesh",s.add(d),c=window.WebGLRenderingContext?new THREE.WebGLRenderer({alpha:!0}):new THREE.CanvasRenderer({alpha:!0}),c.setSize(window.innerWidth,window.innerHeight),o.appendChild(c.domElement);var a=s.getObjectByName("testmesh");t.$watch("overlay",function(e,r){if(e!==r){var n=new THREE.Color("#"+t.overlay);a.material.color=n,a.material.ambient=n,a.material.emissive=n}})}function n(){requestAnimationFrame(n),a()}function a(){d.rotation.x+=.01,d.rotation.y+=.02,c.render(s,i)}var o,i,s,c,l,g,d;r(),n()}}}angular.module("TADkit").directive("tkComponentSceneThreetest",t)}(),function(){"use strict";function t(t){t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState},t.toggle=function(t){t=!t,console.log(t)},t.$on("angular-resizable.resizeEnd",function(e,r){r.width&&(t.state.width=t.settings.views.scene_width=r.width),r.height&&(t.state.height=t.settings.views.scene_height=r.height),t.resizeCanvas()})}angular.module("TADkit").controller("SceneController",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i,s,c,l){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",state:"=",currentmodel:"=",proximities:"=",currentoverlay:"="},templateUrl:"assets/templates/scene.html",link:function(r,c){if(!angular.isUndefined(r.currentmodel)){var g,d,u,h,p,m,f,v,b,y,w,k,x,E,C,T,S,I,j,R,M,A,H,_,P,D,O,L,U=new THREE.Color,$=new THREE.Color,B=new THREE.Color("rgb(0,0,0)");r.init=function(){r.complete_scene=function(){r.view.settings.particles.size=r.settings.current.particleSize,k=new t(r.currentmodel.data,r.currentoverlay.colors.particles,r.view.settings.particles),k.visible=r.view.settings.particles.visible,g.add(k),r.view.settings.chromatin.particleSegments=r.settings.current.particleSegments;var o,s=r.data.object.resolution;if(angular.isUndefined(r.data.object.radius_scale)?(angular.forEach(r.view.settings.chromatin.resolution_scales,function(t,e){parseInt(e)<=s&&(o=t)}),r.data.object.radius_scale=o):o=parseInt(r.data.object.radius_scale),x=new e(r.currentmodel.data,r.currentoverlay.colors.chromatin,r.view.settings.chromatin,o,r.settings.current),x.visible=r.view.settings.chromatin.visible,g.add(x),r.view.settings.chromatin.radius=x.boundingSphere.radius,r.view.settings.chromatin.tubed){var c=x.children[0].geometry.parameters.radius+.2*x.children[0].geometry.parameters.radius,l=new THREE.RingGeometry(c,c+1*c,50);T=new THREE.Mesh(l,new THREE.MeshBasicMaterial({color:16711680,side:THREE.DoubleSide})),g.add(T),S=new THREE.Mesh(l,new THREE.MeshBasicMaterial({color:16711680,side:THREE.DoubleSide})),S.visible=!1,g.add(S),I=new THREE.Mesh(l,new THREE.MeshBasicMaterial({color:16711680,side:THREE.DoubleSide})),I.visible=!1,g.add(I);var d=new THREE.Geometry;d.vertices.push(S.position),d.vertices.push(I.position),j=new THREE.Line(d,new THREE.LineDashedMaterial({color:16711680,linewidth:1,scale:1,dashSize:3,gapSize:2})),j.visible=!1,g.add(j),C=new THREE.Object3D;for(var u,h,p,m,f=0;f<r.data.tad_data.tads.length;f++){u=Math.round((r.data.tad_data.tads[f][1]-r.settings.current.chromStart[r.settings.current.chromIdx])/s),h=Math.round((r.data.tad_data.tads[f][2]-r.settings.current.chromStart[r.settings.current.chromIdx])/s),m=new THREE.Vector3;for(var v=u;h>=v;v++)m.add(k.geometry.vertices[v]);for(m.divideScalar(h-u+1),p=0,v=u;h>=v;v++)m.distanceTo(k.geometry.vertices[v])>p&&(p=m.distanceTo(k.geometry.vertices[v]));var b=new THREE.SphereGeometry(p-10,32,16),y=new THREE.MeshPhongMaterial({color:0,transparent:!0,blending:THREE.AdditiveBlending,opacity:.3}),w=new THREE.Mesh(b,y);w.material.emissive=new THREE.Color(0),w.position.x=m.x,w.position.y=m.y,w.position.z=m.z,C.add(w)}C.name="TADs cloud",g.add(C),_=g.getObjectByName("TADs cloud")}for(var R=r.data.data.length/r.data.object.components,M=i.gradientHCL(r.currentoverlay,R),A=a.getCluster(),H=[],P=0;P<A.length;P++){var D=a.getModel(A[P],r.settings.current.chromosomeIndexes),O=D.data;O?H.unshift(O):console.log("Listed model not found!")}E=new n(H,-1,M,r.view.settings.cluster),E.visible=r.view.settings.cluster.visible,E.name="Cluster View",g.add(E)},d=c[0].children[0].children[3],P=parseInt(r.state.width),D=parseInt(r.state.height),w=window.WebGLRenderingContext?new THREE.WebGLRenderer({alpha:!0,antialias:!1}):new THREE.CanvasRenderer({alpha:!0});var s=r.view.settings.background,R="0x"+s.substring(1);w.setClearColor(parseInt(R)),w.setSize(P,D),w.autoClear=!1,d.appendChild(w.domElement),g=new THREE.Scene,u=new THREE.PerspectiveCamera(r.view.viewpoint.fov,P/D,r.view.viewpoint.near,r.view.viewpoint.far),u.position.fromArray(r.view.viewpoint.camera),u.name="Scene Camera",g.add(u),y=new THREE.TrackballControls(u,w.domElement),b=new THREE.OrbitControls(u,w.domElement),b.autoRotate=r.view.controls.autoRotate,b.autoRotateSpeed=r.view.controls.autoRotateSpeed,b.enableZoom=!1,b.enableRotate=!1,b.enablePan=!1,b.enableKeys=!1;var O=new THREE.AxesHelper(r.view.settings.axis.size);O.visible=r.view.settings.axis.visible,O.name="Axis",g.add(O);var L=r.view.settings.lighting.ambient;f=new THREE.AmbientLight(L),f.name="Scene Ambient Light",g.add(f);var F=r.view.settings.lighting.color,z=r.view.settings.lighting.intensity;v=new THREE.PointLight(F,z),v.name="Scene Light",u.add(v),"undefined"!=typeof r.currentmodel.data&&r.currentmodel.data.length>0&&(r.complete_scene(),h=x.boundingSphere.center,p=x.boundingSphere.center,m=x.boundingSphere.radius*r.view.viewpoint.scale,r.lookAtTAD(h,p,m));var N=1.5*m;v.position.set(N,N,-1*N);var q=1e3,G=(new THREE.PointLightHelper(v,q),m*r.view.viewpoint.fogNear),V=m*r.view.viewpoint.fogFar;r.view.viewpoint.fog&&(g.fog=new THREE.Fog(s,G,V)),r.$watch("view.controls.autoRotate",function(t,e){t!==e&&(b.autoRotate=r.view.controls.autoRotate)}),r.$watch("view.settings.axis.visible",function(t,e){t!==e&&(O.visible=!O.visible)}),r.$watch("view.settings.particles.visible",function(t,e){t!==e&&(k.visible=!k.visible)}),r.$watch("view.settings.chromatin.visible",function(t,e){t!==e&&(x.visible=!x.visible)}),r.$watch("view.settings.cluster.visible",function(t,e){t!==e&&(E.visible=!E.visible)}),M=g.getObjectByName("Particles Cloud"),A=g.getObjectByName("Chromatin Fiber"),H=g.getObjectByName("Cluster View"),r.$watch("currentoverlay.colors.particles",function(t,e){}),r.$watch("data.object.radius_scale",function(t,e){t!==e&&r.toggleTubed(!0)}),r.$watch("currentoverlay.colors.chromatin",function(t,e){if("undefined"!=typeof A&&t!==e){var n,a,o,i=A.children.length;if(r.view.settings.chromatin.tubed)for(var s,c=(r.settings.current.segmentLength*r.settings.current.particleSegments,0),g=0;g<r.settings.current.chromosomeIndexes.length;g++){for(s=A.children[g].geometry,n=0;n<s.faces.length;n++){for(o=l.testIfHex(t[Math.floor(c/16)])||0===t[Math.floor(c/16)].indexOf("#")?new THREE.Color(t[Math.floor(c/16)]):new THREE.Color(l.nameToHex(t[Math.floor(c/16)])),a=0;16>a;a++)"undefined"!=typeof s.faces[n+a]&&s.faces[n+a].color.set(o);c++}s.colorsNeedUpdate=!0}else for(n=0;i>n;n++)o=new THREE.Color(t[n]),A.children[n].material.color=o,A.children[n].material.ambient=o,A.children[n].material.emissive=o}}),r.toggleTubed=function(t){r.clean_scene(),r.view.settings.chromatin.tubed=t,r.complete_scene(),r.view.settings.chromatin.tubed&&(_=g.getObjectByName("TADs cloud")),M=g.getObjectByName("Particles Cloud"),A=g.getObjectByName("Chromatin Fiber"),H=g.getObjectByName("Cluster View")},r.redraw_scene=function(){if("undefined"!=typeof r.currentmodel.data&&0!==r.currentmodel.data.length){r.clean_scene();var t=r.currentoverlay.colors.chromatin.slice();r.currentoverlay.colors.chromatin=t,o.segment(),r.complete_scene(),r.view.settings.chromatin.tubed&&(_=g.getObjectByName("TADs cloud")),M=g.getObjectByName("Particles Cloud"),A=g.getObjectByName("Chromatin Fiber"),H=g.getObjectByName("Cluster View"),h=x.boundingSphere.center,p=x.boundingSphere.center,m=x.boundingSphere.radius*r.view.viewpoint.scale,r.lookAtTAD(h,p,m);var e=1.5*m;v.position.set(e,e,-1*e);var n=m*r.view.viewpoint.fogNear,a=m*r.view.viewpoint.fogFar;g.fog.near=n,g.fog.far=a}},r.$watch("settings.current.chromosomeIndexes",function(t,e){t!==e&&r.redraw_scene()}),r.$watch("settings.current.tad_selected",function(t,e){if(t!==e&&A){var n;if(r.view.settings.chromatin.tubed){var a=_.children.length,o=new THREE.Color(16711680),i=new THREE.Color(0);for(n=0;a>n;n++)n==r.settings.current.tad_selected?(_.children[n].material.opacity=.2,_.children[n].material.emissive.set(o)):-1==t?_.visible=!1:(_.visible=!0,_.children[n].material.opacity=.3,_.children[n].material.color.set(i),_.children[n].material.emissive.set(i)),_.children[n].geometry.colorsNeedUpdate=!0}else{var s,c,l=A.children.length,g=r.settings.current.segmentLength*r.settings.current.particleSegments;for(t>-1&&(s=Math.round((r.data.tad_data.tads[t][1]-r.settings.current.chromStart[r.settings.current.chromIdx])/g)*r.settings.current.particleSegments,c=Math.round((r.data.tad_data.tads[t][2]-r.settings.current.chromStart[r.settings.current.chromIdx])/g)*r.settings.current.particleSegments),n=0;l>n;n++)A.children[n].material.opacity=n>=s&&c>=n?1:-1==t?1:.5}}}),r.$watch("settings.current.particle",function(t,e){t!==e&&M&&(U&&(M.geometry.colors[e-1]=U),U=M.geometry.colors[t-1],M.geometry.colors[t-1]=B,M.geometry.colorsNeedUpdate=!0)}),r.updateRingPosition=function(t,e,r){var n,a,o,i,s=0,c=0;if(e.length>1)n=e[0],a=r[0],s=e[1],c=r[1];else{for(n=e,a=r;A.children[s].geometry.vertices.length<8*(n+1);)n-=Math.floor(A.children[s].geometry.vertices.length/8-1),s++;for(;A.children[c].geometry.vertices.length<8*(a+1);)a-=Math.floor(A.children[c].geometry.vertices.length/8-1),c++}if(A.children[s].geometry.vertices.length>8*(n+1)+8){for(o=A.children[s].geometry.vertices[8*(n+1)],i=1;8>i;i++)o.add(A.children[s].geometry.vertices[8*(n+1)+i]);for(o.divideScalar(8),t.position.x=o.x,t.position.y=o.y,t.position.z=o.z,o=A.children[c].geometry.vertices[8*a],i=1;8>i;i++)o.add(A.children[c].geometry.vertices[8*a+i]);o.divideScalar(8),t.lookAt(o)}},r.$watch("settings.current.segment",function(t,e){if("undefined"!=typeof T&&(t!==e||0===T.position.x&&0===T.position.y&&0===T.position.z)){r.view.settings.chromatin.tubed&&r.updateRingPosition(T,t,e);var n=A.getObjectByName("segment-"+e);$&&n&&(n.material.color=$,n.material.ambient=$,n.material.emissive=$);var a=A.getObjectByName("segment-"+t);a&&($=a.material.color,a.material.color=B,a.material.ambient=B,a.material.emissive=B)}})},r.$watch("settings.current.markers_position",function(t,e){if(t!==e&&A&&r.view.settings.chromatin.tubed)if(angular.isUndefined(r.settings.current.markers_position)||-1===t[0]||-1===t[1])S.visible=!1,I.visible=!1,j.visible=!1,g.remove(R),R=void 0;else{var n=s.getSegment(r.settings.current.markers_position[1]),a=s.getSegment(r.settings.current.markers_position[0]),o=n>0?n-1:0,i=a>0?a-1:0;r.updateRingPosition(S,[n,r.settings.current.chromosomeIndexes.indexOf(r.settings.current.markers_chr[1])],[o,r.settings.current.chromosomeIndexes.indexOf(r.settings.current.markers_chr[1])]),r.updateRingPosition(I,[a,r.settings.current.chromosomeIndexes.indexOf(r.settings.current.markers_chr[0])],[i,r.settings.current.chromosomeIndexes.indexOf(r.settings.current.markers_chr[0])]),S.visible=!0,I.visible=!0,j.visible=!0,j.geometry.computeLineDistances(),j.geometry.verticesNeedUpdate=!0}}),r.onWindowResize=function(){r.resizeCanvas()},r.resizeCanvas=function(){O=parseInt(r.state.width),L=parseInt(r.state.height),u.aspect=O/L,u.updateProjectionMatrix(),w.setSize(O,L)},r.lookAtTAD=function(t,e,r){t=t||new THREE.Vector3(5e4,5e4,5e4);var n=new THREE.Vector3(0,0,0);e=e||n,r=r||500,u.position.set(t.x,t.y,t.z),u.lookAt(n),u.translateY(r),b.target=e,u.lookAt(e),u.updateMatrixWorld(),y.target.copy(t)},r.animate=function(){requestAnimationFrame(r.animate),b.update(),y.update(),r.render()},r.render=function(){w.render(g,u)},r.clean_scene=function(){var t;if("undefined"!=typeof A){if(g.remove(S),g.remove(I),g.remove(T),g.remove(j),g.remove(k),g.remove(x),g.remove(E),g.remove(M),g.remove(A),g.remove(H),k.geometry.dispose(),k.material.dispose(),M.geometry.dispose(),M.material.dispose(),r.view.settings.chromatin.tubed){for(g.remove(C),g.remove(_),t=0;t<C.children.length;t++)C.children[t].geometry.dispose(),C.children[t].material.dispose(),_.children[t].geometry.dispose(),_.children[t].material.dispose();C=void 0,_=void 0}else for(t=0;t<x.children.length;t++)x.children[t].geometry.dispose(),x.children[t].material.dispose(),A.children[t].geometry.dispose(),A.children[t].material.dispose();for(t=0;t<E.children.length;t++)E.children[t].geometry.dispose(),E.children[t].material.dispose(),H.children[t].geometry.dispose(),H.children[t].material.dispose();S=void 0,I=void 0,T=void 0,j=void 0,k=void 0,M=void 0,A=void 0,x=void 0,E=void 0,H=void 0}},r.$on("$destroy",function(){r.clean_scene()}),r.init(),r.animate()}}}}angular.module("TADkit").directive("tkComponentScene",t)}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n){t.d3().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var a,o,i,s,c,l,g,d,u,h,p,m,f,v=r.data,b=r.view.viewpoint.chromStart,y=r.view.viewpoint.chromEnd,w=r.settings.current.particlesCount,k=parseInt(r.view.settings.margin),x={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},E=parseInt(r.view.settings.heightInner),C=(r.view.settings.color,r.overlay.palette[0]),T=r.overlay.palette[1],S=n[0].parentNode,I=n[0].children[0].children[3],j=t.select(I).append("svg");r.$watch(function(){var t=S.clientWidth,e=S.clientHeight;return t+e},function(){r.render(v)}),r.$watch("data.dimension",function(t,e){t!==e&&(v=r.data,r.render(v))}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.getColor=function(t){for(var e=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=e.length-1;n>=0;n--)t==e[n].code&&(r=e[n].color);return r},r.getOpacity=function(t){var e,r=t/5;return e=r*r},r.getStrokeWidth=function(t){var e=10,r=t/5;return e*=r},r.render=function(e){if(j.selectAll("*").remove(),e){var n=S.clientWidth-2*k-x.left-x.right,v=E-x.top-x.bottom,I=1*n/w,R=I;a=t.scale.linear().range([0,n]).domain([b,y]).clamp(!0),o=t.scale.linear().domain([-5,5]).range([0,v]),i=t.svg.axis().scale(o).orient("left").ticks(6).outerTickSize(1);var M=2;s=t.svg.brush().x(a).extent([0,0]).on("brush",r.brushed),c=j.attr("width",n+x.left+x.right).attr("height",v+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(s),c.append("g").attr("class","y axis").append("line").attr("y1",o(0)).attr("y2",o(0)).attr("x1",0).attr("x2",n),c.select(".background").attr("y",v/2).attr("height",v),l=c.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",v).style("fill","white"),g=c.append("g").attr("class","focus"),d=g.append("g").attr("class","container").attr("clip-path","url(#clip)"),p=d.append("g").attr("class","harmonics"),m=d.append("g").attr("class","lowerbounds"),u=g.append("g").attr("class","axis y").call(i),h=c.append("g").attr("class","labels"),p.selectAll("rect").data(e.harmonics).enter().append("rect").attr("x",function(t){return t[1]*R}).attr("y",function(t){return o(t[3])}).attr("width",R).attr("height",function(t){return o(t[3])}).style("fill",C).style("stroke",C).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),m.selectAll("rect").data(e.lowerBounds).enter().append("rect").attr("x",function(t){return t[1]*R}).attr("y",function(t){return o(Math.max(0,-1*t[3]))}).attr("width",R).attr("height",function(t){return o(t[3])}).style("fill",T).style("stroke",T).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),f=c.append("rect").attr("id","highlight").attr("x",function(){return a(r.settings.current.position)}).attr("y",0).attr("width",M).attr("height",E).attr("class","highlight-follow")}},r.update=function(){j.select("#highlight").attr("x",function(){return a(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var o=s.extent()[0];t.event.sourceEvent&&(o=parseInt(a.invert(t.mouse(n)[0])),s.extent([o,o])),f.attr("x",a(o)),r.settings.current.position=o,r.settings.current.particle=e.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(v)})}}}angular.module("TADkit").directive("tkComponentTrackBarchart",t)}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(e,r){t.d3().then(function(t){var n,a,o,i,s,c,l,g=e.data,d=e.view.settings.step,u=e.view.viewpoint.chromStart,h=e.view.viewpoint.chromEnd,p=h-u,m=parseInt(e.view.settings.margin),f={top:parseInt(e.view.settings.padding.top),right:parseInt(e.view.settings.padding.right),bottom:parseInt(e.view.settings.padding.bottom),left:parseInt(e.view.settings.padding.left)},v=parseInt(e.view.settings.heightInner),b=.5*v,y=.5*(v-b),w=(e.view.settings.color,r[0].parentNode),k=r[0].children[0].children[3],x=t.select(k).append("svg");e.$watch(function(){var t=w.clientWidth,e=w.clientHeight;return t+e},function(){e.render(g)}),e.$watch("settings.current.position",function(){e.update()},!0);t.behavior.zoom().on("zoom",function(){e.update()});e.render=function(r){if(x.selectAll("*").remove(),r){var g=w.clientWidth-2*m-f.left-f.right,k=v-f.top-f.bottom;n=d*g/p,l=t.scale.linear().range([0,g]).clamp(!0),l.domain([u,h]),i=t.svg.axis().scale(l).orient("top").ticks(0).outerTickSize(0);var E=2;a=x.attr("width",g+f.left+f.right).attr("height",k+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),o=a.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",g).attr("height",k).style("fill","white"),s=a.append("g").attr("class","focus"),c=s.append("g").attr("class","container").attr("clip-path","url(#clip)");{a.append("g").attr("class","labels"),c.selectAll("rect").data(r).enter().append("rect").attr("x",function(t){return Math.floor(l(t.start))}).attr("y",y).attr("width",function(t){return Math.ceil(l(t.end)-l(t.start))}).attr("height",b).attr("class",function(t){return 1==t.read?e.title:void 0}).append("svg:title").text(function(t){return t.start+":"+t.end+"("+t.read+")"}),a.append("rect").attr("id","highlight").attr("x",function(){return l(e.settings.current.position-.5*d)}).attr("y",0).attr("width",E).attr("height",v).attr("class","highlight-follow")}}},e.update=function(){x.select("#highlight").attr("x",function(){return l(e.settings.current.position-.5*d)})}})}}}angular.module("TADkit").directive("tkComponentBedgraph",t)}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(e,r){t.d3().then(function(t){var n=e.data,a=32e8;e.settings.current.position||(e.settings.current.position=a/2);var o=e.view.viewpoint.chromStart,i=e.view.viewpoint.chromEnd,s=i-o,c=1e3,l=a/s,g=.05*l;l-=2*g;var d,u,h,p,m,f,v=.5*s,b=.5*a,y=parseInt(e.view.settings.margin),w={top:parseInt(e.view.settings.padding.top),right:parseInt(e.view.settings.padding.right),bottom:parseInt(e.view.settings.padding.bottom),left:parseInt(e.view.settings.padding.left)},k=parseInt(e.view.settings.heightInner),x=10,E=r[0].parentNode,C=r[0].children[0].children[3],T=t.select(C).append("svg");e.$watch(function(){var t=E.clientWidth,e=E.clientHeight;return t+e},function(){e.render(n)}),e.$watch("data",function(t,r){t!==r&&e.render(t)}),e.$watch("settings.current.position",function(t,r){t!==r&&e.update()});t.behavior.zoom().on("zoom",function(){e.update()});e.render=function(r){if(T.selectAll("*").remove(),r){var n=E.clientWidth-2*y-w.left-w.right,a=k-w.top-w.bottom;f=t.scale.linear().range([0,n]).clamp(!0),f.domain([o,i]),h=t.svg.axis().scale(f).orient("top").ticks(0).outerTickSize(0);{var s=2;f(b)-f(v)}d=T.attr("width",n+w.left+w.right).attr("height",a+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")"),u=d.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",a).style("fill","white"),p=d.append("g").attr("class","focus"),m=p.append("g").attr("class","container").attr("clip-path","url(#clip)");var l=(p.append("g").attr("class","x axis").attr("transform","translate(0,"+x+")").call(h),d.append("g").attr("class","labels"));l.append("text").attr("x",-18).attr("y",8).style("text-anchor","right").style("font-size","10px").text("<<"),l.append("text").attr("x",-18).attr("y",18).style("text-anchor","right").style("font-size","10px").text(">>");{m.selectAll("rect").data(r).enter().append("rect").attr("x",function(t){return Math.floor(f(t.start))}).attr("y",function(t){return e.view.settings.sense?t.strand<1?x:0:0}).attr("width",function(t){return Math.ceil(f(t.end)-f(t.start))}).attr("height",function(){return e.view.settings.sense?x:2*x}).attr("class",function(t){var e=t.biotypeStyle;return e+=t.strand<1?" forward-strand":" reverse-strand"}).append("svg:title").text(function(t){return t.external_name}),d.append("rect").attr("id","highlight").attr("x",function(){return f(e.settings.current.position-.5*c)}).attr("y",0).attr("width",s).attr("height",k).attr("class","highlight-follow")}}},e.update=function(){T.select("g.x.axis").call(h),m.selectAll("rect").attr("x",function(t){return Math.floor(f(t.start))}).attr("y",function(t){return e.view.settings.sense?t.strand<1?x:0:0}).attr("width",function(t){return Math.ceil(f(t.end)-f(t.start))}).attr("height",function(){return e.view.settings.sense?x:2*x}),T.select("#highlight").attr("x",function(){return f(e.settings.current.position-.5*c)})}})}}}angular.module("TADkit").directive("tkComponentTrackGenes",t)}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n){t.d3().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var a,o,i,s,c,l,g,d,u,h,p=r.data.distances,m=r.view.viewpoint.chromStart,f=r.view.viewpoint.chromEnd,v=r.settings.current.particlesCount,b="clip"+r.title,y="url(#"+b+")",w=parseInt(r.view.settings.margin),k={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},x=parseInt(r.view.settings.heightInner),E=.5*x,C=.5*(x-E),T=r.view.settings.color,S=n[0].parentNode,I=n[0].children[0].children[3],j=t.select(I).append("svg");r.$watch(function(){var t=S.clientWidth,e=S.clientHeight;return t+e},function(){r.render(p)}),r.$watch("data.dimension",function(t,e){t!==e&&(p=r.data.distances,r.render(p))}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.render=function(e){if(j.selectAll("*").remove(),e){var n=S.clientWidth-2*w-k.left-k.right,p=x-k.top-k.bottom,I=1*n/v;a=t.scale.linear().range([0,n]).clamp(!0),a.domain([m,f]),o=t.svg.axis().scale(a).orient("top").ticks(0).outerTickSize(0);var R=2;i=t.svg.brush().x(a).extent([0,0]).on("brush",r.brushed),s=j.attr("width",n+k.left+k.right).attr("height",p+k.top+k.bottom).append("g").attr("transform","translate("+k.left+","+k.top+")").call(i),s.select(".background").attr("y",p/2).attr("height",p),c=s.append("defs").append("clipPath").attr("id",b).append("rect").attr("width",n).attr("height",p).style("fill","white"),l=s.append("g").attr("class","focus"),g=l.append("g").attr("class","container").attr("clip-path",y),d=s.append("g").attr("class","labels"),u=g.selectAll("rect").data(e).enter().append("rect").attr("x",function(t,e){return e*I}).attr("y",C).attr("width",I).attr("height",E).style("fill",T).style("fill-opacity",function(t){return t*t}).style("stroke",T).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),h=s.append("rect").attr("id","highlight").attr("x",function(){return a(r.settings.current.position)}).attr("y",0).attr("width",R).attr("height",x).attr("class","highlight-follow"),h.call(i.extent([r.settings.current.position,0])).call(i.event)}},r.update=function(){j.select("#highlight").attr("x",function(){return a(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var o=i.extent()[0];t.event.sourceEvent&&(o=parseInt(a.invert(t.mouse(n)[0])),i.extent([o,o])),h.attr("x",a(o)),r.settings.current.position=o,r.settings.current.particle=e.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(p)})}}}angular.module("TADkit").directive("tkComponentTrackProximities",t)}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n){t.d3().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var a,o,i,s,c,l,g,d,u,h,p,m=r.data,f=r.view.viewpoint.chromStart,v=r.view.viewpoint.chromEnd,b=r.settings.current.particlesCount,y="clip"+r.title,w="url(#"+y+")",k=parseInt(r.view.settings.margin),x={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},E=2,C=parseInt(r.view.settings.heightInner),T=r.view.settings.nodeSize,S=x.top+.5*T,I=(r.view.settings.color,r.overlay.palette[0]),j=r.overlay.palette[1],R=n[0].parentNode,M=n[0].children[0].children[3],A=t.select(M).append("svg");r.$watch(function(){var t=R.clientWidth,e=R.clientHeight;return t+e},function(){r.render(r.data)}),r.$watch("data.dimension",function(t,e){t!==e&&(m=r.data,r.render(m))}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.getColor=function(t){for(var e=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=e.length-1;n>=0;n--)t==e[n].code&&(r=e[n].color);return r},r.getOpacity=function(t){var e,r=t/E;return e=r*r},r.getStrokeWidth=function(t){var e=5,r=t/5;return e*=r},r.render=function(e){if(A.selectAll("*").remove(),e){var n=R.clientWidth-2*k-x.left-x.right,m=C-x.top-x.bottom,E=1*n/b;a=t.scale.linear().range([0,n]).clamp(!0),a.domain([f,v]),o=t.svg.axis().scale(a).orient("top").ticks(0).outerTickSize(0),i=t.svg.axis().scale(a).orient("bottom").ticks(0).outerTickSize(0);var M=2;s=t.svg.brush().x(a).extent([0,0]).on("brush",r.brushed),c=A.attr("width",n+x.left+x.right).attr("height",m+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(s),c.select(".background").attr("y",m/2).attr("height",m),l=c.append("defs"),l.append("clipPath").attr("id",y).append("rect").attr("width",n).attr("height",m).style("fill","white"),g=c.append("g").attr("class","focus"),u=g.append("g").attr("class","harmonics").attr("clip-path",w),h=g.append("g").attr("class","lowerbounds").attr("clip-path",w),d=c.append("g").attr("class","labels"),u.append("rect").attr("x",e.dimension*E-E).attr("y",S-.5*T).attr("width",E).attr("height",T).style("fill",I).append("svg:title").text(e.dimension),u.selectAll("line").data(e.harmonics).enter().append("line").attr("x1",function(t){return t[0]*E-.5*E}).attr("y1",S).attr("x2",function(t){return t[1]*E-.5*E}).attr("y2",m-T).attr("marker-end","url(#harmonics-marker)").style("stroke",I).style("opacity",1).style("stroke-width",function(t){return r.getStrokeWidth(t[3])}).append("svg:title").text(function(t){return t[1]+":"+t[3]}),u.selectAll("circle").data(e.harmonics).enter().append("circle").attr("cx",function(t){return t[1]*E-.5*E}).attr("cy",m-T).attr("r",.5*T).style("opacity",function(t){return r.getOpacity(t[3])}).style("fill",I).append("svg:title").text(function(t){return t[0]+" : "+t[1]}),h.append("rect").attr("x",e.dimension*E-E).attr("y",m-1.5*T).attr("width",E).attr("height",T).style("fill",j).append("svg:title").text(e.dimension),h.selectAll("line").data(e.lowerBounds).enter().append("line").attr("x1",function(t){return t[0]*E-.5*E}).attr("y2",S).attr("x2",function(t){return t[1]*E-.5*E}).attr("y1",m-T).attr("marker-end","url(#lowerbounds-marker)").style("stroke",j).style("opacity",function(t){return r.getOpacity(t[3])}).style("stroke-width",function(t){return r.getStrokeWidth(t[3])}).append("svg:title").text(function(t){return t[1]+":"+t[3]}),h.selectAll("circle").data(e.lowerBounds).enter().append("circle").attr("cx",function(t){return t[1]*E-.5*E}).attr("cy",S).attr("r",.5*T).style("opacity",function(t){return r.getOpacity(t[3])}).style("fill",j).append("svg:title").text(function(t){return t[0]+" : "+t[1]}),p=c.append("rect").attr("id","highlight").attr("x",a(r.settings.current.position)).attr("y",0).attr("width",M).attr("height",C).attr("class","highlight-follow")}},r.update=function(){A.select("#highlight").attr("x",function(){return a(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var o=s.extent()[0];t.event.sourceEvent&&(o=parseInt(a.invert(t.mouse(n)[0])),s.extent([o,o])),p.attr("x",a(o)),r.settings.current.position=o,r.settings.current.particle=e.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(m)})}}}angular.module("TADkit").directive("tkComponentTrackRestraints",t)}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n){t.d3().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var a,o,i,s,c,l,g,d,u,h,p=(r.data,r.view.viewpoint.chromStart),m=r.view.viewpoint.chromEnd,f=(r.view.settings.cursorWidth,parseInt(r.view.settings.margin)),v={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},b=parseInt(r.view.settings.heightInner),y=n[0].parentNode,w=n[0].children[0].children[3],k=t.select(w).append("svg");r.$watch(function(){var t=y.clientWidth,e=y.clientHeight;return t+e},function(){r.render()}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.render=function(){k.selectAll("*").remove();var e=y.clientWidth-2*f-v.left-v.right,n=b-v.bottom-v.top;o=t.scale.linear().range([0,e]).clamp(!0),o.domain([p,m]),g=t.svg.axis().scale(o).orient("bottom").ticks(4),i=t.svg.axis().orient("left"),s=t.svg.axis().orient("right"),c=.5*n,l=b,d=t.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),a=k.attr("width",e+v.left+v.right).attr("height",n+v.top+v.bottom).append("g").attr("transform","translate("+v.left+", 0)");var w=a.append("g").attr("class","labels");w.append("text").attr("x",-16).attr("y",26).style("text-anchor","right").style("font-size","10px").text("3'"),w.append("text").attr("x",e+8).attr("y",26).style("text-anchor","left").style("font-size","10px").text("5'");
a.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(g).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");a.append("g").attr("class","slider").call(d),a.select(".background").attr("y",n/2).attr("height",n),u=a.append("circle").attr("id","handle").attr("class","handle").attr("cx",o(r.settings.current.position)).attr("cy",n).attr("r",.6*c),h=a.append("text").attr("id","position").attr("x",o(r.settings.current.position)-.5*c).attr("y",n-10).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text(r.settings.current.particle),a.call(d.extent([r.settings.current.position,0])).call(d.event)},r.update=function(){k.select("#handle").attr("cx",o(r.settings.current.position)),k.select("#position").attr("x",o(r.settings.current.position)-.5*c).text(r.settings.current.particle)},r.brushed=function(){var n=this;r.safeApply(function(){var a=d.extent()[0];t.event.sourceEvent&&(a=parseInt(o.invert(t.mouse(n)[0])),d.extent([a,a])),u.attr("cx",o(a)),r.settings.current.position=a,r.settings.current.particle=e.getParticle(),r.settings.current.segment=e.getSegment(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})}})}}}angular.module("TADkit").directive("tkComponentTrackSlider",t)}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(e,r){t.d3().then(function(t){var n,a,o,i,s,c,l,g=e.data,d=e.view.settings.step,u=e.view.viewpoint.chromStart,h=e.view.viewpoint.chromEnd,p=h-u,m=parseInt(e.view.settings.margin),f={top:parseInt(e.view.settings.padding.top),right:parseInt(e.view.settings.padding.right),bottom:parseInt(e.view.settings.padding.bottom),left:parseInt(e.view.settings.padding.left)},v=parseInt(e.view.settings.heightInner),b=.5*v,y=.5*(v-b),w=e.view.settings.color,k=r[0].parentNode,x=r[0].children[0].children[3],E=t.select(x).append("svg");e.$watch(function(){var t=k.clientWidth,e=k.clientHeight;return t+e},function(){e.render(g)}),e.$watch("settings.current.position",function(){e.update()},!0);t.behavior.zoom().on("zoom",function(){e.update()});e.render=function(r){if(E.selectAll("*").remove(),r){var g=k.clientWidth-2*m-f.left-f.right,x=v-f.top-f.bottom;n=d*g/p,l=t.scale.linear().range([0,g]).clamp(!0),l.domain([u,h]),i=t.svg.axis().scale(l).orient("top").ticks(0).outerTickSize(0);var C=2;a=E.attr("width",g+f.left+f.right).attr("height",x+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),o=a.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",g).attr("height",x).style("fill","white"),s=a.append("g").attr("class","focus"),c=s.append("g").attr("class","container").attr("clip-path","url(#clip)");{a.append("g").attr("class","labels"),c.selectAll("rect").data(r).enter().append("rect").attr("x",function(t,e){return(e+1)*n}).attr("y",y).attr("width",n).attr("height",b).style("fill",w).style("fill-opacity",function(t){return t}).style("stroke",w).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),a.append("rect").attr("id","highlight").attr("x",function(){return l(e.settings.current.position-.5*d)}).attr("y",0).attr("width",C).attr("height",v).attr("class","highlight-follow")}}},e.update=function(){E.select("#highlight").attr("x",function(){return l(e.settings.current.position-.5*d)})}})}}}angular.module("TADkit").directive("tkComponentWiggle0",t)}(),function(){"use strict";function t(t){t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState}}angular.module("TADkit").controller("TrackController",t)}(),function(){"use strict";function t(e,r,n,a,o,i){r.fileTitle="No file loaded",r.$on("$viewContentLoaded",function(){function o(){console.log("showing dialog")}var i=angular.element(document.body),s="assets/templates/"+e.current.name+".html";n.show({parent:i,templateUrl:s,controller:t,locals:{datasets:r.$parent.datasets},onComplete:o}).then(function(t){a.show(a.simple().content("Coordinates ("+t+") added"))},function(){a.show(a.simple().content("cancelled")),e.go("browser")})}),r.parseFile=function(t){r.fileData=i.parse(t).data,r.skipRows=0,r.bp_per_nm=.01,r.selectedCols=[];for(var e=r.fileData[0].length;--e>=0;)r.selectedCols[e]=!0;console.log("File Opened...")},r.importData=function(t){r.importedCoords=i.import(t,r.skipRows,r.bp_per_nm,r.selectedCols),n.hide(r.importedCoords);var a=o.get(),s=(i.getDataset(),i.setModel(i.getCentroid(),a.current.chromosomeIndexes),a.current.chromosomeIndexes.slice());a.current.chromosomeIndexes=s,e.go("browser")},r.hide=function(){n.hide(r.DatasAcquired)},r.cancel=function(){n.cancel()}}angular.module("TADkit").controller("DataImportController",t)}(),function(){"use strict";function t(){return{restrict:"A",scope:{tkDataImport:"&",filetitle:"="},link:function(t,e){e.on("change",function(e){var r=new FileReader;r.onload=function(e){t.$apply(function(){t.tkDataImport({$fileContent:e.target.result})})},r.readAsText((e.srcElement||e.target).files[0]),t.filetitle=(e.srcElement||e.target).files[0].name})}}}angular.module("TADkit").directive("tkDataImport",t)}(),function(){"use strict";function t(e,r,n,a,o,i,s,c,l){var g=l.get(),d=c.get();n.maxFreq=d.max,n.minFreq=d.min;var u=n.$parent.settings.current,h=u.segmentLength*u.particleSegments;n.resolution=h,n.TrackList=[];var p;for(p=0;p<g.length;p++)n.TrackList.push(g[p].track_name);n.func=e.func,n.gridOptions={enableGridMenu:!1,enableFiltering:!0,enableColumnResizing:!0,exporterCsvFilename:"tadkit_export.csv",onRegisterApi:function(t){n.gridApi=t}},n.intThreshold=Math.round((n.maxFreq-n.minFreq)/2),n.minDistance=h,n.$on("$viewContentLoaded",function(){function e(){console.log("showing dialog")}var i=angular.element(document.body),s="assets/templates/"+r.current.name+".html";a.show({parent:i,clickOutsideToClose:!1,scope:n,preserveScope:!0,templateUrl:s,controller:t,onComplete:e}).then(function(){o.show(o.simple().content("closed")),r.go("browser")})}),n.refresh=function(t){var e,r,a,i;if(n.gridOptions.data=[],"Features by bin"==t){for(e=0;e<g.length;e++)if(g[e].track_name==n.selTrack)for(r=0;r<u.chromosomeIndexes.length;r++)for(a=u.chromStart[r];a<u.chromEnd[r];a+=h)for(i=0;i<g[e].feature.length;i++)a+h>=g[e].feature[i].start&&a<=g[e].feature[i].end&&g[e].feature[i].chr.replace("chr","")==u.chromosomeIndexes[r].replace("chr","")&&n.gridOptions.data.push({Chromosome:u.chromosomeIndexes[r],Locus:a,id:g[e].feature[i].id,Name:g[e].feature[i].name,Start:g[e].feature[i].start,End:g[e].feature[i].end,Strand:g[e].feature[i].strand,Value:g[e].feature[i].value})}else if("Interacting features"==t){var s,c,l,p,m,f,v,b,y,w,k=0,x=0,E=0,C=function(t){return this.locus_pos+h>=t.start&&this.locus_pos<=t.end&&t.chr.replace("chr","")==this.locus_chr.replace("chr","")},T=function(t){return"name"in t?t.name:"id"in t?t.id:"value"in t?t.value:"color"in t?t.color:void 0};for(r=0;r<g.length;r++)g[r].track_name==n.selTrack&&(y=g[r]);for(r=0;r<g.length;r++)g[r].track_name==n.selTrack2&&(w=g[r]);for(e=0;e<d.value.length;e++)if(!(n.intThreshold>d.value[e]||(l=Math.floor(d.pos[e]%d.n),k=Math.floor(d.pos[e]/d.n),k>l))){for(x=0,E=0;l>=x;)s=(l-x)*h+u.chromStart[E],x+=Math.round(u.chromEnd[E]/h)-Math.round(u.chromStart[E]/h),E++;for(p=u.chromosomeIndexes[E-1],x=0,E=0;k>=x;)c=(k-x)*h+u.chromStart[E],x+=Math.round(u.chromEnd[E]/h)-Math.round(u.chromStart[E]/h),E++;m=u.chromosomeIndexes[E-1],p==m&&Math.abs(s-c)<=n.minDistance||(b={locus_pos:s,locus_chr:p},f=y.feature.filter(C,b),b={locus_pos:c,locus_chr:m},v=w.feature.filter(C,b),0!=f.length&&0!=v.length&&n.gridOptions.data.push({"Chromosome 1":p,"Locus 1":s,"Chromosome 2":m,"Locus 2":c,"Interaction freq,":d.value[e],"Features 1":f.map(T).join(","),"Features 2":v.map(T).join(",")}))}}o.show(o.simple().content(n.gridOptions.data.length+" records retrieved"))},n.export=function(t){var e=n.gridApi.core.getVisibleRows(n.gridApi.grid),r=[];e.forEach(function(t){r.push(t.entity)});var a=XLSX.utils.json_to_sheet(r),o=XLSX.utils.sheet_to_csv(a,{FS:"	"});saveAs(new Blob([o],{type:"attachment/csv;charset=utf-8;"}),t+".tsv")},n.cancel=function(){a.hide()}}angular.module("TADkit").controller("DataMiningController",t)}(),function(){"use strict";function t(){return{restrict:"A",scope:{tkDataMining:"&"},link:function(){}}}angular.module("TADkit").directive("tkDataMining",t)}(),function(){"use strict";function t(){}angular.module("TADkit").controller("HomeController",t)}(),function(){"use strict";function t(t,e,r,n,a,o){e.settings||(e.settings=r.get()),e.settings.app.isProject=t.is("project"),e.$on("$stateChangeSuccess",function(){e.settings.app.isProject=t.is("project")}),e.current={},e.current.user=o.getUser(),e.current.overlay=n.getOverlay(),e.current.storyboard=a.getStoryboard()}angular.module("TADkit").controller("MainController",t)}(),function(){"use strict";function t(e,r,n,a,o,i){r.fileTitle="No file loaded",r.$on("$viewContentLoaded",function(){function o(){console.log("showing dialog")}var i=angular.element(document.body),s="assets/templates/"+e.current.name+".html";n.show({parent:i,templateUrl:s,controller:t,locals:{overlays:r.$parent.overlays},onComplete:o}).then(function(t){a.show(a.simple().content("Overlays ("+t+") added"))},function(){a.show(a.simple().content("cancelled")),e.go("browser")})}),r.parseFile=function(t){r.fileData=i.parse(t).data,r.selectedRows=[];for(var e=r.fileData.length;--e>=0;)r.selectedRows[e]=!0;r.selectedCols=[];for(var n=r.fileData[0].length;--n>=0;)r.selectedCols[n]=!0;console.log("File Opened...")},r.importData=function(t){r.importedOverlays=i.import(t,r.selectedRows,r.selectedCols),n.hide(r.importedOverlays.length),e.go("browser")},r.hide=function(){n.hide(r.overlaysAcquired)},r.cancel=function(){n.cancel()}}angular.module("TADkit").controller("OverlayImportController",t)}(),function(){"use strict";function t(){return{restrict:"A",scope:{tkOverlayImport:"&",filetitle:"="},link:function(t,e){e.on("change",function(e){var r=new FileReader;r.onload=function(e){t.$apply(function(){t.tkOverlayImport({$fileContent:e.target.result})})},r.readAsText((e.srcElement||e.target).files[0]),t.filetitle=(e.srcElement||e.target).files[0].name})}}}angular.module("TADkit").directive("tkOverlayImport",t)}(),function(){"use strict";function t(){}angular.module("TADkit").controller("ProjectContentController",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i){if(e.current.dataset=n.getDataset(),e.current.dataset.models.length>0){e.current.model=n.getModel(n.getCentroid(),e.current.dataset.object.chrom),e.clusterComponent=o.getComponentById("datasets-scene-icon");var s=a.getOverlayById("gradient"),c=e.current.model.data.length/e.current.dataset.object.components,l=i.gradientHCL(s,c);e.clusterComponent.overlay=l;for(var g=new THREE.BufferGeometry,d=e.current.dataset.models.length-1;d>=0;d--)g.addAttribute("position",new THREE.BufferAttribute(e.current.dataset.models[d],3));g.computeBoundingSphere(),e.clusterComponent.view.viewpoint.translate=g.boundingSphere.radius,e.clusters=[];for(var u=e.current.dataset.clusters,h=e.current.dataset.models,p=u.length-1;p>=0;p--){var m={};m.number=p+1,m.list=u[p],m.centroidIndex=m.list.indexOf(n.getCentroid(m.number)),m.data=[];for(var f=m.list.length-1;f>=0;f--){for(var v,b=h.length-1;b>=0;b--){var y=n.getModel(h[b].ref,e.current.dataset.object.chrom);parseInt(y.ref)==m.list[f]&&(v=y.data)}v?m.data.unshift(v):console.log("Listed model not found!")}e.clusters.unshift(m)}e.currentPage=0,e.pageSize=10,e.numberOfPages=function(){return Math.ceil(e.clusters.length/e.pageSize)},e.selectCluster=function(r){e.clusterArray=n.setCluster(r+1),e.centroidRef=n.getCentroid(),e.current.model=n.getModel(),console.log("Current Cluster: "+(r+1)+"(Centroid Model: "+e.centroidRef+")"),t.go("browser")}}else t.go("browser")}angular.module("TADkit").filter("startFrom",function(){return function(t,e){return e=+e,t.slice(e)}}).controller("ProjectDatasetController",t)}(),function(){"use strict";function t(t,e){return{restrict:"A",link:function(t,r,n){var a=n.dropzone,o=e(a),i=function(t){t.preventDefault(),r.addClass("dragOver")},s=function(t){t.preventDefault(),r.removeClass("dragOver")},c=function(e){var r=new FileReader;r.onload=function(e){t.$apply(function(){o(t,{$fileContent:e.target.result}),t.addDataset(e.target.result)})},r.readAsText(e),console.log("File loaded...")};r.bind("dragover",i).bind("dragleave",s).bind("drop",function(e){s(e),0===e.dataTransfer.files.length?t.showAdvanced():c(e.dataTransfer.files[0])}),t.$watch(a,function(){r.attr("src",o(t))}),t.loadFile=c}}}angular.module("TADkit").directive("tkProjectDropzone",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i,s){n.updateCurrent=function(){delete n.settings.current.tad_selected,n.current.dataset=a.getDataset(),n.current.model=a.getModel();for(var t=o.get();t.loaded.length>1;)t.loaded.pop();o.set(0),n.current.overlay=o.getOverlay(),n.current.components=i.load(),n.current.storyboards=s.load(),n.current.storyboard=s.getStoryboard(),console.log("Current dataset, model, overlay and storyboard updated.")},n.addDataset=function(e){var o=a.add(e);return t.all([o]).then(function(){n.updateCurrent(),console.log("Dataset added."),n.current.dataset.models.length>0?r.go("dataset"):r.go("browser")})},n.cleanDataset=function(){r.go("dataset",{conf:"assets/examples/conf.json"})}}angular.module("TADkit").controller("ProjectLoaderController",t)}(),function(){"use strict";function t(t,e){return{restrict:"A",scope:!1,link:function(t,r,n){var a=e(n.tkProjectLoader);r.on("change",function(e){var r=new FileReader;r.onload=function(e){console.log("Data Loaded"),t.$apply(function(){a(t,{$fileContent:e.target.result})})},r.readAsText((e.srcElement||e.target).files[0])})}}}angular.module("TADkit").directive("tkProjectLoader",t)}(),function(){"use strict";function t(){}angular.module("TADkit").controller("ProjectOverlayController",t)}(),function(){"use strict";function t(){}angular.module("TADkit").controller("ProjectStoryboardController",t)}(),function(){"use strict";function t(t,e){t.toggleSetting=function(r){t.settings=e.toggle(r)}}angular.module("TADkit").controller("SidebarBrowserController",t)}(),function(){"use strict";function t(t,e,r,n){t.setCurrentDataset=function(t){e.set(t)},t.setCurrentOverlay=function(t){r.set(t)},t.setCurrentStoryboard=function(t){n.set(t)}}angular.module("TADkit").controller("SidebarProjectController",t)}(),function(){"use strict";function t(){}angular.module("TADkit").controller("SidebarUserController",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i,s,c,l,g,d,u){angular.element(t).on("resize",function(){e.$apply()}),e.current.dataset=u.getDataset(),e.current.model=u.getModel(),s.segment(),e.current.overlay=s.getOverlay(),e.current.storyboard=o.getStoryboard();var h=u.get();return 0===h.loaded.length?(r.go("loader",{conf:n.conf}),void 0):(e.settings.views.scale=1,o.setViewpoint(e.settings.current.chromStart,e.settings.current.chromEnd,e.settings.views.scale),i.setViewpoint(e.settings.current.chromStart,e.settings.current.chromEnd,e.settings.views.scale),e.allProximities=c.get(),e.current.dataset.models.length>0&&(e.currentProximities=c.at(e.settings.current.particle),e.currentRestraints=l.at(e.settings.current.particle)),angular.forEach(e.current.storyboard.components,function(t){var r,n;"scene"==t.object.type?(n={tad_data:g.get(),data:e.current.model.data,object:e.current.dataset.object},t.data=n,t.proximities=e.allProximities,t.overlay=e.current.overlay,t.overlay.state={},t.overlay.object.state.index=s.getCurrentIndex()):"track-genes"==t.object.type||"panel-inspector"==t.object.type?(n={tad_data:g.get(),track_data:d.get(),data:[],object:e.current.dataset.object},angular.isUndefined(e.current.model)||(n.data=e.current.model.data),t.data=n,t.overlay=r):"track-proximities"==t.object.type?(t.data=e.currentProximities,r=s.getOverlayById("proximities"),t.overlay=r):"track-restraints"==t.object.type?(t.data=e.currentRestraints,r=s.getOverlayById("restraints"),t.overlay=r):"panel-hicdata"==t.object.type?t.data=g.get():("panel-jbrowse"==t.object.type||"panel-igvjs"==t.object.type)&&(n={tad_data:g.get(),data:e.currentRestraints},t.data=n,r=s.getOverlayById("restraints"),t.overlay=r)}),e.$watch("settings.current.particle",function(t,r){t!==r&&"matrix"==e.current.overlay.object.type&&(s.at(t),e.current.overlay=s.getOverlay())}),e.overlayOrig=e.current.overlay,e.toggleOverlay=function(t){e.overlaid=s.getOverlay(t).object.state.overlaid,e.overlaid?(s.setOverlaid(e.overlayOrig.object.state.index),s.set(e.overlayOrig.object.state.index),e.current.overlay=s.getOverlay()):(s.setOverlaid(t),s.set(t),e.current.overlay=s.getOverlay())},e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState},e.toggle=function(t){t=!t,console.log(t)},e.testfn=function(){console.log("test worked")},void 0)}angular.module("TADkit").controller("StoryboardController",t)}(),function(){"use strict";function t(t,e,r){e.$state=t,t.includes("main.project")&&(e.projectTitle=e.users[0].projects[0].object.title),e.toggleLeft=function(){r("left").toggle()},e.toggleRight=function(){r("right").toggle()},e.showDatasetCluster=t.includes("browser"),e.$watch("current.model",function(t){"undefined"==typeof t&&(e.showDatasetCluster=!1)})}angular.module("TADkit").controller("TopbarController",t)}(),function(){"use strict";function t(){var t={};return t.re_={x11rgb:/^\s*rgb:([a-f0-9]{1,4})\/([a-f0-9]{1,4})\/([a-f0-9]{1,4})\s*$/i},t.colorNames={transparent:"rgb(0, 0, 0)",rust:"rgb(243, 137, 92)",stripes:"rgb(255, 54, 54)",dark_blue:"rgb(0, 0, 139)",contigblue1:"rgb(0, 0, 139)",contigblue2:"rgb(173, 216, 230)","border:grey70":"rgb(179, 179, 179)",aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",antiquewhite1:"rgb(255, 239, 219)",antiquewhite2:"rgb(238, 223, 204)",antiquewhite3:"rgb(205, 192, 176)",antiquewhite4:"rgb(139, 131, 120)",aquamarine:"rgb(127, 255, 212)",aquamarine1:"rgb(127, 255, 212)",aquamarine2:"rgb(118, 238, 198)",aquamarine3:"rgb(102, 205, 170)",aquamarine4:"rgb(69, 139, 116)",azure:"rgb(240, 255, 255)",azure1:"rgb(240, 255, 255)",azure2:"rgb(224, 238, 238)",azure3:"rgb(193, 205, 205)",azure4:"rgb(131, 139, 139)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",bisque1:"rgb(255, 228, 196)",bisque2:"rgb(238, 213, 183)",bisque3:"rgb(205, 183, 158)",bisque4:"rgb(139, 125, 107)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blue1:"rgb(0, 0, 255)",blue2:"rgb(0, 0, 238)",blue3:"rgb(0, 0, 205)",blue4:"rgb(0, 0, 139)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",brown1:"rgb(255, 64, 64)",brown2:"rgb(238, 59, 59)",brown3:"rgb(205, 51, 51)",brown4:"rgb(139, 35, 35)",burlywood:"rgb(222, 184, 135)",burlywood1:"rgb(255, 211, 155)",burlywood2:"rgb(238, 197, 145)",burlywood3:"rgb(205, 170, 125)",burlywood4:"rgb(139, 115, 85)",cadetblue:"rgb(95, 158, 160)",cadetblue1:"rgb(152, 245, 255)",cadetblue2:"rgb(142, 229, 238)",cadetblue3:"rgb(122, 197, 205)",cadetblue4:"rgb(83, 134, 139)",chartreuse:"rgb(127, 255, 0)",chartreuse1:"rgb(127, 255, 0)",chartreuse2:"rgb(118, 238, 0)",chartreuse3:"rgb(102, 205, 0)",chartreuse4:"rgb(69, 139, 0)",chocolate:"rgb(210, 105, 30)",chocolate1:"rgb(255, 127, 36)",chocolate2:"rgb(238, 118, 33)",chocolate3:"rgb(205, 102, 29)",chocolate4:"rgb(139, 69, 19)",coral:"rgb(255, 127, 80)",coral1:"rgb(255, 114, 86)",coral2:"rgb(238, 106, 80)",coral3:"rgb(205, 91, 69)",coral4:"rgb(139, 62, 47)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",cornsilk1:"rgb(255, 248, 220)",cornsilk2:"rgb(238, 232, 205)",cornsilk3:"rgb(205, 200, 177)",cornsilk4:"rgb(139, 136, 120)",cyan:"rgb(0, 255, 255)",cyan1:"rgb(0, 255, 255)",cyan2:"rgb(0, 238, 238)",cyan3:"rgb(0, 205, 205)",cyan4:"rgb(0, 139, 139)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgoldenrod1:"rgb(255, 185, 15)",darkgoldenrod2:"rgb(238, 173, 14)",darkgoldenrod3:"rgb(205, 149, 12)",darkgoldenrod4:"rgb(139, 101, 8)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkolivegreen1:"rgb(202, 255, 112)",darkolivegreen2:"rgb(188, 238, 104)",darkolivegreen3:"rgb(162, 205, 90)",darkolivegreen4:"rgb(110, 139, 61)",darkorange:"rgb(255, 140, 0)",darkorange1:"rgb(255, 127, 0)",darkorange2:"rgb(238, 118, 0)",darkorange3:"rgb(205, 102, 0)",darkorange4:"rgb(139, 69, 0)",darkorchid:"rgb(153, 50, 204)",darkorchid1:"rgb(191, 62, 255)",darkorchid2:"rgb(178, 58, 238)",darkorchid3:"rgb(154, 50, 205)",darkorchid4:"rgb(104, 34, 139)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkseagreen1:"rgb(193, 255, 193)",darkseagreen2:"rgb(180, 238, 180)",darkseagreen3:"rgb(155, 205, 155)",darkseagreen4:"rgb(105, 139, 105)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategray1:"rgb(151, 255, 255)",darkslategray2:"rgb(141, 238, 238)",darkslategray3:"rgb(121, 205, 205)",darkslategray4:"rgb(82, 139, 139)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",debianred:"rgb(215, 7, 81)",deeppink:"rgb(255, 20, 147)",deeppink1:"rgb(255, 20, 147)",deeppink2:"rgb(238, 18, 137)",deeppink3:"rgb(205, 16, 118)",deeppink4:"rgb(139, 10, 80)",deepskyblue:"rgb(0, 191, 255)",deepskyblue1:"rgb(0, 191, 255)",deepskyblue2:"rgb(0, 178, 238)",deepskyblue3:"rgb(0, 154, 205)",deepskyblue4:"rgb(0, 104, 139)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",dodgerblue1:"rgb(30, 144, 255)",dodgerblue2:"rgb(28, 134, 238)",dodgerblue3:"rgb(24, 116, 205)",dodgerblue4:"rgb(16, 78, 139)",firebrick:"rgb(178, 34, 34)",firebrick1:"rgb(255, 48, 48)",firebrick2:"rgb(238, 44, 44)",firebrick3:"rgb(205, 38, 38)",firebrick4:"rgb(139, 26, 26)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",gold1:"rgb(255, 215, 0)",gold2:"rgb(238, 201, 0)",gold3:"rgb(205, 173, 0)",gold4:"rgb(139, 117, 0)",goldenrod:"rgb(218, 165, 32)",goldenrod1:"rgb(255, 193, 37)",goldenrod2:"rgb(238, 180, 34)",goldenrod3:"rgb(205, 155, 29)",goldenrod4:"rgb(139, 105, 20)",gray:"rgb(190, 190, 190)",gray0:"rgb(0, 0, 0)",gray1:"rgb(3, 3, 3)",gray10:"rgb(26, 26, 26)",gray100:"rgb(255, 255, 255)",gray11:"rgb(28, 28, 28)",gray12:"rgb(31, 31, 31)",gray13:"rgb(33, 33, 33)",gray14:"rgb(36, 36, 36)",gray15:"rgb(38, 38, 38)",gray16:"rgb(41, 41, 41)",gray17:"rgb(43, 43, 43)",gray18:"rgb(46, 46, 46)",gray19:"rgb(48, 48, 48)",gray2:"rgb(5, 5, 5)",gray20:"rgb(51, 51, 51)",gray21:"rgb(54, 54, 54)",gray22:"rgb(56, 56, 56)",gray23:"rgb(59, 59, 59)",gray24:"rgb(61, 61, 61)",gray25:"rgb(64, 64, 64)",gray26:"rgb(66, 66, 66)",gray27:"rgb(69, 69, 69)",gray28:"rgb(71, 71, 71)",gray29:"rgb(74, 74, 74)",gray3:"rgb(8, 8, 8)",gray30:"rgb(77, 77, 77)",gray31:"rgb(79, 79, 79)",gray32:"rgb(82, 82, 82)",gray33:"rgb(84, 84, 84)",gray34:"rgb(87, 87, 87)",gray35:"rgb(89, 89, 89)",gray36:"rgb(92, 92, 92)",gray37:"rgb(94, 94, 94)",gray38:"rgb(97, 97, 97)",gray39:"rgb(99, 99, 99)",gray4:"rgb(10, 10, 10)",gray40:"rgb(102, 102, 102)",gray41:"rgb(105, 105, 105)",gray42:"rgb(107, 107, 107)",gray43:"rgb(110, 110, 110)",gray44:"rgb(112, 112, 112)",gray45:"rgb(115, 115, 115)",gray46:"rgb(117, 117, 117)",gray47:"rgb(120, 120, 120)",gray48:"rgb(122, 122, 122)",gray49:"rgb(125, 125, 125)",gray5:"rgb(13, 13, 13)",gray50:"rgb(127, 127, 127)",gray51:"rgb(130, 130, 130)",gray52:"rgb(133, 133, 133)",gray53:"rgb(135, 135, 135)",gray54:"rgb(138, 138, 138)",gray55:"rgb(140, 140, 140)",gray56:"rgb(143, 143, 143)",gray57:"rgb(145, 145, 145)",gray58:"rgb(148, 148, 148)",gray59:"rgb(150, 150, 150)",gray6:"rgb(15, 15, 15)",gray60:"rgb(153, 153, 153)",gray61:"rgb(156, 156, 156)",gray62:"rgb(158, 158, 158)",gray63:"rgb(161, 161, 161)",gray64:"rgb(163, 163, 163)",gray65:"rgb(166, 166, 166)",gray66:"rgb(168, 168, 168)",gray67:"rgb(171, 171, 171)",gray68:"rgb(173, 173, 173)",gray69:"rgb(176, 176, 176)",gray7:"rgb(18, 18, 18)",gray70:"rgb(179, 179, 179)",gray71:"rgb(181, 181, 181)",gray72:"rgb(184, 184, 184)",gray73:"rgb(186, 186, 186)",gray74:"rgb(189, 189, 189)",gray75:"rgb(191, 191, 191)",gray76:"rgb(194, 194, 194)",gray77:"rgb(196, 196, 196)",gray78:"rgb(199, 199, 199)",gray79:"rgb(201, 201, 201)",gray8:"rgb(20, 20, 20)",gray80:"rgb(204, 204, 204)",gray81:"rgb(207, 207, 207)",gray82:"rgb(209, 209, 209)",gray83:"rgb(212, 212, 212)",gray84:"rgb(214, 214, 214)",gray85:"rgb(217, 217, 217)",gray86:"rgb(219, 219, 219)",gray87:"rgb(222, 222, 222)",gray88:"rgb(224, 224, 224)",gray89:"rgb(227, 227, 227)",gray9:"rgb(23, 23, 23)",gray90:"rgb(229, 229, 229)",gray91:"rgb(232, 232, 232)",gray92:"rgb(235, 235, 235)",gray93:"rgb(237, 237, 237)",gray94:"rgb(240, 240, 240)",gray95:"rgb(242, 242, 242)",gray96:"rgb(245, 245, 245)",gray97:"rgb(247, 247, 247)",gray98:"rgb(250, 250, 250)",gray99:"rgb(252, 252, 252)",green:"rgb(0, 255, 0)",green1:"rgb(0, 255, 0)",green2:"rgb(0, 238, 0)",green3:"rgb(0, 205, 0)",green4:"rgb(0, 139, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(190, 190, 190)",grey0:"rgb(0, 0, 0)",grey1:"rgb(3, 3, 3)",grey10:"rgb(26, 26, 26)",grey100:"rgb(255, 255, 255)",grey11:"rgb(28, 28, 28)",grey12:"rgb(31, 31, 31)",grey13:"rgb(33, 33, 33)",grey14:"rgb(36, 36, 36)",grey15:"rgb(38, 38, 38)",grey16:"rgb(41, 41, 41)",grey17:"rgb(43, 43, 43)",grey18:"rgb(46, 46, 46)",grey19:"rgb(48, 48, 48)",grey2:"rgb(5, 5, 5)",grey20:"rgb(51, 51, 51)",grey21:"rgb(54, 54, 54)",grey22:"rgb(56, 56, 56)",grey23:"rgb(59, 59, 59)",grey24:"rgb(61, 61, 61)",grey25:"rgb(64, 64, 64)",grey26:"rgb(66, 66, 66)",grey27:"rgb(69, 69, 69)",grey28:"rgb(71, 71, 71)",grey29:"rgb(74, 74, 74)",grey3:"rgb(8, 8, 8)",grey30:"rgb(77, 77, 77)",grey31:"rgb(79, 79, 79)",grey32:"rgb(82, 82, 82)",grey33:"rgb(84, 84, 84)",grey34:"rgb(87, 87, 87)",grey35:"rgb(89, 89, 89)",grey36:"rgb(92, 92, 92)",grey37:"rgb(94, 94, 94)",grey38:"rgb(97, 97, 97)",grey39:"rgb(99, 99, 99)",grey4:"rgb(10, 10, 10)",grey40:"rgb(102, 102, 102)",grey41:"rgb(105, 105, 105)",grey42:"rgb(107, 107, 107)",grey43:"rgb(110, 110, 110)",grey44:"rgb(112, 112, 112)",grey45:"rgb(115, 115, 115)",grey46:"rgb(117, 117, 117)",grey47:"rgb(120, 120, 120)",grey48:"rgb(122, 122, 122)",grey49:"rgb(125, 125, 125)",grey5:"rgb(13, 13, 13)",grey50:"rgb(127, 127, 127)",grey51:"rgb(130, 130, 130)",grey52:"rgb(133, 133, 133)",grey53:"rgb(135, 135, 135)",grey54:"rgb(138, 138, 138)",grey55:"rgb(140, 140, 140)",grey56:"rgb(143, 143, 143)",grey57:"rgb(145, 145, 145)",grey58:"rgb(148, 148, 148)",grey59:"rgb(150, 150, 150)",grey6:"rgb(15, 15, 15)",grey60:"rgb(153, 153, 153)",grey61:"rgb(156, 156, 156)",grey62:"rgb(158, 158, 158)",grey63:"rgb(161, 161, 161)",grey64:"rgb(163, 163, 163)",grey65:"rgb(166, 166, 166)",grey66:"rgb(168, 168, 168)",grey67:"rgb(171, 171, 171)",grey68:"rgb(173, 173, 173)",grey69:"rgb(176, 176, 176)",grey7:"rgb(18, 18, 18)",grey70:"rgb(179, 179, 179)",grey71:"rgb(181, 181, 181)",grey72:"rgb(184, 184, 184)",grey73:"rgb(186, 186, 186)",grey74:"rgb(189, 189, 189)",grey75:"rgb(191, 191, 191)",grey76:"rgb(194, 194, 194)",grey77:"rgb(196, 196, 196)",grey78:"rgb(199, 199, 199)",grey79:"rgb(201, 201, 201)",grey8:"rgb(20, 20, 20)",grey80:"rgb(204, 204, 204)",grey81:"rgb(207, 207, 207)",grey82:"rgb(209, 209, 209)",grey83:"rgb(212, 212, 212)",grey84:"rgb(214, 214, 214)",grey85:"rgb(217, 217, 217)",grey86:"rgb(219, 219, 219)",grey87:"rgb(222, 222, 222)",grey88:"rgb(224, 224, 224)",grey89:"rgb(227, 227, 227)",grey9:"rgb(23, 23, 23)",grey90:"rgb(229, 229, 229)",grey91:"rgb(232, 232, 232)",grey92:"rgb(235, 235, 235)",grey93:"rgb(237, 237, 237)",grey94:"rgb(240, 240, 240)",grey95:"rgb(242, 242, 242)",grey96:"rgb(245, 245, 245)",grey97:"rgb(247, 247, 247)",grey98:"rgb(250, 250, 250)",grey99:"rgb(252, 252, 252)",honeydew:"rgb(240, 255, 240)",honeydew1:"rgb(240, 255, 240)",honeydew2:"rgb(224, 238, 224)",honeydew3:"rgb(193, 205, 193)",honeydew4:"rgb(131, 139, 131)",hotpink:"rgb(255, 105, 180)",hotpink1:"rgb(255, 110, 180)",hotpink2:"rgb(238, 106, 167)",hotpink3:"rgb(205, 96, 144)",hotpink4:"rgb(139, 58, 98)",indianred:"rgb(205, 92, 92)",indianred1:"rgb(255, 106, 106)",indianred2:"rgb(238, 99, 99)",indianred3:"rgb(205, 85, 85)",indianred4:"rgb(139, 58, 58)",ivory:"rgb(255, 255, 240)",ivory1:"rgb(255, 255, 240)",ivory2:"rgb(238, 238, 224)",ivory3:"rgb(205, 205, 193)",ivory4:"rgb(139, 139, 131)",khaki:"rgb(240, 230, 140)",khaki1:"rgb(255, 246, 143)",khaki2:"rgb(238, 230, 133)",khaki3:"rgb(205, 198, 115)",khaki4:"rgb(139, 134, 78)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lavenderblush1:"rgb(255, 240, 245)",lavenderblush2:"rgb(238, 224, 229)",lavenderblush3:"rgb(205, 193, 197)",lavenderblush4:"rgb(139, 131, 134)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lemonchiffon1:"rgb(255, 250, 205)",lemonchiffon2:"rgb(238, 233, 191)",lemonchiffon3:"rgb(205, 201, 165)",lemonchiffon4:"rgb(139, 137, 112)",lightblue:"rgb(173, 216, 230)",lightblue1:"rgb(191, 239, 255)",lightblue2:"rgb(178, 223, 238)",lightblue3:"rgb(154, 192, 205)",lightblue4:"rgb(104, 131, 139)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightcyan1:"rgb(224, 255, 255)",lightcyan2:"rgb(209, 238, 238)",lightcyan3:"rgb(180, 205, 205)",lightcyan4:"rgb(122, 139, 139)",lightgoldenrod:"rgb(238, 221, 130)",lightgoldenrod1:"rgb(255, 236, 139)",lightgoldenrod2:"rgb(238, 220, 130)",lightgoldenrod3:"rgb(205, 190, 112)",lightgoldenrod4:"rgb(139, 129, 76)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightpink1:"rgb(255, 174, 185)",lightpink2:"rgb(238, 162, 173)",lightpink3:"rgb(205, 140, 149)",lightpink4:"rgb(139, 95, 101)",lightsalmon:"rgb(255, 160, 122)",lightsalmon1:"rgb(255, 160, 122)",lightsalmon2:"rgb(238, 149, 114)",lightsalmon3:"rgb(205, 129, 98)",lightsalmon4:"rgb(139, 87, 66)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightskyblue1:"rgb(176, 226, 255)",lightskyblue2:"rgb(164, 211, 238)",lightskyblue3:"rgb(141, 182, 205)",lightskyblue4:"rgb(96, 123, 139)",lightslateblue:"rgb(132, 112, 255)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightsteelblue1:"rgb(202, 225, 255)",lightsteelblue2:"rgb(188, 210, 238)",lightsteelblue3:"rgb(162, 181, 205)",lightsteelblue4:"rgb(110, 123, 139)",lightyellow:"rgb(255, 255, 224)",lightyellow1:"rgb(255, 255, 224)",lightyellow2:"rgb(238, 238, 209)",lightyellow3:"rgb(205, 205, 180)",lightyellow4:"rgb(139, 139, 122)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",magenta1:"rgb(255, 0, 255)",magenta2:"rgb(238, 0, 238)",magenta3:"rgb(205, 0, 205)",magenta4:"rgb(139, 0, 139)",maroon:"rgb(176, 48, 96)",maroon1:"rgb(255, 52, 179)",maroon2:"rgb(238, 48, 167)",maroon3:"rgb(205, 41, 144)",maroon4:"rgb(139, 28, 98)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumorchid1:"rgb(224, 102, 255)",mediumorchid2:"rgb(209, 95, 238)",mediumorchid3:"rgb(180, 82, 205)",mediumorchid4:"rgb(122, 55, 139)",mediumpurple:"rgb(147, 112, 219)",mediumpurple1:"rgb(171, 130, 255)",mediumpurple2:"rgb(159, 121, 238)",mediumpurple3:"rgb(137, 104, 205)",mediumpurple4:"rgb(93, 71, 139)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",mistyrose1:"rgb(255, 228, 225)",mistyrose2:"rgb(238, 213, 210)",mistyrose3:"rgb(205, 183, 181)",mistyrose4:"rgb(139, 125, 123)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navajowhite1:"rgb(255, 222, 173)",navajowhite2:"rgb(238, 207, 161)",navajowhite3:"rgb(205, 179, 139)",navajowhite4:"rgb(139, 121, 94)",navy:"rgb(0, 0, 128)",navyblue:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olivedrab:"rgb(107, 142, 35)",olivedrab1:"rgb(192, 255, 62)",olivedrab2:"rgb(179, 238, 58)",olivedrab3:"rgb(154, 205, 50)",olivedrab4:"rgb(105, 139, 34)",orange:"rgb(255, 165, 0)",orange1:"rgb(255, 165, 0)",orange2:"rgb(238, 154, 0)",orange3:"rgb(205, 133, 0)",orange4:"rgb(139, 90, 0)",orangered:"rgb(255, 69, 0)",orangered1:"rgb(255, 69, 0)",orangered2:"rgb(238, 64, 0)",orangered3:"rgb(205, 55, 0)",orangered4:"rgb(139, 37, 0)",orchid:"rgb(218, 112, 214)",orchid1:"rgb(255, 131, 250)",orchid2:"rgb(238, 122, 233)",orchid3:"rgb(205, 105, 201)",orchid4:"rgb(139, 71, 137)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",palegreen1:"rgb(154, 255, 154)",palegreen2:"rgb(144, 238, 144)",palegreen3:"rgb(124, 205, 124)",palegreen4:"rgb(84, 139, 84)",paleturquoise:"rgb(175, 238, 238)",paleturquoise1:"rgb(187, 255, 255)",paleturquoise2:"rgb(174, 238, 238)",paleturquoise3:"rgb(150, 205, 205)",paleturquoise4:"rgb(102, 139, 139)",palevioletred:"rgb(219, 112, 147)",palevioletred1:"rgb(255, 130, 171)",palevioletred2:"rgb(238, 121, 159)",palevioletred3:"rgb(205, 104, 137)",palevioletred4:"rgb(139, 71, 93)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peachpuff1:"rgb(255, 218, 185)",peachpuff2:"rgb(238, 203, 173)",peachpuff3:"rgb(205, 175, 149)",peachpuff4:"rgb(139, 119, 101)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",pink1:"rgb(255, 181, 197)",pink2:"rgb(238, 169, 184)",pink3:"rgb(205, 145, 158)",pink4:"rgb(139, 99, 108)",plum:"rgb(221, 160, 221)",plum1:"rgb(255, 187, 255)",plum2:"rgb(238, 174, 238)",plum3:"rgb(205, 150, 205)",plum4:"rgb(139, 102, 139)",powderblue:"rgb(176, 224, 230)",purple:"rgb(160, 32, 240)",purple1:"rgb(155, 48, 255)",purple2:"rgb(145, 44, 238)",purple3:"rgb(125, 38, 205)",purple4:"rgb(85, 26, 139)",red:"rgb(255, 0, 0)",red1:"rgb(255, 0, 0)",red2:"rgb(238, 0, 0)",red3:"rgb(205, 0, 0)",red4:"rgb(139, 0, 0)",rosybrown:"rgb(188, 143, 143)",rosybrown1:"rgb(255, 193, 193)",rosybrown2:"rgb(238, 180, 180)",rosybrown3:"rgb(205, 155, 155)",rosybrown4:"rgb(139, 105, 105)",royalblue:"rgb(65, 105, 225)",royalblue1:"rgb(72, 118, 255)",royalblue2:"rgb(67, 110, 238)",royalblue3:"rgb(58, 95, 205)",royalblue4:"rgb(39, 64, 139)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",salmon1:"rgb(255, 140, 105)",salmon2:"rgb(238, 130, 98)",salmon3:"rgb(205, 112, 84)",salmon4:"rgb(139, 76, 57)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seagreen1:"rgb(84, 255, 159)",seagreen2:"rgb(78, 238, 148)",seagreen3:"rgb(67, 205, 128)",seagreen4:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",seashell1:"rgb(255, 245, 238)",seashell2:"rgb(238, 229, 222)",seashell3:"rgb(205, 197, 191)",seashell4:"rgb(139, 134, 130)",sienna:"rgb(160, 82, 45)",sienna1:"rgb(255, 130, 71)",sienna2:"rgb(238, 121, 66)",sienna3:"rgb(205, 104, 57)",sienna4:"rgb(139, 71, 38)",skyblue:"rgb(135, 206, 235)",skyblue1:"rgb(135, 206, 255)",skyblue2:"rgb(126, 192, 238)",skyblue3:"rgb(108, 166, 205)",skyblue4:"rgb(74, 112, 139)",slateblue:"rgb(106, 90, 205)",slateblue1:"rgb(131, 111, 255)",slateblue2:"rgb(122, 103, 238)",slateblue3:"rgb(105, 89, 205)",slateblue4:"rgb(71, 60, 139)",slategray:"rgb(112, 128, 144)",slategray1:"rgb(198, 226, 255)",slategray2:"rgb(185, 211, 238)",slategray3:"rgb(159, 182, 205)",slategray4:"rgb(108, 123, 139)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",snow1:"rgb(255, 250, 250)",snow2:"rgb(238, 233, 233)",snow3:"rgb(205, 201, 201)",snow4:"rgb(139, 137, 137)",springgreen:"rgb(0, 255, 127)",springgreen1:"rgb(0, 255, 127)",springgreen2:"rgb(0, 238, 118)",springgreen3:"rgb(0, 205, 102)",springgreen4:"rgb(0, 139, 69)",steelblue:"rgb(70, 130, 180)",steelblue1:"rgb(99, 184, 255)",steelblue2:"rgb(92, 172, 238)",steelblue3:"rgb(79, 148, 205)",steelblue4:"rgb(54, 100, 139)",tan:"rgb(210, 180, 140)",tan1:"rgb(255, 165, 79)",tan2:"rgb(238, 154, 73)",tan3:"rgb(205, 133, 63)",tan4:"rgb(139, 90, 43)",thistle:"rgb(216, 191, 216)",thistle1:"rgb(255, 225, 255)",thistle2:"rgb(238, 210, 238)",thistle3:"rgb(205, 181, 205)",thistle4:"rgb(139, 123, 139)",tomato:"rgb(255, 99, 71)",tomato1:"rgb(255, 99, 71)",tomato2:"rgb(238, 92, 66)",tomato3:"rgb(205, 79, 57)",tomato4:"rgb(139, 54, 38)",turquoise:"rgb(64, 224, 208)",turquoise1:"rgb(0, 245, 255)",turquoise2:"rgb(0, 229, 238)",turquoise3:"rgb(0, 197, 205)",turquoise4:"rgb(0, 134, 139)",violet:"rgb(238, 130, 238)",violetred:"rgb(208, 32, 144)",violetred1:"rgb(255, 62, 150)",violetred2:"rgb(238, 58, 140)",violetred3:"rgb(205, 50, 120)",violetred4:"rgb(139, 34, 82)",wheat:"rgb(245, 222, 179)",wheat1:"rgb(255, 231, 186)",wheat2:"rgb(238, 216, 174)",wheat3:"rgb(205, 186, 150)",wheat4:"rgb(139, 126, 102)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellow1:"rgb(255, 255, 0)",yellow2:"rgb(238, 238, 0)",yellow3:"rgb(205, 205, 0)",yellow4:"rgb(139, 139, 0)",yellowgreen:"rgb(154, 205, 50)"},{nameToRGB:function(e){return e in t.colorNames?t.colorNames[e]:(e=e.toLowerCase(),e in t.colorNames?t.colorNames[e]:(e=e.replace(/\s+/g,""),e in t.colorNames?t.colorNames[e]:null))
},testIfHex:function(t){var e=/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(t);return e},rgbToHex:function(t){var e=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(t),r=parseInt(e[2]),n=parseInt(e[3]),a=parseInt(e[4]);return"#"+((1<<24)+(r<<16)+(n<<8)+a).toString(16).slice(1)},hslToHex:function(t){var e=function(t,e,n){var a,o,i;if(t%=360,0>t&&(t+=360),t=~~t/360,0>e?e=0:e>100&&(e=100),e=~~e/100,0>n?n=0:n>100&&(n=100),n=~~n/100,0===e)a=o=i=n;else{var s=.5>n?n*(1+e):n+e-n*e,c=2*n-s;a=r(c,s,t+1/3),o=r(c,s,t),i=r(c,s,t-1/3)}return[~~(255*a),~~(255*o),~~(255*i)]},r=function(t,e,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?t+6*(e-t)*r:.5>r?e:2/3>r?t+(e-t)*(2/3-r)*6:t};return{process:function(){return t.replace(/hsl\((-?\d+),(-?\d+)%?,(-?\d+)%?\)/g,function(t,r,n,a){var o=e(r,n,a),i=o[0].toString(16),s=o[1].toString(16),c=o[2].toString(16);return"#"+((1==i.length?"0":"")+i)+((1==s.length?"0":"")+s)+((1==c.length?"0":"")+c)})}}},nameToHex:function(e){var r,n=this.testIfHex(e);return n?"#"+e:e in t.colorNames?r=this.rgbToHex(t.colorNames[e]):(e=e.toLowerCase(),e in t.colorNames?r=this.rgbToHex(t.colorNames[e]):(e=e.replace(/\s+/g,""),e in t.colorNames?r=this.rgbToHex(t.colorNames[e]):null))},x11ToCSS:function(e){function r(t){return 1==t.length?parseInt(t+t,16):2==t.length?parseInt(t,16):(3==t.length&&(t+=t.substr(2)),Math.round(parseInt(t,16)/257))}var n=e.match(t.re_.x11rgb);return n?(n.splice(0,1),t.arrayToRGBA(n.map(r))):this.nameToRGB(e)},hexToRGB:function(t){var e=[];return e.push(hexToR(t)),e.push(hexToG(t)),e.push(hexToB(t)),e},hexToR:function(t){return parseInt(cutHex(t).substring(0,2),16)},hexToG:function(t){return parseInt(cutHex(t).substring(2,4),16)},hexToB:function(t){return parseInt(cutHex(t).substring(4,6),16)},cutHex:function(t){return"#"==t.charAt(0)?t.substring(1,7):t}}}angular.module("TADkit").service("ColorConvert",t)}(),function(){"use strict";function t(t){return{colorsFromIni:function(e){var r={section:/^\s*\[\s*([^\]]*)\s*\]\s*$/,param:/^\s*([\w\.\-\_]+)\s*=\s*([\w\.\-\_]+)/,comment:/^\s*#.*$/},n={},a=e.split(/\r\n|\r|\n/),o=null;return a.forEach(function(e){if(!r.comment.test(e)&&""!==e){var a;if(r.param.test(e))if(a=e.match(r.param),o){var i=t.nameToHex(a[2]);n[o][a[1]]=i}else n[a[1]]=a[2];else r.section.test(e)?(a=e.match(r.section),n[a[1]]={},o=a[1]):0===e.length&&o&&(o=null)}}),n},colorsFromTriplets:function(t){for(var e,r,n=0,a=[],o=t.length;o>n;)e=t[n],r=new THREE.Color(e[0],e[1],e[2]),a.push(r),n++;return a},colorsFromArray:function(t){for(var e=[],r=t.length-1;r>=0;r-=1){var n=t[r]/255;r-=1;var a=t[r]/255;r-=1;var o=t[r]/255,i=new THREE.Color(o,a,n);e.unshift(i)}return e},colorsFromHex:function(t){for(var e=[],r=t.length-1;r>=0;r--){var n=new THREE.Color(t[r]);e.unshift(n)}return e},vertexColorsFromColors:function(t){for(var e=new Float32Array(6*t.length),r=t.length-1;r>=0;r--){var n=6*r,a=t[r];e[n]=a.r,e[n+1]=a.g,e[n+2]=a.b,e[n+3]=a.r,e[n+4]=a.g,e[n+5]=a.b}return e},getRandomColors:function(t){for(var e=[],r=0;t>r;r++){var n="#"+Math.floor(16777215*Math.random()).toString(16);e.push(n)}return e},getRandomRGB:function(t){for(var e=[],r=0;t>r;r++){var n="#"+Math.floor(16777215*Math.random()).toString(16),a=new THREE.Color(n);e.push(a)}return e},getGradientColor:function(t,e,r){t=t.replace(/^\s*#|\s*$/g,""),e=e.replace(/^\s*#|\s*$/g,""),3==t.length&&(t=t.replace(/(.)/g,"$1$1")),3==e.length&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(t.substr(0,2),16),a=parseInt(t.substr(2,2),16),o=parseInt(t.substr(4,2),16),i=parseInt(e.substr(0,2),16),s=parseInt(e.substr(2,2),16),c=parseInt(e.substr(4,2),16),l=i-n,g=s-a,d=c-o;return l=(l*r+n).toString(16).split(".")[0],g=(g*r+a).toString(16).split(".")[0],d=(d*r+o).toString(16).split(".")[0],1==l.length&&(l="0"+l),1==g.length&&(g="0"+g),1==d.length&&(d="0"+d),"#"+l+g+d}}}angular.module("TADkit").factory("Color",t)}(),function(){"use strict";function t(t,e,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=t.defer(),a="assets/defaults/tk-defaults-components.json";return n.loaded.length>0?r.resolve(n):e.get(a).success(function(t){n.loaded=t,console.log("Components ("+t.length+") loaded from "+a),r.resolve(n)}),r.promise},add:function(t){t=t||["","","","","","","",[]];var e={metadata:{version:1,type:"component",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],type:t[2],state:{width:t[3],height:t[4],margin:t[5],padding:t[6],position:t[7]}},view:t[8]};return n.loaded.push(e),n.current=n.loaded.length-1,n},remove:function(t){t=t||n.current.index;var e=n.loaded.indexOf(t);return n.loaded.splice(e,1),n},set:function(t){(void 0!==t||t!==!1)&&(n.current.index=t);var e=n.loaded[n.current.index];return e},setViewpoint:function(t,e,r){t=t||0,e=e||4999999;var a=n.loaded;return angular.forEach(a,function(n){var a=r||1;if(n.view.viewpoint.chromStart=t,n.view.viewpoint.chromEnd=e,"scene"===n.object.type||"scene-icon"===n.object.type){var o=n.view.viewpoint.fov/2,i=.6;a=Math.tan(o).toFixed(2)*i}n.view.viewpoint.scale=a}),n},get:function(){return n},getComponent:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t];return e},getComponentById:function(t){var e,r;if(void 0!==t||t!==!1)for(var a=n.loaded.length-1;a>=0;a--)n.loaded[a].object.id===t&&(e=n.loaded[a],r=a);return r||(e=n.loaded[n.current.index],console.log("Component '"+t+"' not found: returning current.")),e},getComponentByType:function(t){var e,r,a;if(a=-1,void 0!==t||t!==!1)for(var o=n.loaded.length-1;o>=0;o--)n.loaded[o].object.type===t&&(e=n.loaded[o],a=o),"default"===n.loaded[o].object.type&&(r=n.loaded[o]);return 0>a&&(e=r,console.log("Component type '"+t+"' not found: returning default.")),e}}}angular.module("TADkit").factory("Components",t)}(),function(){"use strict";function t(t,e,r,n){function a(){r.$apply(function(){o.resolve(window.d3)})}var o=e.defer(),i=t[0].createElement("script");i.type="text/javascript",i.async=!0;var s=n.getOnline();i.src=s?"http://d3js.org/d3.v3.min.js":"assets/js/d3.min.js",i.onreadystatechange=function(){"complete"==this.readyState&&a()},i.onload=a;var c=t[0].getElementsByTagName("body")[0];return c.appendChild(i),{d3:function(){return o.promise}}}angular.module("d3",[]).factory("d3Service",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i,s,c,g){var d={loaded:[],current:{index:0,cluster:1,centroid:1}},u={ref:-1,data:[]};return{load:function(r){var n=this,a=t.defer();return e.get(r).success(function(t){t.object.filename=r,n.add(t),a.resolve(d)}),a.promise},add:function(t){var e=this,r=e.validate(t);return d.loaded.push(r),d.current.index=d.loaded.length-1,e.setSpeciesUrl(),e.setRegion(),e.init(r),console.log("Dataset "+r.object.species+" "+r.object.region+" loaded from file."),d},validate:function(t){var e={},r=a.whatIsIt(t);e="String"===r?JSON.parse(t):t;var n=!0;return n?e:void 0},init:function(t){var e=this;if(0===t.centroids.length)for(var r=0;r<t.models.length;r++)t.centroids.push(t.models[r].ref),t.clusters.push([t.models[r].ref]);var a=e.getModel();if(n.set(t),"undefined"!=typeof a&&(o.set(a.data),i.set(a.data,t.restraints),s.update(o.get().distances,t.restraints)),angular.isUndefined(t.hic_data))c.clear();else{var d=0;t.object.chromosomeIndex&&(d=t.object.chromosomeIndex);for(var u=0,h=t.object.resolution,p=0;d>p;p++)u+=Math.round(t.object.chromEnd[l]/h)-Math.round(t.object.chromStart[l]/h)+1;var m=t.object.chromStart[d]/h+u-t.object.chromStart[0]/h,f=t.object.chromEnd[d]/h+u-t.object.chromStart[0]/h;c.set(t.hic_data,[Math.round(m+1)],[Math.round(f)])}g.clear(),console.log("Settings, Proximities, Restraints & Overlays initialized.")},clear:function(){for(;d.loaded.length>0;)d.loaded.shift()},remove:function(t){(void 0===t||t===!1)&&(t=d.current.index);var e=d.loaded.indexOf(t);return d.loaded.splice(e,1),d},getSpecies:function(t){if("undefined"==typeof d.loaded[t].object.species&&"undefined"!=typeof d.loaded[t].object.taxon_id){var r="https://www.ebi.ac.uk/ena/data/taxonomy/v1/taxon/tax-id/"+d.loaded[t].object.taxon_id;return e({method:"GET",url:r}).then(function(e){return console.log("Retrieved species "+e.data.scientificName+" from taxon_id "+d.loaded[t].object.taxon_id),e.data.scientificName})}return d.loaded[t].object.species},setSpeciesUrl:function(t){(void 0===t||t===!1)&&(t=d.current.index);var e,r=this.getSpecies(t);return"undefined"!=typeof d.loaded[t].object.species?(e=d.loaded[t].object.species.replace(/[^a-z0-9]/gi,"_").toLowerCase(),d.loaded[t].object.speciesUrl=e,e):(r.then(function(r){return d.loaded[t].object.species=r,e=r.replace(/[^a-z0-9]/gi,"_").toLowerCase(),d.loaded[t].object.speciesUrl=e,e}),void 0)},setRegion:function(t){(void 0===t||t===!1)&&(t=d.current.index);var e=0;d.loaded[t].object.chromosomeIndex&&(e=d.loaded[t].object.chromosomeIndex);var r=d.loaded[t].object.chrom[e],n=d.loaded[t].object.chromStart[e],a=d.loaded[t].object.chromEnd[e],o=r+":"+n+"-"+a;return d.loaded[t].object.region=o,o},set:function(t){(void 0!==t||t!==!1)&&(d.current.index=t),this.setCluster(d.current.cluster);var e=d.loaded[d.current.index];return e},setCluster:function(t){t=t||1,d.current.cluster=t;var e=this.getCentroid(d.current.cluster);this.setCentroid(e);var r=this.getCluster();return r},setCentroid:function(t){t=t||this.getCentroid(),d.current.centroid=t;var e=this.setModel(d.current.centroid);return e},setModel:function(t,e){t=t||this.getCentroid();var r=this.getModel(t,e);return d.loaded[d.current.index].data=r,r},get:function(){return d},getDataset:function(t){(void 0===t||t===!1)&&(t=d.current.index);var e=d.loaded[t];return e},getCluster:function(t){t=t||d.current.cluster;var e=d.loaded[d.current.index].clusters[t-1];return e},getClusterId:function(){return d.current.cluster},getCentroid:function(t){t=t||d.current.cluster;var e=d.loaded[d.current.index].centroids[t-1];return e},getModel:function(t,e){var r=this;t=t||this.getCentroid();{var a=r.getDataset();n.get()}(void 0===e||e===!1)&&(e=[a.object.chrom[0]]);for(var o,i=[],s=[],c=a.object.resolution,l=0,g=0;g<a.object.chrom.length;g++)o=e.indexOf(a.object.chrom[g]),o>-1&&(i.push(Math.round((a.object.chromStart[g]-a.object.chromStart[0])/c)+l),s.push(Math.round((a.object.chromEnd[g]-a.object.chromStart[0])/c)+l)),l+=Math.round(a.object.chromEnd[g]/c)-Math.round(a.object.chromStart[g]/c);var h=d.loaded[d.current.index].models;u.data=[];for(var p=h.length-1;p>=0;p--)if(h[p].ref==t)for(var m=0;m<i.length;m++)for(var f=a.object.components*i[m];f<a.object.components*s[m];f+=3)u.data.push(h[p].data[f],h[p].data[f+1],h[p].data[f+2]);return u.ref=t,u},loadHic:function(){var t=this.getDataset();return c.loadExternal(t)},parse:function(t){Papa.DefaultDelimiter=" ";var e=Papa.parse(t,{dynamicTyping:!0,skipEmptyLines:!0,fastMode:!0});return e},"import":function(t,e,r,o){var i=this;e=e||0,o=o||[];var s,c=a.whatIsIt(t);s="String"==c?i.parse(t).data:t;var l,g,u,h,p,m=d.loaded[d.current.index],f=n.get(),v=(f.current.chromosomeIndexes,1),b=0,y=f.current.segmentLength*f.current.particleSegments;if(m.models.length>0){var w=this.getCentroid();for(u=m.models.length-1;u>=0;u--)if(m.models[u].ref==w){l=m.models[u];break}for(h=0;h<l.data.length;h++)l.data[h]=0}else{for(l={ref:1,data:[]},g=0,u=0;u<m.object.chrom.length;u++)g+=Math.round(m.object.chromEnd[u]/y)-Math.round(m.object.chromStart[u]/y);for(h=0;g>h;h++)l.data.push(0,0,0);m.models.push(l),m.centroids.push(1),m.clusters.push([1]),d.current.centroid=1,d.current.cluster=1}var k,x,E,C,T,S,I,j=r/.01;for(g=0,u=0;u<m.object.chrom.length;u++){for(I=Math.round(m.object.chromEnd[u]/y)-Math.round(m.object.chromStart[u]/y),h=0;3*I>h;h+=3)for(T=m.object.chromStart[u]+h/3*y,S=T+y,p=e;;){if(p>=s.length)break;for(C=0,k=x=E=0;(m.object.chrom[u]==s[p][0].toString()||m.object.chrom[u]==s[p][0].toString().replace("chr",""))&&s[p][1]*v>=T&&s[p][1]*v<S&&(k+=s[p][2],x+=s[p][3],E+=s[p][4],C++,!(p>=s.length-1));)p++;if(C>0){l.data[h+3*g]=j*Math.round(k/C),l.data[h+3*g+1]=j*Math.round(x/C),l.data[h+3*g+2]=j*Math.round(E/C),b++;break}p++}g+=I}return b}}}angular.module("TADkit").factory("Datasets",t)}(),function(){"use strict";function t(t,e,r){var n={ping:0};return{ping:function(){console.log("Pinging Ensembl RESTful genomic data server...");var r=t.defer(),a="http://rest.ensemblgenomes.org/info/ping?content-type=application/json";return e.get(a).success(function(t){n.ping=t.ping,console.log("Ensembl RESTful is contactable.")}),r.promise},load:function(n){var a,o=t.defer(),i=r.get(),s=i.current.species,c=i.current.speciesUrl,l=i.current.chrom,g=i.current.chromStart,d=i.current.chromEnd,u=this,h=r.getOnline();return a=h?n.object.url[0]+c+n.object.url[2]+l+n.object.url[4]+g+n.object.url[6]+d+n.object.url[8]:"assets/offline/"+c+"-genes.json",e.get(a).success(function(t){var e=u.setBiotypeStyle(t);n.data=e;var r=l+":"+g+"-"+d,a=h?"Ensembl":"local storage";console.log("Genes for "+s+" "+r+" retreived from "+a+"."),o.resolve(n)}),o.promise},setBiotypeStyle:function(t){return angular.forEach(t,function(t){var e=t.biotype.toLowerCase();t.biotypeStyle=e}),t}}}angular.module("TADkit").factory("Ensembl",t)}(),function(){"use strict";function t(t,e,r){var n={n:0,max:0,min:99999999999,pos:[],value:[],tads:[]},a=0;return{set:function(t,e,r){var a=this;a.clear(),n.n=parseInt(t.n);var o,i,s,c,l,g,d=0,u=0,h=0,p=[0];for(s=0;s<e.length;s++)h+=r[s]-e[s],p.push(h);for(s=0;s<e.length;s++){u=r[s]-e[s];for(l in t.data){if(o=Math.floor(parseInt(l)%n.n),i=Math.floor(parseInt(l)/n.n),g=-1,o>=e[s]&&o<=r[s]-1&&i>=e[s]&&i<=r[s]-1)g=o-e[s]+p[s]+(i-e[s]+p[s])*h;else for(c=0;s>c;c++){if(o>=e[s]&&o<=r[s]-1&&i>=e[c]&&i<=r[c]-1){g=o-e[s]+p[s]+(i-e[c]+p[c])*h;break}if(o>=e[c]&&o<=r[c]-1&&i>=e[s]&&i<=r[s]-1){g=o-e[c]+p[c]+(i-e[s]+p[s])*h;break}}if(g>-1&&(n.pos.push(parseInt(g)),n.value.push(t.data[l]),t.data[l]<n.min&&(n.min=t.data[l]),t.data[l]>n.max&&(n.max=t.data[l]),d++),o>r[s]-1&&i>r[s]-1)break}}return n.n=h,angular.isUndefined(t.tads)?a.setTADS([]):a.setTADS(t.tads),n},setDirect:function(t){var e=this;return e.clear(),n=t},setInteractionFreq:function(t){a=t},setTADS:function(t){n.tads=t},get:function(){return n},loadExternal:function(n){var a=this;a.clear();var o=r.getComponentById("Hic Data");if(angular.isUndefined(o.view.settings.species_data[n.object.speciesUrl]))return!1;var i=o.view.settings.species_data[n.object.speciesUrl].url;i+="&res="+n.object.resolution;var s=n.object.chrom[0].replace("chr","");i+="&chr="+s+"&limit_chr="+s,i+="&start="+n.object.chromStart+"&end="+n.object.chromEnd+"&limit_start="+n.object.chromStart+"&limit_end="+n.object.chromEnd;var c=t.defer();return e.get(i).then(function(t){var e=t.data,r={n:0,max:0,min:99999999999,pos:[],value:[],tads:[]},n=parseInt(e.start),o=parseInt(e.end);r.n=Math.round((o-n)/e.resolution);for(var i in e.values){var s,l,g=e.values[i];g.chrA==g.chrB&&g.startA<o&&g.startA>=n&&g.startB<o&&g.startB>=n&&(s=(g.startB-n)/e.resolution,l=(g.startA-n)/e.resolution,r.pos.push(Math.round(l*r.n+s)),r.value.push(g.value),g.value<r.min&&(r.min=g.value),g.value>r.max&&(r.max=g.value))}a.setDirect(r),c.resolve(r)}),c.promise},clear:function(){n={n:0,max:0,min:99999999999,pos:[],value:[],tads:[]}}}}angular.module("TADkit").factory("Hic_data",t)}(),function(){"use strict";function t(t,e,r,n,a){return function(){var o=e.load(),i=(a.load(),r.load()),s=n.load();return t.all([o,i,s]).then(function(t){return{settings:t[0],components:t[1],storyboards:t[2]}})}}angular.module("TADkit").service("initMain",t)}(),function(){"use strict";function t(t){return{linePiecesRGB:function(e,r){var n=this,a=e.data.length,o=6*r;o>Math.pow(2,10)-1&&(o=Math.pow(2,10)-1);for(var i=new Float32Array(o),s=new THREE.Color("#000000"),c=i.length-1;c>=0;c--)i[g]=s;for(var l=t.getRandomRGB(a),g=0;a>g;g++){var d=e.data[g][0],u=e.data[g][1],h=6*n.getMatrixIndex(d,u,r),p=l[g];if("restraints"==e.object.id){var m={H:"#4CAF50",L:"#0000ff",U:"#ff00ff",C:"#00ff00"};p=n.getFeatureRGB(e.data[g][2],m)}i[h]=p.r,h++,i[h]=p.g,h++,i[h]=p.b,h++,i[h]=p.r,h++,i[h]=p.g,h++,i[h]=p.b}return i.name="Network LinePieces RGB",i},linePiecesAlpha:function(t,e){var r=this,n=2*e;n>Math.pow(2,10)-1&&(n=Math.pow(2,10)-1);for(var a=new Float32Array(n),o=0,i=a.length-1;i>=0;i--)a[i]=o;if(t.data)for(var s=t.data.length,c=0;s>c;c++){var l=t.data[c][0],g=t.data[c][1],d=r.getMatrixIndex(l,g,e),u=t.data[c][3]*t.data[c][3]/5;a[d]=u,d++,a[d]=u}return a.name="Network LinePieces Alphas",a},getMatrixIndex:function(t,e,r){for(var n=0,a=t-1,o=0;a>=o;o++)n+=r-(r-o);return n+=e-t-1},getFeatureRGB:function(t,e){e=e||{0:"#000000"};var r;return angular.forEach(e,function(e,n){t==n&&(r=new THREE.Color(e))}),r}}}angular.module("TADkit").factory("Networks",t)}(),function(){"use strict";function t(t,e,r,n,a,o,i,s,c,l){var g={loaded:[],current:{index:-1}};return{load:function(){var r=t.defer(),n="assets/defaults/tk-defaults-overlays.json";return g.loaded.length>0?r.resolve(g):e.get(n).success(function(t){g.loaded=t,g.current.index=g.loaded.length-1,console.log("Overlays ("+t.length+") loaded from "+n),r.resolve(g)}),r.promise},loadTSV:function(r,n,a){r=r||"tk-example-dataset",n=n||"tsv","undefined"==typeof a&&(a=!0);var i=this;a&&(i.defaults(),o.defaultComponents());var s=t.defer(),c="defaults";"tk-example-dataset"!=r&&(c="examples");var l="assets/"+c+"/"+r+"."+n;return e.get(l).success(function(t){var e=i.import(t,[],[],a);console.log("Overlays ("+e.length+") imported from "+l),s.resolve(g)}).error(function(){console.log("No associated data tracks found.")}),s.promise},"import":function(t,e,r){var n=this;e=e||[],r=r||[];var a,o=l.whatIsIt(t);a="String"==o?n.parse(t).data:t;var i;i=e.length>0&&r.length>0?n.filter(a,e,r):a;var s=n.aquire(i);return n.add(s),s},parse:function(t){Papa.DefaultDelimiter=" ";var e=Papa.parse(t,{dynamicTyping:!0,skipEmptyLines:!0,fastMode:!0});return e},filter:function(t,e,r){for(var n=[],a=e.length,o=r.length,i=0;a>i;i++){var s=[];if(e[i]){for(var c=0;o>c;c++)r[c]&&s.push(t[i][c]);n.push(s)}}return n},aquire:function(t){var e,n,a,o=["#227c4f","#e71818","#8ece0d","#6666ff","#424242"],i=d3.scale.category20(),s=[],c=0,l=1,g=0,d=1,u=t[c].length,h=t[l][d]-t[l][g]+1,p=t[l+1][d]-t[l+1][g]+1;h==p?(e="wiggle_0",n="fixed",a="fixed"):(e="bedgraph",n="variable",a="variable");var m=!1;if(7==u){for(var f=0,v=2;u>v;v++){var b=t[c][v].toLowerCase();("hp1"==b||"brm"==b||"mrg15"==b||"pc"==b||"h1"==b)&&f++}5==f&&(m=!0)}for(var y=u-1;y>=2;y--){var w;w=m?o[y-2]:i(y),s.unshift({metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:r.generate(),id:t[c][y],title:t[c][y],source:"Research output",url:"local",description:"center_label",type:e,format:n,components:2,name:t[c][y],visibility:"full",color:w,altColor:"#cccccc",priority:"100",stepType:a,chrom:"",start:t[l][g],step:h,state:{index:0,overlaid:!1}},palette:[w,"#cccccc"],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}});for(var k=t.length-1;k>=1;k--)"variable"==n?s[0].data.unshift({start:t[k][g],end:t[k][d],read:t[k][y]}):s[0].data.unshift(t[k][y])}return s},add:function(t){var e=this,r=[],n=g.loaded.length-1;return angular.forEach(t,function(t){var e=!1;e||(n++,t.object.state.index=n,t.object.state.overlaid=!1,r.push(t),o.addComponent(t))}),g.loaded=g.loaded.concat(r),e.segment(),r},addDirect:function(t){for(var e=g.loaded.length-1,r=g.loaded.length-1;r>=0;r--)if(g.loaded[r].object.uuid==t.object.uuid)return!0;return e++,t.object.state.index=e,g.loaded=g.loaded.concat(t),e},clear:function(){for(;g.loaded.length>0;)g.loaded.shift()},defaults:function(){for(;g.loaded.length>4;)g.loaded.pop()},remove:function(t){(void 0===t||t===!1)&&(t=g.current.index);var e=g.loaded.indexOf(t);return g.loaded.splice(e,1),g},set:function(t){(void 0!==t||t!==!1)&&(g.current.index=t);var e=g.loaded[g.current.index];return e},setOverlaid:function(t){return t=t||"",angular.forEach(g.loaded,function(e){e.object.state.overlaid=e.object.state.index===t?!0:!1}),t},update:function(e,r){var n=this,a=[],s=[];return angular.forEach(g.loaded,function(t){if("ensembl"==t.object.type){var n=i.load(t);a.push(n),s.push(t)}"proximities"==t.object.id&&(t.data=e),"restraints"==t.object.id&&(t.data=r)}),t.all(a).then(function(t){for(var e=0;e<s.length;e++)o.update(s[e]);return n.segment(),t})},segment:function(){var t=a.get(),e=this;return angular.forEach(g.loaded,function(r){var n=!0;if(n){var a=r.object.type,o=r.object.format;if("gradient"==a&&"hex"==o){r.colors.particles=s.gradientHCL(r,t.current.particlesCount);for(var i=[],g=t.current.segmentLength*t.current.particleSegments,d=0,u=0;u<t.current.chromosomeIndexes.length;u++)d=Math.round((t.current.chromEnd[u]-t.current.chromStart[u])/g),i.push(d*t.current.particleSegments);r.colors.chromatin=s.gradientHCL(r,t.current.segmentsCount,i),r.colors.network.RGB=c.linePiecesRGB(r,t.current.edgesCount),r.colors.network.alpha=c.linePiecesAlpha(r,t.current.edgesCount)}else if("wiggle_0"==a&&"fixed"==o)r.colors.particles=s.bicolor(r,t.current.particlesCount),r.colors.chromatin=s.bicolor(r,t.current.segmentsCount),r.colors.network.RGB=c.linePiecesRGB(r,t.current.edgesCount),r.colors.network.alpha=c.linePiecesAlpha(r,t.current.edgesCount);else if("wiggle_0"==a&&"variable"==o);else if("bedgraph"==a)r.colors.particles=s.bicolorVariable(r,t.current.chromStart,t.current.particlesCount,1),r.colors.chromatin=s.bicolorVariable(r,t.current.chromStart,t.current.segmentsCount,t.current.segmentLength),r.colors.network.RGB=c.linePiecesRGB(r,t.current.edgesCount),r.colors.network.alpha=c.linePiecesAlpha(r,t.current.edgesCount);else if("matrix"==a)r.colors.particlesMatrix=s.matrix(r,1),r.colors.chromatinMatrix=s.matrix(r,t.current.particleSegments),r.colors.networkMatrix=r.colors.particlesMatrix,e.at(1,t.current.particlesCount,t.current.particleSegments);else if("misc"==a&&"variable"==o)r.colors.particles=[],r.colors.chromatin=[],r.colors.network.RGB=c.linePiecesRGB(r,t.current.edgesCount),r.colors.network.alpha=c.linePiecesAlpha(r,t.current.edgesCount);else if("ensembl"==a&&"json"==o){var h=l.get().biotypes,p=1;r.colors.particles=s.features(r,t.current.chromStart,t.current.particlesCount,p,h),r.colors.chromatin=s.features(r,t.current.chromStart,t.current.segmentsCount,t.current.segmentLength,h),r.colors.network.RGB=c.linePiecesRGB(r,t.current.edgesCount),r.colors.network.alpha=c.linePiecesAlpha(r,t.current.edgesCount)}}else console.log("Overlay '"+r.object.title+"' already segmented as color array matching current dataset length")}),g},at:function(t){var e=a.get();return angular.forEach(g.loaded,function(r){var n=r.object.type;if("matrix"==n){var a=(t-1)*e.current.particlesCount,o=t*e.current.particlesCount,i=a*e.current.particleSegments,s=o*e.current.particleSegments;r.colors.particles=r.colors.particlesMatrix.slice(a,o),r.colors.chromatin=r.colors.chromatinMatrix.slice(i,s),r.colors.network=r.colors.networkMatrix.slice(a,o)}}),g},get:function(){return g},getOverlay:function(t){(void 0===t||t===!1)&&(t=g.current.index);var e=g.loaded[t];return e},replaceOverlay:function(t,e){(void 0===e||e===!1)&&(e=g.current.index),g.loaded[e]=t},getOverlayById:function(t){var e,r;if(void 0!==t||t!==!1)for(var n=g.loaded.length-1;n>=0;n--)g.loaded[n].object.id===t&&(e=g.loaded[n],e.object.state.index=n,r=!0);return r||(e=g.loaded[g.current.index],e.object.state.index=g.current.index,console.log('Overlay "'+t+'" not found: returning current.')),e},getCurrentIndex:function(){return g.current.index}}}angular.module("TADkit").factory("Overlays",t)}(),function(){"use strict";function t(){return{simple:function(t){for(var e="EnsemblBacteria",r=t.length,n=[],a=0;r-1>a;a++){var o=t[a],i=t[a+1],s=new THREE.Vector3(0,0,0);s.addVectors(o,i).divideScalar(2);var c=new THREE.Vector3(0,0,0);if(c.copy(s).sub(o),0===a&&"EnsemblBacteria"!=e){var l;l=new THREE.Vector3(0,0,0),l.copy(o).sub(c),n.push(l)}if(n.push(s),a==r-2&&"EnsemblBacteria"!=e){var g;g=new THREE.Vector3(0,0,0),g.copy(i).add(c),n.push(g)}}return n},cubic:function(t,e){e=e||!1;var r=1,n=t.length,a={};a.vertices=[],a.colors=[];for(var o=new THREE.Vector3(0,0,0),i=0;n>i;i++){var s=t[i],c=new THREE.Vector3(0,0,0);i==n-1?e?c=t[0]:c.copy(s).add(new THREE.Vector3(.5,.5,.5)):c=t[i+1];var l=new THREE.Vector3(0,0,0);l.addVectors(s,c).divideScalar(2);var g=new THREE.Vector3(0,0,0);if(g.copy(l).sub(s),0===i)if(e){var d=new THREE.Vector3(0,0,0);d.addVectors(t[n-1],t[0]).divideScalar(2),o.copy(d).sub(t[n-1])}else o.copy(g);var u=new THREE.Vector3(0,0,0);u.copy(s).sub(g);var h=new THREE.Vector3(0,0,0);h.copy(s).add(o);var p=new THREE.Vector3(0,0,0);p.subVectors(h,u).divideScalar(r),u.copy(s).sub(p),h.copy(s).add(p),a.vertices.push(u),a.colors.push(new THREE.Color(13421772)),a.vertices.push(s),a.colors.push(new THREE.Color(0)),a.vertices.push(h),a.colors.push(new THREE.Color(13421772)),o=g}var m=new THREE.Vector3(0,0,0),f=new THREE.Vector3(0,0,0),v=new THREE.Vector3(0,0,0),b=new THREE.Vector3(0,0,0),y=a.vertices.length,w=a.vertices[y-2],k=a.vertices[y-1],x=a.vertices[0],E=a.vertices[1];if(e){var C=new THREE.CubicBezierCurve3(w,k,x,E),T=C.getPointAt(.5),S=C.getTangent(.5).multiplyScalar(1);m.copy(T).sub(S),f.copy(T),v.copy(T).add(S),b.copy(T)}else m.copy(x),f.copy(x),v.copy(k),b.copy(k);return a.vertices.unshift(m),a.colors.unshift(new THREE.Color(16776960)),a.vertices.unshift(f),a.colors.unshift(new THREE.Color(16711680)),a.vertices.push(v),a.colors.push(new THREE.Color(65535)),a.vertices.push(b),a.colors.push(new THREE.Color(255)),a}}}angular.module("TADkit").factory("PathControls",t)}(),function(){"use strict";function t(){return{splineNearFit:function(t){var e,r="EnsemblBacteria";return e="EnsemblBacteria"==r?new THREE.ClosedSplineCurve3(t):new THREE.SplineCurve3(t)},spline:function(t){var e="NotEnsemblBacteria",r=new THREE.CurvePath,n=t.length;if("EnsemblBacteria"==e)r=new THREE.ClosedSplineCurve3(t);else for(var a=1;n-2>a;a+=3){var o=t[a],i=t[a+1],s=t[a+2],c=t[a+3],l=new THREE.Vector3(0,0,0);l.addVectors(s,i).divideScalar(2);var g=new THREE.SplineCurve3([o,l,c]);r.add(g)}return r},quadraticBezier:function(t){var e="NotEnsemblBacteria",r=new THREE.CurvePath,n=t.length;if("EnsemblBacteria"==e)r=new THREE.ClosedSplineCurve3(t);else for(var a=1;n-2>a;a+=3){var o=t[a],i=t[a+1],s=t[a+2],c=t[a+3],l=new THREE.Vector3(0,0,0);l.addVectors(s,i).divideScalar(2);var g=new THREE.QuadraticBezierCurve3(o,l,c);r.add(g)}return r},cubicBezier:function(t,e,r){r=r||!1;for(var n=new THREE.CurvePath,a=t.length,o=0;a-1>o;o+=3){var i=t[o],s=t[o+1],c=t[o+2],l=t[o+3],g=new THREE.CubicBezierCurve3(i,s,c,l);n.add(g)}return n}}}angular.module("TADkit").factory("Paths",t)}(),function(){"use strict";function t(t,e,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=t.defer(),a="assets/defaults/tk-defaults-projects.json";return n.loaded.length>0?r.resolve(n):e.get(a).success(function(t){n.loaded=t,console.log("Projects ("+t.length+") loaded from "+a),r.resolve(n)}),r.promise},add:function(t){var e={metadata:{version:1,type:"project",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],description:t[2],group:t[3],state:t[4]},datasets:t[5],overlays:t[6],storyboards:t[7]};return n.loaded.push(e),n.current=n.loaded.length-1,n},remove:function(t){(void 0===t||t===!1)&&(t=users.current.index);var e=n.loaded.indexOf(t);return n.loaded.splice(e,1),n},set:function(t){(void 0!==t||t!==!1)&&(n.current.index=t);var e=n.loaded[n.current.index];return e},get:function(){return n},getProject:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t];return e},getState:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t].object.state;return e}}}angular.module("TADkit").factory("Projects",t)}(),function(){"use strict";function t(){var t={dimension:0,positions:[],distances:[]},e={dimension:0,positions:[],distances:[]};return{set:function(e,r){var n={minDistance:150,maxDistance:400,limitConnections:!0,maxConnections:200};r=r||{},angular.extend(this,angular.copy(n),r),this.maxDistance=this.getMaxDistance(e);var a=0,o=0;t.dimension=e.length/3;for(var i=t.dimension*t.dimension,s=2*i,c=new Float32Array(3*s),l=new Float32Array(i),g=t.dimension-1,d=g;d>=0;d--)for(var u=g;u>=0;u--){var h=e[3*d]-e[3*u],p=e[3*d+1]-e[3*u+1],m=e[3*d+2]-e[3*u+2],f=Math.sqrt(h*h+p*p+m*m);c[a++]=e[3*d],c[a++]=e[3*d+1],c[a++]=e[3*d+2],c[a++]=e[3*u],c[a++]=e[3*u+1],c[a++]=e[3*u+2];var v=1-f/this.maxDistance;l[o++]=v}return t.positions=c,t.distances=l,t},getMaxDistance:function(t){var e=new Float32Array(t),r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.BufferAttribute(e,3)),r.computeBoundingSphere();var n=Math.ceil(2*r.boundingSphere.radius);return n},at:function(r){e.dimension=r;var n=(r-1)*t.dimension,a=r*t.dimension;return e.positions=t.positions.subarray(2*n*3,2*a*3),e.distances=t.distances.subarray(n,a),e},get:function(){return t},getCurrent:function(){return e}}}angular.module("TADkit").factory("Proximities",t)}(),function(){"use strict";function t(t,e,r,n){var a={};return a.assembly={},a.featureColors={},{setLengthBP:function(t){var e=0,r=t;for(var n in r)if(r.hasOwnProperty(n))for(var a=0,o=r.length;o>a;a++)e+=r[a].length;return e},loadBiotypeColors:function(){var r,o=t.defer(),i=!1;return r=i?"https://cdn.rawgit.com/Ensembl/ensembl-webcode/release/75/conf/ini-files/COLOUR.ini":"assets/offline/ensembl-webcode-COLOUR.ini",e.get(r).success(function(t){var e=n.colorsFromIni(t);a.featureColors=e,a.biotypes=e.gene,console.log("Ensembl webcode biotype colors retrieved Ensembl."),o.resolve(e)}),o.promise},get:function(){return a},whatIsIt:function(t){var e="test".constructor,r=[].constructor,n={}.constructor;return null===t?"null":void 0===t?"undefined":t.constructor===e?"String":t.constructor===r?"Array":t.constructor===n?"Object":"don't know"}}}angular.module("TADkit").factory("Resources",t)}(),function(){"use strict";function t(){var t={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]},e={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]};return{set:function(e,r,n){var a={setting:!0};n=n||{},angular.extend(this,angular.copy(a),n),t={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]},t.dimension=e.length/3;for(var o=0;o<r.length;o++)"H"==r[o][2]&&t.harmonics.push(r[o]),"L"==r[o][2]&&t.lowerBounds.push(r[o]),"U"==r[o][2]&&t.upperBounds.push(r[o]),"C"==r[o][2]&&t.neighbours.push(r[o]);return t},at:function(r){return e.dimension=r,e.harmonics=[],e.lowerBounds=[],e.upperBounds=[],e.neighbours=[],angular.forEach(t,function(t,n){if("dimension"!=n)for(var a=t.length-1;a>=0;a--)if(t[a][0]==r&&e[n].push(t[a]),t[a][1]==r){var o=[];o.push(t[a][1]),o.push(t[a][0]),o.push(t[a][2]),o.push(t[a][3]),e[n].push(o)}}),e},get:function(){return t},getCurrent:function(){return e}}}angular.module("TADkit").factory("Restraints",t)}(),function(){"use strict";function t(t,e){return{gradientHCL:function(t,e,r){(void 0===r||r===!1)&&(r=[e]);for(var n,a=[],o=t.palette[0],i=t.palette[1],s=0;s<r.length;s++){n=r[s];for(var c=n-1;c>=0;c--){var l=c/n,g=d3.interpolateHcl(o,i)(l);a.push(g)}}return a},gradientComponentRGB:function(t,e){var r,n,a,o,i,s,c,l,g,d,u=[],h="0x"+t.palette[0].substring(1),p="0x"+t.palette[1].substring(1);r=h>>16,n=h>>8&255,a=255&h,o=p>>16,i=p>>8&255,s=255&p;for(var m=e-1;m>=0;m--)c=m/e,l=+(c*r+(1-c)*o).toFixed(2),g=+(c*n+(1-c)*i).toFixed(2),d=+(c*a+(1-c)*s).toFixed(2),u.push(l,g,d);return u},bicolor:function(t,e){for(var r=t.palette[0],n=t.palette[1],a=[],o=0;e>o;o++){var i;i=1===t.data[o]?r:n,a.push(i)}return a},matrix:function(t,e){for(var r=t.palette[0],n=t.palette[1],a=[],o=t.data.length-1;o>=0;o--)for(var i=t.data[o],s=1-i*i,c=d3.interpolateHsl(r,n)(s),l=0;e>l;l++)a.push(c);return a},bicolorVariable:function(t,e,r,n){for(var a=t.palette[0],o=t.palette[1],i=t.data,s=[],c=0;r>c;c++){for(var l=o,g=e+n*c,d=g+n,u=i.length,h=0;u>h;h++){var p=i[h].start,m=i[h].end;Math.max(g,p)<=Math.min(d,m)&&(l=1===i[h].read?a:o)}s.push(l)}return s},featureGraph:function(t,r){var n=this.gradientHCL(t,r),a=e.THREEColorsFromHex(n),o=e.vertexColorsFromTHREEColors(a);return o},features:function(t,e,r,n,a){for(var o=t.data,i=[],s=0;r>s;s++){for(var c=[],l=e+n*s,g=l+n,d=o.length,u="cccccc",h="#"+u,p=0;d>p;p++){var m=o[p].start,f=o[p].end,v=[];
if(Math.max(l,m)<=Math.min(g,f)){v.push(s);var b="biotype",y="protein_coding";c.length>0?c[0]==y?c[0]=o[p][b].toLowerCase():c.push(o[p][b].toLowerCase()):c.push(o[p][b].toLowerCase())}o[p].inSegments=v}for(var w=0;w<c.length;w++){var k=c[0];k in a?(u=a[k].match(/[a-f0-9]{6}/gi),h="#"+u):(u="110100",h="#"+u)}i.push(h)}return i}}}angular.module("TADkit").factory("Segments",t)}(),function(){"use strict";function t(t,e){var r={};return{load:function(){var n=t.defer(),a="assets/defaults/tk-defaults-settings.json";return Object.getOwnPropertyNames(r).length>0?n.resolve(r):e.get(a).success(function(t){r=t,console.log("Settings loaded from "+a),n.resolve(r)}),n.promise},set:function(t,e,n){var a=this;(void 0===n||n===!1)&&(n=t.object.chrom[0]),(void 0===e||e===!1)&&(e=[n]),r.current.chrom=n,r.current.chromIdx=e.indexOf(r.current.chrom),r.current.chromStart=[],r.current.chromEnd=[];var o,i=t.object.resolution;r.current.particlesCount=0;for(var s=0;s<t.object.chrom.length;s++)o=e.indexOf(t.object.chrom[s]),o>-1&&(r.current.chromStart.push(Math.round(t.object.chromStart[s])),r.current.chromEnd.push(Math.round(t.object.chromEnd[s])),r.current.particlesCount+=Math.round(t.object.chromEnd[s]/i)-Math.round(t.object.chromStart[s]/i));r.current.chromosomeIndexes=e,r.current.species=t.object.species,r.current.speciesUrl=t.object.speciesUrl,"undefined"!=typeof t.object.assembly&&(r.current.assemblyUrl=t.object.assembly),r.current.particleSegments=Math.ceil(2500/r.current.particlesCount),r.current.edgesCount=.5*(r.current.particlesCount*r.current.particlesCount-r.current.particlesCount),r.current.segmentsCount=r.current.particlesCount*r.current.particleSegments,r.current.segmentLength=t.object.resolution/r.current.particleSegments,r.current.position=r.current.chromStart[r.current.chromIdx]+parseInt(.5*(r.current.chromEnd[r.current.chromIdx]-r.current.chromStart[r.current.chromIdx])),r.current.particle=a.getParticle(),r.current.particleSize=Math.ceil(t.object.resolution/20),r.current.segment=a.getSegment(r.current.position),r.current.segmentLower=r.current.position-.5*r.current.segment,r.current.segmentUpper=r.current.position+.5*r.current.segment},add:function(){return r},remove:function(){return r},getState:function(){var t=r[settingID].state;return t},get:function(){return r},getOnline:function(){var t=!1;return r.app&&(t=r.app.online),t},getSegment:function(t){t=t||r.current.position;for(var e=(r.current.segmentLength*r.current.particleSegments,t-r.current.chromStart[r.current.chromIdx]),n=0,a=0;a<r.current.chromosomeIndexes.length;a++)n+=Math.round(r.current.chromEnd[a])-Math.round(r.current.chromStart[a]);var o=r.current.particlesCount,i=o*r.current.particleSegments,s=Math.round(e*i/n);return s},getParticle:function(t){t=t||r.current.position;for(var e=(r.current.segmentLength*r.current.particleSegments,t-r.current.chromStart[r.current.chromIdx]),n=0,a=0;a<r.current.chromosomeIndexes.length;a++)n+=Math.round(r.current.chromEnd[a])-Math.round(r.current.chromStart[a]);var o=r.current.particlesCount,i=Math.round(e*o/n)+1;return i},getRange:function(t,e){for(var r=0,n=t;e>=n;n++)r++;return r},toggle:function(t){return angular.forEach(r,function(e){t==e.id&&(e.state=!e.state)}),r}}}angular.module("TADkit").factory("Settings",t)}(),function(){"use strict";function t(t,e,r,n,a){var o={loaded:[],current:{index:0}};return{load:function(){var r=t.defer(),n="assets/defaults/tk-defaults-storyboards.json";return e.get(n).success(function(t){o.loaded=t,console.log("Storyboards ("+t.length+") loaded from "+n),r.resolve(o)}),r.promise},add:function(t){t=t||[""];var e={metadata:{version:1,type:"storyboard",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],email:t[2],group:t[3],permissions:t[4]},data:t[5]};return o.loaded.push(e),o.current=o.loaded.length-1,o},addComponent:function(t,e,o){var i=this;e=e||"default",o=o||[];var s=n.get(),c=a.getComponentByType(t.object.type),l=angular.copy(c);l.object.uuid=r.generate(),l.object.id=t.object.id,l.object.title=t.object.id,l.object.dataset=t.object.id,l.view.settings.step=t.object.step,l.view.settings.color=t.object.color,l.view.viewpoint.chromStart=s.current.chromStart,l.view.viewpoint.chromEnd=s.current.chromEnd,l.view.viewpoint.scale=s.views.scale,l.view.viewtype=t.object.type+"-"+t.object.stepType,l.data=t.data,l.overlay=t;var g=i.getStoryboardById(e);return g.components.push(l),l},defaultComponents:function(t){var e=this;t=t||"default";for(var r=e.getStoryboardById(t);r.components.length>6;)console.log("popping"),o.loaded[o.current.index].components.pop();return o},remove:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded.indexOf(t);return o.loaded.splice(e,1),o},removeComponentById:function(t){console.log("component");var e=this;if(void 0!==t||t!==!1){var r=e.getComponentById(t),n=e.getStoryboard();n.components.splice(r.index,1),console.log(r)}return o},set:function(t){(void 0!==t||t!==!1)&&(o.current.index=t);var e=o.loaded[o.current.index];return e},setViewpoint:function(t,e,r){t=t||0,e=e||4999999;var n=o.loaded[o.current.index].components;return angular.forEach(n,function(n){var a=r||1;if(n.view.viewpoint.chromStart=t,n.view.viewpoint.chromEnd=e,"scene"===n.object.type||"scene-icon"===n.object.type){var o=n.view.viewpoint.fov/2,i=.6;a=Math.tan(o).toFixed(2)*i}n.view.viewpoint.scale=a}),o},update:function(t){var e=this,r=e.getStoryboard().components;angular.forEach(r,function(e){("track-genes"==e.object.type||"panel-inspector"==e.object.type)&&(e.data=t.data,e.overlay=t)})},get:function(){return o},getStoryboard:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t];return e},getStoryboardById:function(t){var e,r;if(void 0!==t||t!==!1)for(var n=o.loaded.length-1;n>=0;n--)o.loaded[n].object.id===t&&(e=o.loaded[n],e.index=n,r=!0);return r||(e=o.loaded[o.current.index],e.index=o.current.index,console.log("Storyboard '"+t+"' not found: returning current.")),e},getComponentById:function(t){var e,r,n=this,a=n.getStoryboard().components;if(void 0!==t||t!==!1)for(var o=a.length-1;o>=0;o--)console.log(a[o].object.title),a[o].object.title===t&&(e=a[o],e.index=o,r=!0,console.log("Component '"+t+"' found!"));return e}}}angular.module("TADkit").factory("Storyboards",t)}(),function(){"use strict";function t(t,e,r){function n(){r.$apply(function(){a.resolve(window.three)})}var a=e.defer(),o=t[0].createElement("script");o.type="text/javascript",o.async=!0,o.src="../bower_components/threejs/build/three.js",o.onreadystatechange=function(){"complete"==this.readyState&&n()},o.onload=n;var i=t[0].getElementsByTagName("body")[0];return i.appendChild(o),{three:function(){return a.promise}}}angular.module("three",[]).factory("threeService",t)}(),function(){"use strict";function t(){var t=[];return{setDirect:function(e){var r=this;return r.clear(),t=e},get:function(){return t},clear:function(){t.length=0}}}angular.module("TADkit").factory("Track_data",t)}(),function(){"use strict";function t(t,e,r){var n={loaded:[],current:{index:0,tracks:[]}};return{load:function(){var r=t.defer(),a="assets/defaults/tk-defaults-users.json";return n.loaded.length>0?r.resolve(n):e.get(a).success(function(t){n.loaded=t,console.log("Users ("+t.length+") loaded from "+a),r.resolve(n)}),r.promise},add:function(t){t=t||["id","Name Surname","email@company.com","Group","edit",["default"]];var e={metadata:{version:1,type:"user",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],email:t[2],group:t[3],permissions:t[4]},projects:t[5]};return n.loaded.push(e),n.current=n.loaded.length-1,n},remove:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded.indexOf(t);return n.loaded.splice(e,1),n},set:function(t){(void 0!==t||t!==!1)&&(n.current.index=t);var e=n.loaded[n.current.index];return e},get:function(){return n},getUser:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t];return e},getPermissions:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t].permissions;return e},setTracks:function(t){n.current.tracks=t},getTracks:function(){return n.current.tracks}}}angular.module("TADkit").factory("Users",t)}();