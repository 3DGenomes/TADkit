<<<<<<< HEAD
!function(){"use strict";angular.module("TADkit",["ui.router","ngMaterial","uuid4","d3","angularAwesomeSlider"])}(),function(){"use strict";function e(e,t){t.theme("default").primaryPalette("green").accentPalette("lime",{"default":"500"}).warnPalette("red").backgroundPalette("grey"),t.theme("darkKit").dark()}angular.module("TADkit").config(e)}(),function(){"use strict";function e(e){e.$on("$stateChangeError",function(e,t,r,n,a,o){console.log("Resolve Error: ",o)})}angular.module("TADkit").run(e)}(),function(){"use strict";function e(e,t){t.otherwise("/project/loader/"),e.state("main",{controller:"MainController","abstract":!0,url:"",templateUrl:"assets/templates/main.html",resolve:{initialData:function(e){return e()}}}).state("project",{parent:"main",url:"/project",views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"sidebar-left@main":{templateUrl:"assets/templates/sidebar.project.html",controller:"SidebarProjectController"},"content@main":{templateUrl:"assets/templates/project-content.html",controller:"ProjectContentController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("loader",{parent:"project",url:"/loader/:loadDataset",views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"content@main":{templateUrl:"assets/templates/project-loader.html",controller:"ProjectLoaderController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("dataset",{parent:"project",url:"/dataset",views:{"content@main":{templateUrl:"assets/templates/project-dataset.html",controller:"ProjectDatasetController"}}}).state("overlay",{parent:"project",url:"/overlay",views:{"content@main":{templateUrl:"assets/templates/project-overlay.html",controller:"ProjectOverlayController"}}}).state("storyboard",{parent:"project",url:"/storyboard",views:{"content@main":{templateUrl:"assets/templates/project-storyboard.html",controller:"ProjectStoryboardController"}}}).state("browser",{parent:"project",url:"/browser",views:{"sidebar-left@main":{templateUrl:"assets/templates/sidebar.browser.html",controller:"SidebarBrowserController"},"content@main":{templateUrl:"assets/templates/storyboard.html",controller:"StoryboardController"}}}).state("overlay-import",{parent:"browser",url:"/overlay/import",views:{"modal@main":{templateUrl:"assets/templates/overlay-import.html",controller:"OverlayImportController"}}}).state("404",{url:"/404",templateUrl:"assets/templates/404.tpl.html",controller:"AppController"})}angular.module("TADkit").config(e)}(),function(){"use strict";function e(e){return{restrict:"EA",link:function(t,r){var n="<data-tk-component-"+t.component.object.type+' id="{{component.object.id}}-'+t.$index+'" type="component.object.type" title="{{component.object.title}}" state="component.object.state" settings="settings" view="component.view" currentparticle="currentParticle"currentposition="currentPosition"currentmodel="current.model" currentoverlay="current.overlay" data="component.data" proximities="component.proximities" overlay="component.overlay"toggleoverlay="toggleOverlay(index)" style="margin: {{component.object.state.margin}}; background-color: {{component.view.settings.background}}" class="component '+t.component.object.type+'"></data-tk-component-'+t.component.object.type+">";r.replaceWith(e(n)(t))}}}angular.module("TADkit").directive("tkComponent",e)}(),function(){"use strict";function e(e){return e.width=e.canvas_width=parseInt(e.state.width)-2*parseInt(e.state.margin),e.height=e.canvas_height=parseInt(e.state.height)-2*parseInt(e.state.margin),0===e.data.n?(e.no_hic_data=!0,e.slidevalue="10;0.001",e.slideoptions={},void 0):(e.no_hic_data=!1,parseInt(e.data.n)>e.width&&(e.canvas_width=parseInt(e.data.n)),parseInt(e.data.n)>e.height&&(e.canvas_height=parseInt(e.data.n)),e.slidevalue="10;0.001",e.slideoptions={from:10,to:.001,step:.01,round:2,skin:"blue",modelLabels:function(t){if(10==t)return"";if(.001>=t)return"ln("+Math.round(100*e.data.max)/100+")";var r=Math.log(1e4)/(e.data.max-.001),n=10/Math.exp(r*e.data.max),a=e.data.max-Math.log(t/n)/r;return"ln("+Math.round(100*a)/100+")"},callback:function(t,r){r&&(e.settings.slidevalue=e.slidevalue,e.$apply())}},void 0)}angular.module("TADkit").controller("PanelHicdataController",e)}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"=",currentoverlay:"="},templateUrl:"assets/templates/panel-hicdata.html",link:function(r){function n(){this.reset()}if(!(r.data.n<=0)){var a=r.data;r.rendered=!1,r.imageObject=new Image,r.show_tads=0!==a.tads.length;var o,i,s,l,c,g,d=.8,u={},p=!1,h=!1,m=(r.slidevalue,[]);r.highlighted_tad=-1;var b;n.prototype.reset=function(){this.m=[1,0,0,1,0,0]},n.prototype.multiply=function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],r=this.m[1]*e.m[0]+this.m[3]*e.m[1],n=this.m[0]*e.m[2]+this.m[2]*e.m[3],a=this.m[1]*e.m[2]+this.m[3]*e.m[3],o=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],i=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=r,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=i},n.prototype.invert=function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,r=-this.m[1]*e,n=-this.m[2]*e,a=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),i=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=r,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=i},n.prototype.rotate=function(e){var t=Math.cos(e),r=Math.sin(e),n=this.m[0]*t+this.m[2]*r,a=this.m[1]*t+this.m[3]*r,o=this.m[0]*-r+this.m[2]*t,i=this.m[1]*-r+this.m[3]*t;this.m[0]=n,this.m[1]=a,this.m[2]=o,this.m[3]=i},n.prototype.translate=function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t},n.prototype.scale=function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t},n.prototype.transformPoint=function(e,t){var r=e,n=t;return e=r*this.m[0]+n*this.m[2]+this.m[4],t=r*this.m[1]+n*this.m[3]+this.m[5],[e,t]};var f=new n,v=new n;r.render=function(t,n){if(b=angular.element(document.querySelector("#hic_canvas"))[0],b.getContext){console.log("Drawing hic matrix");var d=b.getContext("2d");d.imageSmoothingEnabled=!1,d.mozImageSmoothingEnabled=!1,d.imageSmoothingEnabled=!1,d.clearRect(0,0,b.width,b.height);var f,y,w,E=0,x=0;0!==a.max&&(x=Math.log(a.max)),0!==a.min&&(w=Math.log(a.min));for(var k=parseInt(r.state.width),C=parseInt(r.state.height),T=0;T<a.value.length&&(y=Math.floor(a.pos[T]%a.n),E=Math.floor(a.pos[T]/a.n),!(y>=parseInt(b.width)&&E>=parseInt(b.height)));T++)y<parseInt(b.width)&&E<parseInt(b.height)&&(f=0!==a.value[T]?a.value[T]<=t&&a.value[T]>=n?Math.floor((Math.log(a.value[T])-w)/(x-w)*255):0:0,d.fillStyle="rgba(255,0,0,"+f/255+")",d.fillRect(y,E,1,1));if(r.scale=(k-2*parseInt(r.state.margin))/(Math.sqrt(2)*a.n),r.imageObject.src=b.toDataURL(),r.rendered)return;e.d3().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},o=e.svg.brush();var t=angular.element(document.querySelector("#hic_data_container")),n=e.select(t[0]).append("svg");n.selectAll("*").remove(),i=n.attr("width",k-2*parseInt(r.state.margin)).attr("height",C-2*parseInt(r.state.margin)).style("position","absolute").style("top",2*parseInt(r.state.margin)+"px").style("left",2*parseInt(r.state.margin)+"px").append("g").attr("id","tads_svg"),s=i.append("circle").attr("id","circ_mark").style("fill","#fff").style("stroke","#ccc").style("stroke-widt",2).attr("cx",r.settings.current.particle*Math.sqrt(2)*r.scale+r.translatePos.x*Math.sqrt(2)).attr("cy",C-2*parseInt(r.state.margin)).attr("r",4),l=i.append("text").attr("id","circ_position").attr("x",r.settings.current.particle*Math.sqrt(2)*r.scale+r.translatePos.x*Math.sqrt(2)-2).attr("y",C-2*parseInt(r.state.margin)-5).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text(r.settings.current.particle);var d,b,f,y,w=0,E=0;for(T=0;T<a.tads.length;T++)w=Math.round(a.tads[T][3]/10),d=r.settings.current.segmentLength*r.settings.current.particleSegments,b=Math.round((a.tads[T][1]-r.settings.current.chromStart)/d),E=Math.round((a.tads[T][2]-r.settings.current.chromStart)/d),y=Math.round(b*Math.sqrt(2)*r.scale+r.translatePos.x*Math.sqrt(2)),f=i.append("rect").attr("id",a.tads[T][0]).attr("start",a.tads[T][1]).attr("end",a.tads[T][2]).attr("score",a.tads[T][3]).style("fill","white").style("fill-opacity",0).style("stroke","black").style("stroke-width",w).style("stroke-dasharray","3,3").attr("class","polygon_tad").attr("width",E-b+1).attr("height",E-b+1).attr("display","block").attr("x",0).attr("y",0).attr("transform","translate("+y+","+(C-2*parseInt(r.state.margin))+") scale("+r.scale+") rotate(-45 0 0)"),f.append("svg:title").text("Start:"+a.tads[T][1]+",End:"+a.tads[T][2]+",Score:"+a.tads[T][3]),m.push(f);c=i.append("rect").attr("id","contact_marker").style("fill","transparent").style("stroke","red").style("stroke-width",1).attr("width",1).attr("height",1).attr("display","block").attr("x",0).attr("y",0),g=i.append("text").attr("id","contact_marker_value").attr("x",0).attr("y",0).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text("0"),n.on("mousedown",function(){p=!0,u.x=e.event.clientX-r.translatePos.x,u.y=e.event.clientY-r.translatePos.y}),n.on("mouseup",function(){if(!h){var t=angular.element(document.querySelector("#jbrowse-iframe")).scope(),n=e.mouse(this),o=v.transformPoint(n[0],n[1]);if(o[0]<0||o[1]<0||o[0]>a.n||o[0]>a.n)c.attr("display","none"),g.attr("display","none"),angular.isUndefined(t)||t.hideTadkitMarkers();else{c.attr("x",n[0]).attr("y",n[1]).attr("width",a.n*r.scale).attr("height",a.n*r.scale).attr("transform","rotate(45 "+n[0]+" "+n[1]+")").attr("display","block");var i=Math.round(o[0])+Math.round(o[1])*a.n,s=a.pos.indexOf(i),l=0;if(s>=0&&(l=a.value[s]),g.attr("x",n[0]).attr("y",n[1]-10).text(l).attr("display","block"),!angular.isUndefined(t)){var d=r.settings.current.segmentLength*r.settings.current.particleSegments;t.updateTadkitMarkers(o[0]*d+r.settings.current.chromStart,o[1]*d+r.settings.current.chromStart)}}}h=!1,p=!1}),n.on("mouseover",function(){p=!1}),n.on("mouseout",function(){p=!1}),n.on("mousemove",function(){p&&(r.translatePos.x=e.event.clientX-u.x,r.translatePos.y=e.event.clientY-u.y,h=!0,r.update(),r.update_marks())})}),r.rendered=!0,r.imageObject.onload=function(){r.update(),r.update_marks()}}},r.$watch("settings.current.particle",function(e,t){e!==t&&(r.update(),r.update_marks())}),r.$watch("settings.slidevalue",function(e,t){if(e!==t){var n=e.split(";"),a=parseFloat(n[0]),o=parseFloat(n[1]),i=Math.log(1e4)/(r.data.max-.001),s=10/Math.exp(i*r.data.max);0!==a&&(a=Math.log(a/s)/i),0!==o&&(o=Math.log(o/s)/i),r.render(r.data.max-o,r.data.max-a)}}),r.update=function(){r.rendered||r.render(a.max,a.min);var e=document.getElementById("hic_canvas"),t=parseInt(r.state.height);if(e.getContext){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),n.save(),f.reset(),f.translate(r.translatePos.x,t-10),f.rotate(-Math.PI/4),f.scale(r.scale,r.scale),v.m=f.m.slice(),v.invert();var o=f.m;n.setTransform(o[0],o[1],o[2],o[3],o[4],o[5]),n.drawImage(r.imageObject,0,0),n.restore()}},r.update_marks=function(){var e=r.settings.current.particle*Math.sqrt(2)*r.scale+r.translatePos.x;s.attr("cx",e),l.attr("x",e).text(r.settings.current.particle),c.attr("display","none"),g.attr("display","none");var t,n,o,i=(parseInt(r.state.width),parseInt(r.state.height));if(r.show_tads)for(var d=0;d<m.length;d++)t=r.settings.current.segmentLength*r.settings.current.particleSegments,n=Math.round((a.tads[d][1]-r.settings.current.chromStart)/t),o=Math.round(n*Math.sqrt(2)*r.scale+r.translatePos.x),m[d].attr("transform","translate("+o+","+(i-2*parseInt(r.state.margin))+") scale("+r.scale+") rotate(-45 0 0)"),d!=r.highlighted_tad&&m[d].style("fill-opacity",.5),r.settings.current.position>=parseInt(m[d].attr("start"))&&r.settings.current.position<=parseInt(m[d].attr("end"))&&(r.highlighted_tad=d)},r.$watch("highlighted_tad",function(e,t){if(e!==t){if(-1==e)return m[t].style("fill-opacity",.5),!0;m[e].style("fill-opacity",0);var n,a;t>-1&&(m[t].style("fill-opacity",.5),n=Math.round((parseInt(m[t].attr("start"))-r.settings.current.chromStart)/r.settings.current.segmentLength),a=Math.ceil((parseInt(m[t].attr("end"))-r.settings.current.chromStart)/r.settings.current.segmentLength)),n=Math.round((parseInt(m[e].attr("start"))-r.settings.current.chromStart)/r.settings.current.segmentLength),a=Math.ceil((parseInt(m[e].attr("end"))-r.settings.current.chromStart)/r.settings.current.segmentLength),r.settings.current.tad_selected=e}}),r.translatePos={x:0,y:0},r.scale=1,r.increasezoom=function(){r.scale/=d,r.update(),r.update_marks()},r.reducezoom=function(){r.scale*=d,r.update(),r.update_marks()},r.toggle=function(e){r.show_tads=e;for(var t=0;t<m.length;t++)r.show_tads?m[t].attr("display","block"):(m[t].attr("display","none"),r.highlighted_tad=-1,r.settings.current.tad_selected=-1);r.update_marks()},t(function(){r.update()})}}}}angular.module("TADkit").directive("tkComponentPanelHicdata",e)}(),function(){"use strict";function e(e){e.species=e.current.dataset.object.species,e.region=e.current.dataset.object.region}angular.module("TADkit").controller("PanelInfoboxController",e)}(),function(){"use strict";function e(){return{restrict:"C",templateUrl:"assets/templates/panel-infobox.html",link:function(){}}}angular.module("TADkit").directive("tkComponentPanelInfobox",e)}(),function(){"use strict";function e(e,t){e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState},e.toggle=function(e){e=!e},e.width=parseInt(e.state.width),e.height=parseInt(e.state.height),e.atPosition=function(t){return e.$parent.settings.current.segmentUpper>=t.start&&e.$parent.settings.current.segmentLower<=t.end?!0:!1},e.formatRegionName=function(e){return"Chromosome"==e?e:"chr"+e},e.featureTitle=function(e){return e.external_name?e.external_name:e.id},e.getDetails=function(e,r){t.show(t.alert().title("Details").content(e.description).ariaLabel("Item details").ok("Close").targetEvent(r))}}angular.module("TADkit").controller("PanelInspectorController",e)}(),function(){"use strict";function e(){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"="},templateUrl:"assets/templates/panel-inspector.html",link:function(){}}}angular.module("TADkit").directive("tkComponentPanelInspector",e)}(),function(){"use strict";function e(e,t,r,n,a){e.width=e.state.width,e.height=e.state.height;var o=r.getCurrentIndex(),i=e.settings.current.chromStart-3e4;0>i&&(i=0);var s=e.settings.current.chrom;e.view.settings.leading_chr||(s=e.settings.current.chrom.replace("chr","")),e.jbrowsedataurl=encodeURIComponent(e.view.settings.species_data[e.settings.current.speciesUrl]),e.iframe_src=e.view.settings.jbrowse_path+"index.html?data="+e.jbrowsedataurl+"&loc="+s+":"+i+".."+(e.settings.current.chromEnd+3e4)+"&tracks=Restraints&highlight="+s+":"+e.settings.current.chromStart+".."+e.settings.current.chromEnd,e.updatePosition=function(t){t>=e.settings.current.chromStart&&t<=e.settings.current.chromEnd&&(e.settings.current.position=t),t<e.settings.current.chromStart&&(e.settings.current.position=e.settings.current.chromStart),t>e.settings.current.chromEnd&&(e.settings.current.position=e.settings.current.chromEnd),e.hideTadkitMarkers(),e.$apply()},e.applyOverlay=function(t,o){for(var i=r.get(),s=0;s<i.loaded.length;s++)if(i.loaded[s].object.title===t)return e.toggleOverlay(i.loaded[s].object.state.index),!0;var l,c,g,d,u={metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:n.generate(),id:i.loaded.length,title:t,source:"JBrowse track",url:"local",description:"JBrowse track overlay",type:"jbrowse",format:"variable",components:2,name:t,state:{index:0,overlaid:!1}},palette:[],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}},p=0,h=0;for(c=0;c<e.settings.current.segmentsCount;c++)u.colors.chromatin[c]="gray";var m=[],b=!1;if(angular.forEach(o,function(e){"undefined"==typeof e.get("color")?(m.push(e.get("score")),b=!0):m.push(e.get("color"))}),b){var f="#0000ff",v="#ffffff";for(g=Math.max.apply(Math,m),d=Math.min.apply(Math,m),c=0;c<m.length;c++)m[c]=d3.interpolateHcl(v,f)((m[c]-d)/(g-d))}angular.forEach(o,function(t){for(p=Math.round((t.get("start")-e.settings.current.chromStart)/e.settings.current.segmentLength),l=Math.round((t.get("end")-t.get("start"))/e.settings.current.segmentLength),c=p;p+l>c&&c<e.settings.current.segmentsCount;c++)u.colors.chromatin[c]=m[h];h++});var y=r.addDirect(u),w=i.loaded[y];w.colors.particles=[],w.colors.network.RGB=a.linePiecesRGB(w,e.settings.current.edgesCount),w.colors.network.alpha=a.linePiecesAlpha(w,e.settings.current.edgesCount),e.toggleOverlay(y)},e.toggleOverlay=function(t){e.overlaid=r.getOverlay(t).object.state.overlaid,e.overlaid?(r.setOverlaid(o),r.set(o),e.currentoverlay=r.getOverlay()):(r.setOverlaid(t),r.set(t),e.currentoverlay=r.getOverlay()),e.toggleColor(e.currentoverlay)},e.removeOverlay=function(t){var n=r.get();angular.forEach(n.loaded,function(r){r.object.title===t&&e.toggleOverlay(r.object.state.index)})}}angular.module("TADkit").controller("PanelJBrowseController",e)}(),function(){"use strict";function e(e){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"=",overlay:"=",currentoverlay:"="},templateUrl:"assets/templates/panel-jbrowse.html",link:function(t){t.$watch("settings.current.position",function(e,r){e!==r&&t.update()}),t.update=function(){t.settings.current.particle=e.getParticle(),t.settings.current.segment=e.getSegment(),t.settings.current.segmentLower=t.settings.current.position-5*t.settings.current.segment,t.settings.current.segmentUpper=t.settings.current.position+5*t.settings.current.segment;var r=angular.element(document.querySelector("#jbrowse-iframe")).scope();!angular.isUndefined(r)&&r.updateTadkitBar&&r.updateTadkitBar(t.settings.current.position)},t.toggleColor=function(e){t.currentoverlay=e,t.$apply(t.currentoverlay.colors.chromatin)}}}}angular.module("TADkit").directive("tkComponentPanelJbrowse",e)}(),function(){"use strict";function e(e,n){return function(a,o,i){var s={visible:!0,genomeLength:816394,particles:0,particleSegments:40,curveSegments:1,radius:15,radiusSegments:16,endcap:!1,pathClosed:!1,tubed:!0};i=i||{},angular.extend(this,angular.copy(s),i);for(var l=t(a),c=l.vertices.length-1;c>=0;c--){var g=new THREE.Color(o[20*c]);l.colors.unshift(g)}var d=n.cubic(l.vertices,this.pathClosed);0===this.particles&&(this.particles=l.vertices.length);var u=this.particles*this.particleSegments;this.pathSegments=u;for(var p=e.cubicBezier(d.vertices,u,this.pathClosed),h=p.createPointsGeometry(u),m=h.vertices.length-1;m>=0;m--){var b=new THREE.Color(o[m]);h.colors.unshift(b)}h.name="cubicGeom";var f=p.getLength(),v=5,y=11*this.genomeLength/1080;this.radius=f*v/y;var w,E=new THREE.Object3D;if(i.tubed){w=new THREE.TubeGeometry(p,u,4,8,this.pathClosed),w.dynamic=!0,w.verticesNeedUpdate=!0;for(var x=new THREE.Mesh(w,new THREE.MeshLambertMaterial({color:16777215,wireframe:!1,transparent:!1,vertexColors:THREE.FaceColors,overdraw:!0})),k=0;k<w.faces.length;k++)w.faces[k].color.setRGB(1,0,0);x.dynamic=!0,x.needsUpdate=!0,E.add(x)}else{w=new THREE.Geometry;for(var C=0;u>C;C++){this.endcap=0===C||C===u-1?!1:!0;var T=o[C],R=new THREE.MeshLambertMaterial({color:T,emissive:T,vertexColors:THREE.VertexColors,opacity:1,transparent:!1,wireframe:!1}),S=r(h.vertices[C],h.vertices[C+1],this);w.merge(S);var j=new THREE.Mesh(S,R);j.name="segment-"+(C+1),E.add(j)}}{var H=new THREE.LineBasicMaterial({color:"#0000ff"});new THREE.Line(h,H)}return w.computeBoundingSphere(),E.boundingSphere=w.boundingSphere,E.name="Chromatin Fiber",E}}function t(e){for(var t,r=0,n=new THREE.Geometry,a=e.length;a>r;)t=new THREE.Vector3,t.x=e[r++],t.y=e[r++],t.z=e[r++],n.vertices.push(t);return n.name="Chromatin Geometry",n}function r(e,t,r){var n,a=(new THREE.Vector3).subVectors(t,e),o=new THREE.Matrix4;o.lookAt(e,t,(new THREE.Object3D).up);var i=new THREE.Matrix4;return i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),o.multiply(i),o.setPosition(e.add(t).multiplyScalar(.5)),n=new THREE.CylinderGeometry(r.radius,r.radius,a.length(),r.radiusSegments,r.curveSegments,r.endcap),n.applyMatrix(o),n}angular.module("TADkit").factory("Chromatin",e)}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{state:"=",type:"=",title:"@",settings:"=",view:"=",id:"@",cluster:"=",overlay:"="},templateUrl:"assets/templates/scene-cluster-icon.html",link:function(r,n){var a,o,i,s,l,c,g,d,u,p,h,m,b;r.init=function(){i=n[0].children[0].children[0],m=parseInt(r.state.width),b=parseInt(r.state.height),a=window.WebGLRenderingContext?new THREE.WebGLRenderer({alpha:!0,antialias:!0}):new THREE.CanvasRenderer({alpha:!0});var f=r.view.settings.background,v="0x"+f.substring(1);a.setClearColor(parseInt(v)),a.setSize(m,b),a.autoClear=!1,a.setSize(m,b),i.appendChild(a.domElement),o=new THREE.Scene,s=new THREE.PerspectiveCamera(r.view.viewpoint.fov,m/b,r.view.viewpoint.near,r.view.viewpoint.far),s.position.fromArray(r.view.viewpoint.camera),s.name="Scene Camera",d=new THREE.OrbitControls(s,a.domElement),d.autoRotate=r.view.controls.autoRotate,d.autoRotateSpeed=r.view.controls.autoRotateSpeed,d.enableZoom=!1,d.enableRotate=!1,d.enablePan=!1,d.enableKeys=!1,u=new THREE.TrackballControls(s,a.domElement),u.noZoom=!0,u.noRotate=!0,u.noPan=!0,p=new e(r.cluster.data[r.cluster.centroidIndex],r.view.settings.particles),p.geometry.center(),p.visible=r.view.settings.particles.visible,o.add(p),h=new t(r.cluster.data,r.cluster.centroidIndex,r.overlay,r.view.settings.cluster),h.visible=r.view.settings.cluster.visible,h.name=h.name+" "+r.id.match(/\d+/)[0],o.add(h),l=new THREE.Vector3,c=new THREE.Vector3(0,0,0);var y=r.view.viewpoint.fov/2,w=.6,E=Math.tan(y).toFixed(2)*w;g=h.boundingSphere.radius*E,r.lookAtTarget(l,c,g)},r.lookAtTarget=function(e,t,r){e=e||new THREE.Vector3(5e4,5e4,5e4);var n=new THREE.Vector3(0,0,0);t=t||n,r=r||500,s.position.set(e.x,e.y,e.z),s.lookAt(n),s.translateZ(r),s.lookAt(t),s.updateMatrixWorld(),u.target.copy(e)},r.animate=function(){requestAnimationFrame(r.animate),d.update(),u.update(),r.render()},r.render=function(){a.render(o,s)},r.init(),r.animate(),r.destroy_scene=function(){o.remove(h),o.remove(p),p.geometry.dispose(),p.material.dispose();for(var e=0;e<h.children.length;e++)h.children[e].geometry.dispose(),h.children[e].material.dispose();p=void 0,h=void 0,a&&a.forceContextLoss()},r.$on("$destroy",function(){r.destroy_scene()})}}}angular.module("TADkit").directive("tkComponentSceneCluster",e)}(),function(){"use strict";function e(e){return function(r,n,a,o){var i={visible:!0};o=o||{},angular.extend(this,angular.copy(i),o);for(var s=0,l=e.colorsFromHex(a),c=new THREE.Object3D,g=0;g<r.length;g++){var d=r[g],u=t(d);u.colors=l;var p=(a[g],new THREE.LineBasicMaterial({color:new THREE.Color(parseInt(this.color)),opacity:this.modelOpacity,transparent:this.transparent,linewidth:this.linewidth,fog:this.fog})),h=new THREE.LineBasicMaterial({opacity:this.centroidOpacity,transparent:this.transparent,linewidth:this.linewidth,vertexColors:THREE.VertexColors,fog:this.fog});g==n&&(p=h);var m=new THREE.Line(u,p);m.name="model-"+g,m.geometry.computeBoundingSphere(),m.geometry.boundingSphere.radius>s&&(s=m.geometry.boundingSphere.radius),c.add(m)}for(g=0;g<c.children.length;g++)c.children[g].geometry.center();return c.boundingSphere=c.children[0].geometry.boundingSphere.clone(),c.boundingSphere.radius=s,c.name="Cluster Ensemble",c}}function t(e){for(var t,r=0,n=new THREE.Geometry,a=e.length;a>r;)t=new THREE.Vector3,t.x=e[r++],t.y=e[r++],t.z=e[r++],n.vertices.push(t);return n}angular.module("TADkit").factory("Cluster",e)}(),function(){"use strict";function e(){return{restrict:"EA",link:function(e,t){function r(){o=t[0],i=o.clientWidth,l=new THREE.Scene,s=new THREE.PerspectiveCamera(50,1,150,650),s.position.z=500,l.add(s),g=new THREE.TorusKnotGeometry(100,30,100,16),d=new THREE.MeshDepthMaterial({wireframe:!0,wireframeLinewidth:1}),u=new THREE.Mesh(g,d),u.name="Floating TAD",l.add(u),c=window.WebGLRenderingContext?new THREE.WebGLRenderer({alpha:!0}):new THREE.CanvasRenderer({alpha:!0}),c.setSize(i,i),o.appendChild(c.domElement),p=new THREE.TrackballControls(s,c.domElement),p.minDistance=450,p.maxDistance=550}function n(){requestAnimationFrame(n),p.update(),a()}function a(){u.rotation.x+=.006,u.rotation.y+=.006,c.render(l,s)}var o,i,s,l,c,g,d,u,p;r(),n()}}}angular.module("TADkit").directive("tkComponentSceneFloatingtad",e)}(),function(){"use strict";function e(){return function(e,n,a){var o={color:"#ff0000",size:200,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0,visible:!1};a=a||{},angular.extend(this,angular.copy(o),a);var i={color:{type:"c",value:new THREE.Color(65280)},alpha:{type:"f",value:1}},s={uniforms:i,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,vertexColors:THREE.VertexColors,transparent:!0},l=new THREE.ShaderMaterial(s);l.linewidth=1;var c=e.length/3,g=.5*(c*c-c),d=t(e,g),u=n.RGB,p=n.alpha,h=new THREE.BufferGeometry;h.addAttribute("position",new THREE.BufferAttribute(d,3)),h.addAttribute("color",new THREE.BufferAttribute(u,3)),h.addAttribute("alpha",new THREE.BufferAttribute(p,1)),h.center(),h.computeBoundingSphere();var m=null;if(this.map){var b=new THREE.TextureLoader;m=b.load(this.map)}var f=new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:m,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),v=r(e);v.center(),v.computeBoundingSphere();for(var y=[],w=0;w<v.vertices.length;w++)y[w]=new THREE.Color("rgb(255,255,255)");v.colors=y;var E=new THREE.Points(v,f);E.name="Network Nodes";var x=new THREE.LineSegments(h,l);x.name="Network Edges";var k=new THREE.Object3D;return k.add(x),k.add(E),k.boundingSphere=h.boundingSphere,k.name="Network Graph",k}}function t(e,t){for(var r=new Float32Array(6*t),n=0,a=0;a<e.length;a+=3)for(var o=a,i=a+3;i<e.length;i+=3){var s=i;r[n]=e[o],n++,r[n]=e[o+1],n++,r[n]=e[o+2],n++,r[n]=e[s],n++,r[n]=e[s+1],n++,r[n]=e[s+2],n++}return r.name="Network Vertex Pairs",r}function r(e){for(var t,r=0,n=new THREE.Geometry,a=e.length;a>r;)t=new THREE.Vector3,t.x=e[r++],t.y=e[r++],t.z=e[r++],n.vertices.push(t);return n.name="Particles Geometry",n}angular.module("TADkit").factory("Network",e)}(),function(){"use strict";function e(){return function(e,r,n){var a={particles:0,visible:!0,color:"#ff0000",size:100,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0};n=n||{},angular.extend(this,angular.copy(a),n);var o=t(e);o.computeBoundingSphere();for(var i=[],s=0;s<o.vertices.length;s++)i[s]=new THREE.Color("rgb(255,255,255)");o.colors=i;var l=null;if(this.map){var c=new THREE.TextureLoader;l=c.load(this.map)}var g=new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:l,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),d=new THREE.Points(o,g);return d.name="Particles Cloud",d}}function t(e){for(var t,r=0,n=new THREE.Geometry,a=e.length;a>r;)t=new THREE.Vector3,t.x=e[r++],t.y=e[r++],t.z=e[r++],n.vertices.push(t);return n.name="Particles Geometry",n}angular.module("TADkit").factory("Particles",e)}(),function(){"use strict";function e(){return{restrict:"EA",scope:{id:"@",type:"=",data:"=",view:"=",overlay:"=",state:"="},link:function(e,t){function r(){o=t[0],s=new THREE.Scene,i=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e4),i.position.z=500,s.add(i);var r=200;c=new THREE.BoxGeometry(r,r,r);var n="#"+e.overlay;g=new THREE.MeshLambertMaterial({color:n,ambient:n,emissive:n,opacity:1,transparent:!1,wireframe:!1}),d=new THREE.Mesh(c,g),d.name="testmesh",s.add(d),l=window.WebGLRenderingContext?new THREE.WebGLRenderer({alpha:!0}):new THREE.CanvasRenderer({alpha:!0}),l.setSize(window.innerWidth,window.innerHeight),o.appendChild(l.domElement);var a=s.getObjectByName("testmesh");e.$watch("overlay",function(t,r){if(t!==r){var n=new THREE.Color("#"+e.overlay);a.material.color=n,a.material.ambient=n,a.material.emissive=n}})}function n(){requestAnimationFrame(n),a()}function a(){d.rotation.x+=.01,d.rotation.y+=.02,l.render(s,i)}var o,i,s,l,c,g,d;r(),n()}}}angular.module("TADkit").directive("tkComponentSceneThreetest",e)}(),function(){"use strict";function e(e){e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState},e.toggle=function(e){e=!e,console.log(e)}}angular.module("TADkit").controller("SceneController",e)}(),function(){"use strict";function e(e,t,r,n,a,o){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",state:"=",currentmodel:"=",proximities:"=",currentoverlay:"="},templateUrl:"assets/templates/scene.html",link:function(n,a){var i,s,l,c,g,d,u,p,h,m,b,f,v,y,w,E,x,k,C,T,R,S,j,H,A,I,M=new THREE.Color,D=new THREE.Color,B=new THREE.Color("rgb(0,0,0)");n.init=function(){n.complete_scene=function(){if(n.view.settings.particles.size=n.settings.current.particleSize,f=new e(n.currentmodel.data,n.currentoverlay.colors.particles,n.view.settings.particles),f.visible=n.view.settings.particles.visible,i.add(f),n.view.settings.chromatin.particleSegments=n.settings.current.particleSegments,v=new t(n.currentmodel.data,n.currentoverlay.colors.chromatin,n.view.settings.chromatin),v.visible=n.view.settings.chromatin.visible,i.add(v),n.view.settings.chromatin.radius=v.boundingSphere.radius,n.view.settings.chromatin.tubed){var a=new THREE.RingGeometry(6,10,50);E=new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:3329330,side:THREE.DoubleSide})),E.position.x=f.geometry.vertices[0].x,E.position.y=f.geometry.vertices[0].y,E.position.z=f.geometry.vertices[0].z,i.add(E),w=new THREE.Object3D;for(var o,s,l,c,g=n.settings.current.segmentLength*n.settings.current.particleSegments,d=0;d<n.data.tad_data.tads.length;d++){o=Math.round((n.data.tad_data.tads[d][1]-n.settings.current.chromStart)/g),s=Math.round((n.data.tad_data.tads[d][2]-n.settings.current.chromStart)/g),c=new THREE.Vector3;for(var u=o;s>=u;u++)c.add(f.geometry.vertices[u]);for(c.divideScalar(s-o+1),l=0,u=o;s>=u;u++)c.distanceTo(f.geometry.vertices[u])>l&&(l=c.distanceTo(f.geometry.vertices[u]));var p=new THREE.SphereGeometry(l-10,32,16),h=new THREE.MeshPhongMaterial({color:0,transparent:!0,blending:THREE.AdditiveBlending,opacity:.3}),m=new THREE.Mesh(p,h);m.material.emissive=new THREE.Color(0),m.position.x=c.x,m.position.y=c.y,m.position.z=c.z,w.add(m)}w.name="TADs cloud",i.add(w),T=i.getObjectByName("TADs cloud")}y=new r(n.data.data,n.overlay.colors.network,n.view.settings.network),y.visible=n.view.settings.network.visible,i.add(y)},s=a[0].children[0].children[3],R=parseInt(n.state.width),window.innerWidth<=1280&&(R=600),S=parseInt(n.state.height),b=window.WebGLRenderingContext?new THREE.WebGLRenderer({alpha:!0,antialias:!0}):new THREE.CanvasRenderer({alpha:!0});var j=n.view.settings.background,H="0x"+j.substring(1);b.setClearColor(parseInt(H)),b.setSize(R,S),b.autoClear=!1,s.appendChild(b.domElement),i=new THREE.Scene,l=new THREE.PerspectiveCamera(n.view.viewpoint.fov,R/S,n.view.viewpoint.near,n.view.viewpoint.far),l.position.fromArray(n.view.viewpoint.camera),l.name="Scene Camera",i.add(l),m=new THREE.TrackballControls(l,b.domElement),h=new THREE.OrbitControls(l,b.domElement),h.autoRotate=n.view.controls.autoRotate,h.autoRotateSpeed=n.view.controls.autoRotateSpeed,h.enableZoom=!1,h.enableRotate=!1,h.enablePan=!1,h.enableKeys=!1;var A=new THREE.AxisHelper(n.view.settings.axis.size);A.visible=n.view.settings.axis.visible,A.name="Axis",i.add(A);var I=n.view.settings.lighting.ambient;
u=new THREE.AmbientLight(I),u.name="Scene Ambient Light",i.add(u),n.complete_scene(),c=v.boundingSphere.center,g=v.boundingSphere.center,d=v.boundingSphere.radius*n.view.viewpoint.scale,n.lookAtTAD(c,g,d);var P=n.view.settings.lighting.color,O=n.view.settings.lighting.intensity;p=new THREE.PointLight(P,O),p.name="Scene Light",l.add(p);var $=1.5*d;p.position.set($,$,-1*$);var L=1e3,z=(new THREE.PointLightHelper(p,L),d*n.view.viewpoint.fogNear),_=d*n.view.viewpoint.fogFar;n.view.viewpoint.fog&&(i.fog=new THREE.Fog(j,z,_)),n.$watch("view.controls.autoRotate",function(e,t){e!==t&&(h.autoRotate=n.view.controls.autoRotate)}),n.$watch("view.settings.axis.visible",function(e,t){e!==t&&(A.visible=!A.visible)}),n.$watch("view.settings.particles.visible",function(e,t){e!==t&&(f.visible=!f.visible)}),n.$watch("view.settings.chromatin.visible",function(e,t){e!==t&&(v.visible=!v.visible)}),n.$watch("view.settings.network.visible",function(e,t){e!==t&&(y.visible=!y.visible)}),x=i.getObjectByName("Particles Cloud"),k=i.getObjectByName("Chromatin Fiber"),C=i.getObjectByName("Network Graph"),n.$watch("currentoverlay.colors.particles",function(e,t){}),n.$watch("currentoverlay.colors.chromatin",function(e,t){if(e!==t){var r,a,i,s=k.children.length;if(n.view.settings.chromatin.tubed){for(r=0;r<e.length;r++)for(i=o.testIfHex(e[r])||0===e[r].indexOf("#")?new THREE.Color(e[r]):new THREE.Color(o.nameToHex(e[r])),a=0;16>a;a++)k.children[0].geometry.faces[16*r+a].color.set(i);k.children[0].geometry.colorsNeedUpdate=!0}else for(s=k.children.length,r=0;s>r;r++)i=new THREE.Color(e[r]),k.children[r].material.color=i,k.children[r].material.ambient=i,k.children[r].material.emissive=i}}),n.toggleTubed=function(e){n.clean_scene(),n.view.settings.chromatin.tubed=e,n.complete_scene(),n.view.settings.chromatin.tubed&&(T=i.getObjectByName("TADs cloud")),x=i.getObjectByName("Particles Cloud"),k=i.getObjectByName("Chromatin Fiber"),C=i.getObjectByName("Network Graph")},n.$watch("settings.current.tad_selected",function(e,t){if(e!==t){var r;if(n.view.settings.chromatin.tubed){var a=T.children.length,o=new THREE.Color(16711680),i=new THREE.Color(0);for(r=0;a>r;r++)r==n.settings.current.tad_selected?(T.children[r].material.opacity=.2,T.children[r].material.emissive.set(o)):-1==e?T.visible=!1:(T.children[r].material.opacity=.3,T.children[r].material.color.set(i),T.children[r].material.emissive.set(i)),T.children[r].geometry.colorsNeedUpdate=!0}else{var s,l,c=k.children.length,g=n.settings.current.segmentLength*n.settings.current.particleSegments;for(e>-1&&(s=Math.round((n.data.tad_data.tads[e][1]-n.settings.current.chromStart)/g)*n.settings.current.particleSegments,l=Math.round((n.data.tad_data.tads[e][2]-n.settings.current.chromStart)/g)*n.settings.current.particleSegments),r=0;c>r;r++)k.children[r].material.opacity=r>=s&&l>=r?1:-1==e?1:.5}}}),n.$watch("currentoverlay.colors.network",function(e,t){e!==t&&C.geometry&&(C.geometry.addAttribute("color",new THREE.BufferAttribute(e.RGB,3)),C.geometry.addAttribute("alpha",new THREE.BufferAttribute(e.alpha,1)))}),n.$watch("settings.current.particle",function(e,t){e!==t&&x&&(M&&(x.geometry.colors[t-1]=M),M=x.geometry.colors[e-1],x.geometry.colors[e-1]=B,x.geometry.colorsNeedUpdate=!0)}),n.$watch("settings.current.segment",function(e,t){if(e!==t){if(n.view.settings.chromatin.tubed){if(k.children[0].geometry.vertices.length>8*(e+1)+8){var r,a;for(r=k.children[0].geometry.vertices[8*(e+1)],a=1;8>a;a++)r.add(k.children[0].geometry.vertices[8*(e+1)+a]);for(r.divideScalar(8),E.position.x=r.x,E.position.y=r.y,E.position.z=r.z,r=k.children[0].geometry.vertices[8*t],a=1;8>a;a++)r.add(k.children[0].geometry.vertices[8*t+a]);r.divideScalar(8),E.lookAt(r)}return}var o=k.getObjectByName("segment-"+t);D&&o&&(o.material.color=D,o.material.ambient=D,o.material.emissive=D);var i=k.getObjectByName("segment-"+e);i&&(D=i.material.color,i.material.color=B,i.material.ambient=B,i.material.emissive=B)}})},n.onWindowResize=function(){n.resizeCanvas()},n.resizeCanvas=function(){j=.66*s.parentNode.clientWidth,H=.66*j,A=j/2,I=H/2,l.aspect=j/H,l.updateProjectionMatrix(),b.setSize(j,H)},n.lookAtTAD=function(e,t,r){e=e||new THREE.Vector3(5e4,5e4,5e4);var n=new THREE.Vector3(0,0,0);t=t||n,r=r||500,l.position.set(e.x,e.y,e.z),l.lookAt(n),l.translateZ(r),l.lookAt(t),l.updateMatrixWorld(),m.target.copy(e)},n.animate=function(){requestAnimationFrame(n.animate),h.update(),m.update(),n.render()},n.render=function(){b.render(i,l)},n.clean_scene=function(){var e;if(i.remove(f),i.remove(v),i.remove(y),i.remove(x),i.remove(k),i.remove(C),f.geometry.dispose(),f.material.dispose(),x.geometry.dispose(),x.material.dispose(),n.view.settings.chromatin.tubed){for(i.remove(w),i.remove(T),e=0;e<w.children.length;e++)w.children[e].geometry.dispose(),w.children[e].material.dispose(),T.children[e].geometry.dispose(),T.children[e].material.dispose();w=void 0,T=void 0}else for(e=0;e<v.children.length;e++)v.children[e].geometry.dispose(),v.children[e].material.dispose(),k.children[e].geometry.dispose(),k.children[e].material.dispose();for(e=0;e<y.children.length;e++)y.children[e].geometry.dispose(),y.children[e].material.dispose(),C.children[e].geometry.dispose(),C.children[e].material.dispose();f=void 0,x=void 0,k=void 0,v=void 0,y=void 0,C=void 0},n.$on("$destroy",function(){n.clean_scene()}),n.init(),n.animate()}}}angular.module("TADkit").directive("tkComponentScene",e)}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n){e.d3().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var a,o,i,s,l,c,g,d,u,p,h,m,b,f=r.data,v=r.view.viewpoint.chromStart,y=r.view.viewpoint.chromEnd,w=r.settings.current.particlesCount,E=parseInt(r.view.settings.margin),x={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},k=parseInt(r.view.settings.heightInner),C=(r.view.settings.color,r.overlay.palette[0]),T=r.overlay.palette[1],R=n[0].parentNode,S=n[0].children[0].children[3],j=e.select(S).append("svg");r.$watch(function(){var e=R.clientWidth,t=R.clientHeight;return e+t},function(){r.render(f)}),r.$watch("data.dimension",function(e,t){e!==t&&(f=r.data,r.render(f))}),r.$watch("settings.current.position",function(e,t){e!==t&&r.update()}),r.getColor=function(e){for(var t=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=t.length-1;n>=0;n--)e==t[n].code&&(r=t[n].color);return r},r.getOpacity=function(e){var t,r=e/5;return t=r*r},r.getStrokeWidth=function(e){var t=10,r=e/5;return t*=r},r.render=function(t){if(j.selectAll("*").remove(),t){var n=R.clientWidth-2*E-x.left-x.right,f=k-x.top-x.bottom,S=1*n/w,H=S;a=e.scale.linear().range([0,n]).domain([v,y]).clamp(!0),o=e.scale.linear().domain([-5,5]).range([0,f]),i=e.svg.axis().scale(o).orient("left").ticks(6).outerTickSize(1);var A=2;s=e.svg.brush().x(a).extent([0,0]).on("brush",r.brushed),l=j.attr("width",n+x.left+x.right).attr("height",f+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(s),l.append("g").attr("class","y axis").append("line").attr("y1",o(0)).attr("y2",o(0)).attr("x1",0).attr("x2",n),l.select(".background").attr("y",f/2).attr("height",f),c=l.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",f).style("fill","white"),g=l.append("g").attr("class","focus"),d=g.append("g").attr("class","container").attr("clip-path","url(#clip)"),h=d.append("g").attr("class","harmonics"),m=d.append("g").attr("class","lowerbounds"),u=g.append("g").attr("class","axis y").call(i),p=l.append("g").attr("class","labels"),h.selectAll("rect").data(t.harmonics).enter().append("rect").attr("x",function(e){return e[1]*H}).attr("y",function(e){return o(e[3])}).attr("width",H).attr("height",function(e){return o(e[3])}).style("fill",C).style("stroke",C).style("stroke-width",0).append("svg:title").text(function(e,t){return t+":"+e}),m.selectAll("rect").data(t.lowerBounds).enter().append("rect").attr("x",function(e){return e[1]*H}).attr("y",function(e){return o(Math.max(0,-1*e[3]))}).attr("width",H).attr("height",function(e){return o(e[3])}).style("fill",T).style("stroke",T).style("stroke-width",0).append("svg:title").text(function(e,t){return t+":"+e}),b=l.append("rect").attr("id","highlight").attr("x",function(){return a(r.settings.current.position)}).attr("y",0).attr("width",A).attr("height",k).attr("class","highlight-follow")}},r.update=function(){j.select("#highlight").attr("x",function(){return a(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var o=s.extent()[0];e.event.sourceEvent&&(o=parseInt(a.invert(e.mouse(n)[0])),s.extent([o,o])),b.attr("x",a(o)),r.settings.current.position=o,r.settings.current.particle=t.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(f)})}}}angular.module("TADkit").directive("tkComponentTrackBarchart",e)}(),function(){"use strict";function e(e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(t,r){e.d3().then(function(e){var n,a,o,i,s,l,c,g=t.data,d=t.view.settings.step,u=t.view.viewpoint.chromStart,p=t.view.viewpoint.chromEnd,h=p-u,m=parseInt(t.view.settings.margin),b={top:parseInt(t.view.settings.padding.top),right:parseInt(t.view.settings.padding.right),bottom:parseInt(t.view.settings.padding.bottom),left:parseInt(t.view.settings.padding.left)},f=parseInt(t.view.settings.heightInner),v=.5*f,y=.5*(f-v),w=(t.view.settings.color,r[0].parentNode),E=r[0].children[0].children[3],x=e.select(E).append("svg");t.$watch(function(){var e=w.clientWidth,t=w.clientHeight;return e+t},function(){t.render(g)}),t.$watch("settings.current.position",function(){t.update()},!0);e.behavior.zoom().on("zoom",function(){t.update()});t.render=function(r){if(x.selectAll("*").remove(),r){var g=w.clientWidth-2*m-b.left-b.right,E=f-b.top-b.bottom;n=d*g/h,c=e.scale.linear().range([0,g]).clamp(!0),c.domain([u,p]),i=e.svg.axis().scale(c).orient("top").ticks(0).outerTickSize(0);var k=2;a=x.attr("width",g+b.left+b.right).attr("height",E+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),o=a.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",g).attr("height",E).style("fill","white"),s=a.append("g").attr("class","focus"),l=s.append("g").attr("class","container").attr("clip-path","url(#clip)");{a.append("g").attr("class","labels"),l.selectAll("rect").data(r).enter().append("rect").attr("x",function(e){return Math.floor(c(e.start))}).attr("y",y).attr("width",function(e){return Math.ceil(c(e.end)-c(e.start))}).attr("height",v).attr("class",function(e){return 1==e.read?t.title:void 0}).append("svg:title").text(function(e){return e.start+":"+e.end+"("+e.read+")"}),a.append("rect").attr("id","highlight").attr("x",function(){return c(t.settings.current.position-.5*d)}).attr("y",0).attr("width",k).attr("height",f).attr("class","highlight-follow")}}},t.update=function(){x.select("#highlight").attr("x",function(){return c(t.settings.current.position-.5*d)})}})}}}angular.module("TADkit").directive("tkComponentBedgraph",e)}(),function(){"use strict";function e(e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(t,r){e.d3().then(function(e){var n=t.data,a=32e8;t.settings.current.position||(t.settings.current.position=a/2);var o=t.view.viewpoint.chromStart,i=t.view.viewpoint.chromEnd,s=i-o,l=1e3,c=a/s,g=.05*c;c-=2*g;var d,u,p,h,m,b,f=.5*s,v=.5*a,y=parseInt(t.view.settings.margin),w={top:parseInt(t.view.settings.padding.top),right:parseInt(t.view.settings.padding.right),bottom:parseInt(t.view.settings.padding.bottom),left:parseInt(t.view.settings.padding.left)},E=parseInt(t.view.settings.heightInner),x=10,k=r[0].parentNode,C=r[0].children[0].children[3],T=e.select(C).append("svg");t.$watch(function(){var e=k.clientWidth,t=k.clientHeight;return e+t},function(){t.render(n)}),t.$watch("data",function(e,r){e!==r&&t.render(e)}),t.$watch("settings.current.position",function(e,r){e!==r&&t.update()});e.behavior.zoom().on("zoom",function(){t.update()});t.render=function(r){if(T.selectAll("*").remove(),r){var n=k.clientWidth-2*y-w.left-w.right,a=E-w.top-w.bottom;b=e.scale.linear().range([0,n]).clamp(!0),b.domain([o,i]),p=e.svg.axis().scale(b).orient("top").ticks(0).outerTickSize(0);{var s=2;b(v)-b(f)}d=T.attr("width",n+w.left+w.right).attr("height",a+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")"),u=d.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",a).style("fill","white"),h=d.append("g").attr("class","focus"),m=h.append("g").attr("class","container").attr("clip-path","url(#clip)");var c=(h.append("g").attr("class","x axis").attr("transform","translate(0,"+x+")").call(p),d.append("g").attr("class","labels"));c.append("text").attr("x",-18).attr("y",8).style("text-anchor","right").style("font-size","10px").text("<<"),c.append("text").attr("x",-18).attr("y",18).style("text-anchor","right").style("font-size","10px").text(">>");{m.selectAll("rect").data(r).enter().append("rect").attr("x",function(e){return Math.floor(b(e.start))}).attr("y",function(e){return t.view.settings.sense?e.strand<1?x:0:0}).attr("width",function(e){return Math.ceil(b(e.end)-b(e.start))}).attr("height",function(){return t.view.settings.sense?x:2*x}).attr("class",function(e){var t=e.biotypeStyle;return t+=e.strand<1?" forward-strand":" reverse-strand"}).append("svg:title").text(function(e){return e.external_name}),d.append("rect").attr("id","highlight").attr("x",function(){return b(t.settings.current.position-.5*l)}).attr("y",0).attr("width",s).attr("height",E).attr("class","highlight-follow")}}},t.update=function(){T.select("g.x.axis").call(p),m.selectAll("rect").attr("x",function(e){return Math.floor(b(e.start))}).attr("y",function(e){return t.view.settings.sense?e.strand<1?x:0:0}).attr("width",function(e){return Math.ceil(b(e.end)-b(e.start))}).attr("height",function(){return t.view.settings.sense?x:2*x}),T.select("#highlight").attr("x",function(){return b(t.settings.current.position-.5*l)})}})}}}angular.module("TADkit").directive("tkComponentTrackGenes",e)}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n){e.d3().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var a,o,i,s,l,c,g,d,u,p,h=r.data.distances,m=r.view.viewpoint.chromStart,b=r.view.viewpoint.chromEnd,f=r.settings.current.particlesCount,v="clip"+r.title,y="url(#"+v+")",w=parseInt(r.view.settings.margin),E={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},x=parseInt(r.view.settings.heightInner),k=.5*x,C=.5*(x-k),T=r.view.settings.color,R=n[0].parentNode,S=n[0].children[0].children[3],j=e.select(S).append("svg");r.$watch(function(){var e=R.clientWidth,t=R.clientHeight;return e+t},function(){r.render(h)}),r.$watch("data.dimension",function(e,t){e!==t&&(h=r.data.distances,r.render(h))}),r.$watch("settings.current.position",function(e,t){e!==t&&r.update()}),r.render=function(t){if(j.selectAll("*").remove(),t){var n=R.clientWidth-2*w-E.left-E.right,h=x-E.top-E.bottom,S=1*n/f;a=e.scale.linear().range([0,n]).clamp(!0),a.domain([m,b]),o=e.svg.axis().scale(a).orient("top").ticks(0).outerTickSize(0);var H=2;i=e.svg.brush().x(a).extent([0,0]).on("brush",r.brushed),s=j.attr("width",n+E.left+E.right).attr("height",h+E.top+E.bottom).append("g").attr("transform","translate("+E.left+","+E.top+")").call(i),s.select(".background").attr("y",h/2).attr("height",h),l=s.append("defs").append("clipPath").attr("id",v).append("rect").attr("width",n).attr("height",h).style("fill","white"),c=s.append("g").attr("class","focus"),g=c.append("g").attr("class","container").attr("clip-path",y),d=s.append("g").attr("class","labels"),u=g.selectAll("rect").data(t).enter().append("rect").attr("x",function(e,t){return t*S}).attr("y",C).attr("width",S).attr("height",k).style("fill",T).style("fill-opacity",function(e){return e*e}).style("stroke",T).style("stroke-width",0).append("svg:title").text(function(e,t){return t+":"+e}),p=s.append("rect").attr("id","highlight").attr("x",function(){return a(r.settings.current.position)}).attr("y",0).attr("width",H).attr("height",x).attr("class","highlight-follow"),p.call(i.extent([r.settings.current.position,0])).call(i.event)}},r.update=function(){j.select("#highlight").attr("x",function(){return a(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var o=i.extent()[0];e.event.sourceEvent&&(o=parseInt(a.invert(e.mouse(n)[0])),i.extent([o,o])),p.attr("x",a(o)),r.settings.current.position=o,r.settings.current.particle=t.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(h)})}}}angular.module("TADkit").directive("tkComponentTrackProximities",e)}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n){e.d3().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var a,o,i,s,l,c,g,d,u,p,h,m=r.data,b=r.view.viewpoint.chromStart,f=r.view.viewpoint.chromEnd,v=r.settings.current.particlesCount,y="clip"+r.title,w="url(#"+y+")",E=parseInt(r.view.settings.margin),x={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},k=2,C=parseInt(r.view.settings.heightInner),T=r.view.settings.nodeSize,R=x.top+.5*T,S=(r.view.settings.color,r.overlay.palette[0]),j=r.overlay.palette[1],H=n[0].parentNode,A=n[0].children[0].children[3],I=e.select(A).append("svg");r.$watch(function(){var e=H.clientWidth,t=H.clientHeight;return e+t},function(){r.render(r.data)}),r.$watch("data.dimension",function(e,t){e!==t&&(m=r.data,r.render(m))}),r.$watch("settings.current.position",function(e,t){e!==t&&r.update()}),r.getColor=function(e){for(var t=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=t.length-1;n>=0;n--)e==t[n].code&&(r=t[n].color);return r},r.getOpacity=function(e){var t,r=e/k;return t=r*r},r.getStrokeWidth=function(e){var t=5,r=e/5;return t*=r},r.render=function(t){if(I.selectAll("*").remove(),t){var n=H.clientWidth-2*E-x.left-x.right,m=C-x.top-x.bottom,k=1*n/v;a=e.scale.linear().range([0,n]).clamp(!0),a.domain([b,f]),o=e.svg.axis().scale(a).orient("top").ticks(0).outerTickSize(0),i=e.svg.axis().scale(a).orient("bottom").ticks(0).outerTickSize(0);var A=2;s=e.svg.brush().x(a).extent([0,0]).on("brush",r.brushed),l=I.attr("width",n+x.left+x.right).attr("height",m+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(s),l.select(".background").attr("y",m/2).attr("height",m),c=l.append("defs"),c.append("clipPath").attr("id",y).append("rect").attr("width",n).attr("height",m).style("fill","white"),g=l.append("g").attr("class","focus"),u=g.append("g").attr("class","harmonics").attr("clip-path",w),p=g.append("g").attr("class","lowerbounds").attr("clip-path",w),d=l.append("g").attr("class","labels"),u.append("rect").attr("x",t.dimension*k-k).attr("y",R-.5*T).attr("width",k).attr("height",T).style("fill",S).append("svg:title").text(t.dimension),u.selectAll("line").data(t.harmonics).enter().append("line").attr("x1",function(e){return e[0]*k-.5*k}).attr("y1",R).attr("x2",function(e){return e[1]*k-.5*k}).attr("y2",m-T).attr("marker-end","url(#harmonics-marker)").style("stroke",S).style("opacity",1).style("stroke-width",function(e){return r.getStrokeWidth(e[3])}).append("svg:title").text(function(e){return e[1]+":"+e[3]}),u.selectAll("circle").data(t.harmonics).enter().append("circle").attr("cx",function(e){return e[1]*k-.5*k}).attr("cy",m-T).attr("r",.5*T).style("opacity",function(e){return r.getOpacity(e[3])}).style("fill",S).append("svg:title").text(function(e){return e[0]+" : "+e[1]}),p.append("rect").attr("x",t.dimension*k-k).attr("y",m-1.5*T).attr("width",k).attr("height",T).style("fill",j).append("svg:title").text(t.dimension),p.selectAll("line").data(t.lowerBounds).enter().append("line").attr("x1",function(e){return e[0]*k-.5*k}).attr("y2",R).attr("x2",function(e){return e[1]*k-.5*k}).attr("y1",m-T).attr("marker-end","url(#lowerbounds-marker)").style("stroke",j).style("opacity",function(e){return r.getOpacity(e[3])}).style("stroke-width",function(e){return r.getStrokeWidth(e[3])}).append("svg:title").text(function(e){return e[1]+":"+e[3]}),p.selectAll("circle").data(t.lowerBounds).enter().append("circle").attr("cx",function(e){return e[1]*k-.5*k}).attr("cy",R).attr("r",.5*T).style("opacity",function(e){return r.getOpacity(e[3])}).style("fill",j).append("svg:title").text(function(e){return e[0]+" : "+e[1]}),h=l.append("rect").attr("id","highlight").attr("x",a(r.settings.current.position)).attr("y",0).attr("width",A).attr("height",C).attr("class","highlight-follow")}},r.update=function(){I.select("#highlight").attr("x",function(){return a(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var o=s.extent()[0];e.event.sourceEvent&&(o=parseInt(a.invert(e.mouse(n)[0])),s.extent([o,o])),h.attr("x",a(o)),r.settings.current.position=o,r.settings.current.particle=t.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(m)})}}}angular.module("TADkit").directive("tkComponentTrackRestraints",e)}(),function(){"use strict";function e(e,t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n){e.d3().then(function(e){r.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var a,o,i,s,l,c,g,d,u,p,h=(r.data,r.view.viewpoint.chromStart),m=r.view.viewpoint.chromEnd,b=(r.view.settings.cursorWidth,parseInt(r.view.settings.margin)),f={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},v=parseInt(r.view.settings.heightInner),y=n[0].parentNode,w=n[0].children[0].children[3],E=e.select(w).append("svg");r.$watch(function(){var e=y.clientWidth,t=y.clientHeight;return e+t},function(){r.render()}),r.$watch("settings.current.position",function(e,t){e!==t&&r.update()}),r.render=function(){E.selectAll("*").remove();var t=y.clientWidth-2*b-f.left-f.right,n=v-f.bottom-f.top;o=e.scale.linear().range([0,t]).clamp(!0),o.domain([h,m]),g=e.svg.axis().scale(o).orient("bottom").ticks(4),i=e.svg.axis().orient("left"),s=e.svg.axis().orient("right"),l=.5*n,c=v,d=e.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),a=E.attr("width",t+f.left+f.right).attr("height",n+f.top+f.bottom).append("g").attr("transform","translate("+f.left+", 0)");var w=a.append("g").attr("class","labels");w.append("text").attr("x",-16).attr("y",26).style("text-anchor","right").style("font-size","10px").text("3'"),w.append("text").attr("x",t+8).attr("y",26).style("text-anchor","left").style("font-size","10px").text("5'");a.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(g).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");a.append("g").attr("class","slider").call(d),a.select(".background").attr("y",n/2).attr("height",n),u=a.append("circle").attr("id","handle").attr("class","handle").attr("cx",o(r.settings.current.position)).attr("cy",n).attr("r",.6*l),p=a.append("text").attr("id","position").attr("x",o(r.settings.current.position)-.5*l).attr("y",n-10).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text(r.settings.current.particle),a.call(d.extent([r.settings.current.position,0])).call(d.event)},r.update=function(){E.select("#handle").attr("cx",o(r.settings.current.position)),E.select("#position").attr("x",o(r.settings.current.position)-.5*l).text(r.settings.current.particle)},r.brushed=function(){var n=this;r.safeApply(function(){var a=d.extent()[0];e.event.sourceEvent&&(a=parseInt(o.invert(e.mouse(n)[0])),d.extent([a,a])),u.attr("cx",o(a)),r.settings.current.position=a,r.settings.current.particle=t.getParticle(),r.settings.current.segment=t.getSegment(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})}})}}}angular.module("TADkit").directive("tkComponentTrackSlider",e)}(),function(){"use strict";function e(e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(t,r){e.d3().then(function(e){var n,a,o,i,s,l,c,g=t.data,d=t.view.settings.step,u=t.view.viewpoint.chromStart,p=t.view.viewpoint.chromEnd,h=p-u,m=parseInt(t.view.settings.margin),b={top:parseInt(t.view.settings.padding.top),right:parseInt(t.view.settings.padding.right),bottom:parseInt(t.view.settings.padding.bottom),left:parseInt(t.view.settings.padding.left)},f=parseInt(t.view.settings.heightInner),v=.5*f,y=.5*(f-v),w=t.view.settings.color,E=r[0].parentNode,x=r[0].children[0].children[3],k=e.select(x).append("svg");t.$watch(function(){var e=E.clientWidth,t=E.clientHeight;return e+t},function(){t.render(g)}),t.$watch("settings.current.position",function(){t.update()},!0);e.behavior.zoom().on("zoom",function(){t.update()});t.render=function(r){if(k.selectAll("*").remove(),r){var g=E.clientWidth-2*m-b.left-b.right,x=f-b.top-b.bottom;n=d*g/h,c=e.scale.linear().range([0,g]).clamp(!0),c.domain([u,p]),i=e.svg.axis().scale(c).orient("top").ticks(0).outerTickSize(0);var C=2;a=k.attr("width",g+b.left+b.right).attr("height",x+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),o=a.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",g).attr("height",x).style("fill","white"),s=a.append("g").attr("class","focus"),l=s.append("g").attr("class","container").attr("clip-path","url(#clip)");{a.append("g").attr("class","labels"),l.selectAll("rect").data(r).enter().append("rect").attr("x",function(e,t){return(t+1)*n}).attr("y",y).attr("width",n).attr("height",v).style("fill",w).style("fill-opacity",function(e){return e}).style("stroke",w).style("stroke-width",0).append("svg:title").text(function(e,t){return t+":"+e}),a.append("rect").attr("id","highlight").attr("x",function(){return c(t.settings.current.position-.5*d)}).attr("y",0).attr("width",C).attr("height",f).attr("class","highlight-follow")}}},t.update=function(){k.select("#highlight").attr("x",function(){return c(t.settings.current.position-.5*d)})}})}}}angular.module("TADkit").directive("tkComponentWiggle0",e)}(),function(){"use strict";function e(e){e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState}}angular.module("TADkit").controller("TrackController",e)}(),function(){"use strict";function e(){}angular.module("TADkit").controller("HomeController",e)}(),function(){"use strict";function e(e,t,r,n,a,o,i,s,l){r.settings||(r.settings=n.get()),r.settings.app.isProject=e.is("project"),r.$on("$stateChangeSuccess",function(){r.settings.app.isProject=e.is("project")}),r.users||(r.users=a.get(),"undefined"!=typeof r.users.loaded[0].projects&&0===r.users.loaded[0].projects.length&&(r.users.loaded[0].projects=o.get(),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].datasets&&0===r.users.loaded[0].projects.loaded[0].datasets.length&&(r.users.loaded[0].projects.loaded[0].datasets=i.get()),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].overlays&&0===r.users.loaded[0].projects.loaded[0].overlays.length&&(r.users.loaded[0].projects.loaded[0].overlays=s.get()),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].storyboards&&0===r.users.loaded[0].projects.loaded[0].storyboards.length&&(r.users.loaded[0].projects.loaded[0].storyboards=l.get()))),r.current={},r.current.user=a.getUser(),r.current.project=o.getProject(),r.current.dataset=i.getDataset(),r.current.model=i.getModel(),r.current.overlay=s.getOverlay(),r.current.storyboard=l.getStoryboard()}angular.module("TADkit").controller("MainController",e)}(),function(){"use strict";function e(t,r,n,a,o,i){r.fileTitle="No file loaded",r.$on("$viewContentLoaded",function(){function o(){console.log("showing dialog")}var i=angular.element(document.body),s="assets/templates/"+t.current.name+".html";n.show({parent:i,templateUrl:s,controller:e,locals:{overlays:r.$parent.overlays},onComplete:o}).then(function(e){a.show(a.simple().content("Overlays ("+e+") added"))},function(){a.show(a.simple().content("cancelled")),t.go("browser")})}),r.parseFile=function(e){r.fileData=i.parse(e).data,r.selectedRows=[];for(var t=r.fileData.length;--t>=0;)r.selectedRows[t]=!0;r.selectedCols=[];for(var n=r.fileData[0].length;--n>=0;)r.selectedCols[n]=!0;console.log("File Opened...")},r.importData=function(e){r.importedOverlays=i.import(e,r.selectedRows,r.selectedCols),n.hide(r.importedOverlays.length),t.go("browser")},r.hide=function(){n.hide(r.overlaysAcquired)},r.cancel=function(){n.cancel()}}angular.module("TADkit").controller("OverlayImportController",e)}(),function(){"use strict";function e(){return{restrict:"A",scope:{tkOverlayImport:"&",filetitle:"="},link:function(e,t){t.on("change",function(t){var r=new FileReader;r.onload=function(t){e.$apply(function(){e.tkOverlayImport({$fileContent:t.target.result})})},r.readAsText((t.srcElement||t.target).files[0]),e.filetitle=(t.srcElement||t.target).files[0].name})}}}angular.module("TADkit").directive("tkOverlayImport",e)}(),function(){"use strict";function e(){}angular.module("TADkit").controller("ProjectContentController",e)}(),function(){"use strict";function e(e,t,r,n,a,o){t.clusterComponent=a.getComponentById("datasets-scene-icon");var i=n.getOverlayById("gradient"),s=t.current.model.data.length/t.current.dataset.object.components,l=o.gradientHCL(i,s);t.clusterComponent.overlay=l;for(var c=new THREE.BufferGeometry,g=t.current.dataset.models.length-1;g>=0;g--)c.addAttribute("position",new THREE.BufferAttribute(t.current.dataset.models[g],3));c.computeBoundingSphere(),t.clusterComponent.view.viewpoint.translate=c.boundingSphere.radius,t.clusters=[];for(var d=t.current.dataset.clusters,u=t.current.dataset.models,p=d.length-1;p>=0;p--){var h={};h.number=p+1,h.list=d[p],h.centroidIndex=h.list.indexOf(r.getCentroid(h.number)),h.data=[];for(var m=h.list.length-1;m>=0;m--){for(var b,f=u.length-1;f>=0;f--){var v=u[f];
parseInt(v.ref)==h.list[m]&&(b=v.data)}b?h.data.unshift(b):console.log("Listed model not found!")}t.clusters.unshift(h)}t.currentPage=0,t.pageSize=10,t.numberOfPages=function(){return Math.ceil(t.clusters.length/t.pageSize)},t.selectCluster=function(n){t.clusterArray=r.setCluster(n+1),t.centroidRef=r.getCentroid(),console.log("Current Cluster: "+(n+1)+"(Centroid Model: "+t.centroidRef+")"),e.go("browser")}}angular.module("TADkit").filter("startFrom",function(){return function(e,t){return t=+t,e.slice(t)}}).controller("ProjectDatasetController",e)}(),function(){"use strict";function e(e,t){return{restrict:"A",link:function(e,r,n){var a=n.dropzone,o=t(a),i=function(e){e.preventDefault(),r.addClass("dragOver")},s=function(e){e.preventDefault(),r.removeClass("dragOver")},l=function(t){var r=new FileReader;r.onload=function(t){e.$apply(function(){o(e,{$fileContent:t.target.result}),e.addDataset(t.target.result)})},r.readAsText(t),console.log("File loaded...")};r.bind("dragover",i).bind("dragleave",s).bind("drop",function(t){s(t),0===t.dataTransfer.files.length?e.showAdvanced():l(t.dataTransfer.files[0])}),e.$watch(a,function(){r.attr("src",o(e))}),e.loadFile=l}}}angular.module("TADkit").directive("tkProjectDropzone",e)}(),function(){"use strict";function e(e,t,r,n,a,o,i,s){n.updateCurrent=function(){n.current.dataset=a.getDataset(),n.current.model=a.getModel();for(var e=o.get();e.loaded.length>1;)e.loaded.pop();o.set(0),n.current.overlay=o.getOverlay(),n.current.storyboard=i.getStoryboard(),console.log("Current dataset, model, overlay and storyboard updated.")},n.loadDatasetFromParam=function(){var o=a.load(r.loadDataset);return e.all([o]).then(function(){n.updateCurrent(),console.log("Dataset loaded: "+r.loadDataset),t.go("browser")})},r.loadDataset&&n.loadDatasetFromParam(),n.addDataset=function(r){var o=a.add(r);return e.all([o]).then(function(){n.updateCurrent(),console.log("Dataset added."),t.go("dataset")})},n.cleanDataset=function(){a.clear(),s.clear();var r=a.load();return e.all([r]).then(function(){n.updateCurrent(),console.log("Dataset example loaded."),t.go("browser")})}}angular.module("TADkit").controller("ProjectLoaderController",e)}(),function(){"use strict";function e(e,t){return{restrict:"A",scope:!1,link:function(e,r,n){var a=t(n.tkProjectLoader);r.on("change",function(t){var r=new FileReader;r.onload=function(t){console.log("Data Loaded"),e.$apply(function(){a(e,{$fileContent:t.target.result})})},r.readAsText((t.srcElement||t.target).files[0])})}}}angular.module("TADkit").directive("tkProjectLoader",e)}(),function(){"use strict";function e(){}angular.module("TADkit").controller("ProjectOverlayController",e)}(),function(){"use strict";function e(){}angular.module("TADkit").controller("ProjectStoryboardController",e)}(),function(){"use strict";function e(e,t){e.toggleSetting=function(r){e.settings=t.toggle(r)}}angular.module("TADkit").controller("SidebarBrowserController",e)}(),function(){"use strict";function e(e,t,r,n){e.setCurrentDataset=function(e){t.set(e)},e.setCurrentOverlay=function(e){r.set(e)},e.setCurrentStoryboard=function(e){n.set(e)}}angular.module("TADkit").controller("SidebarProjectController",e)}(),function(){"use strict";function e(){}angular.module("TADkit").controller("SidebarUserController",e)}(),function(){"use strict";function e(e,t,r,n,a,o,i,s,l){angular.element(e).on("resize",function(){t.$apply()}),t.settings.views.scale=1,n.setViewpoint(t.settings.current.chromStart,t.settings.current.chromEnd,t.settings.views.scale),a.setViewpoint(t.settings.current.chromStart,t.settings.current.chromEnd,t.settings.views.scale),t.allProximities=i.get(),t.currentProximities=i.at(t.settings.current.particle),t.currentRestraints=s.at(t.settings.current.particle),angular.forEach(t.current.storyboard.components,function(e){var r;if("scene"==e.object.type){var n={tad_data:l.get(),data:t.current.model.data};e.data=n,e.proximities=t.allProximities,e.overlay=t.current.overlay,e.overlay.state={},e.overlay.object.state.index=o.getCurrentIndex()}else"track-genes"==e.object.type||"panel-inspector"==e.object.type?(r=o.getOverlayById("genes"),e.data=r.data,e.overlay=r):"track-proximities"==e.object.type?(e.data=t.currentProximities,r=o.getOverlayById("proximities"),e.overlay=r):"track-restraints"==e.object.type?(e.data=t.currentRestraints,r=o.getOverlayById("restraints"),e.overlay=r):"panel-hicdata"==e.object.type?e.data=l.get():"panel-jbrowse"==e.object.type&&(e.data=t.currentRestraints,r=o.getOverlayById("restraints"),e.overlay=r)}),t.$watch("settings.current.particle",function(e,r){e!==r&&(t.currentProximities=i.at(e),t.currentRestraints=s.at(e),"matrix"==t.current.overlay.object.type&&(o.at(e),t.current.overlay=o.getOverlay()))}),t.overlayOrig=t.current.overlay,t.toggleOverlay=function(e){t.overlaid=o.getOverlay(e).object.state.overlaid,t.overlaid?(o.setOverlaid(t.overlayOrig.object.state.index),o.set(t.overlayOrig.object.state.index),t.current.overlay=o.getOverlay()):(o.setOverlaid(e),o.set(e),t.current.overlay=o.getOverlay())},t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState},t.toggle=function(e){e=!e,console.log(e)},t.testfn=function(){console.log("test worked")}}angular.module("TADkit").controller("StoryboardController",e)}(),function(){"use strict";function e(e,t,r){t.$state=e,e.includes("main.project")&&(t.projectTitle=t.users[0].projects[0].object.title),t.toggleLeft=function(){r("left").toggle()},t.toggleRight=function(){r("right").toggle()}}angular.module("TADkit").controller("TopbarController",e)}(),function(){"use strict";function e(){var e={};return e.re_={x11rgb:/^\s*rgb:([a-f0-9]{1,4})\/([a-f0-9]{1,4})\/([a-f0-9]{1,4})\s*$/i},e.colorNames={transparent:"rgb(0, 0, 0)",rust:"rgb(243, 137, 92)",stripes:"rgb(255, 54, 54)",dark_blue:"rgb(0, 0, 139)",contigblue1:"rgb(0, 0, 139)",contigblue2:"rgb(173, 216, 230)","border:grey70":"rgb(179, 179, 179)",aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",antiquewhite1:"rgb(255, 239, 219)",antiquewhite2:"rgb(238, 223, 204)",antiquewhite3:"rgb(205, 192, 176)",antiquewhite4:"rgb(139, 131, 120)",aquamarine:"rgb(127, 255, 212)",aquamarine1:"rgb(127, 255, 212)",aquamarine2:"rgb(118, 238, 198)",aquamarine3:"rgb(102, 205, 170)",aquamarine4:"rgb(69, 139, 116)",azure:"rgb(240, 255, 255)",azure1:"rgb(240, 255, 255)",azure2:"rgb(224, 238, 238)",azure3:"rgb(193, 205, 205)",azure4:"rgb(131, 139, 139)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",bisque1:"rgb(255, 228, 196)",bisque2:"rgb(238, 213, 183)",bisque3:"rgb(205, 183, 158)",bisque4:"rgb(139, 125, 107)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blue1:"rgb(0, 0, 255)",blue2:"rgb(0, 0, 238)",blue3:"rgb(0, 0, 205)",blue4:"rgb(0, 0, 139)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",brown1:"rgb(255, 64, 64)",brown2:"rgb(238, 59, 59)",brown3:"rgb(205, 51, 51)",brown4:"rgb(139, 35, 35)",burlywood:"rgb(222, 184, 135)",burlywood1:"rgb(255, 211, 155)",burlywood2:"rgb(238, 197, 145)",burlywood3:"rgb(205, 170, 125)",burlywood4:"rgb(139, 115, 85)",cadetblue:"rgb(95, 158, 160)",cadetblue1:"rgb(152, 245, 255)",cadetblue2:"rgb(142, 229, 238)",cadetblue3:"rgb(122, 197, 205)",cadetblue4:"rgb(83, 134, 139)",chartreuse:"rgb(127, 255, 0)",chartreuse1:"rgb(127, 255, 0)",chartreuse2:"rgb(118, 238, 0)",chartreuse3:"rgb(102, 205, 0)",chartreuse4:"rgb(69, 139, 0)",chocolate:"rgb(210, 105, 30)",chocolate1:"rgb(255, 127, 36)",chocolate2:"rgb(238, 118, 33)",chocolate3:"rgb(205, 102, 29)",chocolate4:"rgb(139, 69, 19)",coral:"rgb(255, 127, 80)",coral1:"rgb(255, 114, 86)",coral2:"rgb(238, 106, 80)",coral3:"rgb(205, 91, 69)",coral4:"rgb(139, 62, 47)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",cornsilk1:"rgb(255, 248, 220)",cornsilk2:"rgb(238, 232, 205)",cornsilk3:"rgb(205, 200, 177)",cornsilk4:"rgb(139, 136, 120)",cyan:"rgb(0, 255, 255)",cyan1:"rgb(0, 255, 255)",cyan2:"rgb(0, 238, 238)",cyan3:"rgb(0, 205, 205)",cyan4:"rgb(0, 139, 139)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgoldenrod1:"rgb(255, 185, 15)",darkgoldenrod2:"rgb(238, 173, 14)",darkgoldenrod3:"rgb(205, 149, 12)",darkgoldenrod4:"rgb(139, 101, 8)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkolivegreen1:"rgb(202, 255, 112)",darkolivegreen2:"rgb(188, 238, 104)",darkolivegreen3:"rgb(162, 205, 90)",darkolivegreen4:"rgb(110, 139, 61)",darkorange:"rgb(255, 140, 0)",darkorange1:"rgb(255, 127, 0)",darkorange2:"rgb(238, 118, 0)",darkorange3:"rgb(205, 102, 0)",darkorange4:"rgb(139, 69, 0)",darkorchid:"rgb(153, 50, 204)",darkorchid1:"rgb(191, 62, 255)",darkorchid2:"rgb(178, 58, 238)",darkorchid3:"rgb(154, 50, 205)",darkorchid4:"rgb(104, 34, 139)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkseagreen1:"rgb(193, 255, 193)",darkseagreen2:"rgb(180, 238, 180)",darkseagreen3:"rgb(155, 205, 155)",darkseagreen4:"rgb(105, 139, 105)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategray1:"rgb(151, 255, 255)",darkslategray2:"rgb(141, 238, 238)",darkslategray3:"rgb(121, 205, 205)",darkslategray4:"rgb(82, 139, 139)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",debianred:"rgb(215, 7, 81)",deeppink:"rgb(255, 20, 147)",deeppink1:"rgb(255, 20, 147)",deeppink2:"rgb(238, 18, 137)",deeppink3:"rgb(205, 16, 118)",deeppink4:"rgb(139, 10, 80)",deepskyblue:"rgb(0, 191, 255)",deepskyblue1:"rgb(0, 191, 255)",deepskyblue2:"rgb(0, 178, 238)",deepskyblue3:"rgb(0, 154, 205)",deepskyblue4:"rgb(0, 104, 139)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",dodgerblue1:"rgb(30, 144, 255)",dodgerblue2:"rgb(28, 134, 238)",dodgerblue3:"rgb(24, 116, 205)",dodgerblue4:"rgb(16, 78, 139)",firebrick:"rgb(178, 34, 34)",firebrick1:"rgb(255, 48, 48)",firebrick2:"rgb(238, 44, 44)",firebrick3:"rgb(205, 38, 38)",firebrick4:"rgb(139, 26, 26)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",gold1:"rgb(255, 215, 0)",gold2:"rgb(238, 201, 0)",gold3:"rgb(205, 173, 0)",gold4:"rgb(139, 117, 0)",goldenrod:"rgb(218, 165, 32)",goldenrod1:"rgb(255, 193, 37)",goldenrod2:"rgb(238, 180, 34)",goldenrod3:"rgb(205, 155, 29)",goldenrod4:"rgb(139, 105, 20)",gray:"rgb(190, 190, 190)",gray0:"rgb(0, 0, 0)",gray1:"rgb(3, 3, 3)",gray10:"rgb(26, 26, 26)",gray100:"rgb(255, 255, 255)",gray11:"rgb(28, 28, 28)",gray12:"rgb(31, 31, 31)",gray13:"rgb(33, 33, 33)",gray14:"rgb(36, 36, 36)",gray15:"rgb(38, 38, 38)",gray16:"rgb(41, 41, 41)",gray17:"rgb(43, 43, 43)",gray18:"rgb(46, 46, 46)",gray19:"rgb(48, 48, 48)",gray2:"rgb(5, 5, 5)",gray20:"rgb(51, 51, 51)",gray21:"rgb(54, 54, 54)",gray22:"rgb(56, 56, 56)",gray23:"rgb(59, 59, 59)",gray24:"rgb(61, 61, 61)",gray25:"rgb(64, 64, 64)",gray26:"rgb(66, 66, 66)",gray27:"rgb(69, 69, 69)",gray28:"rgb(71, 71, 71)",gray29:"rgb(74, 74, 74)",gray3:"rgb(8, 8, 8)",gray30:"rgb(77, 77, 77)",gray31:"rgb(79, 79, 79)",gray32:"rgb(82, 82, 82)",gray33:"rgb(84, 84, 84)",gray34:"rgb(87, 87, 87)",gray35:"rgb(89, 89, 89)",gray36:"rgb(92, 92, 92)",gray37:"rgb(94, 94, 94)",gray38:"rgb(97, 97, 97)",gray39:"rgb(99, 99, 99)",gray4:"rgb(10, 10, 10)",gray40:"rgb(102, 102, 102)",gray41:"rgb(105, 105, 105)",gray42:"rgb(107, 107, 107)",gray43:"rgb(110, 110, 110)",gray44:"rgb(112, 112, 112)",gray45:"rgb(115, 115, 115)",gray46:"rgb(117, 117, 117)",gray47:"rgb(120, 120, 120)",gray48:"rgb(122, 122, 122)",gray49:"rgb(125, 125, 125)",gray5:"rgb(13, 13, 13)",gray50:"rgb(127, 127, 127)",gray51:"rgb(130, 130, 130)",gray52:"rgb(133, 133, 133)",gray53:"rgb(135, 135, 135)",gray54:"rgb(138, 138, 138)",gray55:"rgb(140, 140, 140)",gray56:"rgb(143, 143, 143)",gray57:"rgb(145, 145, 145)",gray58:"rgb(148, 148, 148)",gray59:"rgb(150, 150, 150)",gray6:"rgb(15, 15, 15)",gray60:"rgb(153, 153, 153)",gray61:"rgb(156, 156, 156)",gray62:"rgb(158, 158, 158)",gray63:"rgb(161, 161, 161)",gray64:"rgb(163, 163, 163)",gray65:"rgb(166, 166, 166)",gray66:"rgb(168, 168, 168)",gray67:"rgb(171, 171, 171)",gray68:"rgb(173, 173, 173)",gray69:"rgb(176, 176, 176)",gray7:"rgb(18, 18, 18)",gray70:"rgb(179, 179, 179)",gray71:"rgb(181, 181, 181)",gray72:"rgb(184, 184, 184)",gray73:"rgb(186, 186, 186)",gray74:"rgb(189, 189, 189)",gray75:"rgb(191, 191, 191)",gray76:"rgb(194, 194, 194)",gray77:"rgb(196, 196, 196)",gray78:"rgb(199, 199, 199)",gray79:"rgb(201, 201, 201)",gray8:"rgb(20, 20, 20)",gray80:"rgb(204, 204, 204)",gray81:"rgb(207, 207, 207)",gray82:"rgb(209, 209, 209)",gray83:"rgb(212, 212, 212)",gray84:"rgb(214, 214, 214)",gray85:"rgb(217, 217, 217)",gray86:"rgb(219, 219, 219)",gray87:"rgb(222, 222, 222)",gray88:"rgb(224, 224, 224)",gray89:"rgb(227, 227, 227)",gray9:"rgb(23, 23, 23)",gray90:"rgb(229, 229, 229)",gray91:"rgb(232, 232, 232)",gray92:"rgb(235, 235, 235)",gray93:"rgb(237, 237, 237)",gray94:"rgb(240, 240, 240)",gray95:"rgb(242, 242, 242)",gray96:"rgb(245, 245, 245)",gray97:"rgb(247, 247, 247)",gray98:"rgb(250, 250, 250)",gray99:"rgb(252, 252, 252)",green:"rgb(0, 255, 0)",green1:"rgb(0, 255, 0)",green2:"rgb(0, 238, 0)",green3:"rgb(0, 205, 0)",green4:"rgb(0, 139, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(190, 190, 190)",grey0:"rgb(0, 0, 0)",grey1:"rgb(3, 3, 3)",grey10:"rgb(26, 26, 26)",grey100:"rgb(255, 255, 255)",grey11:"rgb(28, 28, 28)",grey12:"rgb(31, 31, 31)",grey13:"rgb(33, 33, 33)",grey14:"rgb(36, 36, 36)",grey15:"rgb(38, 38, 38)",grey16:"rgb(41, 41, 41)",grey17:"rgb(43, 43, 43)",grey18:"rgb(46, 46, 46)",grey19:"rgb(48, 48, 48)",grey2:"rgb(5, 5, 5)",grey20:"rgb(51, 51, 51)",grey21:"rgb(54, 54, 54)",grey22:"rgb(56, 56, 56)",grey23:"rgb(59, 59, 59)",grey24:"rgb(61, 61, 61)",grey25:"rgb(64, 64, 64)",grey26:"rgb(66, 66, 66)",grey27:"rgb(69, 69, 69)",grey28:"rgb(71, 71, 71)",grey29:"rgb(74, 74, 74)",grey3:"rgb(8, 8, 8)",grey30:"rgb(77, 77, 77)",grey31:"rgb(79, 79, 79)",grey32:"rgb(82, 82, 82)",grey33:"rgb(84, 84, 84)",grey34:"rgb(87, 87, 87)",grey35:"rgb(89, 89, 89)",grey36:"rgb(92, 92, 92)",grey37:"rgb(94, 94, 94)",grey38:"rgb(97, 97, 97)",grey39:"rgb(99, 99, 99)",grey4:"rgb(10, 10, 10)",grey40:"rgb(102, 102, 102)",grey41:"rgb(105, 105, 105)",grey42:"rgb(107, 107, 107)",grey43:"rgb(110, 110, 110)",grey44:"rgb(112, 112, 112)",grey45:"rgb(115, 115, 115)",grey46:"rgb(117, 117, 117)",grey47:"rgb(120, 120, 120)",grey48:"rgb(122, 122, 122)",grey49:"rgb(125, 125, 125)",grey5:"rgb(13, 13, 13)",grey50:"rgb(127, 127, 127)",grey51:"rgb(130, 130, 130)",grey52:"rgb(133, 133, 133)",grey53:"rgb(135, 135, 135)",grey54:"rgb(138, 138, 138)",grey55:"rgb(140, 140, 140)",grey56:"rgb(143, 143, 143)",grey57:"rgb(145, 145, 145)",grey58:"rgb(148, 148, 148)",grey59:"rgb(150, 150, 150)",grey6:"rgb(15, 15, 15)",grey60:"rgb(153, 153, 153)",grey61:"rgb(156, 156, 156)",grey62:"rgb(158, 158, 158)",grey63:"rgb(161, 161, 161)",grey64:"rgb(163, 163, 163)",grey65:"rgb(166, 166, 166)",grey66:"rgb(168, 168, 168)",grey67:"rgb(171, 171, 171)",grey68:"rgb(173, 173, 173)",grey69:"rgb(176, 176, 176)",grey7:"rgb(18, 18, 18)",grey70:"rgb(179, 179, 179)",grey71:"rgb(181, 181, 181)",grey72:"rgb(184, 184, 184)",grey73:"rgb(186, 186, 186)",grey74:"rgb(189, 189, 189)",grey75:"rgb(191, 191, 191)",grey76:"rgb(194, 194, 194)",grey77:"rgb(196, 196, 196)",grey78:"rgb(199, 199, 199)",grey79:"rgb(201, 201, 201)",grey8:"rgb(20, 20, 20)",grey80:"rgb(204, 204, 204)",grey81:"rgb(207, 207, 207)",grey82:"rgb(209, 209, 209)",grey83:"rgb(212, 212, 212)",grey84:"rgb(214, 214, 214)",grey85:"rgb(217, 217, 217)",grey86:"rgb(219, 219, 219)",grey87:"rgb(222, 222, 222)",grey88:"rgb(224, 224, 224)",grey89:"rgb(227, 227, 227)",grey9:"rgb(23, 23, 23)",grey90:"rgb(229, 229, 229)",grey91:"rgb(232, 232, 232)",grey92:"rgb(235, 235, 235)",grey93:"rgb(237, 237, 237)",grey94:"rgb(240, 240, 240)",grey95:"rgb(242, 242, 242)",grey96:"rgb(245, 245, 245)",grey97:"rgb(247, 247, 247)",grey98:"rgb(250, 250, 250)",grey99:"rgb(252, 252, 252)",honeydew:"rgb(240, 255, 240)",honeydew1:"rgb(240, 255, 240)",honeydew2:"rgb(224, 238, 224)",honeydew3:"rgb(193, 205, 193)",honeydew4:"rgb(131, 139, 131)",hotpink:"rgb(255, 105, 180)",hotpink1:"rgb(255, 110, 180)",hotpink2:"rgb(238, 106, 167)",hotpink3:"rgb(205, 96, 144)",hotpink4:"rgb(139, 58, 98)",indianred:"rgb(205, 92, 92)",indianred1:"rgb(255, 106, 106)",indianred2:"rgb(238, 99, 99)",indianred3:"rgb(205, 85, 85)",indianred4:"rgb(139, 58, 58)",ivory:"rgb(255, 255, 240)",ivory1:"rgb(255, 255, 240)",ivory2:"rgb(238, 238, 224)",ivory3:"rgb(205, 205, 193)",ivory4:"rgb(139, 139, 131)",khaki:"rgb(240, 230, 140)",khaki1:"rgb(255, 246, 143)",khaki2:"rgb(238, 230, 133)",khaki3:"rgb(205, 198, 115)",khaki4:"rgb(139, 134, 78)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lavenderblush1:"rgb(255, 240, 245)",lavenderblush2:"rgb(238, 224, 229)",lavenderblush3:"rgb(205, 193, 197)",lavenderblush4:"rgb(139, 131, 134)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lemonchiffon1:"rgb(255, 250, 205)",lemonchiffon2:"rgb(238, 233, 191)",lemonchiffon3:"rgb(205, 201, 165)",lemonchiffon4:"rgb(139, 137, 112)",lightblue:"rgb(173, 216, 230)",lightblue1:"rgb(191, 239, 255)",lightblue2:"rgb(178, 223, 238)",lightblue3:"rgb(154, 192, 205)",lightblue4:"rgb(104, 131, 139)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightcyan1:"rgb(224, 255, 255)",lightcyan2:"rgb(209, 238, 238)",lightcyan3:"rgb(180, 205, 205)",lightcyan4:"rgb(122, 139, 139)",lightgoldenrod:"rgb(238, 221, 130)",lightgoldenrod1:"rgb(255, 236, 139)",lightgoldenrod2:"rgb(238, 220, 130)",lightgoldenrod3:"rgb(205, 190, 112)",lightgoldenrod4:"rgb(139, 129, 76)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightpink1:"rgb(255, 174, 185)",lightpink2:"rgb(238, 162, 173)",lightpink3:"rgb(205, 140, 149)",lightpink4:"rgb(139, 95, 101)",lightsalmon:"rgb(255, 160, 122)",lightsalmon1:"rgb(255, 160, 122)",lightsalmon2:"rgb(238, 149, 114)",lightsalmon3:"rgb(205, 129, 98)",lightsalmon4:"rgb(139, 87, 66)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightskyblue1:"rgb(176, 226, 255)",lightskyblue2:"rgb(164, 211, 238)",lightskyblue3:"rgb(141, 182, 205)",lightskyblue4:"rgb(96, 123, 139)",lightslateblue:"rgb(132, 112, 255)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightsteelblue1:"rgb(202, 225, 255)",lightsteelblue2:"rgb(188, 210, 238)",lightsteelblue3:"rgb(162, 181, 205)",lightsteelblue4:"rgb(110, 123, 139)",lightyellow:"rgb(255, 255, 224)",lightyellow1:"rgb(255, 255, 224)",lightyellow2:"rgb(238, 238, 209)",lightyellow3:"rgb(205, 205, 180)",lightyellow4:"rgb(139, 139, 122)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",magenta1:"rgb(255, 0, 255)",magenta2:"rgb(238, 0, 238)",magenta3:"rgb(205, 0, 205)",magenta4:"rgb(139, 0, 139)",maroon:"rgb(176, 48, 96)",maroon1:"rgb(255, 52, 179)",maroon2:"rgb(238, 48, 167)",maroon3:"rgb(205, 41, 144)",maroon4:"rgb(139, 28, 98)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumorchid1:"rgb(224, 102, 255)",mediumorchid2:"rgb(209, 95, 238)",mediumorchid3:"rgb(180, 82, 205)",mediumorchid4:"rgb(122, 55, 139)",mediumpurple:"rgb(147, 112, 219)",mediumpurple1:"rgb(171, 130, 255)",mediumpurple2:"rgb(159, 121, 238)",mediumpurple3:"rgb(137, 104, 205)",mediumpurple4:"rgb(93, 71, 139)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",mistyrose1:"rgb(255, 228, 225)",mistyrose2:"rgb(238, 213, 210)",mistyrose3:"rgb(205, 183, 181)",mistyrose4:"rgb(139, 125, 123)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navajowhite1:"rgb(255, 222, 173)",navajowhite2:"rgb(238, 207, 161)",navajowhite3:"rgb(205, 179, 139)",navajowhite4:"rgb(139, 121, 94)",navy:"rgb(0, 0, 128)",navyblue:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olivedrab:"rgb(107, 142, 35)",olivedrab1:"rgb(192, 255, 62)",olivedrab2:"rgb(179, 238, 58)",olivedrab3:"rgb(154, 205, 50)",olivedrab4:"rgb(105, 139, 34)",orange:"rgb(255, 165, 0)",orange1:"rgb(255, 165, 0)",orange2:"rgb(238, 154, 0)",orange3:"rgb(205, 133, 0)",orange4:"rgb(139, 90, 0)",orangered:"rgb(255, 69, 0)",orangered1:"rgb(255, 69, 0)",orangered2:"rgb(238, 64, 0)",orangered3:"rgb(205, 55, 0)",orangered4:"rgb(139, 37, 0)",orchid:"rgb(218, 112, 214)",orchid1:"rgb(255, 131, 250)",orchid2:"rgb(238, 122, 233)",orchid3:"rgb(205, 105, 201)",orchid4:"rgb(139, 71, 137)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",palegreen1:"rgb(154, 255, 154)",palegreen2:"rgb(144, 238, 144)",palegreen3:"rgb(124, 205, 124)",palegreen4:"rgb(84, 139, 84)",paleturquoise:"rgb(175, 238, 238)",paleturquoise1:"rgb(187, 255, 255)",paleturquoise2:"rgb(174, 238, 238)",paleturquoise3:"rgb(150, 205, 205)",paleturquoise4:"rgb(102, 139, 139)",palevioletred:"rgb(219, 112, 147)",palevioletred1:"rgb(255, 130, 171)",palevioletred2:"rgb(238, 121, 159)",palevioletred3:"rgb(205, 104, 137)",palevioletred4:"rgb(139, 71, 93)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peachpuff1:"rgb(255, 218, 185)",peachpuff2:"rgb(238, 203, 173)",peachpuff3:"rgb(205, 175, 149)",peachpuff4:"rgb(139, 119, 101)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",pink1:"rgb(255, 181, 197)",pink2:"rgb(238, 169, 184)",pink3:"rgb(205, 145, 158)",pink4:"rgb(139, 99, 108)",plum:"rgb(221, 160, 221)",plum1:"rgb(255, 187, 255)",plum2:"rgb(238, 174, 238)",plum3:"rgb(205, 150, 205)",plum4:"rgb(139, 102, 139)",powderblue:"rgb(176, 224, 230)",purple:"rgb(160, 32, 240)",purple1:"rgb(155, 48, 255)",purple2:"rgb(145, 44, 238)",purple3:"rgb(125, 38, 205)",purple4:"rgb(85, 26, 139)",red:"rgb(255, 0, 0)",red1:"rgb(255, 0, 0)",red2:"rgb(238, 0, 0)",red3:"rgb(205, 0, 0)",red4:"rgb(139, 0, 0)",rosybrown:"rgb(188, 143, 143)",rosybrown1:"rgb(255, 193, 193)",rosybrown2:"rgb(238, 180, 180)",rosybrown3:"rgb(205, 155, 155)",rosybrown4:"rgb(139, 105, 105)",royalblue:"rgb(65, 105, 225)",royalblue1:"rgb(72, 118, 255)",royalblue2:"rgb(67, 110, 238)",royalblue3:"rgb(58, 95, 205)",royalblue4:"rgb(39, 64, 139)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",salmon1:"rgb(255, 140, 105)",salmon2:"rgb(238, 130, 98)",salmon3:"rgb(205, 112, 84)",salmon4:"rgb(139, 76, 57)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seagreen1:"rgb(84, 255, 159)",seagreen2:"rgb(78, 238, 148)",seagreen3:"rgb(67, 205, 128)",seagreen4:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",seashell1:"rgb(255, 245, 238)",seashell2:"rgb(238, 229, 222)",seashell3:"rgb(205, 197, 191)",seashell4:"rgb(139, 134, 130)",sienna:"rgb(160, 82, 45)",sienna1:"rgb(255, 130, 71)",sienna2:"rgb(238, 121, 66)",sienna3:"rgb(205, 104, 57)",sienna4:"rgb(139, 71, 38)",skyblue:"rgb(135, 206, 235)",skyblue1:"rgb(135, 206, 255)",skyblue2:"rgb(126, 192, 238)",skyblue3:"rgb(108, 166, 205)",skyblue4:"rgb(74, 112, 139)",slateblue:"rgb(106, 90, 205)",slateblue1:"rgb(131, 111, 255)",slateblue2:"rgb(122, 103, 238)",slateblue3:"rgb(105, 89, 205)",slateblue4:"rgb(71, 60, 139)",slategray:"rgb(112, 128, 144)",slategray1:"rgb(198, 226, 255)",slategray2:"rgb(185, 211, 238)",slategray3:"rgb(159, 182, 205)",slategray4:"rgb(108, 123, 139)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",snow1:"rgb(255, 250, 250)",snow2:"rgb(238, 233, 233)",snow3:"rgb(205, 201, 201)",snow4:"rgb(139, 137, 137)",springgreen:"rgb(0, 255, 127)",springgreen1:"rgb(0, 255, 127)",springgreen2:"rgb(0, 238, 118)",springgreen3:"rgb(0, 205, 102)",springgreen4:"rgb(0, 139, 69)",steelblue:"rgb(70, 130, 180)",steelblue1:"rgb(99, 184, 255)",steelblue2:"rgb(92, 172, 238)",steelblue3:"rgb(79, 148, 205)",steelblue4:"rgb(54, 100, 139)",tan:"rgb(210, 180, 140)",tan1:"rgb(255, 165, 79)",tan2:"rgb(238, 154, 73)",tan3:"rgb(205, 133, 63)",tan4:"rgb(139, 90, 43)",thistle:"rgb(216, 191, 216)",thistle1:"rgb(255, 225, 255)",thistle2:"rgb(238, 210, 238)",thistle3:"rgb(205, 181, 205)",thistle4:"rgb(139, 123, 139)",tomato:"rgb(255, 99, 71)",tomato1:"rgb(255, 99, 71)",tomato2:"rgb(238, 92, 66)",tomato3:"rgb(205, 79, 57)",tomato4:"rgb(139, 54, 38)",turquoise:"rgb(64, 224, 208)",turquoise1:"rgb(0, 245, 255)",turquoise2:"rgb(0, 229, 238)",turquoise3:"rgb(0, 197, 205)",turquoise4:"rgb(0, 134, 139)",violet:"rgb(238, 130, 238)",violetred:"rgb(208, 32, 144)",violetred1:"rgb(255, 62, 150)",violetred2:"rgb(238, 58, 140)",violetred3:"rgb(205, 50, 120)",violetred4:"rgb(139, 34, 82)",wheat:"rgb(245, 222, 179)",wheat1:"rgb(255, 231, 186)",wheat2:"rgb(238, 216, 174)",wheat3:"rgb(205, 186, 150)",wheat4:"rgb(139, 126, 102)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellow1:"rgb(255, 255, 0)",yellow2:"rgb(238, 238, 0)",yellow3:"rgb(205, 205, 0)",yellow4:"rgb(139, 139, 0)",yellowgreen:"rgb(154, 205, 50)"},{nameToRGB:function(t){return t in e.colorNames?e.colorNames[t]:(t=t.toLowerCase(),t in e.colorNames?e.colorNames[t]:(t=t.replace(/\s+/g,""),t in e.colorNames?e.colorNames[t]:null))},testIfHex:function(e){var t=/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(e);return t},rgbToHex:function(e){var t=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),r=parseInt(t[2]),n=parseInt(t[3]),a=parseInt(t[4]);return"#"+((1<<24)+(r<<16)+(n<<8)+a).toString(16).slice(1)},hslToHex:function(e){var t=function(e,t,n){var a,o,i;if(e%=360,0>e&&(e+=360),e=~~e/360,0>t?t=0:t>100&&(t=100),t=~~t/100,0>n?n=0:n>100&&(n=100),n=~~n/100,0===t)a=o=i=n;else{var s=.5>n?n*(1+t):n+t-n*t,l=2*n-s;a=r(l,s,e+1/3),o=r(l,s,e),i=r(l,s,e-1/3)}return[~~(255*a),~~(255*o),~~(255*i)]},r=function(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+(t-e)*(2/3-r)*6:e};return{process:function(){return e.replace(/hsl\((-?\d+),(-?\d+)%?,(-?\d+)%?\)/g,function(e,r,n,a){var o=t(r,n,a),i=o[0].toString(16),s=o[1].toString(16),l=o[2].toString(16);return"#"+((1==i.length?"0":"")+i)+((1==s.length?"0":"")+s)+((1==l.length?"0":"")+l)})}}},nameToHex:function(t){var r,n=this.testIfHex(t);return n?"#"+t:t in e.colorNames?r=this.rgbToHex(e.colorNames[t]):(t=t.toLowerCase(),t in e.colorNames?r=this.rgbToHex(e.colorNames[t]):(t=t.replace(/\s+/g,""),t in e.colorNames?r=this.rgbToHex(e.colorNames[t]):null))},x11ToCSS:function(t){function r(e){return 1==e.length?parseInt(e+e,16):2==e.length?parseInt(e,16):(3==e.length&&(e+=e.substr(2)),Math.round(parseInt(e,16)/257))}var n=t.match(e.re_.x11rgb);return n?(n.splice(0,1),e.arrayToRGBA(n.map(r))):this.nameToRGB(t)},hexToRGB:function(e){var t=[];return t.push(hexToR(e)),t.push(hexToG(e)),t.push(hexToB(e)),t},hexToR:function(e){return parseInt(cutHex(e).substring(0,2),16)},hexToG:function(e){return parseInt(cutHex(e).substring(2,4),16)},hexToB:function(e){return parseInt(cutHex(e).substring(4,6),16)},cutHex:function(e){return"#"==e.charAt(0)?e.substring(1,7):e}}}angular.module("TADkit").service("ColorConvert",e)}(),function(){"use strict";function e(e){return{colorsFromIni:function(t){var r={section:/^\s*\[\s*([^\]]*)\s*\]\s*$/,param:/^\s*([\w\.\-\_]+)\s*=\s*([\w\.\-\_]+)/,comment:/^\s*#.*$/},n={},a=t.split(/\r\n|\r|\n/),o=null;return a.forEach(function(t){if(!r.comment.test(t)&&""!==t){var a;if(r.param.test(t))if(a=t.match(r.param),o){var i=e.nameToHex(a[2]);n[o][a[1]]=i}else n[a[1]]=a[2];else r.section.test(t)?(a=t.match(r.section),n[a[1]]={},o=a[1]):0===t.length&&o&&(o=null)}}),n},colorsFromTriplets:function(e){for(var t,r,n=0,a=[],o=e.length;o>n;)t=e[n],r=new THREE.Color(t[0],t[1],t[2]),a.push(r),n++;return a},colorsFromArray:function(e){for(var t=[],r=e.length-1;r>=0;r-=1){var n=e[r]/255;r-=1;var a=e[r]/255;r-=1;var o=e[r]/255,i=new THREE.Color(o,a,n);t.unshift(i)}return t},colorsFromHex:function(e){for(var t=[],r=e.length-1;r>=0;r--){var n=new THREE.Color(e[r]);t.unshift(n)}return t},vertexColorsFromColors:function(e){for(var t=new Float32Array(6*e.length),r=e.length-1;r>=0;r--){var n=6*r,a=e[r];t[n]=a.r,t[n+1]=a.g,t[n+2]=a.b,t[n+3]=a.r,t[n+4]=a.g,t[n+5]=a.b}return t},getRandomColors:function(e){for(var t=[],r=0;e>r;r++){var n="#"+Math.floor(16777215*Math.random()).toString(16);t.push(n)}return t},getRandomRGB:function(e){for(var t=[],r=0;e>r;r++){var n="#"+Math.floor(16777215*Math.random()).toString(16),a=new THREE.Color(n);t.push(a)}return t},getGradientColor:function(e,t,r){e=e.replace(/^\s*#|\s*$/g,""),t=t.replace(/^\s*#|\s*$/g,""),3==e.length&&(e=e.replace(/(.)/g,"$1$1")),3==t.length&&(t=t.replace(/(.)/g,"$1$1"));var n=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16),i=parseInt(t.substr(0,2),16),s=parseInt(t.substr(2,2),16),l=parseInt(t.substr(4,2),16),c=i-n,g=s-a,d=l-o;return c=(c*r+n).toString(16).split(".")[0],g=(g*r+a).toString(16).split(".")[0],d=(d*r+o).toString(16).split(".")[0],1==c.length&&(c="0"+c),1==g.length&&(g="0"+g),1==d.length&&(d="0"+d),"#"+c+g+d}}}angular.module("TADkit").factory("Color",e)}(),function(){"use strict";function e(e,t,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),a="assets/defaults/tk-defaults-components.json";return n.loaded.length>0?r.resolve(n):t.get(a).success(function(e){n.loaded=e,console.log("Components ("+e.length+") loaded from "+a),r.resolve(n)}),r.promise},add:function(e){e=e||["","","","","","","",[]];var t={metadata:{version:1,type:"component",generator:"TADkit"},object:{uuid:r.generate(),id:e[0],title:e[1],type:e[2],state:{width:e[3],height:e[4],margin:e[5],padding:e[6],position:e[7]}},view:e[8]};return n.loaded.push(t),n.current=n.loaded.length-1,n},remove:function(e){e=e||n.current.index;var t=n.loaded.indexOf(e);return n.loaded.splice(t,1),n},set:function(e){(void 0!==e||e!==!1)&&(n.current.index=e);var t=n.loaded[n.current.index];return t},setViewpoint:function(e,t,r){e=e||0,t=t||4999999;var a=n.loaded;return angular.forEach(a,function(n){var a=r||1;if(n.view.viewpoint.chromStart=e,n.view.viewpoint.chromEnd=t,"scene"===n.object.type||"scene-icon"===n.object.type){var o=n.view.viewpoint.fov/2,i=.6;a=Math.tan(o).toFixed(2)*i}n.view.viewpoint.scale=a}),n},get:function(){return n},getComponent:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e];return t},getComponentById:function(e){var t,r;if(void 0!==e||e!==!1)for(var a=n.loaded.length-1;a>=0;a--)n.loaded[a].object.id===e&&(t=n.loaded[a],r=a);return r||(t=n.loaded[n.current.index],console.log("Component '"+e+"' not found: returning current.")),t},getComponentByType:function(e){var t,r,a;if(void 0!==e||e!==!1)for(var o=n.loaded.length-1;o>=0;o--)n.loaded[o].object.type===e&&(t=n.loaded[o],a=o),"default"===n.loaded[o].object.type&&(r=n.loaded[o]);return a||(t=r,console.log("Component type '"+e+"' not found: returning default.")),t}}}angular.module("TADkit").factory("Components",e)}(),function(){"use strict";function e(e,t,r,n){function a(){r.$apply(function(){o.resolve(window.d3)})}var o=t.defer(),i=e[0].createElement("script");i.type="text/javascript",i.async=!0;var s=n.getOnline();i.src=s?"http://d3js.org/d3.v3.min.js":"assets/js/d3.min.js",i.onreadystatechange=function(){"complete"==this.readyState&&a()},i.onload=a;var l=e[0].getElementsByTagName("body")[0];return l.appendChild(i),{d3:function(){return o.promise}}}angular.module("d3",[]).factory("d3Service",e)}(),function(){"use strict";function e(e,t,r,n,a,o,i,s,l){var c={loaded:[],current:{index:0,cluster:1,centroid:1}};return{load:function(r,n){r=r||"tk-example-dataset",n=n||!1;var a=this;n&&a.clear();var o,i="defaults";r.indexOf("%2F")>-1?o=r.split("%2F").join("/")+".json":("tk-example-dataset"!=r&&(i="examples"),o="assets/"+i+"/"+r+".json");var s=e.defer();return t.get(o).success(function(e){e.object.filename=r,a.add(e),s.resolve(c)}),s.promise},add:function(e){var t=this,r=t.validate(e);
return c.loaded.push(r),c.current.index=c.loaded.length-1,t.setSpeciesUrl(),t.setRegion(),t.init(r),console.log("Dataset "+r.object.species+" "+r.object.region+" loaded from file."),c},validate:function(e){var t={},r=a.whatIsIt(e);t="String"===r?JSON.parse(e):e;var n=!0;return n?t:void 0},init:function(e){var t=this,r=t.getModel().data;n.set(e),o.set(r),i.set(r,e.restraints),angular.isUndefined(e.hic_data)?l.clear():l.set(e.hic_data),s.update(o.get().distances,e.restraints),console.log("Settings, Proximities, Restraints & Overlays initialized.")},clear:function(){for(;c.loaded.length>0;)c.loaded.shift()},remove:function(e){(void 0===e||e===!1)&&(e=c.current.index);var t=c.loaded.indexOf(e);return c.loaded.splice(t,1),c},setSpeciesUrl:function(e){(void 0===e||e===!1)&&(e=c.current.index);var t=c.loaded[e].object.species,r=t.replace(/[^a-z0-9]/gi,"_").toLowerCase();return c.loaded[e].object.speciesUrl=r,r},setRegion:function(e){(void 0===e||e===!1)&&(e=c.current.index);var t=0;c.loaded[e].object.chromosomeIndex&&(t=c.loaded[e].object.chromosomeIndex);var r=c.loaded[e].object.chrom[t],n=c.loaded[e].object.chromStart[t],a=c.loaded[e].object.chromEnd[t],o=r+":"+n+"-"+a;return c.loaded[e].object.region=o,o},set:function(e){(void 0!==e||e!==!1)&&(c.current.index=e),this.setCluster(c.current.cluster);var t=c.loaded[c.current.index];return t},setCluster:function(e){e=e||1,c.current.cluster=e;var t=this.getCentroid(c.current.cluster);this.setCentroid(t);var r=this.getCluster();return r},setCentroid:function(e){e=e||this.getCentroid(),c.current.centroid=e;var t=this.setModel(c.current.centroid);return t},setModel:function(e){e=e||this.getCentroid();var t=this.getModel(e-1);return c.loaded[c.current.index].data=t,t},get:function(){return c},getDataset:function(e){(void 0===e||e===!1)&&(e=c.current.index);var t=c.loaded[e];return t},getCluster:function(e){e=e||c.current.cluster;var t=c.loaded[c.current.index].clusters[e-1];return t},getCentroid:function(e){e=e||c.current.cluster;var t=c.loaded[c.current.index].centroids[e-1];return t},getModel:function(e){e=e||this.getCentroid();for(var t,r=c.loaded[c.current.index].models,n=r.length-1;n>=0;n--)r[n].ref==e&&(t=r[n]);return t}}}angular.module("TADkit").factory("Datasets",e)}(),function(){"use strict";function e(e,t,r){var n={ping:0};return{ping:function(){console.log("Pinging Ensembl RESTful genomic data server...");var r=e.defer(),a="http://rest.ensemblgenomes.org/info/ping?content-type=application/json";return t.get(a).success(function(e){n.ping=e.ping,console.log("Ensembl RESTful is contactable.")}),r.promise},load:function(n){var a,o=e.defer(),i=r.get(),s=i.current.species,l=i.current.speciesUrl,c=i.current.chrom,g=i.current.chromStart,d=i.current.chromEnd,u=this,p=r.getOnline();return a=p?n.object.url[0]+l+n.object.url[2]+c+n.object.url[4]+g+n.object.url[6]+d+n.object.url[8]:"assets/offline/"+l+"-genes.json",t.get(a).success(function(e){var t=u.setBiotypeStyle(e);n.data=t;var r=c+":"+g+"-"+d,a=p?"Ensembl":"local storage";console.log("Genes for "+s+" "+r+" retreived from "+a+"."),o.resolve(n)}),o.promise},setBiotypeStyle:function(e){return angular.forEach(e,function(e){var t=e.biotype.toLowerCase();e.biotypeStyle=t}),e}}}angular.module("TADkit").factory("Ensembl",e)}(),function(){"use strict";function e(){var e={n:0,max:0,min:99999999999,pos:[],value:[],tads:[]};return{set:function(t){var r=this;r.clear(),e.n=parseInt(t.n);var n=0;for(var a in t.data)e.pos.push(parseInt(a)),e.value.push(t.data[a]),t.data[a]<e.min&&(e.min=t.data[a]),t.data[a]>e.max&&(e.max=t.data[a]),n++;return angular.isUndefined(t.tads)||r.setTADS(t.tads),e},setTADS:function(t){e.tads=t},get:function(){return e},clear:function(){e={n:0,max:0,min:99999999999,pos:[],value:[],tads:[]}}}}angular.module("TADkit").factory("Hic_data",e)}(),function(){"use strict";function e(e,t,r,n,a,o,i,s,l){return function(){var c=t.load(),g=r.load(),d=n.load(),u=a.load(),p=o.load(),h=i.load(),m=s.load(),b=l.loadBiotypeColors();return e.all([c,g,d,u,p,h,m,b]).then(function(e){return{settings:e[0],users:e[1],projects:e[2],datasets:e[3],overlays:e[4],components:e[5],storyboards:e[6],featureColors:e[7]}})}}angular.module("TADkit").service("initMain",e)}(),function(){"use strict";function e(e){return{linePiecesRGB:function(t,r){for(var n=this,a=t.data.length,o=new Float32Array(6*r),i=new THREE.Color("#000000"),s=o.length-1;s>=0;s--)o[c]=i;for(var l=e.getRandomRGB(a),c=0;a>c;c++){var g=t.data[c][0],d=t.data[c][1],u=6*n.getMatrixIndex(g,d,r),p=l[c];if("restraints"==t.object.id){var h={H:"#4CAF50",L:"#0000ff",U:"#ff00ff",C:"#00ff00"};p=n.getFeatureRGB(t.data[c][2],h)}o[u]=p.r,u++,o[u]=p.g,u++,o[u]=p.b,u++,o[u]=p.r,u++,o[u]=p.g,u++,o[u]=p.b}return o.name="Network LinePieces RGB",o},linePiecesAlpha:function(e,t){for(var r=this,n=new Float32Array(2*t),a=0,o=n.length-1;o>=0;o--)n[o]=a;if(e.data)for(var i=e.data.length,s=0;i>s;s++){var l=e.data[s][0],c=e.data[s][1],g=r.getMatrixIndex(l,c,t),d=e.data[s][3]*e.data[s][3]/5;n[g]=d,g++,n[g]=d}return n.name="Network LinePieces Alphas",n},getMatrixIndex:function(e,t,r){for(var n=0,a=e-1,o=0;a>=o;o++)n+=r-(r-o);return n+=t-e-1},getFeatureRGB:function(e,t){t=t||{0:"#000000"};var r;return angular.forEach(t,function(t,n){e==n&&(r=new THREE.Color(t))}),r}}}angular.module("TADkit").factory("Networks",e)}(),function(){"use strict";function e(e,t,r,n,a,o,i,s,l,c){var g={loaded:[],current:{index:-1}};return{load:function(){var r=e.defer(),n="assets/defaults/tk-defaults-overlays.json";return g.loaded.length>0?r.resolve(g):t.get(n).success(function(e){g.loaded=e,g.current.index=g.loaded.length-1,console.log("Overlays ("+e.length+") loaded from "+n),r.resolve(g)}),r.promise},loadTSV:function(r,n,a){r=r||"tk-example-dataset",n=n||"tsv","undefined"==typeof a&&(a=!0);var i=this;a&&(i.defaults(),o.defaultComponents());var s=e.defer(),l="defaults";"tk-example-dataset"!=r&&(l="examples");var c="assets/"+l+"/"+r+"."+n;return t.get(c).success(function(e){var t=i.import(e,[],[],a);console.log("Overlays ("+t.length+") imported from "+c),s.resolve(g)}).error(function(){console.log("No associated data tracks found.")}),s.promise},"import":function(e,t,r){var n=this;t=t||[],r=r||[];var a,o=c.whatIsIt(e);a="String"==o?n.parse(e).data:e;var i;i=t.length>0&&r.length>0?n.filter(a,t,r):a;var s=n.aquire(i);return n.add(s),s},parse:function(e){Papa.DefaultDelimiter=" ";var t=Papa.parse(e,{dynamicTyping:!0,skipEmptyLines:!0,fastMode:!0});return t},filter:function(e,t,r){for(var n=[],a=t.length,o=r.length,i=0;a>i;i++){var s=[];if(t[i]){for(var l=0;o>l;l++)r[l]&&s.push(e[i][l]);n.push(s)}}return n},aquire:function(e){var t,n,a,o=["#227c4f","#e71818","#8ece0d","#6666ff","#424242"],i=d3.scale.category20(),s=[],l=0,c=1,g=0,d=1,u=e[l].length,p=e[c][d]-e[c][g]+1,h=e[c+1][d]-e[c+1][g]+1;p==h?(t="wiggle_0",n="fixed",a="fixed"):(t="bedgraph",n="variable",a="variable");var m=!1;if(7==u){for(var b=0,f=2;u>f;f++){var v=e[l][f].toLowerCase();("hp1"==v||"brm"==v||"mrg15"==v||"pc"==v||"h1"==v)&&b++}5==b&&(m=!0)}for(var y=u-1;y>=2;y--){var w;w=m?o[y-2]:i(y),s.unshift({metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:r.generate(),id:e[l][y],title:e[l][y],source:"Research output",url:"local",description:"center_label",type:t,format:n,components:2,name:e[l][y],visibility:"full",color:w,altColor:"#cccccc",priority:"100",stepType:a,chrom:"",start:e[c][g],step:p,state:{index:0,overlaid:!1}},palette:[w,"#cccccc"],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}});for(var E=e.length-1;E>=1;E--)"variable"==n?s[0].data.unshift({start:e[E][g],end:e[E][d],read:e[E][y]}):s[0].data.unshift(e[E][y])}return s},add:function(e){var t=this,r=[],n=g.loaded.length-1;return angular.forEach(e,function(e){var t=!1;t||(n++,e.object.state.index=n,e.object.state.overlaid=!1,r.push(e),o.addComponent(e))}),g.loaded=g.loaded.concat(r),t.segment(),r},addDirect:function(e){for(var t=g.loaded.length-1,r=g.loaded.length-1;r>=0;r--)if(g.loaded[r].object.uuid==e.object.uuid)return!0;return t++,e.object.state.index=t,g.loaded=g.loaded.concat(e),t},clear:function(){for(;g.loaded.length>0;)g.loaded.shift()},defaults:function(){for(;g.loaded.length>4;)g.loaded.pop()},remove:function(e){(void 0===e||e===!1)&&(e=g.current.index);var t=g.loaded.indexOf(e);return g.loaded.splice(t,1),g},set:function(e){(void 0!==e||e!==!1)&&(g.current.index=e);var t=g.loaded[g.current.index];return t},setOverlaid:function(e){return e=e||"",angular.forEach(g.loaded,function(t){t.object.state.overlaid=t.object.state.index===e?!0:!1}),e},update:function(t,r){var n=this,a=[],s=[];return angular.forEach(g.loaded,function(e){if("ensembl"==e.object.type){var n=i.load(e);a.push(n),s.push(e)}"proximities"==e.object.id&&(e.data=t),"restraints"==e.object.id&&(e.data=r)}),e.all(a).then(function(e){for(var t=0;t<s.length;t++)o.update(s[t]);return n.segment(),e})},segment:function(){var e=a.get(),t=this;return angular.forEach(g.loaded,function(r){var n=!0;if(n){var a=r.object.type,o=r.object.format;if("gradient"==a&&"hex"==o)r.colors.particles=s.gradientHCL(r,e.current.particlesCount),r.colors.chromatin=s.gradientHCL(r,e.current.segmentsCount),r.colors.network.RGB=l.linePiecesRGB(r,e.current.edgesCount),r.colors.network.alpha=l.linePiecesAlpha(r,e.current.edgesCount);else if("wiggle_0"==a&&"fixed"==o)r.colors.particles=s.bicolor(r,e.current.particlesCount),r.colors.chromatin=s.bicolor(r,e.current.segmentsCount),r.colors.network.RGB=l.linePiecesRGB(r,e.current.edgesCount),r.colors.network.alpha=l.linePiecesAlpha(r,e.current.edgesCount);else if("wiggle_0"==a&&"variable"==o);else if("bedgraph"==a)r.colors.particles=s.bicolorVariable(r,e.current.chromStart,e.current.particlesCount,1),r.colors.chromatin=s.bicolorVariable(r,e.current.chromStart,e.current.segmentsCount,e.current.segmentLength),r.colors.network.RGB=l.linePiecesRGB(r,e.current.edgesCount),r.colors.network.alpha=l.linePiecesAlpha(r,e.current.edgesCount);else if("matrix"==a)r.colors.particlesMatrix=s.matrix(r,1),r.colors.chromatinMatrix=s.matrix(r,e.current.particleSegments),r.colors.networkMatrix=r.colors.particlesMatrix,t.at(1,e.current.particlesCount,e.current.particleSegments);else if("misc"==a&&"variable"==o)r.colors.particles=[],r.colors.chromatin=[],r.colors.network.RGB=l.linePiecesRGB(r,e.current.edgesCount),r.colors.network.alpha=l.linePiecesAlpha(r,e.current.edgesCount);else if("ensembl"==a&&"json"==o){var i=c.get().biotypes,g=1;r.colors.particles=s.features(r,e.current.chromStart,e.current.particlesCount,g,i),r.colors.chromatin=s.features(r,e.current.chromStart,e.current.segmentsCount,e.current.segmentLength,i),r.colors.network.RGB=l.linePiecesRGB(r,e.current.edgesCount),r.colors.network.alpha=l.linePiecesAlpha(r,e.current.edgesCount)}}else console.log("Overlay '"+r.object.title+"' already segmented as color array matching current dataset length")}),g},at:function(e){var t=a.get();return angular.forEach(g.loaded,function(r){var n=r.object.type;if("matrix"==n){var a=(e-1)*t.current.particlesCount,o=e*t.current.particlesCount,i=a*t.current.particleSegments,s=o*t.current.particleSegments;r.colors.particles=r.colors.particlesMatrix.slice(a,o),r.colors.chromatin=r.colors.chromatinMatrix.slice(i,s),r.colors.network=r.colors.networkMatrix.slice(a,o)}}),g},get:function(){return g},getOverlay:function(e){(void 0===e||e===!1)&&(e=g.current.index);var t=g.loaded[e];return t},getOverlayById:function(e){var t,r;if(void 0!==e||e!==!1)for(var n=g.loaded.length-1;n>=0;n--)g.loaded[n].object.id===e&&(t=g.loaded[n],t.object.state.index=n,r=!0);return r||(t=g.loaded[g.current.index],t.object.state.index=g.current.index,console.log('Overlay "'+e+'" not found: returning current.')),t},getCurrentIndex:function(){return g.current.index}}}angular.module("TADkit").factory("Overlays",e)}(),function(){"use strict";function e(){return{simple:function(e){for(var t="EnsemblBacteria",r=e.length,n=[],a=0;r-1>a;a++){var o=e[a],i=e[a+1],s=new THREE.Vector3(0,0,0);s.addVectors(o,i).divideScalar(2);var l=new THREE.Vector3(0,0,0);if(l.copy(s).sub(o),0===a&&"EnsemblBacteria"!=t){var c;c=new THREE.Vector3(0,0,0),c.copy(o).sub(l),n.push(c)}if(n.push(s),a==r-2&&"EnsemblBacteria"!=t){var g;g=new THREE.Vector3(0,0,0),g.copy(i).add(l),n.push(g)}}return n},cubic:function(e,t){t=t||!1;var r=1,n=e.length,a={};a.vertices=[],a.colors=[];for(var o=new THREE.Vector3(0,0,0),i=0;n>i;i++){var s=e[i],l=new THREE.Vector3(0,0,0);i==n-1?t?l=e[0]:l.copy(s).add(new THREE.Vector3(.5,.5,.5)):l=e[i+1];var c=new THREE.Vector3(0,0,0);c.addVectors(s,l).divideScalar(2);var g=new THREE.Vector3(0,0,0);if(g.copy(c).sub(s),0===i)if(t){var d=new THREE.Vector3(0,0,0);d.addVectors(e[n-1],e[0]).divideScalar(2),o.copy(d).sub(e[n-1])}else o.copy(g);var u=new THREE.Vector3(0,0,0);u.copy(s).sub(g);var p=new THREE.Vector3(0,0,0);p.copy(s).add(o);var h=new THREE.Vector3(0,0,0);h.subVectors(p,u).divideScalar(r),u.copy(s).sub(h),p.copy(s).add(h),a.vertices.push(u),a.colors.push(new THREE.Color(13421772)),a.vertices.push(s),a.colors.push(new THREE.Color(0)),a.vertices.push(p),a.colors.push(new THREE.Color(13421772)),o=g}var m=new THREE.Vector3(0,0,0),b=new THREE.Vector3(0,0,0),f=new THREE.Vector3(0,0,0),v=new THREE.Vector3(0,0,0),y=a.vertices.length,w=a.vertices[y-2],E=a.vertices[y-1],x=a.vertices[0],k=a.vertices[1];if(t){var C=new THREE.CubicBezierCurve3(w,E,x,k),T=C.getPointAt(.5),R=C.getTangent(.5).multiplyScalar(1);m.copy(T).sub(R),b.copy(T),f.copy(T).add(R),v.copy(T)}else m.copy(x),b.copy(x),f.copy(E),v.copy(E);return a.vertices.unshift(m),a.colors.unshift(new THREE.Color(16776960)),a.vertices.unshift(b),a.colors.unshift(new THREE.Color(16711680)),a.vertices.push(f),a.colors.push(new THREE.Color(65535)),a.vertices.push(v),a.colors.push(new THREE.Color(255)),a}}}angular.module("TADkit").factory("PathControls",e)}(),function(){"use strict";function e(){return{splineNearFit:function(e){var t,r="EnsemblBacteria";return t="EnsemblBacteria"==r?new THREE.ClosedSplineCurve3(e):new THREE.SplineCurve3(e)},spline:function(e){var t="NotEnsemblBacteria",r=new THREE.CurvePath,n=e.length;if("EnsemblBacteria"==t)r=new THREE.ClosedSplineCurve3(e);else for(var a=1;n-2>a;a+=3){var o=e[a],i=e[a+1],s=e[a+2],l=e[a+3],c=new THREE.Vector3(0,0,0);c.addVectors(s,i).divideScalar(2);var g=new THREE.SplineCurve3([o,c,l]);r.add(g)}return r},quadraticBezier:function(e){var t="NotEnsemblBacteria",r=new THREE.CurvePath,n=e.length;if("EnsemblBacteria"==t)r=new THREE.ClosedSplineCurve3(e);else for(var a=1;n-2>a;a+=3){var o=e[a],i=e[a+1],s=e[a+2],l=e[a+3],c=new THREE.Vector3(0,0,0);c.addVectors(s,i).divideScalar(2);var g=new THREE.QuadraticBezierCurve3(o,c,l);r.add(g)}return r},cubicBezier:function(e,t,r){r=r||!1;for(var n=new THREE.CurvePath,a=e.length,o=0;a-1>o;o+=3){var i=e[o],s=e[o+1],l=e[o+2],c=e[o+3],g=new THREE.CubicBezierCurve3(i,s,l,c);n.add(g)}return n}}}angular.module("TADkit").factory("Paths",e)}(),function(){"use strict";function e(e,t,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),a="assets/defaults/tk-defaults-projects.json";return n.loaded.length>0?r.resolve(n):t.get(a).success(function(e){n.loaded=e,console.log("Projects ("+e.length+") loaded from "+a),r.resolve(n)}),r.promise},add:function(e){var t={metadata:{version:1,type:"project",generator:"TADkit"},object:{uuid:r.generate(),id:e[0],title:e[1],description:e[2],group:e[3],state:e[4]},datasets:e[5],overlays:e[6],storyboards:e[7]};return n.loaded.push(t),n.current=n.loaded.length-1,n},remove:function(e){(void 0===e||e===!1)&&(e=users.current.index);var t=n.loaded.indexOf(e);return n.loaded.splice(t,1),n},set:function(e){(void 0!==e||e!==!1)&&(n.current.index=e);var t=n.loaded[n.current.index];return t},get:function(){return n},getProject:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e];return t},getState:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e].object.state;return t}}}angular.module("TADkit").factory("Projects",e)}(),function(){"use strict";function e(){var e={dimension:0,positions:[],distances:[]},t={dimension:0,positions:[],distances:[]};return{set:function(t,r){var n={minDistance:150,maxDistance:400,limitConnections:!0,maxConnections:200};r=r||{},angular.extend(this,angular.copy(n),r),this.maxDistance=this.getMaxDistance(t);var a=0,o=0;e.dimension=t.length/3;for(var i=e.dimension*e.dimension,s=2*i,l=new Float32Array(3*s),c=new Float32Array(i),g=e.dimension-1,d=g;d>=0;d--)for(var u=g;u>=0;u--){var p=t[3*d]-t[3*u],h=t[3*d+1]-t[3*u+1],m=t[3*d+2]-t[3*u+2],b=Math.sqrt(p*p+h*h+m*m);l[a++]=t[3*d],l[a++]=t[3*d+1],l[a++]=t[3*d+2],l[a++]=t[3*u],l[a++]=t[3*u+1],l[a++]=t[3*u+2];var f=1-b/this.maxDistance;c[o++]=f}return e.positions=l,e.distances=c,e},getMaxDistance:function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e,3)),t.computeBoundingSphere();var r=Math.ceil(2*t.boundingSphere.radius);return r},at:function(r){t.dimension=r;var n=(r-1)*e.dimension,a=r*e.dimension;return t.positions=e.positions.subarray(2*n*3,2*a*3),t.distances=e.distances.subarray(n,a),t},get:function(){return e},getCurrent:function(){return t}}}angular.module("TADkit").factory("Proximities",e)}(),function(){"use strict";function e(e,t,r,n){var a={};return a.assembly={},a.featureColors={},{setLengthBP:function(e){var t=0,r=e;for(var n in r)if(r.hasOwnProperty(n))for(var a=0,o=r.length;o>a;a++)t+=r[a].length;return t},loadBiotypeColors:function(){var r,o=e.defer(),i=!1;return r=i?"https://cdn.rawgit.com/Ensembl/ensembl-webcode/release/75/conf/ini-files/COLOUR.ini":"assets/offline/ensembl-webcode-COLOUR.ini",t.get(r).success(function(e){var t=n.colorsFromIni(e);a.featureColors=t,a.biotypes=t.gene,console.log("Ensembl webcode biotype colors retrieved Ensembl."),o.resolve(t)}),o.promise},get:function(){return a},whatIsIt:function(e){var t="test".constructor,r=[].constructor,n={}.constructor;return null===e?"null":void 0===e?"undefined":e.constructor===t?"String":e.constructor===r?"Array":e.constructor===n?"Object":"don't know"}}}angular.module("TADkit").factory("Resources",e)}(),function(){"use strict";function e(){var e={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]},t={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]};return{set:function(t,r,n){var a={setting:!0};n=n||{},angular.extend(this,angular.copy(a),n),e={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]},e.dimension=t.length/3;for(var o=0;o<r.length;o++)"H"==r[o][2]&&e.harmonics.push(r[o]),"L"==r[o][2]&&e.lowerBounds.push(r[o]),"U"==r[o][2]&&e.upperBounds.push(r[o]),"C"==r[o][2]&&e.neighbours.push(r[o]);return e},at:function(r){return t.dimension=r,t.harmonics=[],t.lowerBounds=[],t.upperBounds=[],t.neighbours=[],angular.forEach(e,function(e,n){if("dimension"!=n)for(var a=e.length-1;a>=0;a--)if(e[a][0]==r&&t[n].push(e[a]),e[a][1]==r){var o=[];o.push(e[a][1]),o.push(e[a][0]),o.push(e[a][2]),o.push(e[a][3]),t[n].push(o)}}),t},get:function(){return e},getCurrent:function(){return t}}}angular.module("TADkit").factory("Restraints",e)}(),function(){"use strict";function e(e,t){return{gradientHCL:function(e,t){for(var r=[],n=e.palette[0],a=e.palette[1],o=t-1;o>=0;o--){var i=o/t,s=d3.interpolateHcl(n,a)(i);r.push(s)}return r},gradientComponentRGB:function(e,t){var r,n,a,o,i,s,l,c,g,d,u=[],p="0x"+e.palette[0].substring(1),h="0x"+e.palette[1].substring(1);r=p>>16,n=p>>8&255,a=255&p,o=h>>16,i=h>>8&255,s=255&h;for(var m=t-1;m>=0;m--)l=m/t,c=+(l*r+(1-l)*o).toFixed(2),g=+(l*n+(1-l)*i).toFixed(2),d=+(l*a+(1-l)*s).toFixed(2),u.push(c,g,d);return u},bicolor:function(e,t){for(var r=e.palette[0],n=e.palette[1],a=[],o=0;t>o;o++){var i;i=1===e.data[o]?r:n,a.push(i)}return a},matrix:function(e,t){for(var r=e.palette[0],n=e.palette[1],a=[],o=e.data.length-1;o>=0;o--)for(var i=e.data[o],s=1-i*i,l=d3.interpolateHsl(r,n)(s),c=0;t>c;c++)a.push(l);return a},bicolorVariable:function(e,t,r,n){for(var a=e.palette[0],o=e.palette[1],i=e.data,s=[],l=0;r>l;l++){for(var c=o,g=t+n*l,d=g+n,u=i.length,p=0;u>p;p++){var h=i[p].start,m=i[p].end;Math.max(g,h)<=Math.min(d,m)&&(c=1===i[p].read?a:o)}s.push(c)}return s},featureGraph:function(e,r){var n=this.gradientHCL(e,r),a=t.THREEColorsFromHex(n),o=t.vertexColorsFromTHREEColors(a);return o},features:function(e,t,r,n,a){for(var o=e.data,i=[],s=0;r>s;s++){for(var l=[],c=t+n*s,g=c+n,d=o.length,u="cccccc",p="#"+u,h=0;d>h;h++){var m=o[h].start,b=o[h].end,f=[];if(Math.max(c,m)<=Math.min(g,b)){f.push(s);var v="biotype",y="protein_coding";l.length>0?l[0]==y?l[0]=o[h][v].toLowerCase():l.push(o[h][v].toLowerCase()):l.push(o[h][v].toLowerCase())}o[h].inSegments=f}for(var w=0;w<l.length;w++){var E=l[0];E in a?(u=a[E].match(/[a-f0-9]{6}/gi),p="#"+u):(u="110100",p="#"+u)}i.push(p)}return i}}}angular.module("TADkit").factory("Segments",e)}(),function(){"use strict";function e(e,t){var r={};return{load:function(){var n=e.defer(),a="assets/defaults/tk-defaults-settings.json";return Object.getOwnPropertyNames(r).length>0?n.resolve(r):t.get(a).success(function(e){r=e,console.log("Settings loaded from "+a),n.resolve(r)}),n.promise},set:function(e){var t=this,n=0;e.object.chromosomeIndex&&(n=e.object.chromosomeIndex),r.current.chrom=e.object.chrom[n],r.current.chromStart=e.object.chromStart[n],r.current.chromEnd=e.object.chromEnd[n],r.current.species=e.object.species,r.current.speciesUrl=e.object.speciesUrl,r.current.particlesCount=e.models[0].data.length/e.object.components,r.current.particleSegments=Math.ceil(2500/r.current.particlesCount),r.current.edgesCount=.5*(r.current.particlesCount*r.current.particlesCount-r.current.particlesCount),r.current.segmentsCount=r.current.particlesCount*r.current.particleSegments,r.current.segmentLength=e.object.resolution/r.current.particleSegments,r.current.position=r.current.chromStart+parseInt(.5*(r.current.chromEnd-r.current.chromStart)),r.current.particle=t.getParticle(),r.current.particleSize=Math.ceil(e.object.resolution/20),r.current.segment=t.getSegment(r.current.position),r.current.segmentLower=r.current.position-.5*r.current.segment,r.current.segmentUpper=r.current.position+.5*r.current.segment},add:function(){return r},remove:function(){return r},getState:function(){var e=r[settingID].state;return e},get:function(){return r},getOnline:function(){var e=!1;return r.app&&(e=r.app.online),e},getSegment:function(e){e=e||r.current.position;var t=this,n=t.getRange(r.current.chromStart,e),a=t.getRange(r.current.chromStart,r.current.chromEnd),o=Math.ceil(n*r.current.segmentsCount/a);return o},getParticle:function(e){e=e||r.current.position;var t=this,n=t.getRange(r.current.chromStart,e),a=t.getRange(r.current.chromStart,r.current.chromEnd),o=Math.ceil(n*r.current.particlesCount/a);return o},getRange:function(e,t){for(var r=0,n=e;t>=n;n++)r++;return r},toggle:function(e){return angular.forEach(r,function(t){e==t.id&&(t.state=!t.state)}),r}}}angular.module("TADkit").factory("Settings",e)}(),function(){"use strict";function e(e,t,r,n,a){var o={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),n="assets/defaults/tk-defaults-storyboards.json";return o.loaded.length>0?(console.log("Storyboards already loaded."),r.resolve(o)):t.get(n).success(function(e){o.loaded=e,console.log("Storyboards ("+e.length+") loaded from "+n),r.resolve(o)}),r.promise},add:function(e){e=e||[""];var t={metadata:{version:1,type:"storyboard",generator:"TADkit"},object:{uuid:r.generate(),id:e[0],title:e[1],email:e[2],group:e[3],permissions:e[4]},data:e[5]};return o.loaded.push(t),o.current=o.loaded.length-1,o},addComponent:function(e,t,o){var i=this;t=t||"default",o=o||[];var s=n.get(),l=a.getComponentByType(e.object.type),c=angular.copy(l);c.object.uuid=r.generate(),c.object.id=e.object.id,c.object.title=e.object.id,c.object.dataset=e.object.id,c.view.settings.step=e.object.step,c.view.settings.color=e.object.color,c.view.viewpoint.chromStart=s.current.chromStart,c.view.viewpoint.chromEnd=s.current.chromEnd,c.view.viewpoint.scale=s.views.scale,c.view.viewtype=e.object.type+"-"+e.object.stepType,c.data=e.data,c.overlay=e;var g=i.getStoryboardById(t);return g.components.push(c),c},defaultComponents:function(e){var t=this;e=e||"default";for(var r=t.getStoryboardById(e);r.components.length>6;)console.log("popping"),o.loaded[o.current.index].components.pop();return o},remove:function(e){(void 0===e||e===!1)&&(e=o.current.index);var t=o.loaded.indexOf(e);return o.loaded.splice(t,1),o},removeComponentById:function(e){console.log("component");var t=this;if(void 0!==e||e!==!1){var r=t.getComponentById(e),n=t.getStoryboard();n.components.splice(r.index,1),console.log(r)}return o},set:function(e){(void 0!==e||e!==!1)&&(o.current.index=e);var t=o.loaded[o.current.index];return t},setViewpoint:function(e,t,r){e=e||0,t=t||4999999;var n=o.loaded[o.current.index].components;return angular.forEach(n,function(n){var a=r||1;if(n.view.viewpoint.chromStart=e,n.view.viewpoint.chromEnd=t,"scene"===n.object.type||"scene-icon"===n.object.type){var o=n.view.viewpoint.fov/2,i=.6;a=Math.tan(o).toFixed(2)*i}n.view.viewpoint.scale=a}),o},update:function(e){var t=this,r=t.getStoryboard().components;angular.forEach(r,function(t){("track-genes"==t.object.type||"panel-inspector"==t.object.type)&&(t.data=e.data,t.overlay=e)})},get:function(){return o},getStoryboard:function(e){(void 0===e||e===!1)&&(e=o.current.index);var t=o.loaded[e];return t},getStoryboardById:function(e){var t,r;if(void 0!==e||e!==!1)for(var n=o.loaded.length-1;n>=0;n--)o.loaded[n].object.id===e&&(t=o.loaded[n],t.index=n,r=!0);return r||(t=o.loaded[o.current.index],t.index=o.current.index,console.log("Storyboard '"+e+"' not found: returning current.")),t},getComponentById:function(e){var t,r,n=this,a=n.getStoryboard().components;if(void 0!==e||e!==!1)for(var o=a.length-1;o>=0;o--)console.log(a[o].object.title),a[o].object.title===e&&(t=a[o],t.index=o,r=!0,console.log("Component '"+e+"' found!"));return r||(t=a[0],console.log("Component '"+e+"' not found: returning first.")),t}}}angular.module("TADkit").factory("Storyboards",e)}(),function(){"use strict";function e(e,t,r){function n(){r.$apply(function(){a.resolve(window.three)})}var a=t.defer(),o=e[0].createElement("script");o.type="text/javascript",o.async=!0,o.src="../bower_components/threejs/build/three.js",o.onreadystatechange=function(){"complete"==this.readyState&&n()},o.onload=n;var i=e[0].getElementsByTagName("body")[0];return i.appendChild(o),{three:function(){return a.promise}}}angular.module("three",[]).factory("threeService",e)}(),function(){"use strict";function e(e,t,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),a="assets/defaults/tk-defaults-users.json";return n.loaded.length>0?r.resolve(n):t.get(a).success(function(e){n.loaded=e,console.log("Users ("+e.length+") loaded from "+a),r.resolve(n)}),r.promise},add:function(e){e=e||["id","Name Surname","email@company.com","Group","edit",["default"]];var t={metadata:{version:1,type:"user",generator:"TADkit"},object:{uuid:r.generate(),id:e[0],title:e[1],email:e[2],group:e[3],permissions:e[4]},projects:e[5]};return n.loaded.push(t),n.current=n.loaded.length-1,n},remove:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded.indexOf(e);return n.loaded.splice(t,1),n},set:function(e){(void 0!==e||e!==!1)&&(n.current.index=e);var t=n.loaded[n.current.index];return t},get:function(){return n},getUser:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e];return t},getPermissions:function(e){(void 0===e||e===!1)&&(e=n.current.index);var t=n.loaded[e].permissions;return t}}}angular.module("TADkit").factory("Users",e)}();
=======
!function(){"use strict";angular.module("TADkit",["TADkit.datasets","TADkit.layers","ui.router","ngMaterial","uuid4","d3js","threejs","generic","ui","bioinformatics","browsers","modeling","visualization"])}(),function(){"use strict";angular.module("TADkit").constant("NAME","TADkit").constant("VERSION","0.3.0").constant("ENV","production").constant("VERBOSE",!1).constant("ONLINE",!1)}(),function(){"use strict";function t(t,e,n,r,o){e.debugEnabled("development"===t),"development"===t&&console.log("TADkit Environment: "+t),r.definePalette("chroma",{50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),r.theme("tadkit").primaryPalette("chroma",{"default":"500"}).accentPalette("lime",{"default":"500"}).warnPalette("red",{"default":"500"}),r.theme("darkKit").dark(),r.setDefaultTheme("tadkit"),o.decorator("mdButtonDirective",["$delegate",function(t){var e=t[0].template;return t[0].template=function(t,n){return"file"===n.type?'<label class="md-button" ng-transclude></label>':e(t,n)},t}])}angular.module("TADkit").config(t),t.$inject=["ENV","$logProvider","$locationProvider","$mdThemingProvider","$provide"]}(),function(){"use strict";function t(t,e,n,r,o,a,i){a.info(t+" "+e),a.debug("Environment: "+n+", "+r+", "+o+" "),i.$on("$stateChangeError",function(t,e,n,r,o,i){a.error("Resolve Error: ",i)})}angular.module("TADkit").run(t),t.$inject=["NAME","VERSION","ENV","VERBOSE","ONLINE","$log","$rootScope"]}(),function(){"use strict";function t(t,e){e.otherwise("/project/loader/"),t.state("main",{controller:"MainController","abstract":!0,url:"",templateUrl:"assets/templates/main.html",resolve:{initialData:["App",function(t){return new t}]}}).state("project",{parent:"main",url:"/project",data:{cssClassnames:"main"},views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"sidebar-left@main":{templateUrl:"assets/templates/sidebar.project.html",controller:"ProjectController"},"content@main":{templateUrl:"assets/templates/project-content.html",controller:"ProjectContentController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("loader",{parent:"project",url:"/loader/:loadDataset",data:{cssClassnames:"loader"},views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"content@main":{templateUrl:"assets/templates/project-loader.html",controller:"ProjectLoaderController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("dataset",{parent:"project",url:"/dataset",data:{cssClassnames:"dataset"},views:{"content@main":{templateUrl:"assets/templates/project-dataset.html",controller:"ProjectDatasetController"}}}).state("layer",{parent:"project",url:"/layer",data:{cssClassnames:"layer"},views:{"content@main":{templateUrl:"assets/templates/project-layer.html",controller:"ProjectController"}}}).state("storyboard",{parent:"project",url:"/storyboard",data:{cssClassnames:"storyboard"},views:{"content@main":{templateUrl:"assets/templates/project-storyboard.html",controller:"ProjectController"}}}).state("browser",{parent:"project",url:"/browser",views:{"sidebar-left@main":{templateUrl:"assets/templates/sidebar.browser.html",controller:"SidebarBrowserController"},"content@main":{templateUrl:"assets/templates/storyboard.html",controller:"StoryboardController"}}}).state("data-import",{parent:"browser",url:"/data/import",views:{"modal@main":{templateUrl:"assets/templates/data-import.html",controller:"DataImportController"}}}).state("404",{url:"/404",templateUrl:"assets/templates/404.tpl.html",controller:"AppController"})}angular.module("TADkit").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,n,r,o,a,i,s){function c(){t.debug("Dependencies loading...");var s=n.load(),c=o.load(),l=a.load(),u=i.load();return e.all([s,c,l,u]).then(function(e){return t.debug("Dependencies loaded OK!"),r.load(e[2].textures),e})}function l(){var t=s.defaults();return e.all([t]).then(function(t){return t})}return function(){return t.log("TADkit loading..."),c().then(l).then(function(){t.log("TADkit loaded OK!")})}}angular.module("TADkit").factory("App",t),t.$inject=["$log","$q","THREEService","THREETextures","d3Service","Settings","Components","Init"]}(),function(){"use strict";function t(t,e,n,r,o){var a={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),o="assets/defaults/tk-defaults-components.json";return a.loaded.length>0?r.resolve(a):n.get(o).success(function(e){a.loaded=e,t.debug("Components ("+e.length+") loaded from "+o),r.resolve(a)}),r.promise},add:function(t){t=t||["","","","","","",[]];var e={metadata:{version:1,type:"component",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],type:t[2],state:{width:t[3],height:t[4],margin:t[5],position:t[6]}},view:t[7]};return a.loaded.push(e),a.current=a.loaded.length-1,a},remove:function(t){t=t||a.current.index;var e=a.loaded.indexOf(t);return a.loaded.splice(e,1),a},set:function(t){(void 0!==t||t!==!1)&&(a.current.index=t);var e=a.loaded[a.current.index];return e},init:function(e){return t.info("Component initialized!"),a},get:function(t){t=t||[];var e=[];if(t.length>0)for(var n=t.length-1;n>=0;n--)for(var r=t[n],o=a.loaded.length-1;o>=0;o--){var i=a.loaded[o];if(i.object.id===r){e.unshift(i);break}}else e=a.loaded;return e},getComponent:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=a.loaded[t];return e},getComponentById:function(e){var n,r;if(void 0===e&&e===!1)return t.warn("No valid component ID supplied.");for(var o=a.loaded.length-1;o>=0;o--)a.loaded[o].object.id===e&&(n=a.loaded[o],r=o,t.debug("Component '"+e+"' found!"));return r||(n=a.loaded[a.current.index],t.warn("Component '"+e+"' not found: returning current.")),n},getComponentByType:function(e){var n,r,o,i=this;if(void 0!==e||e!==!1)for(var s=a.loaded.length-1;s>=0;s--)a.loaded[s].object.type===e&&(n=a.loaded[s],o=s,t.debug("Component type '"+e+"' found!")),"default"===a.loaded[s].object.type&&(r=a.loaded[s]);return o||(n=r,t.warn("Component type '"+e+"' not found: returning default.")),i.init(n),n}}}angular.module("TADkit").factory("Components",t),t.$inject=["$log","$q","$http","uuid4","Settings"]}(),function(){"use strict";function t(t,e,n,r,o,a,i,s,c,l,u,d,p){function g(){t.debug("Default user initializing...");var e=n.getUser();"undefined"!=typeof e.projects&&0===e.projects.length&&(e.projects=r.get(),"undefined"!=typeof e.projects.loaded[0].datasets&&0===e.projects.loaded[0].datasets.length&&(e.projects.loaded[0].datasets=o.get()),"undefined"!=typeof e.projects.loaded[0].layers&&0===e.projects.loaded[0].layers.length&&(e.projects.loaded[0].layers=i.get()),"undefined"!=typeof e.projects.loaded[0].storyboards&&0===e.projects.loaded[0].storyboards.length&&(e.projects.loaded[0].storyboards=c.get())),t.debug("User interface initialized.")}function f(){t.debug("Default dataset initializing...");var n=o.getDataset();a.load(n);var r=a.getModelData();l.set(n);var s=u.set(r).distances,c=r.length/3,p=d.set(n.restraints,c),g=i.update(s,p);return e.all([g]).then(function(){t.debug("Default dataset initialized.")})}return{defaults:function(){t.debug("Defaults initializing...");var a=n.load(),s=r.load(),l=o.load(),u=i.load(),d=c.load(),m=p.load();return e.all([a,s,l,u,d,m]).then(g).then(f).then(function(){t.debug("Defaults initialized.")})}}}angular.module("TADkit").factory("Init",t),t.$inject=["$log","$q","Users","Projects","Datasets","Clusters","Layers","DataImport","Storyboards","Settings","Proximities","Restraints","EnsemblColors"]}(),function(){"use strict";function t(t,e,n,r){var o={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),a="assets/defaults/tk-defaults-projects.json";return o.loaded.length>0?r.resolve(o):n.get(a).success(function(e){o.loaded=e,t.debug("Projects ("+e.length+") loaded from "+a),r.resolve(o)}),r.promise},add:function(t){var e={metadata:{version:1,type:"project",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],description:t[2],group:t[3],state:t[4]},datasets:t[5],layers:t[6],storyboards:t[7]};return o.loaded.push(e),o.current=o.loaded.length-1,o},remove:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded.indexOf(t);return o.loaded.splice(e,1),o},set:function(t){(void 0!==t||t!==!1)&&(o.current.index=t);var e=o.loaded[o.current.index];return e},get:function(){return o},getProject:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t];return e},getState:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t].object.state;return e}}}angular.module("TADkit").factory("Projects",t),t.$inject=["$log","$q","$http","uuid4"]}(),function(){"use strict";function t(t,e,n,r){var o={};return{load:function(){var t=n.defer(),a="assets/defaults/tk-defaults-settings.json";return Object.getOwnPropertyNames(o).length>0?t.resolve(o):r.get(a).success(function(n){o=n,e.debug("Settings loaded from "+a),t.resolve(o)}),t.promise},set:function(t){var e=this,n=0;t.object.chromosomeIndex&&(n=t.object.chromosomeIndex),o.current.chrom=t.object.species,o.current.chrom=t.object.chrom[n],o.current.chromStart=t.object.chromStart[n],o.current.chromEnd=t.object.chromEnd[n],o.current.species=t.object.species,o.current.speciesUrl=t.object.speciesUrl,o.current.particleSegments=20,o.current.particlesCount=t.models[0].data.length/t.object.components,o.current.edgesCount=.5*(o.current.particlesCount*o.current.particlesCount-o.current.particlesCount),o.current.segmentsCount=o.current.particlesCount*o.current.particleSegments,o.current.segmentLength=t.object.resolution/o.current.particleSegments,o.current.position=o.current.chromStart+parseInt(.5*(o.current.chromEnd-o.current.chromStart)),o.current.particle=e.getParticle(),o.current.segment=e.getSegment(o.current.position),o.current.segmentLower=o.current.position-.5*o.current.segment,o.current.segmentUpper=o.current.position+.5*o.current.segment},setOnline:function(e){return e=e||t,o.app.online=e,o.online},add:function(t){return o},remove:function(t){return o},getState:function(t){var e=o[settingID].state;return e},get:function(){return o},getOnline:function(){var e=!1;return e=o.app?o.app.online:t},getAddress:function(){var t={};return t.species=o.current.species,t.speciesUrl=o.current.speciesUrl,t.chrom=o.current.chrom,t.chromStart=o.current.chromStart,t.chromEnd=o.current.chromEnd,t},getSegment:function(t){t=t||o.current.position;var e=this,n=e.getRange(o.current.chromStart,t),r=e.getRange(o.current.chromStart,o.current.chromEnd),a=Math.ceil(n*o.current.segmentsCount/r);return a},getParticle:function(t){t=t||o.current.position;var e=this,n=e.getRange(o.current.chromStart,t),r=e.getRange(o.current.chromStart,o.current.chromEnd),a=Math.ceil(n*o.current.particlesCount/r);return a},getRange:function(t,e){for(var n=0,r=t;e>=r;r++)n++;return n},toggle:function(t){return angular.forEach(o,function(e,n){t==e.id&&(e.state=!e.state)}),o}}}angular.module("TADkit").factory("Settings",t),t.$inject=["ONLINE","$log","$q","$http"]}(),function(){"use strict";function t(t,e,n,r,o,a,i){var s={loaded:[],current:{index:0}};return{load:function(){var t=n.defer(),o="assets/defaults/tk-defaults-storyboards.json";return s.loaded.length>0?(e.warn("Storyboards already loaded."),t.resolve(s)):r.get(o).success(function(n){s.loaded=n,e.debug("Storyboards ("+n.length+") loaded from "+o),t.resolve(s)}),t.promise},add:function(t){t=t||[""];var e={metadata:{version:1,type:"storyboard",generator:"TADkit"},object:{uuid:o.generate(),id:t[0],title:t[1],email:t[2],group:t[3],permissions:t[4]},data:t[5]};return s.loaded.push(e),s.current=s.loaded.length-1,s},addComponent:function(t,e,n){var r=this;e=e||"default",n=n||[];var s=a.get(),c=i.getComponentByType(t.object.type),l=angular.copy(c);l.object.uuid=o.generate(),l.object.id=t.object.id,l.object.title=t.object.id,l.object.dataset=t.object.id,l.view.settings.step=t.object.step,l.view.settings.color=t.object.color,l.view.viewpoint.species=s.current.species,l.view.viewpoint.chrom=s.current.chrom,l.view.viewpoint.chromStart=s.current.chromStart,l.view.viewpoint.chromEnd=s.current.chromEnd,l.view.viewpoint.scale=s.views.scale,l.view.viewtype=t.object.type+"-"+t.object.stepType,l.data=t.data,l.layer=t;var u=r.getStoryboardById(e);return u.components.push(l),l},defaultComponents:function(t){var n=this;t=t||"current";var r;for(r="current"==t?n.getStoryboard():n.getStoryboardById(t);r.components.length>6;)e.warn("Popping to default components..."),s.loaded[s.current.index].components.pop();return s},remove:function(t){(void 0===t||t===!1)&&(t=s.current.index);var e=s.loaded.indexOf(t);return s.loaded.splice(e,1),s},removeComponentById:function(t){var e=this;if(void 0!==t||t!==!1){var n=e.getStoryboard();n.components.splice(component.index,1)}return s},set:function(t){(void 0!==t||t!==!1)&&(s.current.index=t);var e=s.loaded[s.current.index];return e},setComponents:function(){var t=this,e=t.getStoryboard(),n=i.get(e.componentList);return e.components=n,n},setViewpoint:function(){var n=a.get(),r=s.loaded[s.current.index].components;return t&&e.debug(r),angular.forEach(r,function(t,e){var r=n.views.scale||1;if(t.view.viewpoint.species=n.current.species,t.view.viewpoint.chrom=n.current.chrom,t.view.viewpoint.chromStart=n.current.chromStart,t.view.viewpoint.chromEnd=n.current.chromEnd,"scene"===t.object.type||"scene-clusters"===t.object.type){var o=t.view.viewpoint.fov/2,a=.6;r=Math.tan(o).toFixed(2)*a}t.view.viewpoint.scale=r}),s},update:function(t){var e=this,n=e.getStoryboard().components;angular.forEach(n,function(e,n){("track-genes"==e.object.type||"panel-inspector"==e.object.type)&&(e.data=t.data,e.layer=t)})},get:function(){return s},getStoryboard:function(t){(void 0===t||t===!1)&&(t=s.current.index);var e=s.loaded[t];return e},getStoryboardById:function(t){var n,r;if(void 0!==t||t!==!1)for(var o=s.loaded.length-1;o>=0;o--)s.loaded[o].object.id===t&&(n=s.loaded[o],n.index=o,r=!0,e.debug('Layer "'+t+'" found!'));return r||(n=s.loaded[s.current.index],n.index=s.current.index,e.warn("Storyboard '"+t+"' not found: returning current.")),n},getComponents:function(){var t=this,e=t.getStoryboard().components;return e}}}angular.module("TADkit").factory("Storyboards",t),t.$inject=["VERBOSE","$log","$q","$http","uuid4","Settings","Components"]}(),function(){"use strict";function t(t,e,n,r){var o={loaded:[],current:{index:0}};return{load:function(){var r=e.defer(),a="assets/defaults/tk-defaults-users.json";return o.loaded.length>0?r.resolve(o):n.get(a).success(function(e){o.loaded=e,t.debug("Users ("+e.length+") loaded from "+a),r.resolve(o)}),r.promise},add:function(t){t=t||["id","Name Surname","email@company.com","Group","edit",["default"]];var e={metadata:{version:1,type:"user",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],email:t[2],group:t[3],permissions:t[4]},projects:t[5]};return o.loaded.push(e),o.current=o.loaded.length-1,o},remove:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded.indexOf(t);return o.loaded.splice(e,1),o},set:function(t){(void 0!==t||t!==!1)&&(o.current.index=t);var e=o.loaded[o.current.index];return e},get:function(){return o},getUser:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t];return e},getPermissions:function(t){(void 0===t||t===!1)&&(t=o.current.index);var e=o.loaded[t].permissions;return e}}}angular.module("TADkit").factory("Users",t),t.$inject=["$log","$q","$http","uuid4"]}(),function(){"use strict";angular.module("TADkit.datasets",[])}(),function(){"use strict";function t(t,e,n,r,o){return{"import":function(t){t=t||{};var e=this,n={};if(angular.isObject(t)||(t=angular.fromJson(t)),t.metadata&&"dataset"==t.metadata.type&&"TADbit"==t.metadata.generator)n=t,n.object=e.detail(t);else{var a=e.validate(t.data),i=e.filter(a,t.selection),s=e.detail(t);n=e.create(i,s)}return n.clusters?(console.log("Clusters found :)"),r.load(n)):(console.log("No clusters :("),o["import"](n)),n},parse:function(t){Papa.DefaultDelimiter=" ";var e=Papa.parse(t,{dynamicTyping:!0,skipEmptyLines:!0,fastMode:!0});return e.data},validate:function(t){var e,n=!0;return e=t,n?e:void 0},filter:function(t,e){var n=[];if(0===e.rows.length&&0===e.cols.length)n=t;else for(var r=e.rows.length,o=e.cols.length,a=0;r>a;a++){var i=[];if(e.rows[a]){for(var s=0;o>s;s++)e.cols[s]&&i.push(t[a][s]);n.push(i)}}return n},detail:function(t){var e={};if(t.object)e=t.object;else{var n={uuid:"00000000-0000-0000-0000-000000000000",id:"default",title:"Default",description:"Default description",source:"Default",assembly:"Default",experimentType:"Default",project:"Default",domain:"Default",organism:"Default",species:"Default",cellType:"Default",chrom:["X"],chromStart:[0],chromEnd:[1e3],resolution:1e3,datatype:"default",components:2,dependencies:{}};e=n}var r=e.species,o=r.replace(/[^a-z0-9]/gi,"_").toLowerCase();e.speciesUrl=o;for(var a=e.chrom.length-1;a>=0;a--)e.chrom[a].toLowerCase();return e.region=e.chrom+":"+e.chromStart+"-"+e.chromEnd,e},create:function(n,r){var o={metadata:{version:t,type:"dataset",generator:e},object:r,data:n};return o}}}angular.module("TADkit.datasets").factory("DataImport",t),t.$inject=["VERSION","NAME","$log","Clusters","Layers"]}(),function(){"use strict";function t(t,e,n,r,o,a){var i={loaded:[],current:{index:0}};return{load:function(t,e){t=t||"tk-example-dataset",e=e||!1;var o=this;e&&o.clear();var a="examples",s=n.defer(),c="assets/"+a+"/"+t+".json";return r.get(c).success(function(e){e.object.filename=t,o["import"](e),s.resolve(i)}),s.promise},preview:function(t,e){var n={data:{},selection:{rows:[],cols:[]},details:{}};n.data=a.parse(t);for(var r=n.data.length;--r>=0;)n.selection.rows[r]=!0;for(var o=n.data[0].length;--o>=0;)n.selection.cols[o]=!0;return n},"import":function(t){t=t||"error";var e=this,n=a["import"](t);return n=e.unique(n),e.add(n),n},unique:function(t){var n=1e3,r=!1;if(i.loaded.length>0){for(;n>1||!r;){for(var a=0,s=o.generate(),c=i.loaded.length-1;c>=0;c--)if(i.loaded[c].uuid==s){a++;var l={};t==l?e.info("Dataset already loaded."):e.warn("Not a unique ID")}0===a&&(r=!0),n--}r||0!==n||e.warn("Timeout searching for unique UUID")}return t},add:function(t){return i.loaded.push(t),i.current.index=i.loaded.length-1,e.info("Dataset "+t.object.species+" "+t.object.region+" loaded from file."),i},clear:function(){for(;i.loaded.length>0;)i.loaded.shift();return e.info("Datasets Object cleared!")},remove:function(t){(void 0===t||t===!1)&&(t=i.current.index);var n=i.loaded.indexOf(t),r=n.title;return i.loaded.splice(n,1),e.info("Dataset "+r+"at index "+t+" removed!"),i},set:function(t){(void 0!==t||t!==!1)&&(i.current.index=t);var e=i.loaded[i.current.index];return e},get:function(){return i},getDataset:function(t){(void 0===t||t===!1)&&(t=i.current.index);var e=i.loaded[t];return e},getModel:function(t){t=t||1;for(var e,n=i.loaded[i.current.index].length-1;n>=0;n--)i.loaded[i.current.index].models[n].ref==t&&(e=i.loaded[i.current.index].models[n]);return e}}}angular.module("TADkit.datasets").factory("Datasets",t),t.$inject=["VERBOSE","$log","$q","$http","uuid4","DataImport"]}(),function(){"use strict";angular.module("TADkit.layers",[])}(),function(){"use strict";function t(t,e,n,r){return{build:function(t){var e,n,o,a=["#227c4f","#e71818","#8ece0d","#6666ff","#424242"],i=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],s=[],c=0,l=1,u=0,d=1,p=t[c].length,g=t[l][d]-t[l][u]+1,f=t[l+1][d]-t[l+1][u]+1;g==f?(e="wiggle_0",n="fixed",o="fixed"):(e="bedgraph",n="variable",o="variable");var m=!1;if(7==p){for(var h=0,v=2;p>v;v++){var w=t[c][v].toLowerCase();("hp1"==w||"brm"==w||"mrg15"==w||"pc"==w||"h1"==w)&&h++}5==h&&(m=!0)}for(var b=p-1;b>=2;b--){var y;y=m?a[b-2]:i[b],s.unshift({metadata:{version:1,type:"layer",generator:"TADkit"},object:{uuid:r.generate(),id:t[c][b],title:t[c][b],source:"Research output",url:"local",description:"center_label",type:e,format:n,components:2,name:t[c][b],visibility:"full",color:y,altColor:"#cccccc",priority:"100",stepType:o,chrom:"",start:t[l][u],step:g,state:{index:0,overlaid:!1}},palette:[y,"#cccccc"],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}});for(var x=t.length-1;x>=1;x--)"variable"==n?s[0].data.unshift({start:t[x][u],end:t[x][d],read:t[x][b]}):s[0].data.unshift(t[x][b])}return s}}}angular.module("TADkit.layers").factory("LayerAnnotations",t),t.$inject=["$log","$q","$http","uuid4"]}(),function(){"use strict";function t(){return{build:function(t){}}}angular.module("TADkit.layers").factory("LayerName",t)}(),function(){"use strict";function t(t,e,n,r,o,a,i,s,c,l,u){var d={loaded:[],current:{index:0}};return{load:function(){var t=n.defer(),o="assets/defaults/tk-defaults-layers.json";return d.loaded.length>0?t.resolve(d):r.get(o).success(function(n){d.loaded=n,e.debug("Layers ("+n.length+") loaded from "+o),t.resolve(d)}),t.promise},"import":function(t){var e,n,r,a=this,i=t.data,s=["#227c4f","#e71818","#8ece0d","#6666ff","#424242"],c=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],l=[],u=0,d=1,p=0,g=1,f=i[u].length,m=i[d][g]-i[d][p]+1,h=i[d+1][g]-i[d+1][p]+1;m==h?(e="wiggle_0",n="fixed",r="fixed"):(e="bedgraph",n="variable",r="variable");var v=!1;if(7==f){for(var w=0,b=2;f>b;b++){var y=i[u][b].toLowerCase();("hp1"==y||"brm"==y||"mrg15"==y||"pc"==y||"h1"==y)&&w++}5==w&&(v=!0)}for(var x=f-1;x>=2;x--){var C;C=v?s[x-2]:c[x],l.unshift({metadata:{version:1,type:"layer",generator:"TADkit"},object:{uuid:o.generate(),id:i[u][x],title:i[u][x],source:"Research output",url:"local",description:"center_label",type:e,format:n,components:2,name:i[u][x],visibility:"full",color:C,altColor:"#cccccc",priority:"100",stepType:r,chrom:"",start:i[d][p],step:m,state:{index:0,overlaid:!1}},palette:[C,"#cccccc"],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}});for(var k=i.length-1;k>=1;k--)"variable"==n?l[0].data.unshift({start:i[k][p],end:i[k][g],read:i[k][x]}):l[0].data.unshift(i[k][x])}return console.log(l),a.add(l),l},add:function(t){var e=this,n=[],r=d.loaded.length-1;return angular.forEach(t,function(t,e){var o=!1;o||(r++,t.object.state.index=r,t.object.state.overlaid=!1,n.push(t),i.addComponent(t))}),d.loaded=d.loaded.concat(n),e.segment(),n},clear:function(){for(;d.loaded.length>0;)d.loaded.shift()},defaults:function(){for(;d.loaded.length>4;)d.loaded.pop(),i.defaultComponents()},remove:function(t){(void 0===t||t===!1)&&(t=d.current.index);var e=d.loaded.indexOf(t);return d.loaded.splice(e,1),d},set:function(t){(void 0!==t||t!==!1)&&(d.current.index=t);var e=d.loaded[d.current.index];return e},setOverlaid:function(t){return t=t||"",angular.forEach(d.loaded,function(e){e.object.state.index===t?e.object.state.overlaid=!0:e.object.state.overlaid=!1}),t},update:function(t,e){var r=this,o=[],c=[];return angular.forEach(d.loaded,function(t,e){if("ensembl"==t.object.type){var n=a.getAddress(),r=s.load(t,n);o.push(r),c.push(t)}}),n.all(o).then(function(t){for(var e=0;e<c.length;e++){var n=c[e];i.update(n)}return r.segment(),t})},segment:function(){var t=this,n=a.get();return angular.forEach(d.loaded,function(r,o){var a=!0;if(a){var i=r.object.type,s=r.object.format;if("gradient"==i&&"hex"==s)r.colors.particles=l.gradientHCL(r,n.current.particlesCount),r.colors.chromatin=l.gradientHCL(r,n.current.segmentsCount),r.colors.network.RGB=u.lineSegmentsRGB(r,n.current.edgesCount),r.colors.network.alpha=u.lineSegmentsAlpha(r,n.current.edgesCount);else if("wiggle_0"==i&&"fixed"==s)r.colors.particles=l.bicolor(r,n.current.particlesCount),r.colors.chromatin=l.bicolor(r,n.current.segmentsCount),r.colors.network.RGB=u.lineSegmentsRGB(r,n.current.edgesCount),r.colors.network.alpha=u.lineSegmentsAlpha(r,n.current.edgesCount);else if("wiggle_0"==i&&"variable"==s);else if("bedgraph"==i)r.colors.particles=l.bicolorVariable(r,n.current.chromStart,n.current.particlesCount,1),r.colors.chromatin=l.bicolorVariable(r,n.current.chromStart,n.current.segmentsCount,n.current.segmentLength),r.colors.network.RGB=u.lineSegmentsRGB(r,n.current.edgesCount),r.colors.network.alpha=u.lineSegmentsAlpha(r,n.current.edgesCount);else if("matrix"==i)r.colors.particlesMatrix=l.matrix(r,1),r.colors.chromatinMatrix=l.matrix(r,n.current.particleSegments),r.colors.networkMatrix=r.colors.particlesMatrix,t.at(1,n.current.particlesCount,n.current.particleSegments);else if("misc"==i&&"variable"==s)r.colors.particles=[],r.colors.chromatin=[],r.colors.network.RGB=u.lineSegmentsRGB(r,n.current.edgesCount),r.colors.network.alpha=u.lineSegmentsAlpha(r,n.current.edgesCount);else if("ensembl"==i&&"json"==s){var d=c.get("gene"),p=1;r.colors.particles=l.features(r,n.current.chromStart,n.current.particlesCount,p,d),r.colors.chromatin=l.features(r,n.current.chromStart,n.current.segmentsCount,n.current.segmentLength,d),r.colors.network.RGB=u.lineSegmentsRGB(r,n.current.edgesCount),r.colors.network.alpha=u.lineSegmentsAlpha(r,n.current.edgesCount)}}else e.warn("Layer '"+r.object.title+"' already segmented as color array matching current dataset length")}),d},at:function(t){var e=a.get();return angular.forEach(d.loaded,function(n,r){var o=n.object.type;if("matrix"==o){var a=(t-1)*e.current.particlesCount,i=t*e.current.particlesCount,s=a*e.current.particleSegments,c=i*e.current.particleSegments;n.colors.particles=n.colors.particlesMatrix.slice(a,i),n.colors.chromatin=n.colors.chromatinMatrix.slice(s,c),n.colors.network=n.colors.networkMatrix.slice(a,i)}}),d},get:function(){return d},getLayer:function(t){(void 0===t||t===!1)&&(t=d.current.index);var e=d.loaded[t];return e},getLayerById:function(n){var r,o;if(void 0!==n||n!==!1)for(var a=d.loaded.length-1;a>=0;a--)d.loaded[a].object.id===n&&(r=d.loaded[a],r.object.state.index=a,o=!0,e.debug('Layer "'+n+'" found!'));return o||(r=d.loaded[d.current.index],r.object.state.index=d.current.index,e.debug('Layer "'+n+'" not found: returning current.')),t&&e.debug(r),r},getCurrentIndex:function(){return d.current.index}}}angular.module("TADkit.layers").factory("Layers",t),t.$inject=["VERBOSE","$log","$q","$http","uuid4","Settings","Storyboards","FeaturesEnsembl","EnsemblColors","Segments","Networks"]}(),function(){"use strict";function t(t,e,n){return{restrict:"EA",link:function(r,o,a){t&&e.debug(r),r.component.object.idIndex=r.component.object.id+"-"+r.$index;var i="<data-tk-component-"+r.component.object.type+' id="{{component.object.idIndex}}" type="component.object.type" title="{{component.object.title}}" state="component.object.state" settings="settings" view="component.view" currentparticle="currentParticle"currentposition="currentPosition"currentmodel="current.model" currentlayer="current.layer" data="component.data" proximities="component.proximities" layer="component.layer"togglelayer="toggleLayer(index)" style="margin: {{component.object.state.margin}}; background-color: {{component.view.settings.background}}" class="component '+r.component.object.type+'" ng-cloak ></data-tk-component-'+r.component.object.type+">";o.replaceWith(n(i)(r))}}}angular.module("TADkit").directive("tkComponent",t),t.$inject=["VERBOSE","$log","$compile"]}(),function(){"use strict";function t(t,e){return{restrict:"E",templateUrl:"assets/templates/browser.html",link:function(t,e,n){console.log(t.component.view.viewpoint.chromStart);new Browser({pageName:e[0].firstChild.id,chr:"1",viewStart:t.component.view.viewpoint.chromStart,viewEnd:t.component.view.viewpoint.chromEnd,cookieKey:"human",coordSystem:{speciesName:"Human",taxon:9606,auth:"NCBI",version:"36",ucscName:"hg18"},sources:[{name:"Genome",uri:"http://www.derkholm.net:8080/das/hg18comp/",tier_type:"sequence",provides_entrypoints:!0},{name:"Genes",desc:"Gene structures from Ensembl 54",uri:"http://www.derkholm.net:8080/das/hsa_54_36p/",collapseSuperGroups:!0,provides_karyotype:!0,provides_search:!0},{name:"Repeats",uri:"http://www.derkholm.net:8080/das/hsa_54_36p/",stylesheet_uri:"http://www.derkholm.net/dalliance-test/stylesheets/ens-repeats.xml"},{name:"MeDIP raw",uri:"http://www.derkholm.net:8080/das/medipseq_reads"},{name:"MeDIP-seq",uri:"http://www.ebi.ac.uk/das-srv/genomicdas/das/batman_seq_SP/"}]})}}}angular.module("TADkit").directive("tkComponentBrowserBiodalliance",t),t.$inject=["VERBOSE","$log"]}(),function(){"use strict";function t(t,e,n){return{restrict:"E",templateUrl:"assets/templates/browser.html",link:function(t,r,o){var a="{container:'#"+t.component.object.idIndex+"'";a+=",genome:'grch38'",a+=",chr:1",a+=",start:"+t.component.view.viewpoint.chromStart,a+=",end:"+t.component.view.viewpoint.chromEnd,a+=",plugins:['fileDrop']",a+=",tracks:[",a+="Genoverse.Track.Scalebar,",a+="Genoverse.Track.extend({name:'Sequence',controller:Genoverse.Track.Controller.Sequence,model:Genoverse.Track.Model.Sequence.Ensembl,view:Genoverse.Track.View.Sequence,100000:false,resizable:'auto'}),",a+="Genoverse.Track.Gene,",a+="Genoverse.Track.extend({name:'RegulatoryFeatures',url:'http://rest.ensembl.org/overlap/region/human/__CHR__:__START__-__END__?feature=regulatory;content-type=application/json',resizable:'auto',model:Genoverse.Track.Model.extend({dataRequestLimit:5000000}),setFeatureColor:function(f){f.color='#AAA';}}),",a+="Genoverse.Track.dbSNP",a+="]}",n.load(a).then(function(t){e.debug(window.Genoverse)})}}}angular.module("TADkit").directive("tkComponentBrowserGenoverse",t),t.$inject=["VERBOSE","$log","GenoverseService"]}(),function(){"use strict";function t(t,e,n){return{restrict:"E",templateUrl:"assets/templates/browser.html",link:function(t,r,o){function a(){var t={text:"Species",items:[]};return angular.forEach(SPECIES,function(e,n){var r={text:n,items:e};t.items.push(r)}),t}var i=t.component.object.idIndex+"-holder",s=parseInt(t.component.view.settings.margin),c={top:parseInt(t.component.view.settings.padding.top),right:parseInt(t.component.view.settings.padding.right),bottom:parseInt(t.component.view.settings.padding.bottom),left:parseInt(t.component.view.settings.padding.left)},l=parseInt(t.component.view.settings.heightInner),u=(t.component.view.settings.color,r[0].parentNode),d=u.clientWidth-2*s-c.left-c.right,p=(l-c.top-c.bottom,null);n.load().then(function(){for(var n={},r=a(),o=t.component.view.viewpoint.species.toLowerCase(),s=r.items.length-1;s>=0;s--)for(var c=r.items[s].items,l=c.length-1;l>=0;l--){var u=c[l],g=u.scientificName.toLowerCase();g==o&&(n=u,e.info("Cellbase: Found species: "+g+" (id: "+u.id+")"))}n||(n=r.metazoa.items[1],e.warn("Cellbase: Species not found! Returning: "+n.scientificName));var f=new Region({chromosome:t.component.view.viewpoint.chrom,start:t.component.view.viewpoint.chromStart,end:t.component.view.viewpoint.chromEnd}),m="https://wwwdev.ebi.ac.uk/cellbase/webservices/rest";p=new GenomeViewer({cellBaseHost:m,cellBaseVersion:"v3",target:i,width:d,region:f,availableSpecies:r,species:n.id,sidePanel:!1,autoRender:!0,resizable:!0,karyotypePanelConfig:{collapsed:!1,collapsible:!0},chromosomePanelConfig:{collapsed:!1,collapsible:!0},navigationBarConfig:{componentsConfig:{}},handlers:{"region:change":function(t){console.log(t)}}}),e.debug(p),e.info("Browser directive loaded")})}}}angular.module("TADkit").directive("tkComponentBrowserJsorolla",t),t.$inject=["VERBOSE","$log","JsorollaService"]}(),function(){"use strict";function t(t,e,n){return{restrict:"E",templateUrl:"assets/templates/browser.html",link:function(t,r,o){var a=t.component.object.idIndex+"-holder",i=parseInt(t.component.view.settings.margin),s={
top:parseInt(t.component.view.settings.padding.top),right:parseInt(t.component.view.settings.padding.right),bottom:parseInt(t.component.view.settings.padding.bottom),left:parseInt(t.component.view.settings.padding.left)},c=parseInt(t.component.view.settings.heightInner),l=(t.component.view.settings.color,r[0].parentNode),u=l.clientWidth-2*i-s.left-s.right,d=(c-s.top-s.bottom,t.component.view.viewpoint.species.toLowerCase()),p=t.component.view.viewpoint.chrom,g=t.component.view.viewpoint.chromStart,f=t.component.view.viewpoint.chromEnd;n.load().then(function(){function t(t){CellBaseManager.get({host:i,category:"meta",subCategory:"species",success:function(e){var n=e.response[0].result[0];for(var r in n){for(var o=[],a=0;a<n[r].length;a++)for(var i=n[r][a],s=0;s<i.assemblies.length;s++){var c=Utils.clone(i);c.assembly=i.assemblies[s],delete c.assemblies,o.push(c)}n[r]=o}t(n)}})}function n(){var t;for(var n in o)for(var l=o[n],p=l.length-1;p>=0;p--){var g=l[p];g.scientificName.toLowerCase()==d&&(t=g,e.info("Cellbase: Found species: "+g.scientificName+" (id: "+g.id+")"))}t||(t=o.metazoa.items[1],e.warn("Cellbase: Species not found! Returning: "+t.scientificName)),r=new GenomeViewer({cellBaseHost:i,cellBaseVersion:s,target:a,width:u+18,region:c,availableSpecies:o,species:t,sidePanel:!1,autoRender:!0,resizable:!0,karyotypePanelConfig:{collapsed:!1,collapsible:!1},chromosomePanelConfig:{collapsed:!1,collapsible:!1},navigationBarConfig:{componentsConfig:{}},handlers:{"region:change":function(t){}},trackListTitle:"",drawNavigationBar:!1,drawKaryotypePanel:!1,drawChromosomePanel:!1,drawOverviewTrackListPanel:!1});var f=[],m=new GeneTrack({title:void 0,minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,minTranscriptRegionSize:2e5,height:100,renderer:new GeneRenderer({handlers:{"feature:click":function(t){}}}),dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:r.species,params:{exclude:"transcripts"},cacheConfig:{chunkSize:1e5}})});f.push(m),r.addTrack(f),r.draw(),e.debug(r),e.info("Browser directive loaded")}var r,o,i="http://bioinfodev.hpc.cam.ac.uk/cellbase",s="v3",c=new Region({chromosome:p,start:g,end:f});t(function(t){o=t,n()})})}}}angular.module("TADkit").directive("tkComponentBrowserJsorolla",t),t.$inject=["VERBOSE","$log","JsorollaService"]}(),function(){"use strict";function t(t,e){}angular.module("TADkit").controller("BrowserController",t),t.$inject=["$log","$scope"]}(),function(){"use strict";function t(t){t.species=t.current.dataset.object.species,t.region=t.current.dataset.object.region}angular.module("TADkit").controller("PanelInfoboxController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(){return{restrict:"C",templateUrl:"assets/templates/panel-infobox.html",link:function(t,e,n){}}}angular.module("TADkit").directive("tkComponentPanelInfobox",t)}(),function(){"use strict";function t(t,e){t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState},t.toggle=function(t){t=!t},t.width=parseInt(t.state.width),t.height=parseInt(t.state.height),t.atPosition=function(e){return t.$parent.settings.current.segmentUpper>=e.start&&t.$parent.settings.current.segmentLower<=e.end?!0:!1},t.formatRegionName=function(t){return"Chromosome"==t?t:"chr"+t},t.featureTitle=function(t){return t.external_name?t.external_name:t.id},t.getDetails=function(t,n){e.show(e.alert().title("Details").content(t.description).ariaLabel("Item details").ok("Close").targetEvent(n))}}angular.module("TADkit").controller("PanelInspectorController",t),t.$inject=["$scope","$mdDialog"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"="},templateUrl:"assets/templates/panel-inspector.html",link:function(n,r,o){t&&e.debug(n.data)}}}angular.module("TADkit").directive("tkComponentPanelInspector",t),t.$inject=["VERBOSE","$log"]}(),function(){"use strict";function t(t,r,o,a){return function(i,s,c){t&&r.debug(s);var l={visible:!0,genomeLength:816394,particles:0,particleSegments:5,curveSegments:1,radius:15,radiusSegments:16,endcap:!1,pathClosed:!1};c=c||{},angular.extend(this,angular.copy(l),c);for(var u=e(i),d=u.vertices.length-1;d>=0;d--){var p=new THREE.Color(s[20*d]);u.colors.unshift(p)}for(var g=a.cubic(u.vertices,this.pathClosed),f=new THREE.Geometry,m=0;m<g.vertices.length;m++){f.vertices.push(new THREE.Vector3(g.vertices[m].x,g.vertices[m].y,g.vertices[m].z||0));var h=g.colors[m];f.colors.push(h)}f.name="controlsGeom",0===this.particles&&(this.particles=u.vertices.length);var v=this.particles*this.particleSegments;this.pathSegments=v;for(var w=o.cubicBezier(g.vertices,v,this.pathClosed),b=w.createPointsGeometry(v),y=b.vertices.length-1;y>=0;y--){var x=new THREE.Color(s[y]);b.colors.unshift(x)}b.name="cubicGeom";var C=w.getLength(),k=15,E=11*this.genomeLength/1080;this.radius=C*k/E;for(var S=new THREE.Object3D,$=new THREE.Geometry,j=0;v>j;j++){this.endcap=0===j||j===v-1?!1:!0;var T=s[j],A=new THREE.MeshLambertMaterial({color:T,emissive:T,vertexColors:THREE.VertexColors,opacity:1,transparent:!1,wireframe:!1}),D=n(b.vertices[j],b.vertices[j+1],this);$.merge(D);var R=new THREE.Mesh(D,A);R.name="segment-"+(j+1),S.add(R)}return $.computeBoundingSphere(),S.boundingSphere=$.boundingSphere,S.name="Chromatin Fiber",S}}function e(t){for(var e,n=0,r=new THREE.Geometry,o=t.length;o>n;)e=new THREE.Vector3,e.x=t[n++],e.y=t[n++],e.z=t[n++],r.vertices.push(e);return r.name="Chromatin Geometry",r}function n(t,e,n){var r,o=(new THREE.Vector3).subVectors(e,t),a=new THREE.Matrix4;a.lookAt(t,e,(new THREE.Object3D).up);var i=new THREE.Matrix4;return i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),a.multiply(i),a.setPosition(t.add(e).multiplyScalar(.5)),r=new THREE.CylinderGeometry(n.radius,n.radius,o.length(),n.radiusSegments,n.curveSegments,n.endcap),r.applyMatrix(a),r}angular.module("TADkit").factory("Chromatin",t),t.$inject=["VERBOSE","$log","Paths","PathControls"]}(),function(){"use strict";function t(t,n,r){return function(o,a,i,s){t&&n.debug(i);var c={visible:!0};s=s||{},angular.extend(this,angular.copy(c),s);for(var l=new THREE.BufferGeometry,u=r.THREEColorsFromHex(i),d=new THREE.Object3D,p=0;p<o.length;p++){var g=o[p];l.addAttribute("position",new THREE.BufferAttribute(g,3));var f=e(g);f.colors=u;var m=(i[p],new THREE.LineBasicMaterial({color:new THREE.Color(this.color),opacity:this.modelOpacity,transparent:this.transparent,linewidth:this.linewidth,fog:this.fog})),h=new THREE.LineBasicMaterial({opacity:this.centroidOpacity,transparent:this.transparent,linewidth:this.linewidth,vertexColors:THREE.VertexColors,fog:this.fog});p==a&&(m=h);var v=new THREE.Line(f,m);v.name="model-"+p,d.add(v)}return l.computeBoundingBox(),d.boundingBox=l.boundingBox,d.BufferGeometry=l,d.name="Cluster Ensemble",d}}function e(t){for(var e,n=0,r=new THREE.Geometry,o=t.length;o>n;)e=new THREE.Vector3,e.x=t[n++],e.y=t[n++],e.z=t[n++],r.vertices.push(e);return r}angular.module("TADkit").factory("Cluster",t),t.$inject=["VERBOSE","$log","Color"]}(),function(){"use strict";function t(t,e,n,r,o,a){return{restrict:"EA",scope:{title:"@",view:"=",clusters:"=",layer:"=",mousemove:"&"},templateUrl:"assets/templates/scene-clusters.html",link:function(i,s,c){t&&e.debug(i),r.load(["TrackballControls","OrbitControls"]).then(function(t){var r,c,l,u,d,p,g,f,m,h,v,w,b,y,x=n.getRenderer(),C=[];i.init=function(){r=s[0].children[0].children[3].children[0],c=s.parent().parent()[0];var e=parseInt(window.getComputedStyle(c,null).getPropertyValue("padding"));l=c.clientWidth-2*e,u=c.clientHeight-2*e,x.setSize(l,u),r.appendChild(x.domElement);var n=i.view.settings.rowHeight,k=n.split(":"),E=parseInt(k[0],10)/parseInt(k[1],10);v=parseInt(i.view.settings.gutter),h=i.view.settings.cols;var S=(h-1)/h,$=1/h,j=v*S;w=l*$-j,b=w,y=b*E,d=new t.PerspectiveCamera(i.view.viewpoint.fov,E,i.view.viewpoint.near,i.view.viewpoint.far),d.position.fromArray(i.view.viewpoint.camera),d.name="Scene Camera",m=new t.TrackballControls(d,x.domElement),angular.forEach(i.clusters,function(e,n){C[n]=new t.Scene;var r,s;r=new o(e.data[e.centroidIndex],i.layer,i.view.settings.particles),r.visible=i.view.settings.particles.visible,C[n].add(r),s=new a(e.data,e.centroidIndex,i.layer,i.view.settings.cluster),s.visible=i.view.settings.cluster.visible,s.name=s.name+" "+n,C[n].add(s)}),p=i.view.viewpoint.camera,g=i.view.viewpoint.target,f=i.view.viewpoint.translate,i.lookAtTarget(p,g,f)},i.lookAtTarget=function(e,n,r){e=e||new t.Vector3(5e4,5e4,5e4);var o=new t.Vector3(0,0,0);n=n||o,r=r||500,d.position.set(e.x,e.y,e.z),d.lookAt(o),d.translateZ(r),d.lookAt(n),d.updateMatrixWorld(),m.target.copy(e),m.update()};var k,E=0;i.animate=function(){E>=0&&1>E?(k=requestAnimationFrame(i.animate),m.update(),i.render(),E++,e.debug("AnimationFrame requested")):(cancelAnimationFrame(k),e.debug("AnimationFrame canceled"))},i.render=function(){var t=1,n=1;angular.forEach(i.clusters,function(e,r){0===r&&x.clear();var o=C[r];m.update();var a=(w+v)*(t-1),i=u-w*n;x.setViewport(a,i,b,y),x.setScissor(a,i,b,y),x.setScissorTest(!0),x.setClearColor("#ffffff"),x.render(o,d,null,!0),t===h?(t=1,n++):t++}),e.debug(d)},angular.element(document).ready(function(){i.init(),i.animate()})})}}}angular.module("TADkit").directive("tkComponentSceneClusters",t),t.$inject=["VERBOSE","$log","THREEService","THREEPlugins","Particles","Cluster"]}(),function(){"use strict";function t(t,e,n){return{restrict:"EA",link:function(r,o,a){n.load(["TrackballControls","OrbitControls"]).then(function(n){var a,i,s,c,l,u,d,p,g=e.getRenderer();r.init=function(){a=o[0],i=a.clientWidth,g.setSize(i,i),a.appendChild(g.domElement),c=new n.Scene,s=new n.PerspectiveCamera(50,1,300,900),s.position.z=500,c.add(s),l=new n.TorusKnotGeometry(100,30,100,16),u=new n.MeshDepthMaterial({wireframe:!0}),d=new n.Mesh(l,u),d.name="Floating TAD",c.add(d)},t.$on("$stateChangeStart",function(){cancelAnimationFrame(p)}),r.animate=function(){p=requestAnimationFrame(r.animate),r.render()},r.render=function(){d.rotation.x+=.006,d.rotation.y+=.006,g.render(c,s,null,!0)},r.init(),r.animate()})}}}angular.module("TADkit").directive("tkComponentSceneFloatingtad",t),t.$inject=["$rootScope","THREEService","THREEPlugins"]}(),function(){"use strict";function t(t,n,r,o,a){return function(r,o,a){t&&n.debug(r),t&&n.debug(o);var i={color:"#ff0000",size:200,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0,visible:!1};a=a||{},angular.extend(this,angular.copy(i),a);var s={},c={uniforms:s,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,vertexColors:THREE.VertexColors,transparent:!0},l=new THREE.ShaderMaterial(c),u=r.length/3,d=.5*(u*u-u),p=e(r,d),g=o.RGB,f=o.alpha,m=new THREE.BufferGeometry;m.addAttribute("position",new THREE.BufferAttribute(p,3)),m.addAttribute("color",new THREE.BufferAttribute(g,3)),m.addAttribute("alpha",new THREE.BufferAttribute(f,1)),m.computeBoundingSphere();var h=null;if(this.map){var v=new THREE.TextureLoader;v.load(this.map,function(t){h=t},function(t){n.debug(t.loaded/t.total*100+"% loaded")},function(t){n.error("An error happened")})}var w=(new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:h,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),new THREE.LineSegments(m,l));return w.name="Network Graph",t&&n.debug(w),w}}function e(t,e,n){for(var r=new Float32Array(6*n),o=0,a=0;a<e.length;a+=3)for(var i=a,s=a+3;s<e.length;s+=3){var c=s;t.debug(o),t.debug(e[i]+","+e[i+1]+","+e[i+2]),t.debug(e[c]+","+e[c+1]+","+e[c+2]),r[o]=e[i],o++,r[o]=e[i+1],o++,r[o]=e[i+2],o++,r[o]=e[c],o++,r[o]=e[c+1],o++,r[o]=e[c+2],o++}return r.name="Network Vertex Pairs",r}angular.module("TADkit").factory("Network",t),t.$inject=["VERBOSE","$log","Color","Particles","Networks"]}(),function(){"use strict";function t(t){return function(n,r,o){var a={particles:0,visible:!0,color:"#fff000",size:200,opacity:.8,map:"particle",depthtest:!0,alphatest:.5,transparent:!0};o=o||{},angular.extend(this,angular.copy(a),o);var i=e(n);i.computeBoundingSphere();for(var s=[],c=0;c<i.vertices.length;c++)s[c]=new THREE.Color("rgb(255,255,255)");i.colors=s;var l=t.get(this.map),u=new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:l,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),d=new THREE.Points(i,u);return d.name="Particles Cloud",d}}function e(t){for(var e,n=0,r=new THREE.Geometry,o=t.length;o>n;)e=new THREE.Vector3,e.x=t[n++],e.y=t[n++],e.z=t[n++],r.vertices.push(e);return r.name="Particles Geometry",r}angular.module("TADkit").factory("Particles",t),t.$inject=["THREETextures"]}(),function(){"use strict";function t(t,e,n,r){n.optionsState=!1,n.toggleOptions=function(){n.optionsState=!n.optionsState},n.toggle=function(e){e=!e,t.debug(e)},n.selectCluster=function(n){r.setCluster(n+1);var o=r.getCentroidRef();t.info("Current Cluster: "+(n+1)+" (Centroid Model: "+o+")"),e.go("browser")}}angular.module("TADkit").controller("SceneController",t),t.$inject=["$log","$state","$scope","Clusters"]}(),function(){"use strict";function t(t,e,n,r,o,a,i){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",layer:"=",state:"=",currentmodel:"=",proximities:"=",currentlayer:"="},templateUrl:"assets/templates/scene.html",link:function(s,c,l){r.load(["TrackballControls","OrbitControls"]).then(function(r){var l,u,d,p,g,f,m,h,v,w,b,y,x,C,k,E,S,$,j,T,A=n.getRenderer(),D=new r.Color,R=new r.Color,I=new r.Color("rgb(0,0,0)");s.init=function(){l=c[0].children[0].children[3],u=parseInt(s.state.width),d=parseInt(s.state.height);var t=s.view.settings.background;A.setSize(u,d),l.appendChild(A.domElement),v=new r.Scene,w=new r.PerspectiveCamera(s.view.viewpoint.fov,u/d,s.view.viewpoint.near,s.view.viewpoint.far),w.position.fromArray(s.view.viewpoint.camera),w.name="Scene Camera",v.add(w),S=new r.TrackballControls(w,A.domElement),E=new r.OrbitControls(w,A.domElement),E.autoRotate=s.view.controls.autoRotate,E.autoRotateSpeed=s.view.controls.autoRotateSpeed,E.enableZoom=!1,E.enableRotate=!1,E.enablePan=!1,E.enableKeys=!1;var e=new r.AxisHelper(s.view.settings.axis.size);e.visible=s.view.settings.axis.visible,e.name="Axis",v.add(e);var n=s.view.settings.lighting.ambient;C=new r.AmbientLight(n),C.name="Scene Ambient Light",$=new o(s.currentmodel.data,s.currentlayer.colors.particles,s.view.settings.particles),$.visible=s.view.settings.particles.visible,v.add($),j=new a(s.currentmodel.data,s.currentlayer.colors.chromatin,s.view.settings.chromatin),j.visible=s.view.settings.chromatin.visible,v.add(j),s.view.settings.chromatin.radius=j.boundingSphere.radius,T=new i(s.data,s.layer.colors.network,s.view.settings.network),T.visible=s.view.settings.network.visible,v.add(T),b=j.boundingSphere.center,y=j.boundingSphere.center,x=j.boundingSphere.radius*s.view.viewpoint.scale,s.lookAtTAD(b,y,x);var p=s.view.settings.lighting.color,g=s.view.settings.lighting.intensity;k=new r.PointLight(p,g),k.name="Scene Light",w.add(k);var f=.5*x;k.position.set(f,f,-1*f);var m=100,h=(new r.PointLightHelper(k,m),x*s.view.viewpoint.fogNear),B=x*s.view.viewpoint.fogFar;s.view.viewpoint.fog&&(v.fog=new r.Fog(t,h,B)),s.$watch("view.controls.autoRotate",function(t,e){t!==e&&(E.autoRotate=s.view.controls.autoRotate)}),s.$watch("view.settings.axis.visible",function(t,n){t!==n&&(e.visible=!e.visible)}),s.$watch("view.settings.particles.visible",function(t,e){t!==e&&($.visible=!$.visible)}),s.$watch("view.settings.chromatin.visible",function(t,e){t!==e&&(j.visible=!j.visible)}),s.$watch("view.settings.network.visible",function(t,e){t!==e&&(T.visible=!T.visible)}),s.$watch("currentlayer.colors.chromatin",function(t,e){if(t!==e)for(var n=j.children.length,o=0;n>o;o++){var a=new r.Color(t[o]);j.children[o].material.color=a,j.children[o].material.emissive=a}}),s.$watch("currentlayer.colors.network",function(t,e){t!==e&&(T.geometry.addAttribute("color",new r.BufferAttribute(t.RGB,3)),T.geometry.addAttribute("alpha",new r.BufferAttribute(t.alpha,1)))}),s.$watch("settings.current.particle",function(t,e){t!==e&&(D&&($.geometry.colors[e-1]=D),D=$.geometry.colors[t-1],$.geometry.colors[t-1]=I,$.geometry.colorsNeedUpdate=!0)}),s.$watch("settings.current.segment",function(t,e){if(t!==e){var n=j.getObjectByName("segment-"+e);R&&(n.material.color=R,n.material.emissive=R);var r=j.getObjectByName("segment-"+t);R=r.material.color,r.material.color=I,r.material.emissive=I}})},s.onWindowResize=function(){s.resizeCanvas()},e.$on("$stateChangeStart",function(){t.info("$stateChangeStart")}),e.$on("$stateNotFound",function(){t.warn("$stateNotFound")}),e.$on("$stateChangeSuccess",function(){t.info("$stateChangeSuccess")}),e.$on("$stateChangeError",function(){t.warn("$stateChangeError")}),s.resizeCanvas=function(){p=.66*l.parentNode.clientWidth,g=.66*p,f=p/2,m=g/2,w.aspect=p/g,w.updateProjectionMatrix(),A.setSize(p,g)},s.lookAtTAD=function(t,e,n){t=t||new r.Vector3(5e4,5e4,5e4);var o=new r.Vector3(0,0,0);e=e||o,n=n||500,w.position.set(t.x,t.y,t.z),w.lookAt(o),w.translateZ(n),w.lookAt(e),w.updateMatrixWorld(),S.target.copy(t)},s.animate=function(){h=requestAnimationFrame(s.animate),S.update(),s.render()},s.render=function(){A.render(v,w,null,!0)},s.init(),s.animate()})}}}angular.module("TADkit").directive("tkComponentScene",t),t.$inject=["$log","$rootScope","THREEService","THREEPlugins","Particles","Chromatin","Network"]}(),function(){"use strict";function t(t,e,n,r){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",layer:"=",togglelayer:"&"},templateUrl:"assets/templates/track.html",link:function(o,a,i){t&&e.debug(o),n.load().then(function(t){o.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var e,n,i,s,c,l,u,d,p,g,f,m,h,v=o.data,w=o.view.viewpoint.chromStart,b=o.view.viewpoint.chromEnd,y=o.settings.current.particlesCount,x=parseInt(o.view.settings.margin),C={top:parseInt(o.view.settings.padding.top),right:parseInt(o.view.settings.padding.right),bottom:parseInt(o.view.settings.padding.bottom),left:parseInt(o.view.settings.padding.left)},k=parseInt(o.view.settings.heightInner),E=(o.view.settings.color,o.layer.palette[0]),S=o.layer.palette[1],$=a[0].parentNode,j=a[0].children[0].children[3],T=t.select(j).append("svg");o.$watch(function(){var t=$.clientWidth,e=$.clientHeight;return t+e},function(){o.render(v)}),o.$watch("data.dimension",function(t,e){t!==e&&(v=o.data,o.render(v))}),o.$watch("settings.current.position",function(t,e){t!==e&&o.update()}),o.getColor=function(t){for(var e=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],n="#ccc",r=e.length-1;r>=0;r--)t==e[r].code&&(n=e[r].color);return n},o.getOpacity=function(t){var e,n=t/5;return e=n*n},o.getStrokeWidth=function(t){var e=10,n=t/5;return e*=n},o.render=function(r){if(T.selectAll("*").remove(),r){var a=$.clientWidth-2*x-C.left-C.right,v=k-C.top-C.bottom,j=1*a/y,A=j;e=t.scale.linear().range([0,a]).domain([w,b]).clamp(!0),n=t.scale.linear().domain([-5,5]).range([0,v]),i=t.svg.axis().scale(n).orient("left").ticks(6).outerTickSize(1);var D=2;s=t.svg.brush().x(e).extent([0,0]).on("brush",o.brushed),c=T.attr("width",a+C.left+C.right).attr("height",v+C.top+C.bottom).append("g").attr("transform","translate("+C.left+","+C.top+")").call(s),c.append("g").attr("class","y axis").append("line").attr("y1",n(0)).attr("y2",n(0)).attr("x1",0).attr("x2",a),c.select(".background").attr("y",v/2).attr("height",v),l=c.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",a).attr("height",v).style("fill","white"),u=c.append("g").attr("class","focus"),d=u.append("g").attr("class","container").attr("clip-path","url(#clip)"),f=d.append("g").attr("class","harmonics"),m=d.append("g").attr("class","lowerbounds"),p=u.append("g").attr("class","axis y").call(i),g=c.append("g").attr("class","labels"),f.selectAll("rect").data(r.harmonics).enter().append("rect").attr("x",function(t){return t[1]*A}).attr("y",function(t){return n(t[3])}).attr("width",A).attr("height",function(t){return n(t[3])}).style("fill",E).style("stroke",E).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),m.selectAll("rect").data(r.lowerBounds).enter().append("rect").attr("x",function(t){return t[1]*A}).attr("y",function(t){return n(Math.max(0,-1*t[3]))}).attr("width",A).attr("height",function(t){return n(t[3])}).style("fill",S).style("stroke",S).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),h=c.append("rect").attr("id","highlight").attr("x",function(t){return e(o.settings.current.position)}).attr("y",0).attr("width",D).attr("height",k).attr("class","highlight-follow")}},o.update=function(t){T.select("#highlight").attr("x",function(t){return e(o.settings.current.position)})},o.brushed=function(){var n=this;o.safeApply(function(){var a=s.extent()[0];t.event.sourceEvent&&(a=parseInt(e.invert(t.mouse(n)[0])),s.extent([a,a])),h.attr("x",e(a)),o.settings.current.position=a,o.settings.current.particle=r.getParticle(),o.settings.current.segmentLower=o.settings.current.position-5*o.settings.current.segment,o.settings.current.segmentUpper=o.settings.current.position+5*o.settings.current.segment})},o.render(v)})}}}angular.module("TADkit").directive("tkComponentTrackBarchart",t),t.$inject=["VERBOSE","$log","d3Service","Settings"]}(),function(){"use strict";function t(t,e,n){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",layer:"=",togglelayer:"&"},templateUrl:"assets/templates/track.html",link:function(r,o,a){n.load().then(function(n){t&&e.debug(r);var a,i,s,c,l,u,d,p=r.data,g=r.view.settings.step,f=r.view.viewpoint.chromStart,m=r.view.viewpoint.chromEnd,h=m-f,v=parseInt(r.view.settings.margin),w={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},b=parseInt(r.view.settings.heightInner),y=.5*b,x=.5*(b-y),C=(r.view.settings.color,o[0].parentNode),k=o[0].children[0].children[3],E=n.select(k).append("svg");r.$watch(function(){var t=C.clientWidth,e=C.clientHeight;return t+e},function(){r.render(p)}),r.$watch("settings.current.position",function(t){r.update()},!0);n.behavior.zoom().on("zoom",function(){r.update()});r.render=function(t){if(E.selectAll("*").remove(),t){var e=C.clientWidth-2*v-w.left-w.right,o=b-w.top-w.bottom;a=g*e/h,d=n.scale.linear().range([0,e]).clamp(!0),d.domain([f,m]),c=n.svg.axis().scale(d).orient("top").ticks(0).outerTickSize(0);var p=2;i=E.attr("width",e+w.left+w.right).attr("height",o+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")"),s=i.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",o).style("fill","white"),l=i.append("g").attr("class","focus"),u=l.append("g").attr("class","container").attr("clip-path","url(#clip)");i.append("g").attr("class","labels"),u.selectAll("rect").data(t).enter().append("rect").attr("x",function(t,e){return Math.floor(d(t.start))}).attr("y",x).attr("width",function(t){return Math.ceil(d(t.end)-d(t.start))}).attr("height",y).attr("class",function(t){return 1==t.read?r.title:void 0}).append("svg:title").text(function(t,e){return t.start+":"+t.end+"("+t.read+")"}),i.append("rect").attr("id","highlight").attr("x",function(t){return d(r.settings.current.position-.5*g)}).attr("y",0).attr("width",p).attr("height",b).attr("class","highlight-follow")}},r.update=function(){E.select("#highlight").attr("x",function(t){return d(r.settings.current.position-.5*g)})}})}}}angular.module("TADkit").directive("tkComponentBedgraph",t),t.$inject=["VERBOSE","$log","d3Service"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",layer:"=",togglelayer:"&"},templateUrl:"assets/templates/track.html",link:function(t,n,r){e.load().then(function(e){function r(e){e["start-end"]=e.start+"-"+e.end,e.length=e.end-e.start;var n=["id","biotype","start-end","strand","length","assembly_name","description"],r=[];angular.forEach(e,function(t,e){e.toLowerCase();for(var o=n.length-1;o>=0;o--)if(n[o].toLowerCase(),e==n[o]){var a=e.replace("_name","");r.push({name:a,value:t})}}),t.safeApply(function(){t.tooltip.title=e.feature_type+": "+e.external_name,t.tooltip.content=r})}t.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var o=t.data,a=32e8;t.settings.current.position||(t.settings.current.position=a/2);var i=t.view.viewpoint.chromStart,s=t.view.viewpoint.chromEnd,c=s-i,l=1e3,u=a/c,d=.05*u;u-=2*d;var p,g,f,m,h,v,w=.5*c,b=.5*a,y=parseInt(t.view.settings.margin),x={top:parseInt(t.view.settings.padding.top),right:parseInt(t.view.settings.padding.right),bottom:parseInt(t.view.settings.padding.bottom),left:parseInt(t.view.settings.padding.left)},C=parseInt(t.view.settings.heightInner),k=10,E=n[0].parentNode,S=n[0].getBoundingClientRect(),$=n[0].children[0].children[3],j=e.select($).append("svg");t.$watch(function(){var t=E.clientWidth,e=E.clientHeight;return t+e},function(){t.render(o),S=n[0].getBoundingClientRect()}),t.$watch("data",function(e,n){e!==n&&t.render(e)}),t.$watch("settings.current.position",function(e,n){e!==n&&t.update()});var T=160,A=10,D="#fff",R="#333",I=2,B="rgb(76,175,80)";t.tooltip={title:"Gene",content:{},styling:{width:T,padding:A,background:D,color:R,borderWidth:I,borderColor:B}};var P=e.select($).select("ui-tooltip");P.style("width",T+"px"),P.style("padding",A+"px");e.behavior.zoom().on("zoom",function(){t.update()});t.render=function(n){if(j.selectAll("*").remove(),n){var o=E.clientWidth-2*y-x.left-x.right,a=C-x.top-x.bottom;v=e.scale.linear().range([0,o]).clamp(!0),v.domain([i,s]),f=e.svg.axis().scale(v).orient("top").ticks(0).outerTickSize(0);var c=2;v(b)-v(w);p=j.attr("width",o+x.left+x.right).attr("height",a+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")"),g=p.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",o).attr("height",a).style("fill","white"),m=p.append("g").attr("class","focus"),h=m.append("g").attr("class","container").attr("clip-path","url(#clip)");var u=(m.append("g").attr("class","x axis").attr("transform","translate(0,"+k+")").call(f),p.append("g").attr("class","labels"));u.append("text").attr("x",-18).attr("y",8).style("text-anchor","right").style("font-size","10px").text("<<"),u.append("text").attr("x",-18).attr("y",18).style("text-anchor","right").style("font-size","10px").text(">>");h.selectAll("rect").data(n).enter().append("rect").attr("x",function(t){return Math.floor(v(t.start))}).attr("y",function(e){return t.view.settings.sense&&e.strand<1?k:0}).attr("width",function(t){return Math.ceil(v(t.end)-v(t.start))}).attr("height",function(e){return t.view.settings.sense?k:2*k}).attr("class",function(t){var e=t.biotypeStyle;return e+=t.strand<1?" forward-strand":" reverse-strand"}).on("mouseover",function(t){r(t),P.transition().duration(200).style("opacity",.8),P.style("left",e.event.pageX-.5*T+"px")}).on("mouseout",function(t){P.transition().duration(200).style("opacity",0)}),p.append("rect").attr("id","highlight").attr("x",function(e){return v(t.settings.current.position-.5*l)}).attr("y",0).attr("width",c).attr("height",C).attr("class","highlight-follow")}},t.update=function(){j.select("g.x.axis").call(f),h.selectAll("rect").attr("x",function(t){return Math.floor(v(t.start))}).attr("y",function(e){return t.view.settings.sense&&e.strand<1?k:0}).attr("width",function(t){return Math.ceil(v(t.end)-v(t.start))}).attr("height",function(e){return t.view.settings.sense?k:2*k}),j.select("#highlight").attr("x",function(e){return v(t.settings.current.position-.5*l)})}})}}}angular.module("TADkit").directive("tkComponentTrackGenes",t),t.$inject=["$log","d3Service"]}(),function(){"use strict";function t(t,e,n,r){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",layer:"=",togglelayer:"&"},templateUrl:"assets/templates/track.html",link:function(o,a,i){t&&e.debug(o),n.load().then(function(t){o.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var e,n,i,s,c,l,u,d,p,g,f=o.data.distances,m=o.view.viewpoint.chromStart,h=o.view.viewpoint.chromEnd,v=o.settings.current.particlesCount,w="clip"+o.title,b="url(#"+w+")",y=parseInt(o.view.settings.margin),x={top:parseInt(o.view.settings.padding.top),right:parseInt(o.view.settings.padding.right),bottom:parseInt(o.view.settings.padding.bottom),left:parseInt(o.view.settings.padding.left)},C=parseInt(o.view.settings.heightInner),k=.5*C,E=.5*(C-k),S=o.view.settings.color,$=a[0].parentNode,j=a[0].children[0].children[3],T=t.select(j).append("svg");o.$watch(function(){var t=$.clientWidth,e=$.clientHeight;return t+e},function(){o.render(f)}),o.$watch("data.dimension",function(t,e){t!==e&&(f=o.data.distances,o.render(f))}),o.$watch("settings.current.position",function(t,e){t!==e&&o.update()}),o.render=function(r){if(T.selectAll("*").remove(),r){var a=$.clientWidth-2*y-x.left-x.right,f=C-x.top-x.bottom,j=1*a/v;e=t.scale.linear().range([0,a]).clamp(!0),e.domain([m,h]),n=t.svg.axis().scale(e).orient("top").ticks(0).outerTickSize(0);var A=2;i=t.svg.brush().x(e).extent([0,0]).on("brush",o.brushed),s=T.attr("width",a+x.left+x.right).attr("height",f+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(i),s.select(".background").attr("y",f/2).attr("height",f),c=s.append("defs").append("clipPath").attr("id",w).append("rect").attr("width",a).attr("height",f).style("fill","white"),l=s.append("g").attr("class","focus"),u=l.append("g").attr("class","container").attr("clip-path",b),d=s.append("g").attr("class","labels"),p=u.selectAll("rect").data(r).enter().append("rect").attr("x",function(t,e){return e*j}).attr("y",E).attr("width",j).attr("height",k).style("fill",S).style("fill-opacity",function(t){return t*t}).style("stroke",S).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),g=s.append("rect").attr("id","highlight").attr("x",function(t){return e(o.settings.current.position)}).attr("y",0).attr("width",A).attr("height",C).attr("class","highlight-follow"),g.call(i.extent([o.settings.current.position,0])).call(i.event)}},o.update=function(){T.select("#highlight").attr("x",function(t){return e(o.settings.current.position)})},o.brushed=function(){var n=this;o.safeApply(function(){var a=i.extent()[0];t.event.sourceEvent&&(a=parseInt(e.invert(t.mouse(n)[0])),i.extent([a,a])),g.attr("x",e(a)),o.settings.current.position=a,o.settings.current.particle=r.getParticle(),o.settings.current.segmentLower=o.settings.current.position-5*o.settings.current.segment,o.settings.current.segmentUpper=o.settings.current.position+5*o.settings.current.segment})},o.render(f)})}}}angular.module("TADkit").directive("tkComponentTrackProximities",t),t.$inject=["VERBOSE","$log","d3Service","Settings"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",layer:"=",togglelayer:"&"},templateUrl:"assets/templates/track.html",link:function(n,r,o){t.load().then(function(t){n.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var o,a,i,s,c,l,u,d,p,g,f,m=n.data,h=n.view.viewpoint.chromStart,v=n.view.viewpoint.chromEnd,w=n.settings.current.particlesCount,b="clip"+n.title,y="url(#"+b+")",x=parseInt(n.view.settings.margin),C={top:parseInt(n.view.settings.padding.top),right:parseInt(n.view.settings.padding.right),bottom:parseInt(n.view.settings.padding.bottom),left:parseInt(n.view.settings.padding.left)
},k=2,E=parseInt(n.view.settings.heightInner),S=n.view.settings.nodeSize,$=C.top+.5*S,j=(n.view.settings.color,n.layer.palette[0]),T=n.layer.palette[1],A=r[0].parentNode,D=r[0].children[0].children[3],R=t.select(D).append("svg");n.$watch(function(){var t=A.clientWidth,e=A.clientHeight;return t+e},function(){n.render(n.data)}),n.$watch("data.dimension",function(t,e){t!==e&&(m=n.data,n.render(m))}),n.$watch("settings.current.position",function(t,e){t!==e&&n.update()}),n.getColor=function(t){for(var e=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],n="#ccc",r=e.length-1;r>=0;r--)t==e[r].code&&(n=e[r].color);return n},n.getOpacity=function(t){var e,n=t/k;return e=n*n},n.getStrokeWidth=function(t){var e=5,n=t/5;return e*=n},n.render=function(e){if(R.selectAll("*").remove(),e){var r=A.clientWidth-2*x-C.left-C.right,m=E-C.top-C.bottom,k=1*r/w;o=t.scale.linear().range([0,r]).clamp(!0),o.domain([h,v]),a=t.svg.axis().scale(o).orient("top").ticks(0).outerTickSize(0),i=t.svg.axis().scale(o).orient("bottom").ticks(0).outerTickSize(0);var D=2;s=t.svg.brush().x(o).extent([0,0]).on("brush",n.brushed),c=R.attr("width",r+C.left+C.right).attr("height",m+C.top+C.bottom).append("g").attr("transform","translate("+C.left+","+C.top+")").call(s),c.select(".background").attr("y",m/2).attr("height",m),l=c.append("defs"),l.append("clipPath").attr("id",b).append("rect").attr("width",r).attr("height",m).style("fill","white"),u=c.append("g").attr("class","focus"),p=u.append("g").attr("class","harmonics").attr("clip-path",y),g=u.append("g").attr("class","lowerbounds").attr("clip-path",y),d=c.append("g").attr("class","labels"),p.append("rect").attr("x",e.dimension*k-k).attr("y",$-.5*S).attr("width",k).attr("height",S).style("fill",j).append("svg:title").text(e.dimension),p.selectAll("line").data(e.harmonics).enter().append("line").attr("x1",function(t){return t[0]*k-.5*k}).attr("y1",$).attr("x2",function(t){return t[1]*k-.5*k}).attr("y2",m-S).attr("marker-end","url(#harmonics-marker)").style("stroke",j).style("opacity",1).style("stroke-width",function(t){return n.getStrokeWidth(t[3])}).append("svg:title").text(function(t){return t[1]+":"+t[3]}),p.selectAll("circle").data(e.harmonics).enter().append("circle").attr("cx",function(t){return t[1]*k-.5*k}).attr("cy",m-S).attr("r",.5*S).style("opacity",function(t){return n.getOpacity(t[3])}).style("fill",j).append("svg:title").text(function(t){return t[0]+" : "+t[1]}),g.append("rect").attr("x",e.dimension*k-k).attr("y",m-1.5*S).attr("width",k).attr("height",S).style("fill",T).append("svg:title").text(e.dimension),g.selectAll("line").data(e.lowerBounds).enter().append("line").attr("x1",function(t){return t[0]*k-.5*k}).attr("y2",$).attr("x2",function(t){return t[1]*k-.5*k}).attr("y1",m-S).attr("marker-end","url(#lowerbounds-marker)").style("stroke",T).style("opacity",function(t){return n.getOpacity(t[3])}).style("stroke-width",function(t){return n.getStrokeWidth(t[3])}).append("svg:title").text(function(t){return t[1]+":"+t[3]}),g.selectAll("circle").data(e.lowerBounds).enter().append("circle").attr("cx",function(t){return t[1]*k-.5*k}).attr("cy",$).attr("r",.5*S).style("opacity",function(t){return n.getOpacity(t[3])}).style("fill",T).append("svg:title").text(function(t){return t[0]+" : "+t[1]}),f=c.append("rect").attr("id","highlight").attr("x",o(n.settings.current.position)).attr("y",0).attr("width",D).attr("height",E).attr("class","highlight-follow")}},n.update=function(t){R.select("#highlight").attr("x",function(t){return o(n.settings.current.position)})},n.brushed=function(){var r=this;n.safeApply(function(){var a=s.extent()[0];t.event.sourceEvent&&(a=parseInt(o.invert(t.mouse(r)[0])),s.extent([a,a])),f.attr("x",o(a)),n.settings.current.position=a,n.settings.current.particle=e.getParticle(),n.settings.current.segmentLower=n.settings.current.position-5*n.settings.current.segment,n.settings.current.segmentUpper=n.settings.current.position+5*n.settings.current.segment})},n.render(m)})}}}angular.module("TADkit").directive("tkComponentTrackRestraints",t),t.$inject=["d3Service","Settings"]}(),function(){"use strict";function t(t,e,n,r){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",layer:"=",togglelayer:"&"},templateUrl:"assets/templates/track.html",link:function(o,a,i){t&&e.debug(o),n.load().then(function(t){o.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var n=(o.data,o.view.viewpoint.chromStart),i=o.view.viewpoint.chromEnd,s=(o.view.settings.cursorWidth,parseInt(o.view.settings.margin)),c={top:parseInt(o.view.settings.padding.top),right:parseInt(o.view.settings.padding.right),bottom:parseInt(o.view.settings.padding.bottom),left:parseInt(o.view.settings.padding.left)},l=parseInt(o.view.settings.heightInner),u=a[0].parentNode;e.debug(u.clientWidth);var d=a[0].children[0].children[3];e.debug(d.clientWidth);var p,g,f,m,h,v,w,b,y,x,C=t.select(d).append("svg");o.$watch(function(){var t=u.clientWidth,e=u.clientHeight;return t+e},function(){o.render()}),o.$watch("settings.current.position",function(t,e){t!==e&&o.update()}),o.render=function(){C.selectAll("*").remove();var e=u.clientWidth-2*s-c.left-c.right,r=l-c.bottom-c.top;g=t.scale.linear().range([0,e]).clamp(!0),g.domain([n,i]),w=t.svg.axis().scale(g).orient("bottom").ticks(4),f=t.svg.axis().orient("left"),m=t.svg.axis().orient("right"),h=.5*r,v=l,b=t.svg.brush().x(g).extent([0,0]).on("brush",o.brushed),p=C.attr("width",e+c.left+c.right).attr("height",r+c.top+c.bottom).append("g").attr("transform","translate("+c.left+", 0)");var a=p.append("g").attr("class","labels");a.append("text").attr("x",-16).attr("y",26).style("text-anchor","right").style("font-size","10px").text("3'"),a.append("text").attr("x",e+8).attr("y",26).style("text-anchor","left").style("font-size","10px").text("5'");p.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(w).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");p.append("g").attr("class","slider").call(b),p.select(".background").attr("y",r/2).attr("height",r),y=p.append("circle").attr("id","handle").attr("class","handle").attr("cx",g(o.settings.current.position)).attr("cy",r).attr("r",.6*h),x=p.append("text").attr("id","position").attr("x",g(o.settings.current.position)-.5*h).attr("y",r-10).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text(o.settings.current.particle),p.call(b.extent([o.settings.current.position,0])).call(b.event)},o.update=function(t){C.select("#handle").attr("cx",g(o.settings.current.position)),C.select("#position").attr("x",g(o.settings.current.position)-.5*h).text(o.settings.current.particle)},o.brushed=function(){var e=this;o.safeApply(function(){var n=b.extent()[0];t.event.sourceEvent&&(n=parseInt(g.invert(t.mouse(e)[0])),b.extent([n,n])),y.attr("cx",g(n)),o.settings.current.position=n,o.settings.current.particle=r.getParticle(),o.settings.current.segment=r.getSegment(),o.settings.current.segmentLower=o.settings.current.position-5*o.settings.current.segment,o.settings.current.segmentUpper=o.settings.current.position+5*o.settings.current.segment})}})}}}angular.module("TADkit").directive("tkComponentTrackSlider",t),t.$inject=["VERBOSE","$log","d3Service","Settings"]}(),function(){"use strict";function t(t,e,n){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",layer:"=",togglelayer:"&"},templateUrl:"assets/templates/track.html",link:function(r,o,a){n.load().then(function(n){t&&e.debug(r);var a,i,s,c,l,u,d,p=r.data,g=r.view.settings.step,f=r.view.viewpoint.chromStart,m=r.view.viewpoint.chromEnd,h=m-f,v=parseInt(r.view.settings.margin),w={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},b=parseInt(r.view.settings.heightInner),y=.5*b,x=.5*(b-y),C=r.view.settings.color,k=o[0].parentNode,E=o[0].children[0].children[3],S=n.select(E).append("svg");r.$watch(function(){var t=k.clientWidth,e=k.clientHeight;return t+e},function(){r.render(p)}),r.$watch("settings.current.position",function(t){r.update()},!0);n.behavior.zoom().on("zoom",function(){r.update()});r.render=function(t){if(S.selectAll("*").remove(),t){var e=k.clientWidth-2*v-w.left-w.right,o=b-w.top-w.bottom;a=g*e/h,d=n.scale.linear().range([0,e]).clamp(!0),d.domain([f,m]),c=n.svg.axis().scale(d).orient("top").ticks(0).outerTickSize(0);var p=2;i=S.attr("width",e+w.left+w.right).attr("height",o+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")"),s=i.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",o).style("fill","white"),l=i.append("g").attr("class","focus"),u=l.append("g").attr("class","container").attr("clip-path","url(#clip)");i.append("g").attr("class","labels"),u.selectAll("rect").data(t).enter().append("rect").attr("x",function(t,e){return(e+1)*a}).attr("y",x).attr("width",a).attr("height",y).style("fill",C).style("fill-opacity",function(t){return t}).style("stroke",C).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),i.append("rect").attr("id","highlight").attr("x",function(t){return d(r.settings.current.position-.5*g)}).attr("y",0).attr("width",p).attr("height",b).attr("class","highlight-follow")}},r.update=function(){S.select("#highlight").attr("x",function(t){return d(r.settings.current.position-.5*g)})}})}}}angular.module("TADkit").directive("tkComponentWiggle0",t),t.$inject=["VERBOSE","$log","d3Service"]}(),function(){"use strict";function t(t,e){e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState}}angular.module("TADkit").controller("TrackController",t),t.$inject=["$log","$scope"]}(),function(){"use strict";function t(e,n,r,o,a,i,s,c){r.fileTitle="No file loaded",r.$on("$viewContentLoaded",function(){function a(t,n,r){e.debug(t),e.debug("Showing dialog")}var i=angular.element(document.body),s="assets/templates/"+n.current.name+".html";o.show({parent:i,templateUrl:s,controller:t,locals:{layers:r.$parent.layers},onComplete:a}).then(function(t){e.info('Dataset "'+t+'" added.')},function(){e.log("Layers import cancelled. No tracks added."),n.go("browser")})}),r.previewData=function(t){e.info("Previewing..."),r.preview=s.preview(t),e.info("Data fetched - pending selection...")},r.importData=function(){e.info("Import selected data...");var t=s["import"](r.preview);e.info("Import complete."),o.hide(t.object.title),n.go("browser")},r.cancel=function(){o.cancel()}}angular.module("TADkit").controller("DataImportController",t),t.$inject=["$log","$state","$scope","$mdDialog","$mdToast","DataImport","Datasets","Layers"]}(),function(){"use strict";function t(t,e){return{restrict:"A",scope:{tkDataImport:"&",filetitle:"="},link:function(e,n,r){n.on("change",function(n){var r=new FileReader;r.onload=function(n){e.$apply(function(){t.debug("Fetching Import results...."),e.tkDataImport({$fileContent:n.target.result})})},r.readAsText((n.srcElement||n.target).files[0]),e.filetitle=(n.srcElement||n.target).files[0].name})}}}angular.module("TADkit").directive("tkDataImport",t),t.$inject=["$log","$parse"]}(),function(){"use strict";function t(t,e,n){e.toggleSetting=function(t){e.settings=n.toggle(t)}}angular.module("TADkit").controller("SidebarBrowserController",t),t.$inject=["$log","$scope","Settings"]}(),function(){"use strict";function t(t,e,n,r,o,a,i,s,c){angular.element(e).on("resize",function(){n.$apply()}),n.settings.views.scale=1,o.setViewpoint(),n.allProximities=s.get(),n.currentProximities=s.get(n.settings.current.particle),n.currentRestraints=c.get(n.settings.current.particle),n.components=o.getComponents(),angular.forEach(n.components,function(t,e){var r;"scene"==t.object.type?(t.data=n.current.model.data,t.proximities=n.allProximities,t.layer=n.current.layer,t.layer.state={},t.layer.object.state.index=i.getCurrentIndex()):"track-genes"==t.object.type||"panel-inspector"==t.object.type?(r=i.getLayerById("genes"),t.data=r.data,t.layer=r):"track-proximities"==t.object.type?(t.data=n.currentProximities,r=i.getLayerById("proximities"),t.layer=r):"track-restraints"==t.object.type&&(t.data=n.currentRestraints,r=i.getLayerById("restraints"),t.layer=r)}),n.$watch("settings.current.particle",function(e,r){e!==r&&(n.currentProximities=s.get(e),n.currentRestraints=c.get(e),"matrix"==n.current.layer.object.type&&(i.at(e),n.current.layer=i.getLayer()),t.debug(n.currentProximities))}),n.layerOrig=n.current.layer,n.toggleLayer=function(e){n.overlaid=i.getLayer(e).object.state.overlaid,n.overlaid?(i.setOverlaid(n.layerOrig.object.state.index),i.set(n.layerOrig.object.state.index),n.current.layer=i.getLayer()):(i.setOverlaid(e),i.set(e),n.current.layer=i.getLayer(),t.debug(n.current.layer))},n.optionsState=!1,n.toggleOptions=function(){n.optionsState=!n.optionsState},n.toggle=function(e){e=!e,t.debug(e)},n.testfn=function(){t.debug("test worked")}}angular.module("TADkit").controller("StoryboardController",t),t.$inject=["$log","$window","$scope","Settings","Storyboards","Components","Layers","Proximities","Restraints"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("HomeController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,n,r,o,a,i){t.debug(n),n.clusterComponent=a.getComponentById("dataset-clusters");var s=o.getLayerById("gradient"),c=n.current.model.data.length/n.current.dataset.object.components,l=i.gradientHCL(s,c);n.clusterComponent.layer=l;for(var u=new THREE.BufferGeometry,d=n.current.dataset.models.length-1;d>=0;d--)u.addAttribute("position",new THREE.BufferAttribute(n.current.dataset.models[d].data,3));u.computeBoundingSphere(),t.debug(u.boundingSphere.center),t.debug(u.boundingSphere.radius),n.clusterComponent.view.viewpoint.camera=u.boundingSphere.center,n.clusterComponent.view.viewpoint.target=u.boundingSphere.center,n.clusterComponent.view.viewpoint.translate=u.boundingSphere.radius*u.boundingSphere.scale,n.clusters=r.get(),t.debug(n.clusters)}angular.module("TADkit").controller("ProjectDatasetController",t),t.$inject=["$log","$state","$scope","Clusters","Layers","Components","Segments"]}(),function(){"use strict";function t(t,e,n,r,o,a,i,s,c){o.updateCurrent=function(){o.current.dataset=a.getDataset(),o.current.model=i.getModel(),o.current.layer=s.getLayer(),t.info("Current dataset, model, layer and storyboard updated.")},o.loadDatasetFromParam=function(){var i=a.load(r.loadDataset);return e.all([i]).then(function(e){o.updateCurrent(),t.info("Dataset loaded: "+r.loadDataset),n.go("browser")})},r.loadDataset&&o.loadDatasetFromParam(),o.addDataset=function(r){var i=a["import"](r);return e.all([i]).then(function(e){o.updateCurrent(),t.info("Dataset added."),n.go("dataset")})}}angular.module("TADkit").controller("ProjectLoaderController",t),t.$inject=["$log","$q","$state","$stateParams","$scope","Datasets","Clusters","Layers","Storyboards"]}(),function(){"use strict";function t(t,e,n,r){t.setCurrentDataset=function(t){e.set(t)},t.setCurrentLayer=function(t){n.set(t)},t.setCurrentStoryboard=function(t){r.set(t)}}angular.module("TADkit").controller("ProjectController",t),t.$inject=["$scope","Datasets","Layers","Storyboards"]}(),function(){"use strict";function t(t,e,n,r,o,a,i,s,c,l){n.settings||(n.settings=r.get()),n.settings.app.isProject=t.is("project"),n.$on("$stateChangeSuccess",function(){n.settings.app.isProject=t.is("project")}),n.current={},n.current.dataset=i.getDataset(),n.current.model=s.getModel(),n.current.layer=c.getLayer()}angular.module("TADkit").controller("MainController",t),t.$inject=["$state","$stateParams","$scope","Settings","Users","Projects","Datasets","Clusters","Layers","Storyboards"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("SidebarUserController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,n){e.$state=t,e.toggleLeft=function(){n("left").toggle()},e.toggleRight=function(){n("right").toggle()}}angular.module("TADkit").controller("TopbarController",t),t.$inject=["$state","$scope","$mdSidenav"]}();
>>>>>>> upstream/develop
