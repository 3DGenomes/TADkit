!function(){"use strict";angular.module("TADkit",["ui.router","ngMaterial","uuid4","d3js","threejs","shared"])}(),function(){"use strict";function t(t,e){e.theme("default").primaryPalette("green").accentPalette("lime",{"default":"500"}).warnPalette("red").backgroundPalette("grey"),e.theme("darkKit").dark()}angular.module("TADkit").config(t),t.$inject=["$locationProvider","$mdThemingProvider"]}(),function(){"use strict";function t(t){t.$on("$stateChangeError",function(t,e,r,n,o,a){console.log("Resolve Error: ",a)})}angular.module("TADkit").run(t),t.$inject=["$rootScope"]}(),function(){"use strict";function t(t,e){e.otherwise("/project/loader/"),t.state("main",{controller:"MainController","abstract":!0,url:"",templateUrl:"assets/templates/main.html",resolve:{initialData:["initMain",function(t){return t()}]}}).state("project",{parent:"main",url:"/project",data:{cssClassnames:"main"},views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"sidebar-left@main":{templateUrl:"assets/templates/sidebar.project.html",controller:"SidebarProjectController"},"content@main":{templateUrl:"assets/templates/project-content.html",controller:"ProjectContentController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("loader",{parent:"project",url:"/loader/:loadDataset",data:{cssClassnames:"loader"},views:{"topbar@main":{templateUrl:"assets/templates/topbar.html",controller:"TopbarController"},"content@main":{templateUrl:"assets/templates/project-loader.html",controller:"ProjectLoaderController"},"sidebar-right@main":{templateUrl:"assets/templates/sidebar.user.html",controller:"SidebarUserController"}}}).state("dataset",{parent:"project",url:"/dataset",data:{cssClassnames:"dataset"},views:{"content@main":{templateUrl:"assets/templates/project-dataset.html",controller:"ProjectDatasetController"}}}).state("overlay",{parent:"project",url:"/overlay",data:{cssClassnames:"overlay"},views:{"content@main":{templateUrl:"assets/templates/project-overlay.html",controller:"ProjectOverlayController"}}}).state("storyboard",{parent:"project",url:"/storyboard",data:{cssClassnames:"storyboard"},views:{"content@main":{templateUrl:"assets/templates/project-storyboard.html",controller:"ProjectStoryboardController"}}}).state("browser",{parent:"project",url:"/browser",views:{"sidebar-left@main":{templateUrl:"assets/templates/sidebar.browser.html",controller:"SidebarBrowserController"},"content@main":{templateUrl:"assets/templates/storyboard.html",controller:"StoryboardController"}}}).state("overlay-import",{parent:"browser",url:"/overlay/import",views:{"modal@main":{templateUrl:"assets/templates/overlay-import.html",controller:"OverlayImportController"}}}).state("404",{url:"/404",templateUrl:"assets/templates/404.tpl.html",controller:"AppController"})}angular.module("TADkit").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t){return{restrict:"EA",link:function(e,r,n){var o="<data-tk-component-"+e.component.object.type+' id="{{component.object.id}}-'+e.$index+'" type="component.object.type" title="{{component.object.title}}" state="component.object.state" settings="settings" view="component.view" currentparticle="currentParticle"currentposition="currentPosition"currentmodel="current.model" currentoverlay="current.overlay" data="component.data" proximities="component.proximities" overlay="component.overlay"toggleoverlay="toggleOverlay(index)" style="margin: {{component.object.state.margin}}; background-color: {{component.view.settings.background}}" class="component '+e.component.object.type+'"></data-tk-component-'+e.component.object.type+">";r.replaceWith(t(o)(e))}}}angular.module("TADkit").directive("tkComponent",t),t.$inject=["$compile"]}(),function(){"use strict";function t(t){t.species=t.current.dataset.object.species,t.region=t.current.dataset.object.region}angular.module("TADkit").controller("PanelInfoboxController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(){return{restrict:"C",templateUrl:"assets/templates/panel-infobox.html",link:function(t,e,r){}}}angular.module("TADkit").directive("tkComponentPanelInfobox",t)}(),function(){"use strict";function t(t,e){t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState},t.toggle=function(t){t=!t},t.width=parseInt(t.state.width),t.height=parseInt(t.state.height),t.atPosition=function(e){return t.$parent.settings.current.segmentUpper>=e.start&&t.$parent.settings.current.segmentLower<=e.end?!0:!1},t.formatRegionName=function(t){return"Chromosome"==t?t:"chr"+t},t.featureTitle=function(t){return t.external_name?t.external_name:t.id},t.getDetails=function(t,r){e.show(e.alert().title("Details").content(t.description).ariaLabel("Item details").ok("Close").targetEvent(r))}}angular.module("TADkit").controller("PanelInspectorController",t),t.$inject=["$scope","$mdDialog"]}(),function(){"use strict";function t(){return{restrict:"EA",scope:{id:"@",state:"=",view:"=",data:"=",settings:"="},templateUrl:"assets/templates/panel-inspector.html",link:function(t,e,r){}}}angular.module("TADkit").directive("tkComponentPanelInspector",t)}(),function(){"use strict";function t(t,n){return function(o,a,i){var s={visible:!0,genomeLength:816394,particles:0,particleSegments:5,curveSegments:1,radius:15,radiusSegments:16,endcap:!1,pathClosed:!1};i=i||{},angular.extend(this,angular.copy(s),i);for(var c=e(o),l=c.vertices.length-1;l>=0;l--){var u=new THREE.Color(a[20*l]);c.colors.unshift(u)}for(var d=n.cubic(c.vertices,this.pathClosed),p=new THREE.Geometry,g=0;g<d.vertices.length;g++){p.vertices.push(new THREE.Vector3(d.vertices[g].x,d.vertices[g].y,d.vertices[g].z||0));var f=d.colors[g];p.colors.push(f)}p.name="controlsGeom",0===this.particles&&(this.particles=c.vertices.length);var v=this.particles*this.particleSegments;this.pathSegments=v;for(var h=t.cubicBezier(d.vertices,v,this.pathClosed),m=h.createPointsGeometry(v),w=m.vertices.length-1;w>=0;w--){var y=new THREE.Color(a[w]);m.colors.unshift(y)}m.name="cubicGeom";var b=h.getLength(),x=15,C=11*this.genomeLength/1080;this.radius=b*x/C;for(var E=new THREE.Object3D,j=new THREE.Geometry,k=0;v>k;k++){this.endcap=0===k||k===v-1?!1:!0;var S=a[k],T=new THREE.MeshLambertMaterial({color:S,emissive:S,vertexColors:THREE.VertexColors,opacity:1,transparent:!1,wireframe:!1}),$=r(m.vertices[k],m.vertices[k+1],this);j.merge($);var A=new THREE.Mesh($,T);A.name="segment-"+(k+1),E.add(A)}return j.computeBoundingSphere(),E.boundingSphere=j.boundingSphere,E.name="Chromatin Fiber",E}}function e(t){for(var e,r=0,n=new THREE.Geometry,o=t.length;o>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n.name="Chromatin Geometry",n}function r(t,e,r){var n,o=(new THREE.Vector3).subVectors(e,t),a=new THREE.Matrix4;a.lookAt(t,e,(new THREE.Object3D).up);var i=new THREE.Matrix4;return i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),a.multiply(i),a.setPosition(t.add(e).multiplyScalar(.5)),n=new THREE.CylinderGeometry(r.radius,r.radius,o.length(),r.radiusSegments,r.curveSegments,r.endcap),n.applyMatrix(a),n}angular.module("TADkit").factory("Chromatin",t),t.$inject=["Paths","PathControls"]}(),function(){"use strict";function t(t){return function(r,n,o,a){var i={visible:!0};a=a||{},angular.extend(this,angular.copy(i),a);for(var s=new THREE.BufferGeometry,c=t.THREEColorsFromHex(o),l=new THREE.Object3D,u=0;u<r.length;u++){var d=r[u];s.addAttribute("position",new THREE.BufferAttribute(d,3));var p=e(d);p.colors=c;var g=(o[u],new THREE.LineBasicMaterial({color:new THREE.Color(this.color),opacity:this.modelOpacity,transparent:this.transparent,linewidth:this.linewidth,fog:this.fog})),f=new THREE.LineBasicMaterial({opacity:this.centroidOpacity,transparent:this.transparent,linewidth:this.linewidth,vertexColors:THREE.VertexColors,fog:this.fog});u==n&&(g=f);var v=new THREE.Line(p,g);v.name="model-"+u,l.add(v)}return s.computeBoundingBox(),l.boundingBox=s.boundingBox,l.BufferGeometry=s,l.name="Cluster Ensemble",l}}function e(t){for(var e,r=0,n=new THREE.Geometry,o=t.length;o>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n}angular.module("TADkit").factory("Cluster",t),t.$inject=["Color"]}(),function(){"use strict";function t(t,e,r,n){return{restrict:"EA",scope:{state:"=",type:"=",title:"@",settings:"=",view:"=",id:"@",clusters:"=",overlay:"=",mousemove:"&"},templateUrl:"assets/templates/scene-clusters.html",link:function(o,a,i){e.load(["TrackballControls","OrbitControls"]).then(function(e){var i,s,c,l,u,d,p,g,f,v=t.getRenderer(),h=[];o.init=function(){i=a[0].children[0].children[3].children[0],s=a.parent().parent()[0],c=s.clientWidth,l=s.clientHeight,v.setSize(c,l),i.appendChild(v.domElement),u=new e.PerspectiveCamera(o.view.viewpoint.fov,l/l,o.view.viewpoint.near,o.view.viewpoint.far),u.position.fromArray(o.view.viewpoint.camera),u.name="Scene Camera",f=new e.TrackballControls(u,v.domElement);var t=new e.Box3,m=new e.Sphere;angular.forEach(o.clusters,function(a,i){h[i]=new e.Scene;var s,c;s=new r(a.data[a.centroidIndex],o.overlay,o.view.settings.particles),s.visible=o.view.settings.particles.visible,h[i].add(s),c=new n(a.data,a.centroidIndex,o.overlay,o.view.settings.cluster),c.visible=o.view.settings.cluster.visible,c.name=c.name+" "+i,h[i].add(c),t.union(c.boundingBox),t.getBoundingSphere(m)}),d=m.center,p=m.center,g=m.radius*o.view.viewpoint.scale,o.lookAtTarget(d,p,g)},o.lookAtTarget=function(t,r,n){t=t||new e.Vector3(5e4,5e4,5e4);var o=new e.Vector3(0,0,0);r=r||o,n=n||500,u.position.set(t.x,t.y,t.z),u.lookAt(o),u.translateZ(n),u.lookAt(r),u.updateMatrixWorld(),f.target.copy(t),f.update()};var m,w=0;o.animate=function(){w>=0&&1>w?(m=requestAnimationFrame(o.animate),f.update(),o.render(),w++):cancelAnimationFrame(m)},o.render=function(){var t,e,r=o.view.settings.cols,n=o.view.settings.rowHeight,a=n.split(":"),i=parseInt(a[0],10)/parseInt(a[1],10),s=parseInt(o.view.settings.gutter),d=1,p=1,g=(r-1)/r,m=1/r,w=s*g,y=c*m-w;t=y,e=t*i,angular.forEach(o.clusters,function(n,o){0===o&&v.clear();var a=h[o];f.update();var i=(y+s)*(d-1),c=l-y*p;v.setViewport(i,c,t,e),v.setScissor(i,c,t,e),v.enableScissorTest(!0),v.setClearColor("#ffffff"),v.render(a,u,null,!0),d===r?(d=1,p++):d++})},angular.element(document).ready(function(){o.init(),o.animate()})})}}}angular.module("TADkit").directive("tkComponentSceneClusters",t),t.$inject=["THREEService","THREEPlugins","Particles","Cluster"]}(),function(){"use strict";function t(t,e,r){return{restrict:"EA",link:function(n,o,a){r.load(["TrackballControls","OrbitControls"]).then(function(r){var a,i,s,c,l,u,d,p,g=e.getRenderer();n.init=function(){a=o[0],i=a.clientWidth,g.setSize(i,i),a.appendChild(g.domElement),c=new r.Scene,s=new r.PerspectiveCamera(50,1,150,650),s.position.z=500,c.add(s),l=new r.TorusKnotGeometry(100,30,100,16),u=new r.MeshDepthMaterial({wireframe:!0}),d=new r.Mesh(l,u),d.name="Floating TAD",c.add(d)},t.$on("$stateChangeStart",function(){cancelAnimationFrame(p)}),n.animate=function(){p=requestAnimationFrame(n.animate),n.render()},n.render=function(){d.rotation.x+=.006,d.rotation.y+=.006,g.render(c,s,null,!0)},n.init(),n.animate()})}}}angular.module("TADkit").directive("tkComponentSceneFloatingtad",t),t.$inject=["$rootScope","THREEService","THREEPlugins"]}(),function(){"use strict";function t(t,r,n){return function(t,r,n){var o={color:"#ff0000",size:200,opacity:.8,map:"assets/img/sphere-glossy.png",depthtest:!0,alphatest:.5,transparent:!0,visible:!1};n=n||{},angular.extend(this,angular.copy(o),n);var a={},i={uniforms:a,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,vertexColors:THREE.VertexColors,transparent:!0},s=new THREE.ShaderMaterial(i),c=t.length/3,l=.5*(c*c-c),u=e(t,l),d=r.RGB,p=r.alpha,g=new THREE.BufferGeometry;g.addAttribute("position",new THREE.BufferAttribute(u,3)),g.addAttribute("color",new THREE.BufferAttribute(d,3)),g.addAttribute("alpha",new THREE.BufferAttribute(p,1)),g.computeBoundingSphere();var f=null;if(this.map){var v=new THREE.TextureLoader;v.load(this.map,function(t){f=t},function(t){console.log(t.loaded/t.total*100+"% loaded")},function(t){console.log("An error happened")})}var h=(new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:f,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),new THREE.LineSegments(g,s));return h.name="Network Graph",h}}function e(t,e){for(var r=new Float32Array(6*e),n=0,o=0;o<t.length;o+=3)for(var a=o,i=o+3;i<t.length;i+=3){var s=i;r[n]=t[a],n++,r[n]=t[a+1],n++,r[n]=t[a+2],n++,r[n]=t[s],n++,r[n]=t[s+1],n++,r[n]=t[s+2],n++}return r.name="Network Vertex Pairs",r}angular.module("TADkit").factory("Network",t),t.$inject=["Color","Particles","Networks"]}(),function(){"use strict";function t(t){return function(r,n,o){var a={particles:0,visible:!0,color:"#fff000",size:200,opacity:.8,map:"particle",depthtest:!0,alphatest:.5,transparent:!0};o=o||{},angular.extend(this,angular.copy(a),o);var i=e(r);i.computeBoundingSphere();for(var s=[],c=0;c<i.vertices.length;c++)s[c]=new THREE.Color("rgb(255,255,255)");i.colors=s;var l=t.get(this.map),u=new THREE.PointsMaterial({color:this.color,vertexColors:THREE.VertexColors,size:this.size,opacity:this.opacity,map:l,depthTest:this.depthtest,alphaTest:this.alphatest,transparent:this.transparent}),d=new THREE.Points(i,u);return d.name="Particles",d}}function e(t){for(var e,r=0,n=new THREE.Geometry,o=t.length;o>r;)e=new THREE.Vector3,e.x=t[r++],e.y=t[r++],e.z=t[r++],n.vertices.push(e);return n.name="Particles Geometry",n}angular.module("TADkit").factory("Particles",t),t.$inject=["THREETextures"]}(),function(){"use strict";function t(t){t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState},t.toggle=function(t){t=!t,console.log(t)}}angular.module("TADkit").controller("SceneController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,r,n,o,a){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",state:"=",currentmodel:"=",proximities:"=",currentoverlay:"="},templateUrl:"assets/templates/scene.html",link:function(i,s,c){r.load(["TrackballControls","OrbitControls"]).then(function(r){var c,l,u,d,p,g,f,v,h,m,w,y,b,x,C,E,j,k,S,T,$=e.getRenderer(),A=new r.Color,R=new r.Color,H=new r.Color("rgb(0,0,0)");i.init=function(){c=s[0].children[0].children[3],l=parseInt(i.state.width),u=parseInt(i.state.height);var t=i.view.settings.background;$.setSize(l,u),c.appendChild($.domElement),h=new r.Scene,m=new r.PerspectiveCamera(i.view.viewpoint.fov,l/u,i.view.viewpoint.near,i.view.viewpoint.far),m.position.fromArray(i.view.viewpoint.camera),m.name="Scene Camera",h.add(m),j=new r.TrackballControls(m,$.domElement),E=new r.OrbitControls(m,$.domElement),E.autoRotate=i.view.controls.autoRotate,E.autoRotateSpeed=i.view.controls.autoRotateSpeed,E.enableZoom=!1,E.enableRotate=!1,E.enablePan=!1,E.enableKeys=!1;var e=new r.AxisHelper(i.view.settings.axis.size);e.visible=i.view.settings.axis.visible,e.name="Axis",h.add(e);var d=i.view.settings.lighting.ambient;x=new r.AmbientLight(d),x.name="Scene Ambient Light",k=new n(i.currentmodel.data,i.currentoverlay.colors.particles,i.view.settings.particles),k.visible=i.view.settings.particles.visible,h.add(k),S=new o(i.currentmodel.data,i.currentoverlay.colors.chromatin,i.view.settings.chromatin),S.visible=i.view.settings.chromatin.visible,h.add(S),i.view.settings.chromatin.radius=S.boundingSphere.radius,T=new a(i.data,i.overlay.colors.network,i.view.settings.network),T.visible=i.view.settings.network.visible,h.add(T),w=S.boundingSphere.center,y=S.boundingSphere.center,b=S.boundingSphere.radius*i.view.viewpoint.scale,i.lookAtTAD(w,y,b);var p=i.view.settings.lighting.color,g=i.view.settings.lighting.intensity;C=new r.PointLight(p,g),C.name="Scene Light",m.add(C);var f=.5*b;C.position.set(f,f,-1*f);var v=100,D=(new r.PointLightHelper(C,v),b*i.view.viewpoint.fogNear),I=b*i.view.viewpoint.fogFar;i.view.viewpoint.fog&&(h.fog=new r.Fog(t,D,I)),i.$watch("view.controls.autoRotate",function(t,e){t!==e&&(E.autoRotate=i.view.controls.autoRotate)}),i.$watch("view.settings.axis.visible",function(t,r){t!==r&&(e.visible=!e.visible)}),i.$watch("view.settings.particles.visible",function(t,e){t!==e&&(k.visible=!k.visible)}),i.$watch("view.settings.chromatin.visible",function(t,e){t!==e&&(S.visible=!S.visible)}),i.$watch("view.settings.network.visible",function(t,e){t!==e&&(T.visible=!T.visible)});var B=h.getObjectByName("Particles Cloud"),P=h.getObjectByName("Chromatin Fiber"),O=h.getObjectByName("Network Graph");i.$watch("currentoverlay.colors.chromatin",function(t,e){if(t!==e)for(var n=P.children.length,o=0;n>o;o++){var a=new r.Color(t[o]);P.children[o].material.color=a,P.children[o].material.ambient=a,P.children[o].material.emissive=a}}),i.$watch("currentoverlay.colors.network",function(t,e){t!==e&&(O.geometry.addAttribute("color",new r.BufferAttribute(t.RGB,3)),O.geometry.addAttribute("alpha",new r.BufferAttribute(t.alpha,1)))}),i.$watch("settings.current.particle",function(t,e){t!==e&&(A&&(B.geometry.colors[e-1]=A),A=B.geometry.colors[t-1],B.geometry.colors[t-1]=H,B.geometry.colorsNeedUpdate=!0)}),i.$watch("settings.current.segment",function(t,e){if(t!==e){var r=P.getObjectByName("segment-"+e);R&&(r.material.color=R,r.material.ambient=R,r.material.emissive=R);var n=P.getObjectByName("segment-"+t);R=n.material.color,n.material.color=H,n.material.ambient=H,n.material.emissive=H}})},i.onWindowResize=function(){i.resizeCanvas()},t.$on("$stateChangeStart",function(){cancelAnimationFrame(v)}),i.resizeCanvas=function(){d=.66*c.parentNode.clientWidth,p=.66*d,g=d/2,f=p/2,m.aspect=d/p,m.updateProjectionMatrix(),$.setSize(d,p)},i.lookAtTAD=function(t,e,n){t=t||new r.Vector3(5e4,5e4,5e4);var o=new r.Vector3(0,0,0);e=e||o,n=n||500,m.position.set(t.x,t.y,t.z),m.lookAt(o),m.translateZ(n),m.lookAt(e),m.updateMatrixWorld(),j.target.copy(t)},i.animate=function(){v=requestAnimationFrame(i.animate),j.update(),i.render()},i.render=function(){$.render(h,m,null,!0)},i.init(),i.animate()})}}}angular.module("TADkit").directive("tkComponentScene",t),t.$inject=["$rootScope","THREEService","THREEPlugins","Particles","Chromatin","Network"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){t.load().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var o,a,i,s,c,l,u,d,p,g,f,v,h,m=r.data,w=r.view.viewpoint.chromStart,y=r.view.viewpoint.chromEnd,b=r.settings.current.particlesCount,x=parseInt(r.view.settings.margin),C={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},E=parseInt(r.view.settings.heightInner),j=(r.view.settings.color,r.overlay.palette[0]),k=r.overlay.palette[1],S=n[0].parentNode,T=n[0].children[0].children[3],$=t.select(T).append("svg");r.$watch(function(){var t=S.clientWidth,e=S.clientHeight;return t+e},function(){r.render(m)}),r.$watch("data.dimension",function(t,e){t!==e&&(m=r.data,r.render(m))}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.getColor=function(t){for(var e=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=e.length-1;n>=0;n--)t==e[n].code&&(r=e[n].color);return r},r.getOpacity=function(t){var e,r=t/5;return e=r*r},r.getStrokeWidth=function(t){var e=10,r=t/5;return e*=r},r.render=function(e){if($.selectAll("*").remove(),e){var n=S.clientWidth-2*x-C.left-C.right,m=E-C.top-C.bottom,T=1*n/b,A=T;o=t.scale.linear().range([0,n]).domain([w,y]).clamp(!0),a=t.scale.linear().domain([-5,5]).range([0,m]),i=t.svg.axis().scale(a).orient("left").ticks(6).outerTickSize(1);var R=2;s=t.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),c=$.attr("width",n+C.left+C.right).attr("height",m+C.top+C.bottom).append("g").attr("transform","translate("+C.left+","+C.top+")").call(s),c.append("g").attr("class","y axis").append("line").attr("y1",a(0)).attr("y2",a(0)).attr("x1",0).attr("x2",n),c.select(".background").attr("y",m/2).attr("height",m),l=c.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",m).style("fill","white"),u=c.append("g").attr("class","focus"),d=u.append("g").attr("class","container").attr("clip-path","url(#clip)"),f=d.append("g").attr("class","harmonics"),v=d.append("g").attr("class","lowerbounds"),p=u.append("g").attr("class","axis y").call(i),g=c.append("g").attr("class","labels"),f.selectAll("rect").data(e.harmonics).enter().append("rect").attr("x",function(t){return t[1]*A}).attr("y",function(t){return a(t[3])}).attr("width",A).attr("height",function(t){return a(t[3])}).style("fill",j).style("stroke",j).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),v.selectAll("rect").data(e.lowerBounds).enter().append("rect").attr("x",function(t){return t[1]*A}).attr("y",function(t){return a(Math.max(0,-1*t[3]))}).attr("width",A).attr("height",function(t){return a(t[3])}).style("fill",k).style("stroke",k).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),h=c.append("rect").attr("id","highlight").attr("x",function(t){return o(r.settings.current.position)}).attr("y",0).attr("width",R).attr("height",E).attr("class","highlight-follow")}},r.update=function(t){$.select("#highlight").attr("x",function(t){return o(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var a=s.extent()[0];t.event.sourceEvent&&(a=parseInt(o.invert(t.mouse(n)[0])),s.extent([a,a])),h.attr("x",o(a)),r.settings.current.position=a,r.settings.current.particle=e.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(m)})}}}angular.module("TADkit").directive("tkComponentTrackBarchart",t),t.$inject=["d3Service","Settings"]}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(e,r,n){t.load().then(function(t){var n,o,a,i,s,c,l,u=e.data,d=e.view.settings.step,p=e.view.viewpoint.chromStart,g=e.view.viewpoint.chromEnd,f=g-p,v=parseInt(e.view.settings.margin),h={top:parseInt(e.view.settings.padding.top),right:parseInt(e.view.settings.padding.right),bottom:parseInt(e.view.settings.padding.bottom),left:parseInt(e.view.settings.padding.left)},m=parseInt(e.view.settings.heightInner),w=.5*m,y=.5*(m-w),b=(e.view.settings.color,r[0].parentNode),x=r[0].children[0].children[3],C=t.select(x).append("svg");e.$watch(function(){var t=b.clientWidth,e=b.clientHeight;return t+e},function(){e.render(u)}),e.$watch("settings.current.position",function(t){e.update()},!0);t.behavior.zoom().on("zoom",function(){e.update()});e.render=function(r){if(C.selectAll("*").remove(),r){var u=b.clientWidth-2*v-h.left-h.right,x=m-h.top-h.bottom;n=d*u/f,l=t.scale.linear().range([0,u]).clamp(!0),l.domain([p,g]),i=t.svg.axis().scale(l).orient("top").ticks(0).outerTickSize(0);var E=2;o=C.attr("width",u+h.left+h.right).attr("height",x+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),a=o.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",u).attr("height",x).style("fill","white"),s=o.append("g").attr("class","focus"),c=s.append("g").attr("class","container").attr("clip-path","url(#clip)");o.append("g").attr("class","labels"),c.selectAll("rect").data(r).enter().append("rect").attr("x",function(t,e){return Math.floor(l(t.start))}).attr("y",y).attr("width",function(t){return Math.ceil(l(t.end)-l(t.start))}).attr("height",w).attr("class",function(t){return 1==t.read?e.title:void 0}).append("svg:title").text(function(t,e){return t.start+":"+t.end+"("+t.read+")"}),o.append("rect").attr("id","highlight").attr("x",function(t){return l(e.settings.current.position-.5*d)}).attr("y",0).attr("width",E).attr("height",m).attr("class","highlight-follow")}},e.update=function(){C.select("#highlight").attr("x",function(t){return l(e.settings.current.position-.5*d)})}})}}}angular.module("TADkit").directive("tkComponentBedgraph",t),t.$inject=["d3Service"]}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(e,r,n){t.load().then(function(t){var n=e.data,o=32e8;e.settings.current.position||(e.settings.current.position=o/2);var a=e.view.viewpoint.chromStart,i=e.view.viewpoint.chromEnd,s=i-a,c=1e3,l=o/s,u=.05*l;l-=2*u;var d,p,g,f,v,h,m=.5*s,w=.5*o,y=parseInt(e.view.settings.margin),b={top:parseInt(e.view.settings.padding.top),right:parseInt(e.view.settings.padding.right),bottom:parseInt(e.view.settings.padding.bottom),left:parseInt(e.view.settings.padding.left)},x=parseInt(e.view.settings.heightInner),C=10,E=r[0].parentNode,j=r[0].children[0].children[3],k=t.select(j).append("svg");e.$watch(function(){var t=E.clientWidth,e=E.clientHeight;return t+e},function(){e.render(n)}),e.$watch("data",function(t,r){t!==r&&e.render(t)}),e.$watch("settings.current.position",function(t,r){t!==r&&e.update()});t.behavior.zoom().on("zoom",function(){e.update()});e.render=function(r){if(k.selectAll("*").remove(),r){var n=E.clientWidth-2*y-b.left-b.right,o=x-b.top-b.bottom;h=t.scale.linear().range([0,n]).clamp(!0),h.domain([a,i]),g=t.svg.axis().scale(h).orient("top").ticks(0).outerTickSize(0);var s=2;h(w)-h(m);d=k.attr("width",n+b.left+b.right).attr("height",o+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),p=d.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",n).attr("height",o).style("fill","white"),f=d.append("g").attr("class","focus"),v=f.append("g").attr("class","container").attr("clip-path","url(#clip)");var l=(f.append("g").attr("class","x axis").attr("transform","translate(0,"+C+")").call(g),d.append("g").attr("class","labels"));l.append("text").attr("x",-18).attr("y",8).style("text-anchor","right").style("font-size","10px").text("<<"),l.append("text").attr("x",-18).attr("y",18).style("text-anchor","right").style("font-size","10px").text(">>");v.selectAll("rect").data(r).enter().append("rect").attr("x",function(t){return Math.floor(h(t.start))}).attr("y",function(t){return e.view.settings.sense&&t.strand<1?C:0}).attr("width",function(t){return Math.ceil(h(t.end)-h(t.start))}).attr("height",function(t){return e.view.settings.sense?C:2*C}).attr("class",function(t){var e=t.biotypeStyle;return e+=t.strand<1?" forward-strand":" reverse-strand"}).append("svg:title").text(function(t){return t.external_name}),d.append("rect").attr("id","highlight").attr("x",function(t){return h(e.settings.current.position-.5*c)}).attr("y",0).attr("width",s).attr("height",x).attr("class","highlight-follow")}},e.update=function(){k.select("g.x.axis").call(g),v.selectAll("rect").attr("x",function(t){return Math.floor(h(t.start))}).attr("y",function(t){return e.view.settings.sense&&t.strand<1?C:0}).attr("width",function(t){return Math.ceil(h(t.end)-h(t.start))}).attr("height",function(t){return e.view.settings.sense?C:2*C}),k.select("#highlight").attr("x",function(t){return h(e.settings.current.position-.5*c)})}})}}}angular.module("TADkit").directive("tkComponentTrackGenes",t),t.$inject=["d3Service"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){t.load().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var o,a,i,s,c,l,u,d,p,g,f=r.data.distances,v=r.view.viewpoint.chromStart,h=r.view.viewpoint.chromEnd,m=r.settings.current.particlesCount,w="clip"+r.title,y="url(#"+w+")",b=parseInt(r.view.settings.margin),x={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},C=parseInt(r.view.settings.heightInner),E=.5*C,j=.5*(C-E),k=r.view.settings.color,S=n[0].parentNode,T=n[0].children[0].children[3],$=t.select(T).append("svg");r.$watch(function(){var t=S.clientWidth,e=S.clientHeight;return t+e},function(){r.render(f)}),r.$watch("data.dimension",function(t,e){t!==e&&(f=r.data.distances,r.render(f))}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.render=function(e){if($.selectAll("*").remove(),e){var n=S.clientWidth-2*b-x.left-x.right,f=C-x.top-x.bottom,T=1*n/m;o=t.scale.linear().range([0,n]).clamp(!0),o.domain([v,h]),a=t.svg.axis().scale(o).orient("top").ticks(0).outerTickSize(0);var A=2;i=t.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),s=$.attr("width",n+x.left+x.right).attr("height",f+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")").call(i),s.select(".background").attr("y",f/2).attr("height",f),c=s.append("defs").append("clipPath").attr("id",w).append("rect").attr("width",n).attr("height",f).style("fill","white"),l=s.append("g").attr("class","focus"),u=l.append("g").attr("class","container").attr("clip-path",y),d=s.append("g").attr("class","labels"),p=u.selectAll("rect").data(e).enter().append("rect").attr("x",function(t,e){return e*T}).attr("y",j).attr("width",T).attr("height",E).style("fill",k).style("fill-opacity",function(t){return t*t}).style("stroke",k).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),g=s.append("rect").attr("id","highlight").attr("x",function(t){return o(r.settings.current.position)}).attr("y",0).attr("width",A).attr("height",C).attr("class","highlight-follow"),g.call(i.extent([r.settings.current.position,0])).call(i.event)}},r.update=function(){$.select("#highlight").attr("x",function(t){return o(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var a=i.extent()[0];t.event.sourceEvent&&(a=parseInt(o.invert(t.mouse(n)[0])),i.extent([a,a])),g.attr("x",o(a)),r.settings.current.position=a,r.settings.current.particle=e.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(f)})}}}angular.module("TADkit").directive("tkComponentTrackProximities",t),t.$inject=["d3Service","Settings"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){t.load().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var o,a,i,s,c,l,u,d,p,g,f,v=r.data,h=r.view.viewpoint.chromStart,m=r.view.viewpoint.chromEnd,w=r.settings.current.particlesCount,y="clip"+r.title,b="url(#"+y+")",x=parseInt(r.view.settings.margin),C={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},E=2,j=parseInt(r.view.settings.heightInner),k=r.view.settings.nodeSize,S=C.top+.5*k,T=(r.view.settings.color,r.overlay.palette[0]),$=r.overlay.palette[1],A=n[0].parentNode,R=n[0].children[0].children[3],H=t.select(R).append("svg");r.$watch(function(){
var t=A.clientWidth,e=A.clientHeight;return t+e},function(){r.render(r.data)}),r.$watch("data.dimension",function(t,e){t!==e&&(v=r.data,r.render(v))}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.getColor=function(t){for(var e=[{type:"harmonic",code:"H",color:"#4CAF50"},{type:"upperBound",code:"L",color:"#0000ff"},{type:"lowerBound",code:"U",color:"#ff00ff"},{type:"contact",code:"C",color:"#00ff00"}],r="#ccc",n=e.length-1;n>=0;n--)t==e[n].code&&(r=e[n].color);return r},r.getOpacity=function(t){var e,r=t/E;return e=r*r},r.getStrokeWidth=function(t){var e=5,r=t/5;return e*=r},r.render=function(e){if(H.selectAll("*").remove(),e){var n=A.clientWidth-2*x-C.left-C.right,v=j-C.top-C.bottom,E=1*n/w;o=t.scale.linear().range([0,n]).clamp(!0),o.domain([h,m]),a=t.svg.axis().scale(o).orient("top").ticks(0).outerTickSize(0),i=t.svg.axis().scale(o).orient("bottom").ticks(0).outerTickSize(0);var R=2;s=t.svg.brush().x(o).extent([0,0]).on("brush",r.brushed),c=H.attr("width",n+C.left+C.right).attr("height",v+C.top+C.bottom).append("g").attr("transform","translate("+C.left+","+C.top+")").call(s),c.select(".background").attr("y",v/2).attr("height",v),l=c.append("defs"),l.append("clipPath").attr("id",y).append("rect").attr("width",n).attr("height",v).style("fill","white"),u=c.append("g").attr("class","focus"),p=u.append("g").attr("class","harmonics").attr("clip-path",b),g=u.append("g").attr("class","lowerbounds").attr("clip-path",b),d=c.append("g").attr("class","labels"),p.append("rect").attr("x",e.dimension*E-E).attr("y",S-.5*k).attr("width",E).attr("height",k).style("fill",T).append("svg:title").text(e.dimension),p.selectAll("line").data(e.harmonics).enter().append("line").attr("x1",function(t){return t[0]*E-.5*E}).attr("y1",S).attr("x2",function(t){return t[1]*E-.5*E}).attr("y2",v-k).attr("marker-end","url(#harmonics-marker)").style("stroke",T).style("opacity",1).style("stroke-width",function(t){return r.getStrokeWidth(t[3])}).append("svg:title").text(function(t){return t[1]+":"+t[3]}),p.selectAll("circle").data(e.harmonics).enter().append("circle").attr("cx",function(t){return t[1]*E-.5*E}).attr("cy",v-k).attr("r",.5*k).style("opacity",function(t){return r.getOpacity(t[3])}).style("fill",T).append("svg:title").text(function(t){return t[0]+" : "+t[1]}),g.append("rect").attr("x",e.dimension*E-E).attr("y",v-1.5*k).attr("width",E).attr("height",k).style("fill",$).append("svg:title").text(e.dimension),g.selectAll("line").data(e.lowerBounds).enter().append("line").attr("x1",function(t){return t[0]*E-.5*E}).attr("y2",S).attr("x2",function(t){return t[1]*E-.5*E}).attr("y1",v-k).attr("marker-end","url(#lowerbounds-marker)").style("stroke",$).style("opacity",function(t){return r.getOpacity(t[3])}).style("stroke-width",function(t){return r.getStrokeWidth(t[3])}).append("svg:title").text(function(t){return t[1]+":"+t[3]}),g.selectAll("circle").data(e.lowerBounds).enter().append("circle").attr("cx",function(t){return t[1]*E-.5*E}).attr("cy",S).attr("r",.5*k).style("opacity",function(t){return r.getOpacity(t[3])}).style("fill",$).append("svg:title").text(function(t){return t[0]+" : "+t[1]}),f=c.append("rect").attr("id","highlight").attr("x",o(r.settings.current.position)).attr("y",0).attr("width",R).attr("height",j).attr("class","highlight-follow")}},r.update=function(t){H.select("#highlight").attr("x",function(t){return o(r.settings.current.position)})},r.brushed=function(){var n=this;r.safeApply(function(){var a=s.extent()[0];t.event.sourceEvent&&(a=parseInt(o.invert(t.mouse(n)[0])),s.extent([a,a])),f.attr("x",o(a)),r.settings.current.position=a,r.settings.current.particle=e.getParticle(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})},r.render(v)})}}}angular.module("TADkit").directive("tkComponentTrackRestraints",t),t.$inject=["d3Service","Settings"]}(),function(){"use strict";function t(t,e){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(r,n,o){t.load().then(function(t){r.safeApply=function(t){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?t&&"function"==typeof t&&t():this.$apply(t)};var o,a,i,s,c,l,u,d,p,g,f=(r.data,r.view.viewpoint.chromStart),v=r.view.viewpoint.chromEnd,h=(r.view.settings.cursorWidth,parseInt(r.view.settings.margin)),m={top:parseInt(r.view.settings.padding.top),right:parseInt(r.view.settings.padding.right),bottom:parseInt(r.view.settings.padding.bottom),left:parseInt(r.view.settings.padding.left)},w=parseInt(r.view.settings.heightInner),y=n[0].parentNode,b=n[0].children[0].children[3],x=t.select(b).append("svg");r.$watch(function(){var t=y.clientWidth,e=y.clientHeight;return t+e},function(){r.render()}),r.$watch("settings.current.position",function(t,e){t!==e&&r.update()}),r.render=function(){x.selectAll("*").remove();var e=y.clientWidth-2*h-m.left-m.right,n=w-m.bottom-m.top;a=t.scale.linear().range([0,e]).clamp(!0),a.domain([f,v]),u=t.svg.axis().scale(a).orient("bottom").ticks(4),i=t.svg.axis().orient("left"),s=t.svg.axis().orient("right"),c=.5*n,l=w,d=t.svg.brush().x(a).extent([0,0]).on("brush",r.brushed),o=x.attr("width",e+m.left+m.right).attr("height",n+m.top+m.bottom).append("g").attr("transform","translate("+m.left+", 0)");var b=o.append("g").attr("class","labels");b.append("text").attr("x",-16).attr("y",26).style("text-anchor","right").style("font-size","10px").text("3'"),b.append("text").attr("x",e+8).attr("y",26).style("text-anchor","left").style("font-size","10px").text("5'");o.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(u).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");o.append("g").attr("class","slider").call(d),o.select(".background").attr("y",n/2).attr("height",n),p=o.append("circle").attr("id","handle").attr("class","handle").attr("cx",a(r.settings.current.position)).attr("cy",n).attr("r",.6*c),g=o.append("text").attr("id","position").attr("x",a(r.settings.current.position)-.5*c).attr("y",n-10).style("text-anchor","bottom").style("font-family","sans-serif").style("font-size","10px").style("color","#333").text(r.settings.current.particle),o.call(d.extent([r.settings.current.position,0])).call(d.event)},r.update=function(t){x.select("#handle").attr("cx",a(r.settings.current.position)),x.select("#position").attr("x",a(r.settings.current.position)-.5*c).text(r.settings.current.particle)},r.brushed=function(){var n=this;r.safeApply(function(){var o=d.extent()[0];t.event.sourceEvent&&(o=parseInt(a.invert(t.mouse(n)[0])),d.extent([o,o])),p.attr("cx",a(o)),r.settings.current.position=o,r.settings.current.particle=e.getParticle(),r.settings.current.segment=e.getSegment(),r.settings.current.segmentLower=r.settings.current.position-5*r.settings.current.segment,r.settings.current.segmentUpper=r.settings.current.position+5*r.settings.current.segment})}})}}}angular.module("TADkit").directive("tkComponentTrackSlider",t),t.$inject=["d3Service","Settings"]}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{type:"=",title:"@",settings:"=",view:"=",data:"=",overlay:"=",toggleoverlay:"&"},templateUrl:"assets/templates/track.html",link:function(e,r,n){t.load().then(function(t){var n,o,a,i,s,c,l,u=e.data,d=e.view.settings.step,p=e.view.viewpoint.chromStart,g=e.view.viewpoint.chromEnd,f=g-p,v=parseInt(e.view.settings.margin),h={top:parseInt(e.view.settings.padding.top),right:parseInt(e.view.settings.padding.right),bottom:parseInt(e.view.settings.padding.bottom),left:parseInt(e.view.settings.padding.left)},m=parseInt(e.view.settings.heightInner),w=.5*m,y=.5*(m-w),b=e.view.settings.color,x=r[0].parentNode,C=r[0].children[0].children[3],E=t.select(C).append("svg");e.$watch(function(){var t=x.clientWidth,e=x.clientHeight;return t+e},function(){e.render(u)}),e.$watch("settings.current.position",function(t){e.update()},!0);t.behavior.zoom().on("zoom",function(){e.update()});e.render=function(r){if(E.selectAll("*").remove(),r){var u=x.clientWidth-2*v-h.left-h.right,C=m-h.top-h.bottom;n=d*u/f,l=t.scale.linear().range([0,u]).clamp(!0),l.domain([p,g]),i=t.svg.axis().scale(l).orient("top").ticks(0).outerTickSize(0);var j=2;o=E.attr("width",u+h.left+h.right).attr("height",C+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),a=o.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",u).attr("height",C).style("fill","white"),s=o.append("g").attr("class","focus"),c=s.append("g").attr("class","container").attr("clip-path","url(#clip)");o.append("g").attr("class","labels"),c.selectAll("rect").data(r).enter().append("rect").attr("x",function(t,e){return(e+1)*n}).attr("y",y).attr("width",n).attr("height",w).style("fill",b).style("fill-opacity",function(t){return t}).style("stroke",b).style("stroke-width",0).append("svg:title").text(function(t,e){return e+":"+t}),o.append("rect").attr("id","highlight").attr("x",function(t){return l(e.settings.current.position-.5*d)}).attr("y",0).attr("width",j).attr("height",m).attr("class","highlight-follow")}},e.update=function(){E.select("#highlight").attr("x",function(t){return l(e.settings.current.position-.5*d)})}})}}}angular.module("TADkit").directive("tkComponentWiggle0",t),t.$inject=["d3Service"]}(),function(){"use strict";function t(t){t.optionsState=!1,t.toggleOptions=function(){t.optionsState=!t.optionsState}}angular.module("TADkit").controller("TrackController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("HomeController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,r,n,o,a,i,s,c){r.settings||(r.settings=n.get()),r.settings.app.isProject=t.is("project"),r.$on("$stateChangeSuccess",function(){r.settings.app.isProject=t.is("project")}),r.users||(r.users=o.get(),"undefined"!=typeof r.users.loaded[0].projects&&0===r.users.loaded[0].projects.length&&(r.users.loaded[0].projects=a.get(),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].datasets&&0===r.users.loaded[0].projects.loaded[0].datasets.length&&(r.users.loaded[0].projects.loaded[0].datasets=i.get()),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].overlays&&0===r.users.loaded[0].projects.loaded[0].overlays.length&&(r.users.loaded[0].projects.loaded[0].overlays=s.get()),"undefined"!=typeof r.users.loaded[0].projects.loaded[0].storyboards&&0===r.users.loaded[0].projects.loaded[0].storyboards.length&&(r.users.loaded[0].projects.loaded[0].storyboards=c.get()))),r.current={},r.current.user=o.getUser(),r.current.project=a.getProject(),r.current.dataset=i.getDataset(),r.current.model=i.getModel(),r.current.overlay=s.getOverlay(),r.current.storyboard=c.getStoryboard()}angular.module("TADkit").controller("MainController",t),t.$inject=["$state","$stateParams","$scope","Settings","Users","Projects","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function t(e,r,n,o,a,i,s,c,l){r.fileTitle="No file loaded",r.$on("$viewContentLoaded",function(){function a(t,e,r){console.log("showing dialog")}var i=angular.element(document.body),s="assets/templates/"+e.current.name+".html";n.show({parent:i,templateUrl:s,controller:t,locals:{overlays:r.$parent.overlays},onComplete:a}).then(function(t){o.show(o.simple().content("Overlays ("+t+") added"))},function(){o.show(o.simple().content("cancelled")),e.go("browser")})}),r.parseFile=function(t){r.fileData=i.parse(t).data,r.selectedRows=[];for(var e=r.fileData.length;--e>=0;)r.selectedRows[e]=!0;r.selectedCols=[];for(var n=r.fileData[0].length;--n>=0;)r.selectedCols[n]=!0;console.log("File Opened...")},r.importData=function(t){r.importedOverlays=i["import"](t,r.selectedRows,r.selectedCols),n.hide(r.importedOverlays.length),e.go("browser")},r.hide=function(){n.hide(r.overlaysAcquired)},r.cancel=function(){n.cancel()}}angular.module("TADkit").controller("OverlayImportController",t),t.$inject=["$state","$scope","$mdDialog","$mdToast","Settings","CustomTracks","Components","Storyboards","uuid4"]}(),function(){"use strict";function t(t){return{restrict:"A",scope:{tkOverlayImport:"&",filetitle:"="},link:function(t,e,r){e.on("change",function(e){var r=new FileReader;r.onload=function(e){t.$apply(function(){t.tkOverlayImport({$fileContent:e.target.result})})},r.readAsText((e.srcElement||e.target).files[0]),t.filetitle=(e.srcElement||e.target).files[0].name})}}}angular.module("TADkit").directive("tkOverlayImport",t),t.$inject=["$parse"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("ProjectContentController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,r,n,o,a){e.clusterComponent=o.getComponentById("dataset-clusters");var i=n.getOverlayById("gradient"),s=e.current.model.data.length/e.current.dataset.object.components,c=a.gradientHCL(i,s);e.clusterComponent.overlay=c;for(var l=new THREE.BufferGeometry,u=e.current.dataset.models.length-1;u>=0;u--)l.addAttribute("position",new THREE.BufferAttribute(e.current.dataset.models[g],3));l.computeBoundingSphere(),e.clusterComponent.view.viewpoint.translate=l.boundingSphere.radius,e.clusters=[];for(var d=e.current.dataset.clusters,p=e.current.dataset.models,g=d.length-1;g>=0;g--){var f={};f.number=g+1,f.list=d[g],f.centroidIndex=f.list.indexOf(r.getCentroid(f.number)),f.data=[];for(var v=f.list.length-1;v>=0;v--){for(var h,m=p.length-1;m>=0;m--){var w=p[m];parseInt(w.ref)==f.list[v]&&(h=w.data)}h?f.data.unshift(h):console.log("Listed model not found!")}e.clusters.unshift(f)}e.selectCluster=function(n){e.clusterArray=r.setCluster(n+1),e.centroidRef=r.getCentroid(),console.log("Current Cluster: "+(n+1)+"(Centroid Model: "+e.centroidRef+")"),t.go("browser")}}angular.module("TADkit").controller("ProjectDatasetController",t),t.$inject=["$state","$scope","Datasets","Overlays","Components","Segments"]}(),function(){"use strict";function t(t,e){return{restrict:"A",link:function(t,r,n){var o=n.dropzone,a=e(o),i=function(t){t.preventDefault(),r.addClass("dragOver")},s=function(t){t.preventDefault(),r.removeClass("dragOver")},c=function(e){var r=new FileReader;r.onload=function(e){t.$apply(function(){a(t,{$fileContent:e.target.result}),t.addDataset(e.target.result)})},r.readAsText(e),console.log("File loaded...")};r.bind("dragover",i).bind("dragleave",s).bind("drop",function(t){s(t),c(t.dataTransfer.files[0])}),t.$watch(o,function(){r.attr("src",a(t))})}}}angular.module("TADkit").directive("tkProjectDropzone",t),t.$inject=["$state","$parse"]}(),function(){"use strict";function t(t,e,r,n,o,a,i){n.updateCurrent=function(){n.current.dataset=o.getDataset(),n.current.model=o.getModel(),n.current.overlay=a.getOverlay(),n.current.storyboard=i.getStoryboard(),console.log("Current dataset, model, overlay and storyboard updated.")},n.loadDatasetFromParam=function(){var a=o.load(r.loadDataset);return t.all([a]).then(function(t){n.updateCurrent(),console.log("Dataset loaded: "+r.loadDataset),e.go("browser")})},r.loadDataset&&n.loadDatasetFromParam(),n.addDataset=function(r){var a=o.add(r);return t.all([a]).then(function(t){n.updateCurrent(),console.log("Dataset added."),e.go("dataset")})}}angular.module("TADkit").controller("ProjectLoaderController",t),t.$inject=["$q","$state","$stateParams","$scope","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function t(t,e){return{restrict:"A",scope:!1,link:function(t,r,n){var o=e(n.tkProjectLoader);r.on("change",function(e){var r=new FileReader;r.onload=function(e){console.log("Data Loaded"),t.$apply(function(){o(t,{$fileContent:e.target.result})})},r.readAsText((e.srcElement||e.target).files[0])})}}}angular.module("TADkit").directive("tkProjectLoader",t),t.$inject=["$state","$parse"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("ProjectOverlayController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("ProjectStoryboardController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e){t.toggleSetting=function(r){t.settings=e.toggle(r)}}angular.module("TADkit").controller("SidebarBrowserController",t),t.$inject=["$scope","Settings"]}(),function(){"use strict";function t(t,e,r,n){t.setCurrentDataset=function(t){e.set(t)},t.setCurrentOverlay=function(t){r.set(t)},t.setCurrentStoryboard=function(t){n.set(t)}}angular.module("TADkit").controller("SidebarProjectController",t),t.$inject=["$scope","Datasets","Overlays","Storyboards"]}(),function(){"use strict";function t(t){}angular.module("TADkit").controller("SidebarUserController",t),t.$inject=["$scope"]}(),function(){"use strict";function t(t,e,r,n,o,a,i,s){angular.element(t).on("resize",function(){e.$apply()}),e.settings.views.scale=1,n.setViewpoint(e.settings.current.chromStart,e.settings.current.chromEnd,e.settings.views.scale),o.setViewpoint(e.settings.current.chromStart,e.settings.current.chromEnd,e.settings.views.scale),e.allProximities=i.get(),e.currentProximities=i.at(e.settings.current.particle),e.currentRestraints=s.at(e.settings.current.particle),angular.forEach(e.current.storyboard.components,function(t,r){var n;"scene"==t.object.type?(t.data=e.current.model.data,t.proximities=e.allProximities,t.overlay=e.current.overlay,t.overlay.state={},t.overlay.object.state.index=a.getCurrentIndex()):"track-genes"==t.object.type||"panel-inspector"==t.object.type?(n=a.getOverlayById("genes"),t.data=n.data,t.overlay=n):"track-proximities"==t.object.type?(t.data=e.currentProximities,n=a.getOverlayById("proximities"),t.overlay=n):"track-restraints"==t.object.type&&(t.data=e.currentRestraints,n=a.getOverlayById("restraints"),t.overlay=n)}),e.$watch("settings.current.particle",function(t,r){t!==r&&(e.currentProximities=i.at(t),e.currentRestraints=s.at(t),"matrix"==e.current.overlay.object.type&&(a.at(t),e.current.overlay=a.getOverlay()))}),e.overlayOrig=e.current.overlay,e.toggleOverlay=function(t){e.overlaid=a.getOverlay(t).object.state.overlaid,e.overlaid?(a.setOverlaid(e.overlayOrig.object.state.index),a.set(e.overlayOrig.object.state.index),e.current.overlay=a.getOverlay()):(a.setOverlaid(t),a.set(t),e.current.overlay=a.getOverlay())},e.optionsState=!1,e.toggleOptions=function(){e.optionsState=!e.optionsState},e.toggle=function(t){t=!t,console.log(t)},e.testfn=function(){console.log("test worked")}}angular.module("TADkit").controller("StoryboardController",t),t.$inject=["$window","$scope","Settings","Storyboards","Components","Overlays","Proximities","Restraints"]}(),function(){"use strict";function t(t,e,r){e.$state=t,t.includes("main.project")&&(e.projectTitle=e.users[0].projects[0].object.title),e.toggleLeft=function(){r("left").toggle()},e.toggleRight=function(){r("right").toggle()}}angular.module("TADkit").controller("TopbarController",t),t.$inject=["$state","$scope","$mdSidenav"]}(),function(){"use strict";function t(t,e,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=t.defer(),o="assets/defaults/tk-defaults-components.json";return n.loaded.length>0?r.resolve(n):e.get(o).success(function(t){n.loaded=t,console.log("Components ("+t.length+") loaded from "+o),r.resolve(n)}),r.promise},add:function(t){t=t||["","","","","","","",[]];var e={metadata:{version:1,type:"component",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],type:t[2],state:{width:t[3],height:t[4],margin:t[5],padding:t[6],position:t[7]}},view:t[8]};return n.loaded.push(e),n.current=n.loaded.length-1,n},remove:function(t){t=t||n.current.index;var e=n.loaded.indexOf(t);return n.loaded.splice(e,1),n},set:function(t){(void 0!==t||t!==!1)&&(n.current.index=t);var e=n.loaded[n.current.index];return e},setViewpoint:function(t,e,r){t=t||0,e=e||4999999;var o=n.loaded;return angular.forEach(o,function(n,o){var a=r||1;if(n.view.viewpoint.chromStart=t,n.view.viewpoint.chromEnd=e,"scene"===n.object.type||"scene-clusters"===n.object.type){var i=n.view.viewpoint.fov/2,s=.6;a=Math.tan(i).toFixed(2)*s}n.view.viewpoint.scale=a}),n},get:function(){return n},getComponent:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t];return e},getComponentById:function(t){var e,r;if(void 0!==t||t!==!1)for(var o=n.loaded.length-1;o>=0;o--)n.loaded[o].object.id===t&&(e=n.loaded[o],r=o);return r||(e=n.loaded[n.current.index],console.log("Component '"+t+"' not found: returning current.")),e},getComponentByType:function(t){var e,r,o;if(void 0!==t||t!==!1)for(var a=n.loaded.length-1;a>=0;a--)n.loaded[a].object.type===t&&(e=n.loaded[a],o=a),"default"===n.loaded[a].object.type&&(r=n.loaded[a]);return o||(e=r,console.log("Component type '"+t+"' not found: returning default.")),e}}}angular.module("TADkit").factory("Components",t),t.$inject=["$q","$http","uuid4"]}(),function(){"use strict";function t(t,e,r,n,o){return{load:function(r,n,o){r=r||"tk-example-dataset",n=n||"tsv","undefined"==typeof o&&(o=!0);var a=this,i=t.defer(),s="defaults";"tk-example-dataset"!=r&&(s="examples");var c="assets/"+s+"/"+r+"."+n;return e.get(c).success(function(t){var e=a["import"](t,[],[],o);console.log("Overlays ("+e.length+") imported from "+c),i.resolve(e)}).error(function(t){console.log("No associated data tracks found.")}),i.promise},"import":function(t,e,r){var a=this;e=e||[],r=r||[];var i,s=n.whatIsIt(t);i="String"==s?a.parse(t).data:t;var c;c=e.length>0&&r.length>0?a.filter(i,e,r):i;var l=a.aquire(c);return o.add(l),l},parse:function(t){Papa.DefaultDelimiter=" ";var e=Papa.parse(t,{dynamicTyping:!0,skipEmptyLines:!0,fastMode:!0});return e},filter:function(t,e,r){for(var n=[],o=e.length,a=r.length,i=0;o>i;i++){var s=[];if(e[i]){for(var c=0;a>c;c++)r[c]&&s.push(t[i][c]);n.push(s)}}return n},aquire:function(t){var e,n,o,a=["#227c4f","#e71818","#8ece0d","#6666ff","#424242"],i=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],s=[],c=0,l=1,u=0,d=1,p=t[c].length,g=t[l][d]-t[l][u]+1,f=t[l+1][d]-t[l+1][u]+1;g==f?(e="wiggle_0",n="fixed",o="fixed"):(e="bedgraph",n="variable",o="variable");var v=!1;if(7==p){for(var h=0,m=2;p>m;m++){var w=t[c][m].toLowerCase();("hp1"==w||"brm"==w||"mrg15"==w||"pc"==w||"h1"==w)&&h++}5==h&&(v=!0)}for(var y=p-1;y>=2;y--){var b;b=v?a[y-2]:i[y],s.unshift({metadata:{version:1,type:"overlay",generator:"TADkit"},object:{uuid:r.generate(),id:t[c][y],title:t[c][y],source:"Research output",url:"local",description:"center_label",type:e,format:n,components:2,name:t[c][y],visibility:"full",color:b,altColor:"#cccccc",priority:"100",stepType:o,chrom:"",start:t[l][u],step:g,state:{index:0,overlaid:!1}},palette:[b,"#cccccc"],data:[],colors:{particles:[],chromatin:[],network:{RGB:[],alpha:[]}}});for(var x=t.length-1;x>=1;x--)"variable"==n?s[0].data.unshift({start:t[x][u],end:t[x][d],read:t[x][y]}):s[0].data.unshift(t[x][y])}return s}}}angular.module("TADkit").factory("CustomTracks",t),t.$inject=["$q","$http","uuid4","Resources","Overlays"]}(),function(){"use strict";function t(t,e,r,n,o,a,i,s,c){var l={loaded:[],current:{index:0,cluster:1,centroid:1}};return{load:function(r,n){r=r||"tk-example-dataset",n=n||!1;var o=this;n&&o.clear();var a="defaults";"tk-example-dataset"!=r&&(a="examples");var i=t.defer(),s="assets/"+a+"/"+r+".json";return e.get(s).success(function(t){t.object.filename=r,o.add(t),i.resolve(l)}),i.promise},add:function(t){var e=this,r=e.validate(t);return l.loaded.push(r),l.current.index=l.loaded.length-1,e.setSpeciesUrl(),e.setRegion(),e.init(r),console.log("Dataset "+r.object.species+" "+r.object.region+" loaded from file."),l},validate:function(t){var e={},r=o.whatIsIt(t);e="String"===r?JSON.parse(t):t;var n=!0;return n?e:void 0},init:function(t){var e=this,r=e.getModel().data;n.set(t),a.set(r),i.set(r,t.restraints),s.update(a.get().distances,t.restraints);var o="tsv",l=!0;c.load(t.object.filename,o,l),console.log("Settings, Proximities, Restraints & Overlays initialized.")},clear:function(){for(;l.loaded.length>0;)l.loaded.shift()},remove:function(t){(void 0===t||t===!1)&&(t=l.current.index);var e=l.loaded.indexOf(t);return l.loaded.splice(e,1),l},setSpeciesUrl:function(t){(void 0===t||t===!1)&&(t=l.current.index);var e=l.loaded[t].object.species,r=e.replace(/[^a-z0-9]/gi,"_").toLowerCase();return l.loaded[t].object.speciesUrl=r,r},setRegion:function(t){(void 0===t||t===!1)&&(t=l.current.index);var e=0;l.loaded[t].object.chromosomeIndex&&(e=l.loaded[t].object.chromosomeIndex);var r=l.loaded[t].object.chrom[e],n=l.loaded[t].object.chromStart[e],o=l.loaded[t].object.chromEnd[e],a=r+":"+n+"-"+o;return l.loaded[t].object.region=a,a},set:function(t){(void 0!==t||t!==!1)&&(l.current.index=t),this.setCluster(l.current.cluster);var e=l.loaded[l.current.index];return e},setCluster:function(t){t=t||1,l.current.cluster=t;var e=this.getCentroid(l.current.cluster);this.setCentroid(e);var r=this.getCluster();return r},setCentroid:function(t){t=t||this.getCentroid(),l.current.centroid=t;var e=this.setModel(l.current.centroid);return e},setModel:function(t){t=t||this.getCentroid();var e=this.getModel(t-1);return l.loaded[l.current.index].data=e,e},get:function(){return l},getDataset:function(t){(void 0===t||t===!1)&&(t=l.current.index);var e=l.loaded[t];return e},getCluster:function(t){t=t||l.current.cluster;var e=l.loaded[l.current.index].clusters[t-1];return e},getCentroid:function(t){t=t||l.current.cluster;var e=l.loaded[l.current.index].centroids[t-1];return e},getModel:function(t){t=t||this.getCentroid();for(var e,r=l.loaded[l.current.index].models,n=r.length-1;n>=0;n--)r[n].ref==t&&(e=r[n]);return e}}}angular.module("TADkit").factory("Datasets",t),t.$inject=["$q","$http","uuid4","Settings","Resources","Proximities","Restraints","Overlays","CustomTracks"]}(),function(){"use strict";function t(t,e,r,n){var o={root:"http://rest.ensemblgenomes.org/",ping:0,assembly:{},featureColors:{},biotypes:{}};return{ping:function(){console.log("Pinging Ensembl RESTful genomic data server...");var r=t.defer(),n=o.root+"info/ping?content-type=application/json";return e.get(n).success(function(t){o.ping=t.ping,console.log("Ensembl RESTful is contactable.")}),r.promise},load:function(n){var o,a=t.defer(),i=r.get(),s=i.current.species,c=i.current.speciesUrl,l=i.current.chrom,u=i.current.chromStart,d=i.current.chromEnd,p=this,g=r.getOnline();return o=g?n.object.url[0]+c+n.object.url[2]+l+n.object.url[4]+u+n.object.url[6]+d+n.object.url[8]:"assets/offline/"+c+"-genes.json",e.get(o).success(function(t){var e=p.setBiotypeStyle(t);n.data=e;var r=l+":"+u+"-"+d,o=g?"Ensembl":"local storage";console.log("Genes for "+s+" "+r+" retreived from "+o+"."),a.resolve(n)}),a.promise},loadBiotypeColors:function(){var r,a=t.defer(),i=!1;return r=i?"https://cdn.rawgit.com/Ensembl/ensembl-webcode/release/75/conf/ini-files/COLOUR.ini":"assets/offline/ensembl-webcode-COLOUR.ini",e.get(r).success(function(t){var e=n.colorsFromIni(t);o.featureColors=e,o.biotypes=e.gene,console.log("Ensembl webcode biotype colors retrieved Ensembl."),a.resolve(e)}),a.promise},setBiotypeStyle:function(t){return angular.forEach(t,function(t,e){var r=t.biotype.toLowerCase();t.biotypeStyle=r}),t},setLengthBP:function(t){var e=0,r=t;for(var n in r)if(r.hasOwnProperty(n))for(var o=0,a=r.length;a>o;o++)e+=r[o].length;return e},get:function(){return o}}}angular.module("TADkit").factory("Ensembl",t),t.$inject=["$q","$http","Settings","Color"]}(),function(){"use strict";function t(t,e,r,n,o,a,i,s,c,l,u,d){return function(){console.log("Loading TADkit...");var p=function(i){var s=e.load(),c=r.load(),l=n.load(),u=o.load(),d=a.loadBiotypeColors();return t.all([s,c,l,u,d]).then(function(t){return t})},g=function(e){var r=i.load(),n=s.load(),o=c.load(),a=l.load(),p=u.load();d.load(e[2].textures);return t.all([r,n,o,a,p]).then(function(t){return t})};return p().then(g)}}angular.module("TADkit").service("initMain",t),t.$inject=["$q","THREEService","d3Service","Settings","Components","Ensembl","Users","Projects","Datasets","Overlays","Storyboards","THREETextures"]}(),function(){"use strict";function t(){return{lineSegmentsRGB:function(t,e){for(var r=this,n=t.data.length,o=new Float32Array(6*e),a=0;n>a;a++){var i=t.data[a][0],s=t.data[a][1],c=6*r.getMatrixIndex(i,s,e),l={r:.5,g:.5,b:.5};if("restraints"==t.object.id){var u={H:"#4CAF50",L:"#0000ff",U:"#ff00ff",C:"#00ff00"};l=r.getFeatureRGB(t.data[a][2],u)}o[c]=l.r,c++,o[c]=l.g,c++,o[c]=l.b,c++,o[c]=l.r,c++,o[c]=l.g,c++,o[c]=l.b}return o.name="Network lineSegments RGB",o},lineSegmentsAlpha:function(t,e){for(var r=this,n=new Float32Array(2*e),o=0,a=n.length-1;a>=0;a--)n[a]=o;if(t.data)for(var i=t.data.length,s=0;i>s;s++){var c=t.data[s][0],l=t.data[s][1],u=r.getMatrixIndex(c,l,e),d=t.data[s][3]*t.data[s][3]/5;n[u]=d,u++,n[u]=d}return n.name="Network lineSegments Alphas",n},getMatrixIndex:function(t,e,r){for(var n=0,o=t-1,a=0;o>=a;a++)n+=r-(r-a);return n+=e-t-1},getFeatureRGB:function(t,e){e=e||{0:"#000000"};var r;return angular.forEach(e,function(e,n){t==n&&(r=new THREE.Color(e))}),r}}}angular.module("TADkit").factory("Networks",t)}(),function(){"use strict";function t(t,e,r,n,o,a,i,s){var c={loaded:[],current:{index:0}};return{load:function(){var r=t.defer(),n="assets/defaults/tk-defaults-overlays.json";return c.loaded.length>0?r.resolve(c):e.get(n).success(function(t){c.loaded=t,console.log("Overlays ("+t.length+") loaded from "+n),r.resolve(c)}),r.promise},add:function(t){var e=this,r=[],n=c.loaded.length-1;return angular.forEach(t,function(t,e){var a=!1;a||(n++,t.object.state.index=n,t.object.state.overlaid=!1,r.push(t),o.addComponent(t))}),c.loaded=c.loaded.concat(r),e.segment(),r},clear:function(){for(;c.loaded.length>0;)c.loaded.shift()},defaults:function(){for(;c.loaded.length>4;)c.loaded.pop(),o.defaultComponents()},remove:function(t){(void 0===t||t===!1)&&(t=c.current.index);var e=c.loaded.indexOf(t);return c.loaded.splice(e,1),c},set:function(t){(void 0!==t||t!==!1)&&(c.current.index=t);var e=c.loaded[c.current.index];return e},setOverlaid:function(t){return t=t||"",angular.forEach(c.loaded,function(e){e.object.state.index===t?e.object.state.overlaid=!0:e.object.state.overlaid=!1}),t},update:function(e,r){var n=this,i=[],s=[];return angular.forEach(c.loaded,function(t,n){if("ensembl"==t.object.type){var o=a.load(t);i.push(o),s.push(t)}"proximities"==t.object.id&&(t.data=e),"restraints"==t.object.id&&(t.data=r)}),t.all(i).then(function(t){for(var e=0;e<s.length;e++)o.update(s[e]);return n.segment(),t})},segment:function(){var t=this,e=n.get();return angular.forEach(c.loaded,function(r,n){var o=!0;if(o){var c=r.object.type,l=r.object.format;if("gradient"==c&&"hex"==l)r.colors.particles=i.gradientHCL(r,e.current.particlesCount),r.colors.chromatin=i.gradientHCL(r,e.current.segmentsCount),r.colors.network.RGB=s.lineSegmentsRGB(r,e.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,e.current.edgesCount);else if("wiggle_0"==c&&"fixed"==l)r.colors.particles=i.bicolor(r,e.current.particlesCount),r.colors.chromatin=i.bicolor(r,e.current.segmentsCount),r.colors.network.RGB=s.lineSegmentsRGB(r,e.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,e.current.edgesCount);else if("wiggle_0"==c&&"variable"==l);else if("bedgraph"==c)r.colors.particles=i.bicolorVariable(r,e.current.chromStart,e.current.particlesCount,1),r.colors.chromatin=i.bicolorVariable(r,e.current.chromStart,e.current.segmentsCount,e.current.segmentLength),r.colors.network.RGB=s.lineSegmentsRGB(r,e.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,e.current.edgesCount);else if("matrix"==c)r.colors.particlesMatrix=i.matrix(r,1),r.colors.chromatinMatrix=i.matrix(r,e.current.particleSegments),r.colors.networkMatrix=r.colors.particlesMatrix,t.at(1,e.current.particlesCount,e.current.particleSegments);else if("misc"==c&&"variable"==l)r.colors.particles=[],r.colors.chromatin=[],r.colors.network.RGB=s.lineSegmentsRGB(r,e.current.edgesCount),
r.colors.network.alpha=s.lineSegmentsAlpha(r,e.current.edgesCount);else if("ensembl"==c&&"json"==l){var u=a.get().biotypes,d=1;r.colors.particles=i.features(r,e.current.chromStart,e.current.particlesCount,d,u),r.colors.chromatin=i.features(r,e.current.chromStart,e.current.segmentsCount,e.current.segmentLength,u),r.colors.network.RGB=s.lineSegmentsRGB(r,e.current.edgesCount),r.colors.network.alpha=s.lineSegmentsAlpha(r,e.current.edgesCount)}}else console.log("Overlay '"+r.object.title+"' already segmented as color array matching current dataset length")}),c},at:function(t){var e=n.get();return angular.forEach(c.loaded,function(r,n){var o=r.object.type;if("matrix"==o){var a=(t-1)*e.current.particlesCount,i=t*e.current.particlesCount,s=a*e.current.particleSegments,c=i*e.current.particleSegments;r.colors.particles=r.colors.particlesMatrix.slice(a,i),r.colors.chromatin=r.colors.chromatinMatrix.slice(s,c),r.colors.network=r.colors.networkMatrix.slice(a,i)}}),c},get:function(){return c},getOverlay:function(t){(void 0===t||t===!1)&&(t=c.current.index);var e=c.loaded[t];return e},getOverlayById:function(t){var e,r;if(void 0!==t||t!==!1)for(var n=c.loaded.length-1;n>=0;n--)c.loaded[n].object.id===t&&(e=c.loaded[n],e.object.state.index=n,r=!0);return r||(e=c.loaded[c.current.index],e.object.state.index=c.current.index,console.log('Overlay "'+t+'" not found: returning current.')),e},getCurrentIndex:function(){return c.current.index}}}angular.module("TADkit").factory("Overlays",t),t.$inject=["$q","$http","uuid4","Settings","Storyboards","Ensembl","Segments","Networks"]}(),function(){"use strict";function t(){return{simple:function(t){for(var e="EnsemblBacteria",r=t.length,n=[],o=0;r-1>o;o++){var a=t[o],i=t[o+1],s=new THREE.Vector3(0,0,0);s.addVectors(a,i).divideScalar(2);var c=new THREE.Vector3(0,0,0);if(c.copy(s).sub(a),0===o&&"EnsemblBacteria"!=e){var l;l=new THREE.Vector3(0,0,0),l.copy(a).sub(c),n.push(l)}if(n.push(s),o==r-2&&"EnsemblBacteria"!=e){var u;u=new THREE.Vector3(0,0,0),u.copy(i).add(c),n.push(u)}}return n},cubic:function(t,e){e=e||!1;var r=1,n=t.length,o={};o.vertices=[],o.colors=[];for(var a=new THREE.Vector3(0,0,0),i=0;n>i;i++){var s=t[i],c=new THREE.Vector3(0,0,0);i==n-1?e?c=t[0]:c.copy(s).addVectors(s,t[i-1]):c=t[i+1];var l=new THREE.Vector3(0,0,0);l.addVectors(s,c).divideScalar(2);var u=new THREE.Vector3(0,0,0);if(u.copy(l).sub(s),0===i)if(e){var d=new THREE.Vector3(0,0,0);d.addVectors(t[n-1],t[0]).divideScalar(2),a.copy(d).sub(t[n-1])}else a.copy(u);var p=new THREE.Vector3(0,0,0);p.copy(s).sub(u);var g=new THREE.Vector3(0,0,0);g.copy(s).add(a);var f=new THREE.Vector3(0,0,0);f.subVectors(g,p).divideScalar(r),p.copy(s).sub(f),g.copy(s).add(f),o.vertices.push(p),o.colors.push(new THREE.Color(13421772)),o.vertices.push(s),o.colors.push(new THREE.Color(0)),o.vertices.push(g),o.colors.push(new THREE.Color(13421772)),a=u}var v=new THREE.Vector3(0,0,0),h=new THREE.Vector3(0,0,0),m=new THREE.Vector3(0,0,0),w=new THREE.Vector3(0,0,0),y=o.vertices.length,b=o.vertices[y-2],x=o.vertices[y-1],C=o.vertices[0],E=o.vertices[1];if(e){var j=new THREE.CubicBezierCurve3(b,x,C,E),k=j.getPointAt(.5),S=j.getTangent(.5).multiplyScalar(1);v.copy(k).sub(S),h.copy(k),m.copy(k).add(S),w.copy(k)}else v.copy(C),h.copy(C),m.copy(x),w.copy(x);return o.vertices.unshift(v),o.colors.unshift(new THREE.Color(16776960)),o.vertices.unshift(h),o.colors.unshift(new THREE.Color(16711680)),o.vertices.push(m),o.colors.push(new THREE.Color(65535)),o.vertices.push(w),o.colors.push(new THREE.Color(255)),o}}}angular.module("TADkit").factory("PathControls",t)}(),function(){"use strict";function t(){return{splineNearFit:function(t,e){var r,n="EnsemblBacteria";return r="EnsemblBacteria"==n?new THREE.ClosedSplineCurve3(t):new THREE.SplineCurve3(t)},spline:function(t,e){var r="NotEnsemblBacteria",n=new THREE.CurvePath,o=t.length;if("EnsemblBacteria"==r)n=new THREE.ClosedSplineCurve3(t);else for(var a=1;o-2>a;a+=3){var i=t[a],s=t[a+1],c=t[a+2],l=t[a+3],u=new THREE.Vector3(0,0,0);u.addVectors(c,s).divideScalar(2);var d=new THREE.SplineCurve3([i,u,l]);n.add(d)}return n},quadraticBezier:function(t,e){var r="NotEnsemblBacteria",n=new THREE.CurvePath,o=t.length;if("EnsemblBacteria"==r)n=new THREE.ClosedSplineCurve3(t);else for(var a=1;o-2>a;a+=3){var i=t[a],s=t[a+1],c=t[a+2],l=t[a+3],u=new THREE.Vector3(0,0,0);u.addVectors(c,s).divideScalar(2);var d=new THREE.QuadraticBezierCurve3(i,u,l);n.add(d)}return n},cubicBezier:function(t,e,r){r=r||!1;for(var n=new THREE.CurvePath,o=t.length,a=0;o-1>a;a+=3){var i=t[a],s=t[a+1],c=t[a+2],l=t[a+3],u=new THREE.CubicBezierCurve3(i,s,c,l);n.add(u)}return n}}}angular.module("TADkit").factory("Paths",t)}(),function(){"use strict";function t(t,e,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=t.defer(),o="assets/defaults/tk-defaults-projects.json";return n.loaded.length>0?r.resolve(n):e.get(o).success(function(t){n.loaded=t,console.log("Projects ("+t.length+") loaded from "+o),r.resolve(n)}),r.promise},add:function(t){var e={metadata:{version:1,type:"project",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],description:t[2],group:t[3],state:t[4]},datasets:t[5],overlays:t[6],storyboards:t[7]};return n.loaded.push(e),n.current=n.loaded.length-1,n},remove:function(t){(void 0===t||t===!1)&&(t=users.current.index);var e=n.loaded.indexOf(t);return n.loaded.splice(e,1),n},set:function(t){(void 0!==t||t!==!1)&&(n.current.index=t);var e=n.loaded[n.current.index];return e},get:function(){return n},getProject:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t];return e},getState:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t].object.state;return e}}}angular.module("TADkit").factory("Projects",t),t.$inject=["$q","$http","uuid4"]}(),function(){"use strict";function t(t){var e={dimension:0,positions:[],distances:[]},r={dimension:0,positions:[],distances:[]};return{set:function(t,r){var n={minDistance:150,maxDistance:400,limitConnections:!0,maxConnections:200};r=r||{},angular.extend(this,angular.copy(n),r),this.maxDistance=this.getMaxDistance(t);var o=0,a=0;e.dimension=t.length/3;for(var i=e.dimension*e.dimension,s=2*i,c=new Float32Array(3*s),l=new Float32Array(i),u=e.dimension-1,d=u;d>=0;d--)for(var p=u;p>=0;p--){var g=t[3*d]-t[3*p],f=t[3*d+1]-t[3*p+1],v=t[3*d+2]-t[3*p+2],h=Math.sqrt(g*g+f*f+v*v);c[o++]=t[3*d],c[o++]=t[3*d+1],c[o++]=t[3*d+2],c[o++]=t[3*p],c[o++]=t[3*p+1],c[o++]=t[3*p+2];var m=1-h/this.maxDistance;l[a++]=m}return e.positions=c,e.distances=l,e},getMaxDistance:function(t){var e=500;return e},at:function(t){r.dimension=t;var n=(t-1)*e.dimension,o=t*e.dimension;return r.positions=e.positions.subarray(2*n*3,2*o*3),r.distances=e.distances.subarray(n,o),r},get:function(){return e},getCurrent:function(){return r}}}angular.module("TADkit").factory("Proximities",t),t.$inject=["$q"]}(),function(){"use strict";function t(){return{whatIsIt:function(t){var e="test".constructor,r=[].constructor,n={}.constructor;return null===t?"null":void 0===t?"undefined":t.constructor===e?"String":t.constructor===r?"Array":t.constructor===n?"Object":"don't know"}}}angular.module("TADkit").factory("Resources",t)}(),function(){"use strict";function t(){var t={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]},e={dimension:0,harmonics:[],lowerBounds:[],upperBounds:[],neighbours:[]};return{set:function(e,r,n){var o={setting:!0};n=n||{},angular.extend(this,angular.copy(o),n),t.dimension=e.length/3;for(var a=0;a<r.length;a++)"H"==r[a][2]&&t.harmonics.push(r[a]),"L"==r[a][2]&&t.lowerBounds.push(r[a]),"U"==r[a][2]&&t.upperBounds.push(r[a]),"C"==r[a][2]&&t.neighbours.push(r[a]);return t},at:function(r){return e.dimension=r,e.harmonics=[],e.lowerBounds=[],e.upperBounds=[],e.neighbours=[],angular.forEach(t,function(t,n){if("dimension"!=n)for(var o=t.length-1;o>=0;o--)if(t[o][0]==r&&e[n].push(t[o]),t[o][1]==r){var a=[];a.push(t[o][1]),a.push(t[o][0]),a.push(t[o][2]),a.push(t[o][3]),e[n].push(a)}}),e},get:function(){return t},getCurrent:function(){return e}}}angular.module("TADkit").factory("Restraints",t)}(),function(){"use strict";function t(t,e){return{gradientHCL:function(t,e){for(var r=[],n=t.palette[0],o=t.palette[1],a=e-1;a>=0;a--){var i=a/e,s=d3.interpolateHcl(n,o)(i);r.push(s)}return r},gradientComponentRGB:function(t,e){var r,n,o,a,i,s,c,l,u,d,p=[],g="0x"+t.palette[0].substring(1),f="0x"+t.palette[1].substring(1);r=g>>16,n=g>>8&255,o=255&g,a=f>>16,i=f>>8&255,s=255&f;for(var v=e-1;v>=0;v--)c=v/e,l=+(c*r+(1-c)*a).toFixed(2),u=+(c*n+(1-c)*i).toFixed(2),d=+(c*o+(1-c)*s).toFixed(2),p.push(l,u,d);return p},bicolor:function(t,e){for(var r=t.palette[0],n=t.palette[1],o=[],a=0;e>a;a++){var i;i=1===t.data[a]?r:n,o.push(i)}return o},matrix:function(t,e){for(var r=t.palette[0],n=t.palette[1],o=[],a=t.data.length-1;a>=0;a--)for(var i=t.data[a],s=1-i*i,c=d3.interpolateHsl(r,n)(s),l=0;e>l;l++)o.push(c);return o},bicolorVariable:function(t,e,r,n){for(var o=t.palette[0],a=t.palette[1],i=t.data,s=[],c=0;r>c;c++){for(var l=a,u=e+n*c,d=u+n,p=i.length,g=0;p>g;g++){var f=i[g].start,v=i[g].end;Math.max(u,f)<=Math.min(d,v)&&(l=1===i[g].read?o:a)}s.push(l)}return s},featureGraph:function(t,r){var n=this.gradientHCL(t,r),o=e.THREEColorsFromHex(n),a=e.vertexColorsFromTHREEColors(o);return a},features:function(t,e,r,n,o){for(var a=t.data,i=[],s=0;r>s;s++){for(var c=[],l=e+n*s,u=l+n,d=a.length,p="cccccc",g="#"+p,f=0;d>f;f++){var v=a[f].start,h=a[f].end,m=[];if(Math.max(l,v)<=Math.min(u,h)){m.push(s);var w="biotype",y="protein_coding";c.length>0&&c[0]==y?c[0]=a[f][w].toLowerCase():c.push(a[f][w].toLowerCase())}a[f].inSegments=m}for(var b=0;b<c.length;b++){var x=c[0];x in o?(p=o[x].match(/[a-f0-9]{6}/gi),g="#"+p):(p="110100",g="#"+p)}i.push(g)}return i}}}angular.module("TADkit").factory("Segments",t),t.$inject=["$q","Color"]}(),function(){"use strict";function t(t,e){var r={};return{load:function(){var n=t.defer(),o="assets/defaults/tk-defaults-settings.json";return Object.getOwnPropertyNames(r).length>0?n.resolve(r):e.get(o).success(function(t){r=t,console.log("Settings loaded from "+o),n.resolve(r)}),n.promise},set:function(t){var e=this,n=0;t.object.chromosomeIndex&&(n=t.object.chromosomeIndex),r.current.chrom=t.object.chrom[n],r.current.chromStart=t.object.chromStart[n],r.current.chromEnd=t.object.chromEnd[n],r.current.species=t.object.species,r.current.speciesUrl=t.object.speciesUrl,r.current.particleSegments=20,r.current.particlesCount=t.models[0].data.length/t.object.components,r.current.edgesCount=.5*(r.current.particlesCount*r.current.particlesCount-r.current.particlesCount),r.current.segmentsCount=r.current.particlesCount*r.current.particleSegments,r.current.segmentLength=t.object.resolution/r.current.particleSegments,r.current.position=r.current.chromStart+parseInt(.5*(r.current.chromEnd-r.current.chromStart)),r.current.particle=e.getParticle(),r.current.segment=e.getSegment(r.current.position),r.current.segmentLower=r.current.position-.5*r.current.segment,r.current.segmentUpper=r.current.position+.5*r.current.segment},add:function(t){return r},remove:function(t){return r},getState:function(t){var e=r[settingID].state;return e},get:function(){return r},getOnline:function(){var t=!1;return r.app&&(t=r.app.online),t},getSegment:function(t){t=t||r.current.position;var e=this,n=e.getRange(r.current.chromStart,t),o=e.getRange(r.current.chromStart,r.current.chromEnd),a=Math.ceil(n*r.current.segmentsCount/o);return a},getParticle:function(t){t=t||r.current.position;var e=this,n=e.getRange(r.current.chromStart,t),o=e.getRange(r.current.chromStart,r.current.chromEnd),a=Math.ceil(n*r.current.particlesCount/o);return a},getRange:function(t,e){for(var r=0,n=t;e>=n;n++)r++;return r},toggle:function(t){return angular.forEach(r,function(e,r){t==e.id&&(e.state=!e.state)}),r}}}angular.module("TADkit").factory("Settings",t),t.$inject=["$q","$http"]}(),function(){"use strict";function t(t,e,r,n,o){var a={loaded:[],current:{index:0}};return{load:function(){var r=t.defer(),n="assets/defaults/tk-defaults-storyboards.json";return a.loaded.length>0?(console.log("if"),console.log("Storyboards already loaded."),r.resolve(a)):e.get(n).success(function(t){a.loaded=t,console.log("Storyboards ("+t.length+") loaded from "+n),r.resolve(a)}),r.promise},add:function(t){t=t||[""];var e={metadata:{version:1,type:"storyboard",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],email:t[2],group:t[3],permissions:t[4]},data:t[5]};return a.loaded.push(e),a.current=a.loaded.length-1,a},addComponent:function(t,e,a){var i=this;e=e||"default",a=a||[];var s=n.get(),c=o.getComponentByType(t.object.type),l=angular.copy(c);l.object.uuid=r.generate(),l.object.id=t.object.id,l.object.title=t.object.id,l.object.dataset=t.object.id,l.view.settings.step=t.object.step,l.view.settings.color=t.object.color,l.view.viewpoint.chromStart=s.current.chromStart,l.view.viewpoint.chromEnd=s.current.chromEnd,l.view.viewpoint.scale=s.views.scale,l.view.viewtype=t.object.type+"-"+t.object.stepType,l.data=t.data,l.overlay=t;var u=i.getStoryboardById(e);return u.components.push(l),l},defaultComponents:function(t){var e=this;t=t||"current";var r;for(r="current"==t?e.getStoryboard():e.getStoryboardById(t);r.components.length>6;)console.log("popping"),a.loaded[a.current.index].components.pop();return a},remove:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=a.loaded.indexOf(t);return a.loaded.splice(e,1),a},removeComponentById:function(t){console.log("component");var e=this;if(void 0!==t||t!==!1){var r=e.getComponentById(t),n=e.getStoryboard();n.components.splice(r.index,1),console.log(r)}return a},set:function(t){(void 0!==t||t!==!1)&&(a.current.index=t);var e=a.loaded[a.current.index];return e},setViewpoint:function(t,e,r){t=t||0,e=e||4999999;var n=a.loaded[a.current.index].components;return angular.forEach(n,function(n,o){var a=r||1;if(n.view.viewpoint.chromStart=t,n.view.viewpoint.chromEnd=e,"scene"===n.object.type||"scene-clusters"===n.object.type){var i=n.view.viewpoint.fov/2,s=.6;a=Math.tan(i).toFixed(2)*s}n.view.viewpoint.scale=a}),a},update:function(t){var e=this,r=e.getStoryboard().components;angular.forEach(r,function(e,r){("track-genes"==e.object.type||"panel-inspector"==e.object.type)&&(e.data=t.data,e.overlay=t)})},get:function(){return a},getStoryboard:function(t){(void 0===t||t===!1)&&(t=a.current.index);var e=a.loaded[t];return e},getStoryboardById:function(t){var e,r;if(void 0!==t||t!==!1)for(var n=a.loaded.length-1;n>=0;n--)a.loaded[n].object.id===t&&(e=a.loaded[n],e.index=n,r=!0);return r||(e=a.loaded[a.current.index],e.index=a.current.index,console.log("Storyboard '"+t+"' not found: returning current.")),e},getComponentById:function(t){var e,r,n=this,o=n.getStoryboard().components;if(void 0!==t||t!==!1)for(var a=o.length-1;a>=0;a--)console.log(o[a].object.title),o[a].object.title===t&&(e=o[a],e.index=a,r=!0,console.log("Component '"+t+"' found!"));return r||(e=o[0],console.log("Component '"+t+"' not found: returning first.")),e}}}angular.module("TADkit").factory("Storyboards",t),t.$inject=["$q","$http","uuid4","Settings","Components"]}(),function(){"use strict";function t(t){var e={loaded:[]};return{load:function(r){console.log(r);var n=this,o=[];return angular.forEach(r,function(t,r){for(var a=!0,i=e.loaded.length-1;i>=0;i--)e.loaded[r]==t&&(a=!1);if(a){var s=n.add(t);o.push(s)}}),t.all(o).then(function(t){return t.length>0&&console.log("Images loaded: "+t),t})},add:function(t){console.log("Texture added!")},remove:function(t){console.log("Texture removed!")}}}angular.module("TADkit").factory("Textures",t),t.$inject=["$q"]}(),function(){"use strict";function t(t,e,r){var n={loaded:[],current:{index:0}};return{load:function(){var r=t.defer(),o="assets/defaults/tk-defaults-users.json";return n.loaded.length>0?r.resolve(n):e.get(o).success(function(t){n.loaded=t,console.log("Users ("+t.length+") loaded from "+o),r.resolve(n)}),r.promise},add:function(t){t=t||["id","Name Surname","email@company.com","Group","edit",["default"]];var e={metadata:{version:1,type:"user",generator:"TADkit"},object:{uuid:r.generate(),id:t[0],title:t[1],email:t[2],group:t[3],permissions:t[4]},projects:t[5]};return n.loaded.push(e),n.current=n.loaded.length-1,n},remove:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded.indexOf(t);return n.loaded.splice(e,1),n},set:function(t){(void 0!==t||t!==!1)&&(n.current.index=t);var e=n.loaded[n.current.index];return e},get:function(){return n},getUser:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t];return e},getPermissions:function(t){(void 0===t||t===!1)&&(t=n.current.index);var e=n.loaded[t].permissions;return e}}}angular.module("TADkit").factory("Users",t),t.$inject=["$q","$http","uuid4"]}();